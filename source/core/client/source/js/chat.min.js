function MediaCall(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}function t(e){return"[object Object]"===Object.prototype.toString.call(e)}function n(e){e&&("connected"!==e.iceConnectionState&&"completed"!==e.iceConnectionState||e.getStats(null).then(function(e){var t=null,n=null;Object.keys(e).forEach(function(n){var o=e[n];("candidatepair"===o.type&&o.selected||"googCandidatePair"===o.type&&"true"===o.googActiveConnection)&&(t=o)}),t&&t.remoteCandidateId&&Object.keys(e).forEach(function(o){var i=e[o];"remotecandidate"===i.type&&i.id===t.remoteCandidateId&&(n=i)}),n&&n.ipAddress&&n.portNumber&&console.log("[onIceStateChange]: Remote address changed to "+n.ipAddress+":"+n.portNumber)}))}function o(e){if(w&&w.stream){var t=p||document.createElement("video");t.className="VideoCaller",t.autoplay=!0,t.srcObject=w.stream,m[e]=t,y=!0}console.log("AssignStream iceConnectionState: "+g.iceConnectionState),console.log(w)}function i(e,a){var r=!a;if(g=d[e]||new RTCPeerConnection(b),console.log(JSON.stringify(b)),!d[e]){if(d[e]=g,g.oniceconnectionstatechange=function(t){console.log("ICE connection state change: "+t.target.iceConnectionState),"disconnected"===g.iceConnectionState?v=c.restoreCall:"closed"===g.iceConnectionState&&c.iceClosed?c.iceClosed():"failed"===g.iceConnectionState?(v=c.restoreCall,c.restoreCall||s("Error: ICE Connection State FAILED!",1)):"connected"!==g.iceConnectionState&&"completed"!==g.iceConnectionState||!c.showMedia||(clearTimeout(f),n(g,t),v||c.showMedia.apply(null,[m[e]]),v=!1,y||o(e)),v&&setTimeout(function(){i(e)},500)},g.onicecandidateerror=function(e){s("OnIceCandidateError: "+JSON.stringify(e),1)},g.onicecandidate=function(t){t.candidate&&(console.log("OUTGOING ICE: "+t.candidate.candidate),c.sendCandidate(e,c.MID,JSON.stringify(t.candidate)))},g.onaddstream=function(e){w=e,console.log("Get Remote Stream complete!")},c.useVideo){if("[object String]"===Object.prototype.toString.call(_)&&(_=document.getElementById(_)),-1===["[object HTMLVideoElement]","[object HTMLAudioElement]"].indexOf(Object.prototype.toString.call(_)))return c.hangUp('"mirrorContainer" is not a HTML element!'),!1;l&&(_.srcObject=l)}l&&g.addStream(l)}return console.log("ICE  GatheringState: "+g.iceGatheringState),console.log("ICE ConnectionState: "+g.iceConnectionState),r?g.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1,iceRestart:v}).then(function(t){g.setLocalDescription(t),c.sendOffer(e,c.MID,JSON.stringify(t))},function(e){c.hangUp("CreateOffer: "+JSON.stringify(e))}):(t(a)||(a=JSON.parse(a)),g.setRemoteDescription(new RTCSessionDescription(a)),g.createAnswer(function(t){g.setLocalDescription(t),c.sendAnswer(e,c.MID,JSON.stringify(t))},function(e){c.hangUp("CreateAnswer: "+JSON.stringify(e))})),g}function s(){clearTimeout(f),c.onError&&c.onError.apply(null,arguments)}function a(e){C||c.useVideo?l?e():c.hangUp("No media devices"):navigator.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:"screen:0:0",minWidth:160,minHeight:120,maxWidth:1920,maxHeight:1080,minFrameRate:5,maxFrameRate:15}}},function(t){var n=t.getVideoTracks()[0];l?l.addTrack(n):l=t,n.enabled=c.Share,e()},function(t){console.warn("Error getting screen stream: "+JSON.stringify(t)),l?e():c.hangUp("No media devices")})}function r(e){if(l)e();else{var t={audio:{optional:[].concat(h&&h.microphone?{sourceId:h.microphone}:[])},video:!!c.useVideo&&{mandatory:{minWidth:160,maxWidth:1280,minHeight:120,maxHeight:720,minAspectRatio:4/3,maxAspectRatio:16/9,minFrameRate:10,maxFrameRate:50},optional:[].concat(c.useVideo&&h.camera?{sourceId:h.camera}:[])}};console.log("GetMedia config: "+JSON.stringify(t)),f=setTimeout(function(){c.onFailedInit&&c.onFailedInit(),f=null,r(e)},c.initFailTime),navigator.getUserMedia(t,function(t){console.log("getUserMedia: Media stream get successfully"),(l=t)||console.warn("Getting empty stream!"),a(e)},function(t){l=null,"NotFoundError"===t.name&&c.Share?a(e):S?c.hangUp("Error getting media stream: "+JSON.stringify(t)):e()})}}var c=this,l=null,d={},m={},u=null,f=null,g=null,_=null,p=null,h={},v=!1,C="file:"!==location.protocol,S=!1,b={iceTransportPolicy:"all",iceTransport:"all",iceServers:[]},w=null,y=!1;this.onFailedInit=null,this.onError=null,this.sendAnswer=null,this.sendOffer=null,this.sendCandidate=null,this.showMedia=null,this.iceClosed=null,this.restoreCall=!1,this.useVideo=!1,this.MID=null,this.initFailTime=95e3,this.Share=!1,this.receiveScreen=!1,this.addIceServers=function(e,t){b.iceServers=e||[],b.iceTransportPolicy=t||"all",b.iceTransport=t||"all"},this.setDevices=function(e,n,o){h=t(e)?{microphone:e.microphome,camera:e.camera,sound:e.sound}:{microphone:e,camera:n,sound:o},console.log("DEVICES:"+JSON.stringify(h))},this.setMirror=function(e){_=e},this.setCallee=function(e){p="[object String]"===Object.prototype.toString.call(e)?document.getElementById(e):e,-1===["[object HTMLVideoElement]","[object HTMLAudioElement]"].indexOf(Object.prototype.toString.call(p))&&c.hangUp('"calleeContainer" is not a HTML element!')},this.recvAnswer=function(e){console.log("RECEIVE ANSWER"),t(e.SDP)||(e.SDP=JSON.parse(e.SDP)),d[e.UIN]&&d[e.UIN].setRemoteDescription?d[e.UIN].setRemoteDescription(new RTCSessionDescription(e.SDP)):c.hangUp('error in "RECEIVE ANSWER"')},this.recvOffer=function(e){console.log("RECEIVE OFFER"),S=!1,r(function(){i(e.UIN,e.SDP)})},this.recvCandidate=function(e){console.log("RECEIVE CANDIDATE"),d[e.UIN]&&d[e.UIN].addIceCandidate&&(t(e.CANDIDATE)||(e.CANDIDATE=JSON.parse(e.CANDIDATE)),d[e.UIN].addIceCandidate(new RTCIceCandidate(e.CANDIDATE))),console.log("INCOMING ICE:"+JSON.stringify(e.CANDIDATE))},this.recvReady=function(t){console.log("RECEIVE READY"),g=null,(u=t||u)&&(S=!0,r(function(){u&&(e(u)||(u=u.toString().split(",")),u.forEach(function(e){i(e)}))}))},this.restartIceNow=function(){v=!0,i(e(u)?u[0]:u)},this.CallToUser=function(e){u=e},this.switchCamera=function(){var e=l?l.getVideoTracks():[];return e.length&&(e[0].enabled=!e[0].enabled),!(!e||!e[0])&&e[0].enabled},this.switchMicrophone=function(){var e=l?l.getAudioTracks():[];return e.length&&(e[0].enabled=!e[0].enabled),!(!e||!e[0])&&e[0].enabled},this.hangUp=function(e){if(console.log("Hang Up Call"),l){try{_.pause(),_.srcObject=null}catch(e){}l.getTracks&&l.getTracks().forEach(function(e){e.stop()})}else c.iceClosed&&c.iceClosed();for(var t in m);try{m[t].pause(),m[t].srcObject.getTracks().forEach(function(e){e.stop()})}catch(e){}for(var t in d)d[t].close(),d[t]=null;d={},m={},l=null,u=null,c.MID=null,w=null,y=!1,clearTimeout(f),f=null,e&&s(e),S=!1}}function CallStates(){function e(e){return"[object Array]"===Object.prototype.toString.call(e)}var t=0,n=null,o=this;this.list={free:0,outgoing_call_try:1,outgoing_call_busy:2,outgoing_call_rejected:3,outgoing_call_accepted:4,outgoing_call_cancelled:5,outgoing_call_cancelled_by_timeout:6,outgoing_call_remote_error:7,outgoing_call_my_error:8,outgoing_call_started:9,outgoing_call_my_close:10,outgoing_call_remote_close:11,incoming_call_try:101,incoming_call_busy:102,incoming_call_rejected:103,incoming_call_accepted:104,incoming_call_cancelled:105,incoming_call_cancelled_by_timeout:106,incoming_call_remote_error:107,incoming_call_my_error:108,incoming_call_started:109,incoming_call_my_close:110,incoming_call_remote_close:111},this.setStateEvent=function(o,i){t=o,console.log("State changed to: "+o),n&&n.apply(t,e(i)?i:[i])},this.setUniversalStateEvent=function(e){n=e},this.currentState=function(){return t},this.setCustomCallEvent=function(e){t=e,console.log("State changed to: "+e)},this.clearState=function(){t=o.list.free,o.isMyCall=!1,console.log("Clear State: "+t)},this.isMyCall=!1}function mcPlaySound(e){function t(e){a=e;try{i[e].play().catch(function(){}),i[e].onended=i[e].onended||function(){this.onended=null,this.sndIdx===a&&(a=null)},i[a].onpause=i[a].onpause||function(){this.onpause=null,this.sndIdx===a&&(a=null)}}catch(e){}}var n="file:"!==location.protocol,o={Call:1,Receive:2,Reject:3,Busy:4,End:5,Private:6,ConfMsg:7,JoinConf:8,LeaveConf:9,EnterBtn:10,Typing:11,DeleteAct:12,BBS:13},i={},s=this,a=null;this.snd=o,this.Sounds=o,this.Play=function(n,o){!e.isWebClient&&mcConst.ClientSettings.SoundsAllSoundsOff||(i[n]?(o?i[n].currentTime=0:a&&s.Stop(a),t(n)):console.warn("Sound idx: "+n+" is not defined"))},this.PlaySound=this.Play,this.Stop=function(e){if(e)if(i[e])try{i[e].pause(),i[e].currentTime=0}catch(e){}else console.warn("Sound idx: "+e+" is not defined");else for(var t in i)if(i[t])try{i[t].pause(),i[t].currentTime=0}catch(e){}},function(){var e="";if(n)e='<audio id="Sound_Ring"      preload loop><source src="source/media/mediaincomingcall.mp3" type="audio/mpeg"></audio><audio id="Sound_Calling"   preload loop><source src="source/media/mediacall.mp3" type="audio/mpeg"></audio><audio id="Sound_End"       preload><source src="source/media/mediaendcall.mp3" type="audio/mpeg"></audio><audio id="Sound_Reject"    preload><source src="source/media/mediacallreject.mp3" type="audio/mpeg"></audio><audio id="Sound_Busy"      preload><source src="source/media/mediabusy.mp3" type="audio/mpeg"></audio><audio id="Sound_Private"   preload><source src="source/media/private.mp3" type="audio/mpeg"></audio><audio id="Sound_EnterBtn"  preload><source src="source/media/chatret.mp3" type="audio/mpeg"></audio><audio id="Sound_Typing"    preload><source src="source/media/chattype.mp3" type="audio/mpeg"></audio><audio id="Sound_JoinConf"  preload><source src="source/media/join.mp3" type="audio/mpeg"></audio><audio id="Sound_ConfMsg"   preload><source src="source/media/chat.mp3" type="audio/mpeg"></audio><audio id="Sound_DeleteAct" preload><source src="source/media/chatbs.mp3" type="audio/mpeg"></audio><audio id="Sound_LeaveConf" preload><source src="source/media/leave.mp3" type="audio/mpeg"></audio>';else{var t=require("../service/profile").getProfilePath()+"/sounds/";e='<audio id="Sound_BBS"       preload><source src="'+t+'newmsg.mp3" type="audio/mpeg"></audio><audio id="Sound_Ring"      preload loop><source src="'+t+'mediaincomingcall.mp3" type="audio/mpeg"></audio><audio id="Sound_Calling"   preload loop><source src="'+t+'mediacall.mp3"  type="audio/mpeg"></audio><audio id="Sound_End"       preload><source src="'+t+'mediaendcall.mp3"    type="audio/mpeg"></audio><audio id="Sound_Reject"    preload><source src="'+t+'mediacallreject.mp3" type="audio/mpeg"></audio><audio id="Sound_Busy"      preload><source src="'+t+'mediabusy.mp3" type="audio/mpeg"></audio><audio id="Sound_ConfMsg"   preload><source src="'+t+'chat.mp3"      type="audio/mpeg"></audio><audio id="Sound_JoinConf"  preload><source src="'+t+'join.mp3"      type="audio/mpeg"></audio><audio id="Sound_LeaveConf" preload><source src="'+t+'leave.mp3"     type="audio/mpeg"></audio><audio id="Sound_EnterBtn"  preload><source src="'+t+'chatret.mp3"   type="audio/mpeg"></audio><audio id="Sound_Typing"    preload><source src="'+t+'chattype.mp3"  type="audio/mpeg"></audio><audio id="Sound_DeleteAct" preload><source src="'+t+'chatbs.mp3"    type="audio/mpeg"></audio><audio id="Sound_Private"   preload><source src="'+t+'private.mp3"   type="audio/mpeg"></audio>'}document.body.insertAdjacentHTML("beforeEnd",e),i[o.Call]=document.getElementById("Sound_Ring"),i[o.Receive]=document.getElementById("Sound_Calling"),i[o.Reject]=document.getElementById("Sound_End"),i[o.Busy]=document.getElementById("Sound_Reject"),i[o.End]=document.getElementById("Sound_Busy"),i[o.Private]=document.getElementById("Sound_Private"),i[o.JoinConf]=document.getElementById("Sound_JoinConf"),i[o.LeaveConf]=document.getElementById("Sound_LeaveConf"),i[o.EnterBtn]=document.getElementById("Sound_EnterBtn"),i[o.Typing]=document.getElementById("Sound_Typing"),i[o.ConfMsg]=document.getElementById("Sound_ConfMsg"),i[o.DeleteAct]=document.getElementById("Sound_DeleteAct"),i[o.Call].sndIdx=o.Call,i[o.Receive].sndIdx=o.Receive,i[o.Reject].sndIdx=o.Reject,i[o.Busy].sndIdx=o.Busy,i[o.End].sndIdx=o.End,i[o.Private].sndIdx=o.Private,i[o.JoinConf].sndIdx=o.JoinConf,i[o.LeaveConf].sndIdx=o.LeaveConf,i[o.EnterBtn].sndIdx=o.EnterBtn,i[o.Typing].sndIdx=o.Typing,i[o.ConfMsg].sndIdx=o.ConfMsg,i[o.DeleteAct].sndIdx=o.DeleteAct,n||(i[o.BBS]=document.getElementById("Sound_BBS"),i[o.BBS].sndIdx=o.BBS)}()}function Create_cPanel(e,t,n,o){function i(e){function t(e){var t=e%60,n=parseInt(e/3600),o=parseInt(e/60)-60*n;return(n<10?"0"+n:n)+":"+(o<10?"0"+o:o)+":"+(t<10?"0"+t:t)}var n=0,o=null;this.Start=function(){o=setInterval(function(){e.innerText=t(n++)},1e3)},this.Stop=function(){return clearInterval(o),console.log("Stop timer, Now: "+n),n||0}}function s(){l?(clearTimeout(d),d=setTimeout(function(){l=!1,d=null,g.out()},4e3)):(g.in(),l=!0)}var a=this,r=!1,c=!1,l=!1,d=null,m=document.createElement("div"),u=null,f={cameraSwitch:document.createElement("span"),microphoneSwitch:document.createElement("span"),cancelCall:document.createElement("span"),fillFitScreen:document.createElement("span"),minMaxScreen:document.createElement("span"),callTime:document.createElement("div")},g=new mcService.FadeControl(m);m.id="cPanel",f.cameraSwitch.id="cameraSwitch",f.microphoneSwitch.id="microphoneSwitch",f.cancelCall.id="cancelCall",f.fillFitScreen.id="fillFitScreen",f.minMaxScreen.id="minMaxScreen",f.callTime.id="callTime",f.cameraSwitch.style.display=t?"inline-block":"none",f.fillFitScreen.style.display=n?"inline-block":"none",f.minMaxScreen.style.display=t||n?"inline-block":"none",f.callTime.innerText="00:00:00",m.appendChild(f.cameraSwitch),m.appendChild(f.microphoneSwitch),m.appendChild(f.fillFitScreen),m.appendChild(f.minMaxScreen),m.appendChild(f.cancelCall),m.appendChild(f.callTime),f.cameraSwitch.addEventListener("click",function(){e.switchCamera()?f.cameraSwitch.className="":f.cameraSwitch.className="cameraSwitchOFF"}),f.microphoneSwitch.addEventListener("click",function(){e.switchMicrophone()?f.microphoneSwitch.className="":f.microphoneSwitch.className="microphoneSwitchOFF"}),f.fillFitScreen.addEventListener("click",function(){a.fitFill&&a.fitFill(r,o),f.fillFitScreen.className=r?"":"fillFitScreenOFF",r=!r}),f.minMaxScreen.addEventListener("click",function(){a.minMax&&a.minMax(c),c=!c}),f.cancelCall.addEventListener("click",function(){a.closeCall&&a.closeCall()}),this.body=m,this.closeCall=null,this.minMax=null,this.fitFill=null,this.init=function(e){e&&e.appendChild(m),u=new i(f.callTime)},this.show=function(){m.className+="whitePanelBG",m.style.opacity=1,l=!0,s(),u.Start()},this.onmousemove=s,this.destructor=function(){m&&(m.innerHTML="",m.parentNode&&m.parentNode.removeChild(m),m=null),u&&(u.Stop(),u=null)}}function mcConnect(e){var t=require("electron").ipcRenderer,n=this,o={CallBackFunctionPull:{},idError:0,AjaxInProgress:!1,_Timeout:3e4,CRLF:"\r\n",CR:"\r",LF:"\n"};n.asyncType=!0,n.NoCMD=!1,n.CallBackNoCMD=null,n.LeaveCallBacks=!1;var i=function(){clearTimeout(o.idError),o.idError=0};t.on("scPostParser",function(e,t){i(),o.AjaxInProgress=!1,r(t)});var s=function(e){t.send("csPostParser",e)},a=function(e){return setTimeout(function(){console&&console.error("AHTUNG! Reload page."),o.CallBackFunctionPull={},o.AjaxInProgress=!1,n.OnError&&n.OnError("error")},e)};n.SendDataToServer=function(e){var t="",i={};if(!e||0===e.length)return console&&console.warn("SendDataToServer: _data is empty or undefined"),n.OnWarning&&n.OnWarning({type:"noSendData",cmd:e?e.CMD:void 0}),1;switch(typeof e){case"string":t=e;break;case"object":if(""===(i=mcService.Marge({CMD:"",Data:"",OnReceive:void 0,Terminator:"\r",AfterSend:void 0},e||{})).Data)return console.warn('SendDataToServer: [_data : Object] field "Data" is empty or undefined'),2;"[object Object]"===Object.prototype.toString.call(i.Data)&&(i.Data=JSON.stringify(i.Data)),t=(""!==i.CMD?i.CMD+i.Terminator:"")+i.Data,""!==i.CMD&&i.OnReceive&&n.SetCallBackFunctionByCMD(i.CMD,i.OnReceive)}if(i.immediately)s(t);else var r=setInterval(function(){!1===o.AjaxInProgress&&(o.AjaxInProgress=!0,o.idError=a(o._Timeout+2e3),s(t),n.ExtendedCallBackFunctionAtSandData&&n.ExtendedCallBackFunctionAtSandData.apply(),clearInterval(r))},100)};var r=function(e){var t=e.indexOf(o.CR);-1===t&&(t=e.length);var i=e.slice(0,t),s=e.slice(t+1,e.length+1);n.NoCMD?n.CallBackNoCMD.apply(e):n.RunCallBackFunctionByCMD(i,s)};n.OnError=void 0,n.OnWarning=void 0,n.SetCallBackFunctionByCMD=function(e,t){t&&(o.CallBackFunctionPull.hasOwnProperty(e)||(o.CallBackFunctionPull[e]=[]),o.CallBackFunctionPull[e].push(t))},n.SetCallBackFunctionByCMDOnlyOne=function(e,t){t&&(o.CallBackFunctionPull[e]=[],o.CallBackFunctionPull[e][0]=t)},n.DelCallBackFunctionByCMD=function(e){o.CallBackFunctionPull.hasOwnProperty(e)&&delete o.CallBackFunctionPull[e]},n.ClearAllCallBackFunctionByCMD=function(){for(var e in o.CallBackFunctionPull)o.CallBackFunctionPull.hasOwnProperty(e)&&delete o.CallBackFunctionPull[e]},n.RunCallBackFunctionByCMD=function(e,t){var i=!!o.CallBackFunctionPull.hasOwnProperty(e)&&o.CallBackFunctionPull[e].length>0;for(i||("OK"!==e&&"ping"!==e&&console.warn('CMD: "'+e+'" not have request func'),n.OnWarning&&n.OnWarning({type:"NoRunCallback",cmd:e}));i;)o.CallBackFunctionPull[e]&&o.CallBackFunctionPull[e][0].apply(t),n.LeaveCallBacks?i=!1:(o.CallBackFunctionPull[e].shift(),0===o.CallBackFunctionPull[e].length&&delete o.CallBackFunctionPull[e],i=!!o.CallBackFunctionPull.hasOwnProperty(e)&&o.CallBackFunctionPull[e].length>0)},n.ExtendedCallBackFunctionAtSandData=void 0}function mcCmdLoop(e,t){function n(e,o){var i=[].concat(e),s=i.length;if(o&&console.log("InBuf:\n"+e),s>0){o&&(console.log("RunCMD, inBuf Length:"+s),console.log("_inBuf:\n"+i));var a=i.shift();if(a&&a.length>0){a=mcService.StringToObj(a);for(var r in a)o&&console.log("Receive CMD: "+r),function(e,n){o&&(console.log("Receive CMD: "+e),console.log(n)),setTimeout(function(){t.ProcessCMD([e,n])},0)}(r,a[r]);i.length>0&&n(i)}}}function o(e){t.SendCMDToServer([mcConst._CMD_.Ping,e])}return window.idMcPingTimer=null,function(t,i,s){var a=this,r=s||{onError:null,onStop:null,onWarn:null};e.ClearAllCallBackFunctionByCMD(),e.LeaveCallBacks=!0,e.SetCallBackFunctionByCMD(mcConst._CMD_.Ping,function(){"{}"!=this&&this.length>0&&n(this.split("\r"))}),window.idMcPingTimer=function(e){return setInterval(function(){o(e)},t)}(i),a.StopPingTimer=function(){null!==window.idMcPingTimer&&(clearInterval(window.idMcPingTimer),window.idMcPingTimer=null,e.ClearAllCallBackFunctionByCMD(),r.onStop&&r.onStop())},e.OnError=function(e){console&&console.warn("An error occurred: Ping-Timer has been Stopped"),a.StopPingTimer(),r.onError&&r.onError(e)}}}function mcFileUploading(e){"use strict";function t(e,t){var n=e.size,o=0,i=null,s=e.size/100,a=0,r=function(r){if(!h){if(null!=r.target.error)return void t(r.target.error);if(o+=r.target.result.byteLength,a=(o/s).toFixed(),t(null,r.target.result,a),o>=n)return void t(null,null,100);i(c,o,524288,e)}},c=(i=function(t,n,o,i){var s=t||new FileReader,a=i.slice(n,o+n);return t||(u.onBeforeFileAdd&&u.onBeforeFileAdd(e),_||(_=function(){s.abort(),s.onload=null,_=null}),s.onload=r),s.readAsArrayBuffer(a),s})(null,o,524288,e)}function n(t,n){u.Hash=t.Hash,u.Width=e.thumbsSize.x,u.Height=e.thumbsSize.y,u.FileName=t.FileName,t.Present?m?m.apply(u,arguments):console.trace("No set success callback on file uploading"):(l.define("upload",mcService.getLocalHostPath(e.isWebClient)+"/uploading/?sid="+mcConst.SessionID+"&hash="+t.Hash+v),l.addFile(n))}function o(){e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_upload_start,u.filePath,{Where:u.Where,ID:u.ID,Type:u.Type,chatType:u.chatType}]),p=function(){p=null,e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_upload_abort])},_=function(){_=null,e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_upload_prepare_abort])}}function i(t,n){e.SendCMDToServer([mcConst._CMD_.cs_is_file_exists,mcConst.SessionID].concat(t||[]).concat(n))}function s(){var e=mcService.SHA1(),t="",o=new FileReader;o.onloadend=function(){var o=this.result,s=u.clipboardImage;if(e.append(o),!s.name||s.name&&0===s.name.indexOf("image.")&&!s.path)try{s.name="Screenshot ("+mcConst.UserInfo.Nick+") "+mcService.formatDate(new Date,"dd-mm-yyyy hh-nn-ss")+".png"}catch(e){}i([t=e.end(),mcConst._CMD_.msgType.IMAGE,s.name,u.Where,u.ID,mcService.fileTimeStamp()],function(e){n(e,s)})},o.readAsArrayBuffer(u.clipboardImage)}function a(){var e=this,o=mcService.SHA1(),s=e.files[0],a=u.Type;s&&(u.fileSize=s.size,u.lastModifiedDate=s.lastModified||s.lastModifiedDate,setTimeout(function(){t(s,function(t,r,c){if(t)console.error("Read error: "+t);else if(r)u.onPrepareProgress&&u.onPrepareProgress(c),o.append(r);else{var l=o.end();e.value&&(e.value=""),i([l,a,u.Type===mcConst._CMD_.msgType.IMAGE?s.name:s.path||s.name,u.Where,u.ID,mcService.fileTimeStamp(s.lastModified||s.lastModifiedDate)],function(e){n(e,s)})}})},100))}function r(){var e=document.getElementById(f);e||((e=document.createElement("div")).id=f,e.className="hideFileInput",document.body.appendChild(e)),e.innerHTML='<input type="file">';var t=e.firstChild;switch(t.value&&mcService.isIE()&&(t.parentNode.replaceChild(t.cloneNode(!0),t),t=document.getElementById(f).firstChild),u.Type){case mcConst._CMD_.msgType.IMAGE:t.accept="image/png, image/gif, image/jpeg, image/jpg";break;case mcConst._CMD_.msgType.VIDEO:t.accept="video/mp4, video/x-m4v, .mkv, video/mpeg, video/webm, video/*";break;default:t.accept=""}t.fileEvent&&t.removeEventListener("change",t.fileEvent),t.fileEvent=a,t.addEventListener("change",t.fileEvent),t.click()}function c(e,t,n){d=e,m=t,(u=n||{}).clipboardImage?s():u.filePath&&u.dropFile?a.apply(u.dropFile):u.filePath?o():r()}var l=null,d=null,m=null,u={},f="__fileSender__",g=null,_=null,p=null,h=!1,v="",C=window._messages_.mcFileUploader={abortUploading:"abortUploading",abortPreparingUploading:"abortPreparingUploading",uploadFile:"uploadFile"};e.$on(C.abortUploading,function(){h=!0,_&&_(),l&&g&&(l.stopUpload(g),l.destructor()),p&&p(),u={}}),e.$on(C.abortPreparingUploading,function(){_&&_(),l&&l.destructor()}),e.$on(C.uploadFile,function(t,n){(l=$$("uploadAPI"))&&l.destructor(),g=null,_=null,p=null,h=!1,v=e.hasOwnProperty("GetChatType")?"&where="+e.GetChatType().toLowerCase():"";var o=n[2]||{};o.uploadProgress||$$("uploadProgress")||webix.ui({id:"uploadProgress",view:"list",scroll:!1,padding:0,borderless:!0,hidden:!0,select:!1}),l=webix.ui({id:"uploadAPI",view:"uploader",multiple:!1,link:o.uploadProgress||"uploadProgress",apiOnly:!0,on:{onAfterFileAdd:function(e){g=e.id,u.onAfterFileAdd&&u.onAfterFileAdd(e)},onUploadComplete:function(){m?m.apply(u,[]):console.trace("No set success callback on file uploading"),d=null,m=null},onFileUploadError:function(){console.warn("Error during file uploading"),d&&d.apply(null,arguments),d=null,m=null}}}),c.apply(null,n)})}function mcStorage(e){"use strict";function t(t){e.$broadcast("sendCMDToElectron",[t.cmd].concat(t.values).concat([function(e){e&&n[e.name]?n[e.name].shift()(e.data):t&&t.cb&&t.cb(e)}]))}var n={};e.Storage={historyDialogs:{load:function(o,i,s){if(e.isWebClient){if(!s)return webix.storage.local.get(i+o);s(webix.storage.local.get(i+o))}else n[i]||(n[i]=[]),n[i].push(s),t({cmd:mcConst._CMD_.ce_history_get_dialogs,values:[],cb:s})},remove:function(n,o,i){if(e.isWebClient){if(!i)return webix.storage.local.remove(o+n);i(webix.storage.local.remove(o+n))}else t({cmd:mcConst._CMD_.ce_history_remove_dialogs,values:[],cb:i})},save:function(n,o,i,s){if(e.isWebClient){if(!s)return webix.storage.local.put(o+n,i);s(webix.storage.local.put(o+n,i))}else t({cmd:mcConst._CMD_.ce_history_set_dialogs,values:[i],cb:s})}},dialogs:{load:function(o,i,s,a){if(e.isWebClient){if(!a)return webix.storage.local.get(s+i);a(webix.storage.local.get(s+i))}else n[s]||(n[s]=[]),n[s].push(a),t({cmd:mcConst._CMD_.ce_storage_get,values:[o,i,s],cb:a})},remove:function(n,o,i,s){if(e.isWebClient){if(!s)return webix.storage.local.remove(i+o);s(webix.storage.local.remove(i+o))}else t({cmd:mcConst._CMD_.ce_storage_remove,values:[n,o,i],cb:s})},save:function(n,o,i,s,a){if(e.isWebClient){if(!a)return webix.storage.local.put(i+o,s);a(webix.storage.local.put(i+o,s))}else t({cmd:mcConst._CMD_.ce_storage_save,values:[n,o,i,s],cb:a})}},statistics:{load:function(o,i,s){e.isWebClient||(n[name]||(n[name]=[]),n[name].push(s),t({cmd:mcConst._CMD_.ce_statistics_get,values:[o,i],cb:s}))},save:function(n,o,i,s){e.isWebClient||t({cmd:mcConst._CMD_.ce_statistics_save,values:[n,o,i],cb:s})}}},window.mcStorage=e.Storage}function mcStatistics(e){var t={n_voice:0,n_video:0,l_voice:0,l_video:0,n_msg_img:0,n_msg_smile:0,n_msg_conf_link:0,n_msg_local_net_link:0,n_msg_user_link:0,n_msg_font:0,n_msg_action:0,n_msg_myfiles:0,n_msg_publicfiles:0,n_conf_msg:0,n_conf_create:0,n_conf_enter:0,n_conf_invites:0,n_priv_msg:0,n_pers_msg:0,n_alert_msg:0,n_brdcst_msg:0,n_bbs:0,n_file:0,n_file_offline:0,n_file_exp:0,n_file_drag:0,n_file_ctrlc:0,n_file_direct:0,n_file_serv:0,n_ohis:0,n_opr:0,n_vpr:0,n_omyf:0,n_opf:0,n_ign_view:0,n_ign_add:0,n_ign_del:0,n_ign_mod:0,n_opriv:0,n_frcvd:0,n_ocomp:0,n_cexp:0,n_cimp:0,n_creategrp:0,n_delgrp:0,n_addcnt:0,n_rengrp:0,n_delcnt:0,adm_ban:0,adm_kick:0,adm_disconnect:0,adm_halt:0,adm_blockuin:0,adm_block_ip:0,adm_block_mac:0,adm_ren_conf:0,adm_set_topic:0,n_state:0,n_opt:0,n_cons:0,n_hlp:0,n_accmng:0,n_accmng_enter:0,n_accmng_recall:0,n_accmng_newuser:0,n_fnd:0,n_fnd_ext:0,n_srv_spell:0,n_srv_ctrlspace:0,n_srv_beep:0,n_srv_stayontop:0,n_srv_transp:0,n_srv_fastmsg:0,n_srv_block:0,cl_hid:"",cl_os:"",cl_v:"6.0",cl_lng:"ru",cl_plg:"",cl_skin:"Classic",cl_adm:!1,cl_ad:!1,cl_portable:!1,cl_instpath:2,cl_t:"-",last_update:null},n=!1,o=null;this.val={n_voice:"n_voice",n_video:"n_video",l_voice:"l_voice",l_video:"l_video",n_msg_img:"n_msg_img",n_msg_smile:"n_msg_smile",n_msg_conf_link:"n_msg_conf_link",n_msg_local_net_link:"n_msg_local_net_link",n_msg_user_link:"n_msg_user_link",n_msg_font:"n_msg_font",n_msg_action:"n_msg_action",n_msg_myfiles:"n_msg_myfiles",n_msg_publicfiles:"n_msg_publicfiles",n_conf_msg:"n_conf_msg",n_conf_create:"n_conf_create",n_conf_enter:"n_conf_enter",n_conf_invites:"n_conf_invites",n_priv_msg:"n_priv_msg",n_pers_msg:"n_pers_msg",n_alert_msg:"n_alert_msg",n_brdcst_msg:"n_brdcst_msg",n_bbs:"n_bbs",n_file:"n_file",n_file_offline:"n_file_offline",n_file_exp:"n_file_exp",n_file_drag:"n_file_drag",n_file_ctrlc:"n_file_ctrlc",n_file_direct:"n_file_direct",n_file_serv:"n_file_serv",n_ohis:"n_ohis",n_opr:"n_opr",n_vpr:"n_vpr",n_omyf:"n_omyf",n_opf:"n_opf",n_ign_view:"n_ign_view",n_ign_add:"n_ign_add",n_ign_del:"n_ign_del",n_ign_mod:"n_ign_mod",n_opriv:"n_opriv",n_frcvd:"n_frcvd",n_ocomp:"n_ocomp",n_cexp:"n_cexp",n_cimp:"n_cimp",n_creategrp:"n_creategrp",n_delgrp:"n_delgrp",n_addcnt:"n_addcnt",n_rengrp:"n_rengrp",n_delcnt:"n_delcnt",adm_ban:"adm_ban",adm_kick:"adm_kick",adm_disconnect:"adm_disconnect",adm_halt:"adm_halt",adm_blockuin:"adm_blockuin",adm_block_ip:"adm_block_ip",adm_block_mac:"adm_block_mac",adm_ren_conf:"adm_ren_conf",adm_set_topic:"adm_set_topic",n_state:"n_state",n_opt:"n_opt",n_cons:"n_cons",n_hlp:"n_hlp",n_accmng:"n_accmng",n_accmng_enter:"n_accmng_enter",n_accmng_recall:"n_accmng_recall",n_accmng_newuser:"n_accmng_newuser",n_fnd:"n_fnd",n_fnd_ext:"n_fnd_ext",n_srv_spell:"n_srv_spell",n_srv_ctrlspace:"n_srv_ctrlspace",n_srv_beep:"n_srv_beep",n_srv_stayontop:"n_srv_stayontop",n_srv_transp:"n_srv_transp",n_srv_fastmsg:"n_srv_fastmsg",n_srv_block:"n_srv_block",cl_hid:"cl_hid",cl_os:"cl_os",cl_v:"cl_v",cl_lng:"cl_lng",cl_plg:"cl_plg",cl_skin:"cl_skin",cl_adm:"cl_adm",cl_ad:"cl_ad",cl_portable:"cl_portable",cl_instpath:"cl_instpath",cl_t:"cl_t"},this.loadStat=function(i,s){i&&e.Storage.statistics.load(i,s,function(i){t=mcService.Marge(t,i||{}),e.$broadcast("getSystemInfo",function(){if(t.cl_t=e.clientSysInfo.osType,o=t.last_update||null){var i=moment(new Date).diff(moment(o),"days");!isNaN(i)&&void 0!==i&&i>=7&&setTimeout(function(){e.SendCMDToServer([mcConst._CMD_.cs_stat,mcConst.SessionID,JSON.stringify(t),function(n){n.lo_hid=e.clientSysInfo.HardwareID,n.lo_dt=mcService.formatDate(new Date,"dd.mm.yyyy.hh.nn.ss"),n.lo_os=e.clientSysInfo.OS,n.lo_ssl=0,t.lo_os=e.clientSysInfo.OS,i>=7&&webix.ajax().post("http://mychat-server.com/statSpec.txt","MyChat-"+e.clientSysInfo.Ver+"("+e.clientSysInfo.HardwareID+")["+e.clientSysInfo.serverHWID+"]%%%"+JSON.stringify(n)),t.last_update=mcService.formatDate(new Date,"yyyy-mm-dd hh:nn:ss")}])},18e5)}n=!0})})},this.close=function(){n=!1},this.saveStat=function(o,i,s){n&&o?e.Storage.statistics.save(o,i,t,s):console.error("Can't save statistics, it wasn't loaded!")},this.setValue=function(e,o,i){n&&t.hasOwnProperty(e)&&(mcService.isNumber(t[e])?void 0!==o?i?t[e]=o:t[e]+=o:t[e]++:void 0!==o&&(t[e]=o))},this.getValue=function(e){return n&&t.hasOwnProperty(e)?t[e]:null},this.setValueByCMD=function(){switch(arguments[0]){case mcConst._CMD_.cs_private_msg:if(arguments[2])try{switch(JSON.parse(arguments[2]).MsgType){case mcConst._CMD_.msgType.OLD_SHIT:case mcConst._CMD_.msgType.TEXT:t.n_priv_msg++;break;case mcConst._CMD_.msgType.IMAGE:t.n_msg_img++}}catch(e){}break;case mcConst._CMD_.cs_put_msg2txt_channel:if(arguments[2])try{switch(JSON.parse(arguments[2]).MsgType){case mcConst._CMD_.msgType.OLD_SHIT:case mcConst._CMD_.msgType.TEXT:t.n_conf_msg++;break;case mcConst._CMD_.msgType.IMAGE:t.n_msg_img++}}catch(e){}break;case mcConst._CMD_.cs_join_txt_channel:t.n_conf_enter++;break;case mcConst._CMD_.cs_create_txt_channel:t.n_conf_create++;break;case mcConst._CMD_.cs_get_uin_info:arguments[2]==mcConst.UserInfo.UIN?t.n_opr++:t.n_vpr++;break;case mcConst._CMD_.sc_media_call_accept:arguments[1].useVideo?t.n_video++:t.n_voice++;break;case mcConst._CMD_.sc_grant_private_access:t.n_opriv++;break;case mcConst._CMD_.sc_halt:t.adm_halt++}}}function DownloadUploadManager(e,t,n){function o(t){var n=e.GetChatID();e.GetChatType()===e.chatAliases.UIN&&n&&e.$broadcast("getUserState",[e.GetChatID(),function(o){mcConst.states.offline===o?webix.alert(mcLang(585)):(m.setUINsend(n,e.chatAliases.UIN),e.isWebClient||e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_direct_upload_prepare,n,t]))}])}var i={UPLOAD:1,UPLOADBUFFER:2,DOWNLOAD:3,PREPARING:4,UPLOADIRECT:5,WAITANSWER:6,DOWNLOADPREP:7,DOWNLOADDIRECT:8},s=!1,a=this,r={Visualisation:function(e){function t(){switch(s){case i.DOWNLOAD:e.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_file_download_abort]);break;case i.WAITANSWER:c.getUINsend()&&e.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_file_direct_upload_abort]),e.SendCMDToServer([mcConst._CMD_.cs_files_transfer_request_abort,mcConst.SessionID,e.GetChatID()]);break;case i.UPLOADIRECT:e.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_file_direct_upload_abort]),e.SendCMDToServer([mcConst._CMD_.cs_files_transfer_abort,mcConst.SessionID,e.GetChatID()]);break;case i.UPLOADBUFFER:case i.UPLOAD:e.$broadcast("abortUploading");break;case i.PREPARING:e.$broadcast("abortPreparingUploading");break;case i.DOWNLOADPREP:l.reject(!0);break;case i.DOWNLOADDIRECT:e.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_remove_ftp_user,a])}o._hideProgressInfo()}function n(){}var o=this,a=null,r=mcService.RandomHash(5),c=null,l=null,d={};this._getViews=function(e){return{progressWrapper:{id:"progressWrapper"+r,css:"noBGColor byCenter borderTopBottom",height:30,padding:0,borderless:!0,hidden:!0,cols:[{id:"universalProgress"+r,borderless:!0,css:"noBGColor byCenter",hidden:!0,template:function(){var e="&nbsp;";if(this.progress){var t=this.progress;e=mcService.myReplaceFormated("<div class='uploader_overall'>   <div class='uploader_status'>       <div class='uploader_progress' style='width:#{width}'></div>       <div class='uploader_message'>#{txt}</div>   </div></div>",{width:void 0!==t.percent?t.percent+"%":0,txt:t.text+(t.size?"/"+t.size+" ":" ")+(void 0!==t.percent?t.percent+"%":"")})}return e}},{id:"uploadProgress"+r,view:"list",type:"myUploader",css:"uploader_nopadding",scroll:!1,padding:0,borderless:!0,hidden:!0,select:!1},{view:"button",value:e||mcLang(33),width:105,click:t}]},downloadFilesQuestion:{id:"downloadFilesQuestion"+r,css:"borderTopBottom",borderless:!0,height:60,hidden:!0,rows:[{id:"downloadFileList",view:"template",template:"&nbsp;",padding:5,borderless:!0,css:"whiteBg monospaceAll",scroll:"y"},{cols:[{},{view:"button",value:mcLang(592),maxWidth:130,click:n},{width:10},{view:"button",value:mcLang(33),maxWidth:130,click:t,type:"danger"},{}]}]}}},this.getUploadProgress=function(){return"uploadProgress"+r},this._initViews=function(){d.progressWrapper=$$("progressWrapper"+r),d.universalProgress=$$("universalProgress"+r),d.uploadProgress=$$("uploadProgress"+r)},this._showDownloadFileList=function(t){a=t.UIN,e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_get_user_folder,t.UIN,t.DisplayName,function(n){l.setFilesList(t,n),e.customUserOptions.getOption(a,"autoReceive")?setTimeout(function(){l.accept(n)},100):(e.$broadcast("selectTool",[mcConst.dataModels.ReceiveFiles]),e.$broadcast(window._messages_.receiveFiles.setReceiveFilesInfo,[l.getInfo()]))}])},this._hideProgressInfo=function(t){if(s&&(d.progressWrapper&&d.progressWrapper.hide(),!t&&window._messages_.chatFrame&&e.$broadcast(window._messages_.chatFrame.scrollDownChat)),t)switch(s){case i.DOWNLOAD:webix.message(mcLang(575));break;case i.UPLOAD:webix.message(mcLang(576))}s=!1},this._showProgressInfo=function(e){switch(s&&d.progressWrapper.show(),e&&d.uploadProgress.clearAll(),s){case i.PREPARING:case i.DOWNLOAD:case i.UPLOADBUFFER:case i.UPLOADIRECT:case i.DOWNLOADDIRECT:o._updateProgress({percent:0,text:" ... "}),d.universalProgress.show(),d.uploadProgress.hide();break;case i.WAITANSWER:o._updateProgress({text:mcLang(583)}),d.universalProgress.show(),d.uploadProgress.hide();break;case i.UPLOAD:d.universalProgress.hide(),d.uploadProgress.show()}},this._updateProgress=function(e){s&&(d.universalProgress.define("progress",e),d.universalProgress.refresh())},this._onPrepareProgress=function(e){o._updateProgress({percent:e,text:"SHA1 calculating"})},this._abortUploading=t,this.setFileUploader=function(e){c=e},this.setDirectReceive=function(e){l=e},this.active=function(){return!!d.progressWrapper}},LoadingImages:function(e){function t(e){return a[e]&&a[e].idx&&a[e].idx.length?a[e].idx.shift():null}function n(e){return a[e]?a[e].name:null}function o(e){return a[e]&&a[e].ID&&a[e].ID.length?a[e].ID.shift():null}function i(e,t,o,s){r.loadThumbs([e[t],n(e[t])],s,function(){++t<e.length?i(e,t,o,s):o&&o()})}var s=new McDeferredLoadImages,a={},r=this;return r.loadAllThumbs=function(e,t){s||(s=new McDeferredLoadImages);var n=[];Object.keys(a).forEach(function(e){a[e].idx.forEach(function(){n.push(e)})}),i(n,0,e,t)},r.loadThumbs=function(n,i,a){var r=mcService.isObject(n)?n:{Hash:n[0],FileName:n[1],idx:n[2]};r.FileName&&e.SendCMDToServer([mcConst._CMD_.cs_get_image_thumbs,mcConst.SessionID,r.Hash,e.thumbsSize.x,e.thumbsSize.y,r.FileName,mcService.getCurrentChantTypeForFiles(e.GetChatType()),function(n){var c=t(n.Hash)||r.idx;if(c){var l="/"+e.GetChatType().toLowerCase()+"/",d=document.getElementById("link_"+n.Hash+c),m=document.getElementById("img_"+n.Hash+c);"/kanban/"===l&&"/forum/"===l||(l="/");var u=n.Exists&&(e.isWebClient||mcConst.ClientSettings.SysEventsShowImagesInChat)?mcService.getLocalHostPath(e.isWebClient)+"/"+mcConst.pathAliases.AliasFiles+l+n.Hash+"-"+e.thumbsSize.xy+".jpg":mcConst.imagesPath.nofile,f=mcService.getLocalHostPath(e.isWebClient)+"/"+mcConst.pathAliases.AliasFiles+l+n.Hash+"/"+(n.Exists?encodeURI(n.FileName):mcConst.imagesPath.nofile);m&&m.src&&d&&d.href?(m.src=u,d.href=f,m.onload=function(){i&&i(this.height,n,o(n.Hash),u,f)},m.onerror=m.onabort=function(e){console.warn(e)}):s&&s.addImage(c,n.Hash,u,f)}a&&a(n)}])},r.loadAllImages=function(e){s||(s=new McDeferredLoadImages),s.load(e)},r.addImageToLoad=function(e,t,n,o){a.hasOwnProperty(e)?-1===mcService.inArray(t,a[e].idx)&&(a[e].idx.push(t),o&&(a[e].ID?a[e].ID.push(o):a[e].ID=[o])):(a[e]={idx:[t],name:n},o&&(a[e].ID=[o]))},r.destroy=function(){s=null},r},FileUploaderViaServer:function(e,t,n){function o(e,n){t(e.chatType,e.ID,e.Hash+mcConst.CRLF+e.FileName+mcConst.CRLF+mcService.fileTimeStamp(e.lastModifiedDate)+mcConst.CRLF+e.fileSize,e.Type),u._hideProgressInfo(n)}function a(t,n){n===e.chatAliases.UIN&&(d=t)}function r(){d=null,m=null,u._abortUploading()}function c(){s=i.PREPARING,n&&n.onBeforeFileAdd&&n.onBeforeFileAdd.apply(null,arguments)?r():u._showProgressInfo(!0)}function l(){s=i.UPLOAD,n&&n.onAfterFileAdd&&n.onAfterFileAdd.apply(null,arguments)?r():u._showProgressInfo()}var d=null,m=null,u=null;this.getFilesInfo=function(){return m},this.getUINsend=function(){return d},this.setUINsend=a,this.abortUploading=r,this.sendFileMessage=o,this._onPasteItemFromClipboard=function(t){var n;s||t.addEventListener("paste",function(t){var i=e.GetChatType();if(t.clipboardData.items.length){for(var d=t.clipboardData.items.length-1;d>=0;d--)if("file"===t.clipboardData.items[d].kind&&"image/png"===t.clipboardData.items[d].type){n=d;var m=t.clipboardData.items[n].getAsFile(),f=e.GetChatID();a(f,i),e.$broadcast(window._messages_.mcFileUploader.uploadFile,[function(){u._hideProgressInfo(),r(),webix.alert("Error file uploading!")},function(){var e=this;r(),e.Type=mcConst._CMD_.msgType.IMAGE,e.chatType=i,e.ID=f,e.fileSize=m.size,o(e)},{onBeforeFileAdd:c,onPrepareProgress:u._onPrepareProgress,onAfterFileAdd:l,uploadProgress:u.getUploadProgress(),clipboardImage:m,Where:mcService.getCurrentChantTypeForFiles(e.GetChatType()),ID:f}]),t.preventDefault();break}}else t.clipboardData.files.length>=0&&(s?webix.message(mcLang(601)):e.isWebClient||e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_get_clipboard_files_list]))})},this.setVisualisation=function(e){u=e},this._uploadFile=function(t,n,i){var s=e.GetChatID(),d=e.GetChatType();a(s,d),e.$broadcast(window._messages_.mcFileUploader.uploadFile,[function(){u._hideProgressInfo(),r(),webix.alert("Error file uploading!")},function(){var e=this;switch(r(),t){case mcConst._CMD_.msgType.IMAGE:o(e);break;default:o(e,!0)}},{onBeforeFileAdd:c,onAfterFileAdd:l,onPrepareProgress:u._onPrepareProgress,uploadProgress:u.getUploadProgress(),filePath:n,chatType:d,dropFile:i,Type:t,Where:mcService.getCurrentChantTypeForFiles(e.GetChatType()),ID:s}])}},DirectReceive:function(e){function t(e){var t=e.split(d),n=0;for(r={};n++<l;){var o=t.shift(),i=t.shift(),s=t.shift(),a=t.shift(),c=t.shift();r[o]={fileName:i,path:s,size:a,attr:c}}}function n(){return mcService.convertObjToArray(r,"idx",!0)}function o(){a=-1,r={},l=0,c=0,f=""}var a=-1,r={},c=0,l=0,d=mcConst.terminator,m=this,u="",f="",g=null;m.clear=o,m.setFilesList=function(e,n){mcService.isObjectEmpty(r)||o(),c=e.FilesSize,l=e.FilesCount,u=e.DisplayName,a=e.UIN,f=n,t(e.List)},m.getCurrentReceiveUIN=function(){return a},m.getInfo=function(){return{FilesList:n(),DisplayName:u,UIN:a,Size:c,Count:l,DownloadPath:f}},m.reject=function(t){e.$broadcast(window._messages_.chatWrapper.hideTool,[mcConst.dataModels.ReceiveFiles]),t||e.SendCMDToServer([mcConst._CMD_.cs_files_transfer_deny,mcConst.SessionID,a]),o()},m.accept=function(t){e.customUserOptions.getOption(a,"autoReceive")||(e.$broadcast(window._messages_.chatWrapper.hideTool,[mcConst.dataModels.ReceiveFiles]),e.$broadcast("selectDialog",["UIN-"+a])),e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_direct_receive_start,a,t,function(t){e.SendCMDToServer([mcConst._CMD_.cs_files_transfer_accept,mcConst.SessionID,a,t.port,t.interfaces,"",512]),s=i.DOWNLOADDIRECT,g._showProgressInfo()}]),e.$broadcast(window._messages_.dialogsList.OpenPrivate,[a])},m.addReceiveFile=function(e){e.UIN===a&&(r[e.FileIdx].received=!0)},m.setVisualisation=function(e){g=e}}},c=new r.DirectReceive(e),l=new r.LoadingImages(e),d=new r.Visualisation(e),m=new r.FileUploaderViaServer(e,t,n);c.setVisualisation(d),m.setVisualisation(d),d.setFileUploader(m),d.setDirectReceive(c),e.isWebClient||(e.ElectronErrors[mcConst._CMD_.errElectron.eFileDownload]=function(e){webix.message(e.msg,"error",15e3),console.warn(e)}),a.onPasteItemFromClipboard=m._onPasteItemFromClipboard,a.sendFilesToUser=o,a.uploadFile=m._uploadFile,a.abortUploading=m.abortUploading,a.addImageToLoad=l.addImageToLoad,a.loadThumbs=l.loadThumbs,a.loadAllImages=l.loadAllImages,a.loadAllThumbs=l.loadAllThumbs,a.getViews=d._getViews,a.initViews=d._initViews,a.downloadUrl=function(t,n,o){e.isWebClient||e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_download_url,t,n,o])},a.openDownloadUrl=function(t,n){e.isWebClient||e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_open_or_download,t,n])},a.openInFolder=function(t,n){e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_open_in_folder,t,n])},a.isActive=function(){return s},a.openFolder=function(t){e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_open_folder,t])},a.sendText=function(e){t=e},a.destroy=function(){l.destroy(),c=null,l=null,d=null,m=null;for(var t in window._messages_.downloadUpload)"---"!==t&&e.$off(window._messages_.downloadUpload[t])};var u=window._messages_.downloadUpload={changeStateForUser:"changeStateForUser",pastFilesFromClipboard:"pastFilesFromClipboard",acceptReceiveFiles:"acceptReceiveFiles",rejectReceiveFiles:"rejectReceiveFiles",sendFilesToUser:"sendFilesToUser",on_file_download_progress:"on_file_download_progress",on_file_download_start:"on_file_download_start",on_file_download_complete:"on_file_download_complete",on_file_download_aborted:"on_file_download_aborted",on_file_upload_prepare_progress:"on_file_upload_prepare_progress",on_file_upload_start:"on_file_upload_start",on_file_upload_prepare_start:"on_file_upload_prepare_start",on_file_upload_aborted:"on_file_upload_aborted",on_file_upload_progress:"on_file_upload_progress",on_file_upload_complete:"on_file_upload_complete",on_file_check_exist:"on_file_check_exist",on_file_drop:"on_file_drop",on_files_transfer_progress:"on_files_transfer_progress",on_file_direct_upload_wait_accept:"on_file_direct_upload_wait_accept",on_file_direct_upload_accept:"on_file_direct_upload_accept",on_file_direct_upload_complete:"on_file_direct_upload_complete",on_file_direct_upload_no_files:"on_file_direct_upload_no_files",on_file_direct_download_complete:"on_file_direct_download_complete",on_file_direct_download_file_received:"on_file_direct_download_file_received",on_file_direct_receive_client_disconnected:"on_file_direct_receive_client_disconnected",on_file_request_transfer:"on_file_request_transfer","---":"---"};e.$on(u.acceptReceiveFiles,function(e,t){d.active()&&c.accept.apply(c,t)}),e.$on(u.rejectReceiveFiles,function(){d.active()&&c.reject()}),e.$on(u.changeStateForUser,function(t,n){if(d.active()){var o=n[0],i=n[1];c.getCurrentReceiveUIN()==o&&i==mcConst.states.offline?(c.clear(),e.$broadcast(window._messages_.chatWrapper.hideTool,[mcConst.dataModels.ReceiveFiles])):m.getUINsend()==o&&m.abortUploading()}}),e.$on(u.pastFilesFromClipboard,function(e,t){if(d.active()){var n=t[0];n&&n.length&&m._uploadFile(mcConst._CMD_.msgType.FILE,n,!1)}}),e.$on(u.on_file_check_exist,function(t,n){if(d.active()){var o=n[0].id,i=n[0].info;o&&i&&e.SendCMDToServer([mcConst._CMD_.cs_is_file_exists,mcConst.SessionID,i.Hash,i.Type,i.FileName,i.Where,i.ID,mcService.fileTimeStamp(i.lastModifiedDate),function(t){t.Present?m.sendFileMessage(i):e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_check_exist,o])}])}}),e.$on(u.on_file_drop,function(e,t){if(d.active()){var n=t[0];m._uploadFile(mcConst._CMD_.msgType.FILE,!0,n)}}),e.$on(u.on_files_transfer_progress,function(e,t){d.active()&&d._updateProgress.apply(d,t)}),e.$on(u.on_file_download_start,function(){d.active()&&(s=i.DOWNLOAD,d._showProgressInfo())}),e.$on(u.on_file_download_progress,function(e,t){d.active()&&d._updateProgress.apply(d,t)}),e.$on(u.on_file_download_aborted,function(){d.active()&&d._hideProgressInfo()}),e.$on(u.on_file_download_complete,function(){d.active()&&d._hideProgressInfo(!0)}),e.$on(u.on_file_upload_start,function(){d.active()&&(s=i.UPLOADBUFFER,d._showProgressInfo())}),e.$on(u.on_file_upload_progress,function(e,t){d.active()&&d._updateProgress.apply(d,t)}),e.$on(u.on_file_upload_aborted,function(t,n){if(d.active()){var o=n[0];m.abortUploading(),o&&(e.$broadcast(window._messages_.chatFrame.addCustomMSG,[{UIN:o,Msg:mcLang(584)}]),webix.message(mcLang(584)),e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_direct_upload_abort]))}}),e.$on(u.on_file_upload_complete,function(e,t){if(d.active()){var n=t[0];d._hideProgressInfo(!0),m.sendFileMessage(n)}}),e.$on(u.on_file_upload_prepare_start,function(){d.active()&&(s=i.PREPARING,d._showProgressInfo())}),e.$on(u.on_file_upload_prepare_progress,function(e,t){if(d.active()){var n=t[0].percent;d._onPrepareProgress(n)}}),e.$on(u.on_file_direct_upload_wait_accept,function(e,t){d.active()&&(s=i.WAITANSWER,d._showProgressInfo())}),e.$on(u.on_file_direct_upload_accept,function(t,n){if(d.active()){var o=n[0];s=i.UPLOADIRECT,d._showProgressInfo(),e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_direct_upload_start,o])}}),e.$on(u.on_file_direct_upload_complete,function(t,n){if(d.active()){var o=n[0];e.$broadcast(window._messages_.chatFrame.addCustomMSG,[{MsgType:mcConst._CMD_.msgType.SHOW_UPLOADED_FILES,UIN:m.getUINsend(),FilesList:o.FilesList,Count:o.FilesCount,Size:o.FilesSize,Path:o.filesPath}]),d._hideProgressInfo(!0)}}),e.$on(u.sendFilesToUser,function(e,t){d.active()&&o.apply(null,t)}),e.$on(u.on_file_request_transfer,function(e,t){d.active()&&(s=i.DOWNLOADPREP,d._showDownloadFileList.apply(d,t))}),e.$on(u.on_file_direct_upload_no_files,function(){d.active()&&d._hideProgressInfo(!0)}),e.$on(u.on_file_direct_download_complete,function(){if(d.active()){var t=c.getInfo();e.$broadcast(window._messages_.chatFrame.addCustomMSG,[{MsgType:mcConst._CMD_.msgType.SHOW_RECEIVED_FILES,UIN:t.UIN,FilesList:t.FilesList,Count:t.Count,Size:t.Size,Path:t.DownloadPath}]),d._hideProgressInfo(!0)}}),e.$on(u.on_file_direct_download_file_received,function(e,t){d.active()&&c.addReceiveFile.apply(null,t)}),e.$on(u.on_file_direct_receive_client_disconnected,function(e,t){d.active()&&c.getCurrentReceiveUIN()===t[0]&&d._abortUploading()})}function McDeferredLoadImages(){var e={};this.addImage=function(t,n,o,i){e.hasOwnProperty(t)||(e[t]=[n,o,i])},this.load=function(t){var n=Object.keys(e).length,o=0;Object.keys(e).forEach(function(i){var s=e[i][0],a=e[i][1],r=e[i][2],c=document.getElementById("link_"+s+i),l=document.getElementById("img_"+s+i);l&&l.src&&c&&c.href&&(l.src=a,c.href=r,console.log("loadAll: "+a),l.onload=function(){o++,delete e[i],o===n&&t&&t()},l.onerror=l.onabort=function(e){console.warn(e)})})}}function cLog(e,t,n){var o=function(e){return"[object Object]"===Object.prototype.toString.call(e)};e&&t&&(window.console={log:function(){try{___native_console.log.apply(null,arguments)}catch(e){Function.prototype.bind.apply(___native_console.log,[null].concat(arguments))}var i=o(arguments[0])?JSON.stringify(arguments[0]):arguments[0];t([e].concat(n?[mcConst.SessionID]:[]).concat(["log ",i]),!n)},error:function(){try{___native_console.error.apply(null,arguments)}catch(e){Function.prototype.bind.apply(___native_console.error,[null].concat(arguments))}var i=o(arguments[0])?JSON.stringify(arguments[0]):arguments[0],s={};try{Error.captureStackTrace(s)}catch(e){}t([e].concat(n?[mcConst.SessionID]:[]).concat(["err ",i+"\n"+s.stack]),!n)},err:function(){try{___native_console.error.apply(null,arguments)}catch(e){Function.prototype.bind.apply(___native_console.error,[null].concat(arguments))}var i=o(arguments[0])?JSON.stringify(arguments[0]):arguments[0],s={};try{Error.captureStackTrace(s)}catch(e){}t([e].concat(n?[mcConst.SessionID]:[]).concat(["err ",i+"\n"+s.stack]),!n)},warn:function(){try{___native_console.warn.apply(null,arguments)}catch(e){Function.prototype.bind.apply(___native_console.warn,[null].concat(arguments))}var i=o(arguments[0])?JSON.stringify(arguments[0]):arguments[0];t([e].concat(n?[mcConst.SessionID]:[]).concat(["warn",i]),!n)}})}function servicesController(_api){var hexCodes=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],imgIndex=1,serviceList={ModalTimer:null,noNotify:!1,notify:null,idNotify:0,insertIco:function(e,t){return"<span class='webix_icon "+e+" "+(t||"fa-lg")+"'></span>"},checkRights:function(e){var t=!1;return e=parseInt(e),isNaN(e)||(t=mcConst.MyRightsSet[e-1]),t},isPlainObject:function(e){var t=!1;if(!e||!serviceList.isObject(e)||e.nodeType||e.setInterval)t=!1;else if(!e.constructor||e.constructor||e.constructor.isPrototypeOf){var n;for(n in e);t=void 0===n||!!e[n]}else t=!1;return t},oldMarge:function(){var e,t,n,o,i,s,a=arguments[0]||{},r=1,c=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[1]||{},r=2),"object"!=typeof a&&"function"!=typeof a&&(a={});r<c;r++)if(null!==(e=arguments[r]))for(t in e)n=a[t],a!==(o=e[t])&&(l&&o&&(serviceList.isPlainObject(o)||(i=serviceList.isArray(o)))?(i?(i=!1,s=n&&serviceList.isArray(n)?n:[]):s=n&&serviceList.isPlainObject(n)?n:{},a[t]=serviceList.oldMarge(l,s,o)):void 0!==o&&(a[t]=o));return a},Marge:function(){return serviceList.isIE()?serviceList.oldMarge.apply(null,arguments):(Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){"use strict";if(void 0===e||null===e)throw new TypeError("Cannot convert first argument to object");for(var n=Object(e),o=1;o<arguments.length;o++){var i=arguments[o];if(void 0!==i&&null!==i)for(var s=Object.keys(Object(i)),a=0,r=s.length;a<r;a++){var c=s[a],l=Object.getOwnPropertyDescriptor(i,c);void 0!==l&&l.enumerable&&(n[c]=i[c])}}return n}}),Object.assign.apply(null,arguments))},deepExtend:function(e){e=e||{};for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var o in n)n.hasOwnProperty(o)&&("object"==typeof n[o]?e[o]=serviceList.deepExtend(e[o],n[o]):e[o]=n[o])}return e},RGBToHex:function(e){var t=!1;if(e)if("#"===e.substr(0,1))t=e;else{var n=/(.*?)rgb\((\d+), (\d+), (\d+)\)/.exec(e),o=parseInt(n[2]),i=parseInt(n[3]),s=parseInt(n[4])|i<<8|o<<16;t=n[1]+"#"+s.toString(16)}return t},IntToBool:function(e){return serviceList.isBoolean(val)?val:"1"==val},BoolToIntEx:function(e){return!0===e?0:-1},isIE:function(){var tmp=document.documentMode,_isIE;try{document.documentMode=""}catch(e){}_isIE="number"==typeof document.documentMode||eval("/*@cc_on!@*/!1");try{document.documentMode=tmp}catch(e){}return _isIE},isIE6:function(){var e=navigator.appVersion,t=e.indexOf("MSIE");return"6"===e.slice(t+5,t+6)},isFuckingFirefox:function(){return"undefined"!=typeof InstallTrigger},LessOfTwo:function(e,t,n){var o,i;return parseInt(e)<parseInt(t)?(o=e,i=t):(o=t,i=e),n?o+"_"+i:{min:o,more:i}},formatDate:function(e,t){if(!e)return e;var n=serviceList.isString(e);n&&(e=e.split("."));var o=n?parseInt(e[2]):e.getFullYear(),i=o.toString().substring(2),s=n?parseInt(e[1]):e.getMonth()+1,a=s<10?"0"+s:s,r=n?parseInt(e[0]):e.getDate(),c=r<10?"0"+r:r,l=n?parseInt(e[3]):e.getHours(),d=l<10?"0"+l:l,m=n?parseInt(e[4]):e.getMinutes(),u=m<10?"0"+m:m,f=n?parseInt(e[5]):e.getSeconds(),g=f<10?"0"+f:f,_=n?parseInt(e[6]||"0"):e.getMilliseconds();_<10?_="00"+_:_>=10&&_<100&&(_="0"+_);var p=moment().locale(mcConst.Lang).month(parseInt(s)-1).format("MMMM");return t=t.replace(/yyyy/,o),t=t.replace(/yy/,i),t=t.replace(/mm/,a),t=t.replace(/m/,s),t=t.replace(/dd/,c),t=t.replace(/d/,r),t=t.replace(/hh/,d),t=t.replace(/h/,l),t=t.replace(/nn/,u),t=t.replace(/n/,m),t=t.replace(/ss/,g),t=t.replace(/s/,f),t=t.replace(/zzz/,_),t=t.replace(/MMM/,p)},DIV:function(e,t){var n=(e/t).toString(),o=n.indexOf(".");return n.slice(0,-1!==o?o:n.length)},CopyArray:function(e){return[].concat(e)},StringToArray:function(e,t){var n=[],o=-1;if(e){if(!1===serviceList.isIE())n=e.split(t)||[];else do{(o=e.indexOf(t))>=0&&(n.push(e.slice(0,o)),e=e.slice(o+1,e.length+1))}while(-1!==o);n.length&&0===n[n.length-1].length&&n.pop()}return n},GetSubstring:function(e,t){var n=e.indexOf(t);return-1!==n?e.slice(0,n):e.slice(0,e.length+1)},GetSubstringFrom:function(e,t){var n=e.indexOf(t);return-1!==n?e.slice(n+1,e.length+1):e.slice(0,e.length+1)},DelSubstring:function(e,t){var n=e.indexOf(t);return-1!==n?e.slice(n+1,e.length+1):""},delArrayItem:function(e,t,n){t>=0&&e.splice(t,n||1)},doGetCaretPosition:function(e){var t=0;if(document.selection){var n=document.selection.createRange();e.focus(),n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},inArray:function(e,t,n){var o;if(t)for(o=t.length,n=n?n<0?Math.max(0,o+n):n:0;n<o;n++)if(n in t&&t[n]===e)return n;return-1},inArrayLowerCase:function(e,t,n){var o;if(t)for(o=t.length,n=n?n<0?Math.max(0,o+n):n:0;n<o;n++)if(n in t&&t[n].toLowerCase()===e.toLowerCase())return n;return-1},inArrayNoStrict:function(e,t,n){var o;if(t)for(o=t.length,n=n?n<0?Math.max(0,o+n):n:0;n<o;n++)if(n in t&&t[n]==e)return n;return-1},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isString:function(e){return"[object String]"===Object.prototype.toString.call(e)},isHtmlElement:function(e){return 0===Object.prototype.toString.call(e).indexOf("[object HTML")},isNumber:function(e){return"[object Number]"===Object.prototype.toString.call(e)},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isBoolean:function(e){return"[object Boolean]"===Object.prototype.toString.call(e)},RandomHash:function(e,t){for(var n=t?"JjKAEeaMpsTt9QqRxBcDdF2fGgHh3ibC-kL7mNnPV85yr6SUuZ1WwXY4._vz!@#%$&*":"JjKAEeaMpsTt9QqRxBcDdF2fGgHhI3ibC-kL7mNnOPV85yr6SUuZo1WwXlY40._vz",o="",i=0;i<e;i++)o+=n[Math.floor(Math.random()*n.length)];return o},getRandomInt:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},GetType:function(e){return Object.prototype.toString.call(e)},isFormatedLikeIP:function(e){return/((((\d){1,3}\.){3})((\d){1,3}))/.test(e)},isValidFIO:function(e){return new RegExp(/^([\x27а-яА-Яa-zA-ZїЇіІєЄ]{2,}|[\x27а-яА-Яa-zA-ZїЇіІєЄ]{2,}\-[\x27а-яА-Яa-zA-ZїЇіІєЄ]{2,})\040[\x27а-яА-Яa-zA-ZїЇіІєЄ]{2,}|[\x27а-яА-Яa-zA-ZїЇіІєЄ]{2,}\040[\x27а-яА-Яa-zA-ZїЇіІєЄ]{2,}$/).test(e)},isValidEmailAddress:function(e){return new RegExp(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i).test(e)},isValidIpAddress:function(e){return/(^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?$))/.test(e)},isValidIpAddressV6:function(e){return/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(e)},isValidHostName:function(e){return/^[0-9a-zA-Z\-.]*$/.test(e)||serviceList.isValidIpAddressV6(e)},isValidIpRange:function(e){return/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)(-)((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/.test(e)},isValidIpMask:function(e){return/(^(((25([0-5]|\?)|2([0-4]|\?)(\d|\?)|([01]|\?)?(\d|\?)(\d|\?)?)|\*)\.){3}((25([0-5]|\?)|2([0-4]|\?)(\d|\?)|([01]|\?)?(\d|\?)(\d|\?)?)|\*)$)/.test(e)},isValidMACAddress:function(e){return/^([0-9a-fA-F]{2}([:-]|$)){6}$|([0-9a-fA-F]{4}([.]|$)){3}$/.test(e)},isHasNoRussianSymbol:function(e){return new RegExp(/[a-zA-Z0-9]/i).test(e)},isSymbolicNumbers:function(e){return new RegExp(/[a-zA-Z0-9а-яА-ЯїЇіІєЄ\s]/i).test(e)},isURL:function(e){return/(((http|https|ftp|ftps)(:\/\/)?|(:\/\/)(www\.)?|(www\.))[a-zа-я0-9-]+\.[a-zа-я0-9-]{2,6})/gi.test(e)},trim:function(e){return e.toString().replace(/^\s+|\s+$/g,"")},GetUserOS:function(){var e="",t=navigator.appVersion,n=navigator.oscpu;return e=serviceList.isIE()?t.split(";")[2]:null!==n||void 0!==n?n:t.slice(t.indexOf("(")+1,-1!=t.indexOf(";")?t.indexOf(";"):t.indexOf(")")),navigator.platform+" "+e},GetUserLanguage:function(){return(navigator.language?navigator.language:"")+(navigator.systemLanguage?navigator.systemLanguage:"")},GetUserRefLink:function(){return document.referrer},GetUserAgent:function(){return navigator.userAgent},GetUserBrowser:function(){return this.isIE()?"IE":"Opera"===navigator.appName?"Opera":"Apple Computer, Inc."===navigator.vendor?"Safari":"Google Inc."===navigator.vendor?"Chrome":navigator.oscpu?"FireFox":"Other Brouser"},pos:function(e,t){return t.indexOf(e)},copy:function(e,t,n){return e?e.slice(t,t+(n||e.length-t)):""},ReplaceURLs:function(e,t){var n=new RegExp("(?:\\b[a-z\\d.-]+://[^<>(\\s|\\)|\\(|\\[|\\])]+|\\b(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)(?::\\d{1,5})?|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])(?::\\d{1,5})?)(?:[;/][^#?<>\\s]*)?(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w)|(?:mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)(?::\\d{1,5})?|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])(?::\\d{1,5})?)(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w))","ig"),o=new RegExp("^[a-z\\d.-]+://","i"),i={"'":"`",">":"<",")":"(","]":"[","}":"{","В»":"В«","вЂє":"вЂ№"},s={callback:function(e,t){return t?'<a href="'+t+'" title="'+t+'">'+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};t=t||{};var a,r,c,l,d,m,u,f,g,_,p,h,v="",C=[];for(r in s)void 0===t[r]&&(t[r]=s[r]);for(;a=n.exec(e);)if(c=a[0],m=n.lastIndex,u=m-c.length,!/[\/:]/.test(e.charAt(u-1))){do{f=c,(p=i[h=c.substr(-1)])&&(g=c.match(new RegExp("\\"+p+"(?!$)","g")),_=c.match(new RegExp("\\"+h,"g")),(g?g.length:0)<(_?_.length:0)&&(c=c.substr(0,c.length-1),m--)),t.punct_regexp&&(c=c.replace(t.punct_regexp,function(e){return m-=e.length,""}))}while(c.length&&c!==f);l=c,o.test(l)||(l=(-1!==l.indexOf("@")?l.indexOf("mailto:")?"mailto:":"":l.indexOf("irc.")?l.indexOf("ftp.")?"http://":"ftp://":"irc://")+l),d!=u&&(C.push([e.slice(d,u)]),d=m),C.push([c,l])}for(C.push([e.substr(d)]),r=0;r<C.length;r++)v+=t.callback.apply(window,C[r]);return v||e},isObjectEmpty:function(e){var t=!0;if(e&&this.isObject(e))for(var n in e)t=!1;return t},StringToObj:function(e){var t=null;if(this.isString(e))try{t=JSON.parse(e)}catch(e){}return t||e},isNewNotificationSupported:function(){if(!window.Notification||!Notification.requestPermission)return!1;if("granted"==Notification.permission)return!1;try{new Notification("")}catch(e){if("TypeError"==e.name)return!1}return!0},CreateNotification:function(e){null!==serviceList.notify&&(clearTimeout(serviceList.idNotify),serviceList.notify.close(),serviceList.idNotify=0,serviceList.notify=null),!serviceList.noNotify&&serviceList.isNewNotificationSupported()&&(serviceList.notify=new Notification(e.title?e.title:"No title",serviceList.Marge({icon:mcConst.imagesPath.all+"75x75.png",tag:"list",body:"Empty"},e||{})),serviceList.idNotify=setTimeout(function(){serviceList.notify.close(),serviceList.idNotify=0,serviceList.notify=null},e.timeOut),serviceList.notify.onerror=function(){console&&console.warn("permission state = default or denied"),clearTimeout(serviceList.idNotify),serviceList.idNotify=0,serviceList.notify=null,serviceList.noNotify=!0},e.onShow&&(serviceList.notify.onshow=function(){e.onShow()}),e.click&&(serviceList.notify.onclick=function(){clearTimeout(serviceList.idNotify),serviceList.notify.close(),serviceList.idNotify=0,serviceList.notify=null,window.focus(),e.click()}),serviceList.notify.show&&serviceList.notify.show())},CheckNotification:function(e){var t=!1;return window.webkitNotifications||window.Notification?window.webkitNotifications&&0===window.webkitNotifications.checkPermission()||"granted"===Notification.permission?(t=!0,serviceList.noNotify=!1):window.Notification?Notification.requestPermission(function(e){"permission"in Notification||(Notification.permission=e)}):window.webkitNotifications.requestPermission(function(t){e="granted"===t,serviceList.noNotify=!e}):console.warn("Notifications are not supported for this Browser/OS version yet."),t},mobileDetection:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return this.Android()||this.BlackBerry()||this.iOS()||this.Opera()||this.Windows()||!1}},MyFormatTime:function(e,t){var n=e%60,o=parseInt(e/3600),i=parseInt(e/60)-60*o;return t?(i<10?"0"+i:i)+":"+(n<10?"0"+n:n):(o<10?"0"+o:o)+":"+(i<10?"0"+i:i)+":"+(n<10?"0"+n:n)},startOfDay:function(e){return e.getTime()-(1e3*e.getHours()*60*60+1e3*e.getMinutes()*60+1e3*e.getSeconds()+e.getMilliseconds())},detectLang:function(e){var t=(e="undefined"!==e&&e?e:null)||(window.navigator.language||window.navigator.userLanguage).slice(0,2).toLowerCase(),n=t;return"en"!==t&&"ru"!==t&&"uk"!==t?(t=MC_RESOURCE.TextSource.www[_api]+"en",n="en"):t=MC_RESOURCE.TextSource.www[_api]+t,webix.storage.local.put(mcConst.storageFields.lang,n),[t,n]},Lang:function(e,t,n){var o={};o=serviceList.isObject(e)?e:{id:e,items:t,term:n,html:!1};var i=mcConst[o.from?"LMSG_"+o.from:"LMSG"][o.id.toString()];return o.html&&(serviceList.isArray(o.items)?o.items.forEach(function(e,t){e&&(o.items[t]=e.replace(/</gi,"&lt;"))}):o.items&&(o.items=o.items.replace(/</gi,"&lt;"))),o.items?serviceList.myReplace(i,o.items,o.term):i},getElementByClass:function(e,t){var n=null,o=t||document;if(document.getElementsByClassName)n=o.getElementsByClassName(e);else{for(var i=o.getElementsByTagName("*"),s=i.length,a=e.split(/\s+/),r=a.length,c=[],l=0;l<s;l++)for(var d=0;d<r;d++)if(-1!=i[l].className.search("\\b"+a[d]+"\\b")){c.push(i[l]);break}n=c}return n},myReplace:function(e,t,n){var o=e,i=[];if(void 0!==t&&void 0!==e){var s=n||"%s";serviceList.isArray(t)?i=t:i.push(t),i.length>0&&(o=e.toString().replace(s,i.shift()),o=serviceList.myReplace(o,i,s))}return o},initResize:function(e,t){mcConst.scrResize=e,mcConst.isShowed=t},showView:function(e){e&&-1!==e.className.indexOf("hidden")&&(e.className=e.className.replace(" hidden",""))},hideView:function(e){e&&-1===e.className.indexOf("hidden")&&(e.className+=" hidden")},showCurrentView:function(e,t,n,o){o=o||{},mcConst.isShowed!==e&&(t.$broadcast("hide"+mcConst.isShowed),t.$broadcast("setLocation",["/"+t.currentRootPath+"/"+e+"/",o.callBack,o.title]),serviceList.showView(n),mcConst.isShowed=e)},getLangItemsFromList:function(e,t,n){var o=[];n=n||0;for(var i=e;i<=t;i++)o.push({id:(i-e+n).toString(),value:serviceList.Lang(i)});return o},getLanguagesItems:function(e,t,n){var o=[];n=n||0;for(var i=e;i<=t;i++)o.push({id:(i-e+n).toString(),value:mcConst.LanguagesList[i]});return o},GetFioFormatList:function(){return serviceList.getLangItemsFromList(975,983)},sortAB:function(e,t,n){return e>t?n?-1:1:e<t?n?1:-1:0},GetCountriesList:function(){var e=serviceList.getLanguagesItems(249,492,1).sort(function(e,t){return serviceList.sortAB(e.value.toLowerCase(),t.value.toLowerCase())});return e.unshift({id:"-1",value:serviceList.Lang(140)}),e},GetMaritalStatusList:function(){return serviceList.getLangItemsFromList(151,157,1)},GetSpokenLangList:function(){var e=serviceList.getLanguagesItems(180,248,1).sort(function(e,t){return serviceList.sortAB(e.value.toLowerCase(),t.value.toLowerCase())});return e.unshift({id:"-1",value:serviceList.Lang(140)}),e},GetInterestsList:function(){var e=serviceList.getLangItemsFromList(494,543,1);return e.unshift({id:"-1",value:serviceList.Lang(140)}),e},GetPastList:function(){var e=serviceList.getLangItemsFromList(546,553,1);return e.unshift({id:"-1",value:serviceList.Lang(140)}),e},GetPastOrgList:function(){var e=serviceList.getLangItemsFromList(554,573,1);return e.unshift({id:"-1",value:serviceList.Lang(140)}),e},GetWeekDays:function(){return serviceList.getLangItemsFromList(646,652)},SaveSessionSettings:function(e,t,n,o,i){serviceList.isObject(e)&&(t=e.pwd,n=e.servPwd,o=e.rm,e=e.login),webix.storage.local.put(mcConst.storageFields.Login,e),o?(webix.storage.local.put(mcConst.storageFields.Pwd,t),webix.storage.local.put(mcConst.storageFields.ServPwd,n),webix.storage.local.put(mcConst.storageFields.Rm,!0)):(webix.storage.local.remove(mcConst.storageFields.Pwd),webix.storage.local.remove(mcConst.storageFields.ServPwd),webix.storage.local.remove(mcConst.storageFields.Rm))},LoadSessionSettings:function(){var e={};return e.login=webix.storage.local.get(mcConst.storageFields.Login),e.pwd=webix.storage.local.get(mcConst.storageFields.Pwd),e.servPwd=webix.storage.local.get(mcConst.storageFields.ServPwd),e.rm=webix.storage.local.get(mcConst.storageFields.Rm),e},ClearSessionSettings:function(e,t){e||webix.storage.local.remove(mcConst.storageFields.Login),webix.storage.local.remove(mcConst.storageFields.Pwd),webix.storage.local.remove(mcConst.storageFields.ServPwd),webix.storage.local.remove(mcConst.storageFields.Rm),t?webix.storage.local.put(mcConst.storageFields.AutoRld,!0):webix.storage.local.remove(mcConst.storageFields.AutoRld)},toNormalDate:function(e,t){serviceList.isString(e)&&(e=e.split("."));var n=e[0]+"."+e[1]+"."+e[2],o=e[3]+":"+e[4]+":"+e[5];return n+(t?" "+o:"")},sortableDate:function(e,t){var n=e.split(".");return n[2]+"."+n[1]+"."+n[0]+" "+n[3]+":"+n[4]+(t?"":":"+n[5])},secToTime:function(e){var t=e%60,n=parseInt(e/86400);e-=86400*n;var o=parseInt(e/3600),i=parseInt(e/60)-60*o;return n+":"+(o<10?"0"+o:o)+":"+(i<10?"0"+i:i)+":"+(t<10?"0"+t:t)},formatNumber:function(e){for(var t=e.toString(),n=[],o=1,i=t.length-1;i>=0;i--)n.unshift((3===o?" ":"")+t[i]),o=3===o?1:o+1;return n.join("")},convertBool:function(e){switch(e){case!0:e="1";break;case!1:e="0";break;default:e+=""}return e},convertIntToBool:function(e){return serviceList.isBoolean(e)?e:1==e},clearPlaneObj:function(e){for(var t in e)e[t]=null},Queue:function(e,t){function n(){return setInterval(function(){if(!r&&i.length>0){r=!0;var e=serviceList.isArray(a[0])?a[0]:[a[0]];i[0].apply(o,e)}},c)}var o=this,i=[],s=t||!1,a=[],r=!1,c=e||1e3,l=null;this.next=function(){i.length>0?(i.shift(),a.shift(),r=!1):s||(clearInterval(l),o=null)},this.addTask=function(e,t){return 0!==i.length||r||(l=n()),i.push(e),a.push(t),i.length}},TaskList:function(e){var t=this,n=[],o={};this.AddTask=function(e){n.push(e)},this.Next=function(){n[0]?n.shift().apply(o,arguments):t=null},this.Run=function(){t.Next()},o=serviceList.Marge({next:t.Next,Next:t.Next},e||{})},transformDataObject:function(e,t){var n=[];if(e&&t)for(var o=0;o<e.length;o++){for(var i={},s=0;s<t.length;s++)i[t[s][1]]=e[o][t[s][0]].toString();n.push(i)}else n=e;return n},networkInterfaces:function(e,t){for(var n=0==e?"IPv4":"IPv6",o=[].concat(t[n]),i=0;i<o.length;i++)o[i]={id:o[i],value:"0.0.0.0"==o[i]||"::"==o[i]?serviceList.Lang(667):o[i]};return o},correctStringWithCRLF:function(e){return serviceList.isString(e)?e.replace(/(?!\r)\n/g,"\r\n"):e},removeCRFL:function(e){return e.toString().replace(/\n/g,"<br>").replace(/\r/g,"")},initChangesApplyForSettings:function(e,t,n,o,i){function s(){e.changedData.data.Items={},e.changedData.data.Desc="",e.changedData.data.ShowDesc=!1}function a(n,o){e.changedData.data.ShowDesc=!0,e.changedData.data.Items[n]=serviceList.correctStringWithCRLF(o),e.changedData.data.Desc=serviceList.Lang(590);var i="";for(var s in e.changedData.data.Items)i=e.changedData.data.Items[s].toString().replace(/\\/g,"\\\\").replace(/</g,"&lt;"),e.changedData.data.Desc+="<br>"+s+": <b>"+(-1!==s.indexOf("PWD")||-1!==s.toLowerCase().indexOf("pass")||"UseConnPass"===s?"*****":i)+"</b>";t.$broadcast("show"+mcConst.dataModels.ApplyPanel,[e.changedData])}function r(e,t){e[t]&&-1===["\\","/"].indexOf(e[t][e[t].length-1])&&(e[t]+="\\")}var c={};i=i||mcConst.dataModels.SettingsNetwork,e.changedData={data:{Desc:"",Items:{},ShowDesc:!1,Reopen:!1},clearChangedData:s,onApply:function(){e.data=serviceList.Marge(e.data,e.changedData.data.Items),c=serviceList.Marge({},e.changedData.data.Items);var n={};e.changedData.data.Items.hasOwnProperty("TURNPortTCP")&&(n.turn=e.changedData.data.Items.TURNPortTCP),e.changedData.data.Items.hasOwnProperty("WEBTCPPort")&&(n.web=e.changedData.data.Items.WEBTCPPort),e.changedData.data.Items.hasOwnProperty("TCPPort")&&(n.core=e.changedData.data.Items.TCPPort),e.changedData.data.Items.hasOwnProperty("FTPPort")&&(n.ftp=e.changedData.data.Items.FTPPort),e.changedData.data.Items.hasOwnProperty("FTPPortsPool")&&(n.ftprange=e.changedData.data.Items.FTPPortsPool),e.changedData.data.Items.hasOwnProperty("TURNExternalConfig")&&(n.turnconfig=e.changedData.data.Items.TURNExternalConfig),Object.keys(n).length?t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_adm_check_ports,mcConst.SessionID,JSON.stringify(n),function(){e.applyChange(e.data),s()}]):(e.applyChange(e.data),s())},onClose:function(){e.$emit("show"+e.Name,[]),s()}},e.change=function(n,o){if(!e.skipChangeNow){var s=serviceList.copy(this.config.id,3),r=!0;void 0==n&&(n=this.getValue()),void 0===o&&(o=t.mcStorage[i][s]),this.config.pathAlias?(n=serviceList.trim(n.replace(/\W/gi,"")),this.$setValue(n)):"checkbox"===this.config.view?(n=serviceList.convertIntToBool(n),o=serviceList.convertIntToBool(o)):"port"===this.config.mcType?r=!isNaN(parseInt(n))&&n&&n>0&&n<65534:"stgRobotAvatarNum"===this.config.id?r=/^\d+$/.test(n)&&n>=0&&n<=239:"stgRobotName"===this.config.id?r=""!==serviceList.trim(n):"stgExternalIP"!==this.config.id&&"stwExternalIP"!==this.config.id||((r=!(!serviceList.isValidIpAddress(n)&&!serviceList.isValidHostName(n))&&-1===serviceList.trim(n).indexOf(":"))||(n=t.mcStorage[i][s]),a(s,n)),r&&mcConst.isShowed===e.Name&&serviceList.correctStringWithCRLF(n)!==o?(this.config.pathAlias&&!n&&(n=o),a(s,n)):"text"!==this.config.view&&"textarea"!==this.config.view&&this.$setValue(o)}},e.changeExc=function(){if(this.config&&"counter"===this.config.view||"text"===this.config.view){var t=this.getValue(),n=e.data[serviceList.copy(this.config.id,3)];isNaN(t)?(e.change.apply(this,[n,1]),this.$setValue(n)):e.change.apply(this,[t,n])}},e.applyChange=function(s){e._onApply&&e._onApply(s),["BackupsDir","FTPPublicDir","FTPPersonalDir","FilesDir","LogsDir"].forEach(function(e){r(s,e)});var a=JSON.stringify(s,function(e,t){return t});t.$broadcast("SendCMDToServer",[n,mcConst.SessionID,a,function(){webix.message(o(c)),t.mcStorage[i]=serviceList.Marge(t.mcStorage[i],c||{})}]),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_adm_get_server_options,mcConst.SessionID])}},openNewWindow:function(e){var t=window.open(e,"","menubar=no,resizable=0,directories=no,location=no,toolbar=no,status=no,screenX=0,screenY=0,width=1000,height=600");t&&t.focus()},onOffToBool:function(e){return serviceList.isBoolean(e)?e:"on"==e},InObject:function(e,t){var n=!1;for(var o in t)if(e==t[o]){n=!0;break}return n},getIdxByIdFromData:function(e,t){for(var n=null,o=0;o<e.length;o++)if(e[o].id==t){n=o;break}return n},getIdxByNameFromData:function(e,t,n){for(var o=null,i=0;i<e.length;i++)if(void 0!==e[i][t]&&e[i][t]==n){o=i;break}return o},getValueByNameFromData:function(e,t,n){for(var o="",i=0;i<e.length;i++)if(void 0!==e[i][t]&&e[i][t]==n){o=e[i][t];break}return o},oldLicenseKey:function(e){var t=!1;return(t=/^([A-Z0-9]{4}\-){6}[A-Z0-9]{4}$/.test(serviceList.trim(e)))&&(t=serviceList.trim(e)),t},checkLicenseKey:function(e){var t=!1;return(t=/^([A-F0-9]{4}\-){10}[A-F0-9]{4}$/.test(serviceList.trim(e)))&&(t=serviceList.trim(e)),t},checkGuestKey:function(e){var t=!1;return(t=/^([A-F0-9]{4}\-){5}[A-F0-9]{4}$/.test(serviceList.trim(e)))&&(t=serviceList.trim(e)),t},checkQuizKey:function(e){var t=!1;return(t=/^[A-F0-9]{6,8}\-([A-F0-9]{4}\-){3}[A-F0-9]{4}$/.test(serviceList.trim(e)))&&(t=serviceList.trim(e)),t},renameProperty:function(e,t){return this.hasOwnProperty(e)&&(this[t]=serviceList.trim(this[e]),delete this[e]),this},ListButtonSet:function(e){function t(){i.actions.save&&i.actions.save.apply(null,c.fields)&&n()}function n(){c.fields[0]&&c.fields[0].hasOwnProperty("getPopup")&&c.fields[0].getPopup().hide(),$$(r).hide(),$$(a).show(),i.hideSearchField&&$$(i.hideSearchField).show()}function o(){webix.UIManager.addHotKey("Enter",function(){return t(),!1},this),webix.UIManager.addHotKey("Esc",function(){return n(),!1},this)}var i=serviceList.Marge({type:"1",actions:{del:null,clear:null,save:null,preview:null,enable:null,disable:null},text:{field1:"",field2:"",field3:""},visibleBtns:{add:!0,del:!0,cls:!0},list:null,listData:[],regShowWindow:null,selectedItem:"value"},e||{}),s=null;if(serviceList.isFunction(i._back)&&i._back(n),i.regShowWindow){var a=serviceList.RandomHash(10),r=serviceList.RandomHash(10),c={fieldBlock:null,fields:[],list:null};switch(s={rows:[{id:a,cols:[{view:"button",value:serviceList.Lang(50),hidden:!i.visibleBtns.add,click:function(){if($$(a).hide(),$$(r).show(),i.hideSearchField&&$$(i.hideSearchField).hide(),!c.fields[0])throw new Error("No fields found!");3==i.type&&"combo"===i.type||(c.fields[0].setValue(""),c.fields[1]&&c.fields[1].setValue("")),c.fields[0].focus(),i.actions.preview&&i.actions.preview(c.fields[0]),i.actions.afterShow&&i.actions.afterShow(c.fields)},css:"applyButton"},{view:"button",value:serviceList.Lang(52),hidden:!i.visibleBtns.del,click:function(){var e=$$(i.list),t=e.getSelectedItem();if(t&&i.actions.del){var n=t[i.selectedItem]?t[i.selectedItem].length:0,o=serviceList.Lang(1078,n>15?serviceList.copy(t[i.selectedItem],0,15)+"...":t[i.selectedItem]);serviceList.isArray(t)&&(o=serviceList.Lang(1142)),i.regShowWindow(serviceList.RandomHash(4),webix.confirm({type:"confirm-warning",text:o,ok:serviceList.Lang(581),cancel:serviceList.Lang(103),callback:function(n){if(n){if(i.actions.del(t,e),serviceList.isArray(t)){for(var o=0;o<t.length;o++)serviceList.remove(t[o].id);webix.message(serviceList.Lang(1506))}else webix.message(serviceList.Lang(1077,t[i.selectedItem])),e.remove(t.id);i.actions.afterDel&&i.actions.afterDel(e)}}}))}},type:"danger"},{view:"button",value:serviceList.Lang(619),hidden:!i.visibleBtns.cls,click:function(){i.regShowWindow(serviceList.RandomHash(4),webix.confirm({type:"confirm-warning",text:serviceList.Lang(1072),ok:serviceList.Lang(581),cancel:serviceList.Lang(103),callback:function(e){e&&i.actions.clear()&&$$(i.list).clearAll()}}))}}]},{id:r,hidden:!0,rows:[{}]}]},i.type){case"textComment":case"1":s.rows[1].rows=[{view:"text",placeholder:i.text.field1,on:{onAfterRender:function(){c.fields[0]=this,o.apply(this,arguments)}}},{cols:[{view:"text",placeholder:i.text.field2,on:{onAfterRender:function(){c.fields[1]=this,o.apply(this,arguments)}}},{view:"button",value:serviceList.Lang(104),width:100,click:t},{view:"button",value:serviceList.Lang(103),width:100,click:n,type:"danger"}]}];break;case"text":case"2":s.rows[1].cols=[{view:"text",placeholder:i.text.field1,on:{onAfterRender:function(){c.fields[0]=this,o.apply(this,arguments)}}},{view:"button",value:serviceList.Lang(104),width:100,click:t},{view:"button",value:serviceList.Lang(103),width:100,click:n,type:"danger"}];break;case"combo":case"3":s.rows[1].cols=[{view:"combo",options:i.listData,on:{onAfterRender:function(){c.fields[0]=this,o.apply(this,arguments)}}},{view:"button",value:serviceList.Lang(13),width:100,click:t,css:"applyButton"},{view:"button",value:serviceList.Lang(103),width:100,click:n,type:"danger"}];break;case"textRichselectComment":case"4":s.rows[1].rows=[{cols:[{view:"text",placeholder:i.text.field1,on:{onAfterRender:function(){c.fields[0]=this,o.apply(this,arguments)}}},{view:"richselect",placeholder:i.text.field2,options:i.listData,on:{onAfterRender:function(){c.fields[1]=this}}}]},{cols:[{view:"text",placeholder:i.text.field3,on:{onAfterRender:function(){c.fields[2]=this,o.apply(this,arguments)}}},{view:"button",value:serviceList.Lang(104),width:100,click:t},{view:"button",value:serviceList.Lang(103),width:100,click:n,type:"danger"}]}]}}else{var l='Needs "regShowWindow" for show popup windows in '+i.list;console.error(l),webix.message({type:"error",text:l,expire:2*mcConst.errMessageExpire})}return s},findItemInArrayOfObj:function(e,t,n,o){for(var i=0;i<e.length;i++)if(n){if(o){if(e[i][n].toLowerCase()==t.toLowerCase())return i}else if(e[i][n]==t)return i}else for(var s in e[i])if(o){if(e[i][s].toLowerCase()==t.toLowerCase())return i}else if(e[i][s]==t)return i;return-1},ContextMenu:function(e,t,n,o){function i(){e.selectAll?e.selectAll():e.selectRange(e.getFirstId(),e.getLastId())}return t&&t.destructor(),webix.ui({view:"context",width:220,master:e,body:{rows:[{view:"button",value:serviceList.Lang(1105),click:function(){i();var e=this.getTopParentView();n&&n.call(e.getContext().obj,"selectAll"),e.hide()}},{view:"button",value:serviceList.Lang(1106),click:function(){e.unselectAll?e.unselectAll():e.clearSelection();var t=this.getTopParentView();n&&n.call(t.getContext().obj,"clear"),t.hide()}},{view:"button",value:serviceList.Lang(1107),click:function(){var t=e.getSelectedItem();serviceList.isObject(t)&&(t=[t]),i();for(var o=this.getTopParentView(),s=0;t&&s<t.length;s++)e.unselect(t[s].id);n&&n.call(o.getContext().obj,"invert"),o.hide()}}]},on:{onShow:function(){o&&o.apply(this,[])}}})},getAllUserForFillList:function(e,t,n){var o=n.mcStorage[mcConst.dataModels.UserManager];o&&"All"===o.Params&&!e.length?t.apply(o,[o.Users]):(!o||"All"!==o.Params||e.length>0&&o.Users.length!==e.length)&&n.$broadcast("getAllUserList",[!1,function(){o=n.mcStorage[mcConst.dataModels.UserManager],t.apply(o,[o.Users])}])},getAllUserWithParams:function(e,t,n){var o=t.mcStorage[mcConst.dataModels.UserManager];o&&"All"===o.Params&&"All"===n?e.apply(o,[o.Users]):t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_adm_list_users,mcConst.SessionID,n?n.Params||"All":"All",n?n.Filters||mcConst.userFields:mcConst.userFields,function(n){t.mcStorage.UserManager=n,e.apply(n,[n.Users])}])},getMcSettings:function(e,t,n){!e.mcStorage.SettingsNetwork||n?e.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_adm_get_server_options,mcConst.SessionID,function(n){e.mcStorage.SettingsNetwork=n,e.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_adm_get_server_info,mcConst.SessionID,function(n){e.mcStorage.ServerInfo=n,t&&t()}])}]):t&&t()},getTitle:function(e){var t="";switch(e){case"ServerInfo":t=serviceList.Lang(10);break;case"UserManager":t=serviceList.Lang(49);break;case"UserProfile":t=serviceList.Lang(1484);break;case"GroupRights":t=serviceList.Lang(57);break;case"GroupUsers":t=serviceList.Lang(916);break;case"Contacts":t=serviceList.Lang(587);break;case"WorkPositions":t=serviceList.Lang(588);break;case"WebSupport":t=serviceList.Lang(938);break;case"MyChatGuest":t=serviceList.Lang(945);break;case"LicenseMyChat":t=serviceList.Lang(944);break;case"LicenseGuest":t=serviceList.Lang(945);break;case"UsersImports":t=serviceList.Lang(960);break;case"Operators":t=serviceList.Lang(817);break;case"Bans":t=serviceList.Lang(1029);break;case"AutoChannels":t=serviceList.Lang(1039);break;case"RemoteSettings":t=serviceList.Lang(1329);break;case"History":t=serviceList.Lang(1134);break;case"FilterAntiflood":t=serviceList.Lang(1057);break;case"FilterBadWords":t=serviceList.Lang(1058);break;case"FilterIP":t=serviceList.Lang(1059);break;case"FilterMAC":t=serviceList.Lang(1060);break;case"FilterNames":t=serviceList.Lang(1061);break;case"SettingsNetwork":t=serviceList.Lang(591);break;case"SettingsInfo":t=serviceList.Lang(596);break;case"SettingsLogs":t=serviceList.Lang(598);break;case"SettingsFTP":t=serviceList.Lang(599);break;case"SettingsWEB":t=serviceList.Lang(600);break;case"SettingsBackup":t=serviceList.Lang(601);break;case"SettingsService":t=serviceList.Lang(602);break;case"SettingsAPI":t=serviceList.Lang(603);break;case"SettingsSMTP":t=serviceList.Lang(921);break;case"Others":t=serviceList.Lang(672)}return t},formatDeptList:function(e){for(var t="",n={},o=0,i=[],s=[],a=[];e.length>0||o<e.length;)0==e[o].ParentID?(s.push(e[o]),e.splice(o,1)):-1==serviceList.findItemInArrayOfObj(s,e[o].ParentID,"GroupID")?o++:(s.push(e[o]),e.splice(o,1)),e.length>0&&o==e.length&&(o=0);for(o=0;o<s.length;o++)0==s[o].ParentID?n[s[o].GroupID]=0:n[s[o].GroupID]=n[s[o].ParentID]+1,t=new Array(n[s[o].GroupID]+1).join("&#151;"),i.push({id:s[o].GroupID,value:t+s[o].GroupName});for(o=0;o<s.length;o++)0==s[o].ParentID?a.push(i[o]):a.splice(serviceList.findItemInArrayOfObj(a,s[o].ParentID,"id")+1,0,i[o]);return a},copyToBuffer:function(){return setTimeout(function(){webix.message(serviceList.Lang(1483))},10),$$("logsContainer").$view.innerText.replace(/\n/g,"\r\n")},convertDomainToDn:function(e){if(-1===e.indexOf("=")){e=e.split(".");for(var t=0;t<e.length;t++)e[t]="DC="+e[t];e=e.join(",").toUpperCase()}else e=e.toUpperCase();return e},convertDataToTree:function(e,t){function n(e,n){var o=null;if(e.IsGroup)o={DisplayName:e.GroupName||e.DisplayName,id:e.ID||e.id,ParentID:e.ParentID,GroupID:e.GroupID,IsGroup:!0,folder:!0,data:e.data||[]};else{if(!t&&e.UIN==mcConst.UserInfo.UIN)return!1;o={DisplayName:e.DisplayName,id:e.ID||e.id,ParentID:e.ParentID,State:e.State,UIN:e.UIN,TeamLead:e.TeamLead}}return n.push(o),!0}for(var o=[],i=[],s=[].concat(e),a=0;s.length>0;){if(0==s[a].ParentID)n(s[a],o)&&n(o[o.length-1],i),s.splice(a,1);else{var r=serviceList.findItemInArrayOfObj(i,s[a].ParentID,"GroupID");r>=0?(n(s[a],i)&&n(i[i.length-1],i[r].data),s.splice(a,1)):a++}a==s.length&&(a=0)}return o},hideFrame:function(e){var t=document.getElementById(e);t&&(t.style.display="none")},showFrame:function(e){var t=document.getElementById(e);t&&(t.style.display="block")},getFrame:function(e,t){var n=t||document.getElementById(e);return!n||n.showFrame||n.hideFrame||(n.showFrame=function(){serviceList.showFrame(e)},n.hideFrame=function(){serviceList.hideFrame(e)}),n},convertObjToArray:function(e,t,n){var o=[];for(var i in e)serviceList.isObject(e[i])&&(t&&(e[i][t]=i),o.push(n?serviceList.Marge({},e[i]):e[i]));return o},getStateStatuses:function(e){return{Online:e.Online?serviceList.StringToArray(e.Online,","):serviceList.StringToArray(e.Users,","),Offline:e.Offline?serviceList.StringToArray(e.Offline,","):[],States:e.States?serviceList.StringToArray(e.States,","):serviceList.StringToArray(e.Statuses,",")}},addEvent:function(e,t,n){null!=e&&void 0!==e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n)},getWindowSize:function(){var e=0,t=0;return"number"==typeof window.innerWidth?(e=window.innerWidth,t=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(e=document.documentElement.clientWidth,t=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(e=document.body.clientWidth,t=document.body.clientHeight),{width:e,height:t}},convertDnArrayToTreeTable:function(e,t){function n(e,t,i){if(t.length){var s=t.pop().replace("CN=","");i=i||o;var a=serviceList.findItemInArrayOfObj(i,s,"value");n(e,t,-1===a?function(n,o){var i={value:o};return 0===t.length?i=serviceList.Marge(i,e):(i.$row="value",i.open=!0,i.data=[]),n.push(i),i}(i,s).data:i[a].data)}}for(var o=[],i={},s="distinguishedName",a=0;a<e.length;a++)e[a][s]=e[a][s].replace(","+t,""),i[e[a][s]]||(i[e[a][s]]=e[a][s].split(","),n(e[a],[].concat(i[e[a][s]]),null));return o},makeIceServers:function(e,t){var n=[],o=e.IPList.split(",");""===o[0]&&(o[0]=t?window.location.host:mcConst.ServerInfo.Host);for(var i=0;i<o.length;i++){var s="turn:"+o[i]+":"+e.TURNPort+"?transport=tcp",a="turn:"+o[i]+":"+e.TURNPort+"?transport=udp";n.push({urls:[].concat(t?s:[]).concat(t||mcConst.ClientSettings&&mcConst.ClientSettings.MediaNetworkTransportTCP?s:[]).concat(t||mcConst.ClientSettings&&mcConst.ClientSettings.MediaNetworkTransportUDP?a:[]),credential:e.Credential,username:e.UserName})}return n},checkRightsCollection:function(e,t){for(var n=!1,o=null,i=0;i<e.length;i++)o=parseInt(e[i])-1,n=t?n&&"1"==mcConst.MyRightsSet.RightsSet[o]:n||"1"==mcConst.MyRightsSet.RightsSet[o];return n},MyTimer:function(e){var t=0,n=null;this.Start=function(){t=0,clearInterval(n),n=setInterval(function(){t++,e&&e.text(serviceList.MyFormatTime(t,!0))},1e3)},this.Pause=function(e){clearInterval(n),t=e||t},this.Stop=function(){return e&&e.text(serviceList.MyFormatTime(0,!0)),clearInterval(n),serviceList.MyFormatTime(t,!0)}},openLink:function(e,t){var n=t||"menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes";window.open(e,"",n)},showImportResult:function(e,t){var n=[],o=[],i=[],s="";if(e&&e.Results&&e.Users){for(var a=0;a<e.Results.length;a++)switch(e.Results[a]){case"0":case 0:n.push(e.Users[a]);break;case"1":case 1:o.push(e.Users[a]);break;default:i.push(e.Users[a])}n.length&&(s+="<span class='blue _grName'>"+mcLang(1552)+"</span><br>",s+=n.join("<br>")+"<br><br>"),o.length&&(s+="<span class='green _grName'>"+mcLang(1553)+"</span><br>",s+=o.join("<br>")+"<br><br>"),i.length&&(s+="<span class='red _grName'>"+mcLang(1554)+"</span><br>",s+=i.join("<br>"));var r=webix.ui({view:"window",position:"center",modal:!0,width:300,height:500,head:mcLang(971),body:{rows:[{template:s,borderless:!0,scroll:"y"},{view:"button",value:mcLang(12),click:function(){this.getTopParentView().hide(),this.getTopParentView().destructor()}}]}});t.regShowWindow(serviceList.RandomHash(4),r),r.show(),(n.length||o.length)&&t.$broadcast("refreshUserManagerOnNextShow",[])}},getUserStateText:function(e,t){var n="";switch(e){case mcConst.states.offline:n=serviceList.Lang(1641);break;case mcConst.states.online:case mcConst.states.webOnline:n=(t?"":'<span class="green">')+serviceList.Lang(1642)+(t?"":"</span>");break;case mcConst.states.away:n=(t?"":'<span class="blue">')+serviceList.Lang(1643)+(t?"":"</span>");break;case mcConst.states.dnd:n=(t?"":'<span class="red">')+serviceList.Lang(1644)+(t?"":"</span>")}return n},getColorForStatus:function(e){var t="#545454";switch(e=parseInt(e)){case mcConst.states.offline:t="#545454";break;case mcConst.states.online:case mcConst.states.webOnline:t="#24F427";break;case mcConst.states.away:t="blue";break;case mcConst.states.dnd:t="red"}return t},smartReplace:function(e,t){for(var n in t)e=e.replace(new RegExp("{"+n+"}","g"),t[n]);return e},getIPs:function(e){function t(t){var o=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(t)[1];void 0===n[o]&&e(o),n[o]=!0}var n={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;window.webkitRTCPeerConnection;if(!o){var i=iframe.contentWindow;o=i.RTCPeerConnection||i.mozRTCPeerConnection||i.webkitRTCPeerConnection,!!i.webkitRTCPeerConnection}var s=new o({iceServers:[{urls:"stun:stun.services.mozilla.com"}]},{optional:[{RtpDataChannels:!0}]});s.onicecandidate=function(e){e.candidate&&t(e.candidate.candidate)},s.createDataChannel(""),s.createOffer(function(e){s.setLocalDescription(e,function(){},function(){})},function(){}),setTimeout(function(){s.localDescription.sdp.split("\n").forEach(function(e){0===e.indexOf("a=candidate:")&&t(e)})},1e3)},treeWalker:function(e,t,n){if(serviceList.inArray(e))for(var o=0;o<e.length;o++)n&&n(e[o]),e[o].hasOwnProperty(t)&&serviceList.treeWalker(e[o][t],t,n)},updateStatuses:function(e,t){function n(t){t.hasOwnProperty("UIN")&&(e.Statuses&&e.Users?t.State=e.Statuses[e.Users.indexOf(t.UIN.toString())]:t.State=void 0!==e[t.UIN.toString()]?e[t.UIN.toString()]:mcConst.states.offline)}e&&t&&(serviceList.isArray(t)?t.forEach(n):t.each(n))},getCaretPosition:function(e){var t=0;if(document.selection){var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else(e.selectionStart||"0"==e.selectionStart)&&(t=e.selectionStart);return t},setCaretPosition:function(e,t){if(e.setSelectionRange)e.setSelectionRange(t,t);else if(e.createTextRange){var n=e.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",t),n.select()}},goToHelp:function(e,t){var n=(e||window.location.hash).replace(/^#\/|^\/|\/$/g,""),o=serviceList.isIE()?window.location.protocol+"//"+window.location.host:window.location.origin;0===e.toLowerCase().indexOf("http")?window.open(e,"",""):mcConst.accordance.hasOwnProperty(n)&&""!==mcConst.accordance[n]?window.open(o+mcConst.accordance[n],"",""):t&&window.open(o+"/"+n,"","")},HotkeyManager:function(e){function t(e,t){return(e.ctrlKey?"ctrl+":"")+(e.shiftKey?"shift+":"")+(e.altKey?"alt+":"")+t}function n(e,n){var o=null;return c[e].source.forEach(function(e){t(e,e.key)==n&&(o=e)}),o}function o(o,i){for(var s=i.source,a=0;a<s.length;a++){var f=t(s[a],s[a].key);r.hasOwnProperty(f)||(r[f]={}),e&&console.log("Registered key: "+f+"\npreset: "+o),r[f][o]=s[a].func,m[f]?m[f].push(i.marker):m[f]=[i.marker]}i.target&&!i.ID&&(i.ID=webix.event(i.target,"keydown",function(o){var i=t(o,o.keyCode),s=!1,a=this;if(r.hasOwnProperty(i)&&a.hasOwnProperty(u)&&m.hasOwnProperty(i)&&-1!=m[i].indexOf(a[u])){if(e&&(console.log("Fired key: "+i),console.log(o)),!d.hasOwnProperty(i)){d[i]="fired";for(var f in r[i])if(a[u]==c[f].marker)if(c[f].level==l)n(f,i)._locked||(s=!r[i][f].call(a,o));else{var g=c[f].source;for(var _ in g)if(t(g[_],g[_].key)==i){s=g[_].skipDefault;break}}!function(e){setTimeout(function(){delete d[e]},10)}(i)}if(s)return o.preventDefault(),!1}}))}function i(t){for(var n in r)if(r[n].hasOwnProperty(t)){if(c[t].level==l&&l>0){var o=0,i=0;Object.keys(c).forEach(function(e){c[e].level==c[t].level&&o++,c[e].level>i&&c[e].level!==l&&(i=c[e].level)}),1==o&&(l=i)}e&&console.log("Removing key: "+n+"\npreset: "+t),a(n,c[t].key),m[n].splice(m[n].indexOf(c[t].marker),1),0==m[n].length&&delete m[n],delete r[n][t]}webix.eventRemove(c[t].ID),delete c[t]}function s(e,n){for(var o in c)c[o].source.forEach(function(i){o!=n&&e==t(i,i.key)&&(i.hasOwnProperty("_locked")?i._locked++:i._locked=1)})}function a(e){for(var n in c)c[n].source.forEach(function(n){e==t(n,n.key)&&n.hasOwnProperty("_locked")&&n._locked>0&&n._locked--})}var r={},c={},l=0,d={},m={},u="hotKeyMarker"+serviceList.RandomHash(5);this.addPreset=function(e,n,i,a){if(c.hasOwnProperty(e))return!1;var r=serviceList.RandomHash(10);i.hasOwnProperty(u)?r=i[u]:i[u]=r,c[e]={source:n,target:i,marker:r,ID:null},a?l++:n.forEach(function(n){n.lockPrev&&s(t(n,n.key),e)}),c[e].level=l,o(e,c[e])},this.removePreset=function(e){if(!c.hasOwnProperty(e))return!1;i(e)}},utcTime:function(e,t){var n=serviceList.isNumber(e)?new Date(e):e.dtUTC||e.dt||e;return n?serviceList.formatDate(new Date((new(Function.prototype.bind.apply(Date,[null].concat(serviceList.formatDate(n,"yyyy.mm.dd.hh.nn.ss.zzz").split(".").map(function(e,t){return 1===t?e-1:e}))))).getTime()+1e3*(new Date).getTimezoneOffset()*60*(t?1:-1)),"dd.mm.yyyy.hh.nn.ss.zzz"):""},reloadOrChangeProtocol:function(){mcConst.changeProtocol&&mcConst.changeProtocol!==location.protocol?(location.protocol=mcConst.changeProtocol,window.open(location.href)):(location.search="",location.reload(!0))},myReplaceFormated:function(e,t){if(serviceList.isObject(t)&&serviceList.isString(e))for(var n in t)e=e.replace(new RegExp("#{"+n+"}","g"),t[n]);return e},createKanbanLink:function(e,t,n){return serviceList.getLocalHostPath("file:"!==location.protocol)+"/"+mcConst.pathAliases.AliasKanban+"/#project="+e+(t?"&task="+t+(n?"&comment="+n:""):"")},createForumLink:function(e){return serviceList.isIE()?window.location.protocol+"//"+window.location.host+window.location.pathname+mcConst.pathAliases.AliasForum+"/#"+e:window.location.origin+window.location.pathname+mcConst.pathAliases.AliasForum+"/#"+e},getCommonFilesPath:function(e){return this.myReplaceFormated("ftp://#{user}:#{pwd}@#{host}:#{port}/",{host:e?window.location.host:mcConst.ServerInfo.Host,user:mcConst.FTP.CommonUser,pwd:mcConst.FTP.CommonPWD,port:mcConst.UserInfo.PortFTP})},SHA1:function(){var e=new Rusha;return e.resetState(),e},convertToEntities:function(e){var t="";if(!e)throw new Error("convertToEntities: incoming data is empty or undefined: "+e);for(var n=0;n<e.length;++n)e.charCodeAt(n)>127?t+="\\u"+function(e){var t="0000";return e>=0&&e<=15?t="000"+e.toString(16):e>=16&&e<=255?t="00"+e.toString(16):e>=256&&e<=4095?t="0"+e.toString(16):e>=4096&&e<=65535&&(t=e.toString(16)),t}(e.charCodeAt(n)):t+=e.charAt(n);return t},extractFileName:function(e){for(var t=0,n=e.length-1;n>=0;n--)if(t++,"\\"===e[n]||"/"===e[n])return e.slice(n+1,n+t);return e},extractFileExtension:function(e){var t=(e||"").split(".");return t[t.length-1]},getLocalHostPath:function(e){return e?serviceList.isIE()?window.location.protocol+"//"+window.location.host:window.location.origin:(mcConst.UserInfo.HTTPS?"https://":"http://")+(mcConst.ServerInfo.IPv6?"["+mcConst.ServerInfo.Host+"]":mcConst.ServerInfo.Host)+(mcConst.UserInfo.HTTPS?443!=mcConst.UserInfo.PortNode?":"+mcConst.UserInfo.PortNode:"":80!=mcConst.UserInfo.PortNode?":"+mcConst.UserInfo.PortNode:"")},createHostPath:function(e,t,n){var o=t||mcConst.UserInfo.PortNode,i=e||mcConst.ServerInfo.Host,s="file:"!==window.location.protocol?"https:"===window.location.protocol:mcConst.UserInfo.HTTPS;return(n?"":s?"https://":"http://")+(-1!==i.indexOf(":")?s?443!=o?":"+o:"":80!=o?":"+o:"":i)},formatFileSize:function(e){for(var t=0;e>1024;)t++,e/=1024;return Math.round(100*e)/100+" "+["B","KB","MB","GB","TB","PB","EB"][t]},fileTimeStamp:function(e){var t=60*(new Date).getTimezoneOffset()*1e3,n=e?new Date(e):new Date,o=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0);return(n.getTime()-o.getTime()||864e5)+t+"."+moment(n).diff(moment([0,0,0]),"days")},getSelectedText:function(e){var t={selectionStart:e.selectionStart,selectionEnd:e.selectionEnd};if(t.selectionStart!==t.selectionEnd){var n=e.value;t.prefix=n.substring(0,t.selectionStart),t.infix=n.substring(t.selectionStart,t.selectionEnd),t.postfix=n.substring(t.selectionEnd)}return t},setSelectionText:function(e,t,n){if(t>n&&(t=n),"selectionStart"in e)e.setSelectionRange(t,n);else{var o=e.createTextRange();o.collapse(!0),o.moveStart("character",t),o.moveEnd("character",n-t),o.select()}},convertArrayToObj:function(e,t){var n={};return t&&serviceList.isString(t)&&serviceList.isArray(e)?e.forEach(function(e){n[e[t]]=e}):console.error("convertArrayToObj: is not Array or Item is not string!"),n},convertArrayObjToObj:function(e,t){for(var n={},o=0;o<e.length;o++)e[o].hasOwnProperty(t)&&(n[e[o][t]]=e[o]);return n},getAvatar:function(e){var t="";switch(e){case 0:t=serviceList.insertIco("fa-user taskAvatar");break;case 1:t=serviceList.insertIco("fa-male taskAvatar");break;case 2:t=serviceList.insertIco("fa-female taskAvatar")}return t},getPriority:function(e){var t="";switch(parseInt(e)){case mcConst.priority.LOW:t=mcLang(61);break;case mcConst.priority.MEDIUM:t=mcLang(62);break;case mcConst.priority.HI:t=mcLang(63);break;case mcConst.priority.IMPORTANT:t=mcLang(64);break;case mcConst.priority.URGENT:t=mcLang(65);break;case mcConst.priority.CRITICAL:t=mcLang(66)}return t},openKanbanLinkIfCan:function(e,t){var n=!1;return"A"!==e.target.nodeName||e.target.origin+e.target.pathname!=window.location.origin+window.location.pathname&&(serviceList.isIE()&&e.target.protocol+"//"+e.target.host+e.target.pathname)!=window.location.protocol+"//"+window.location.host+window.location.pathname||(setTimeout(function(){t.$broadcast("openKanbanURI",[e.target.href])},10),e.preventDefault(),n=!0),n},replaceKanbanLink:function(e,t){var n='<a href="'+e+'" title="'+e+'" '+(-1==e.indexOf("mailto")?'target="_blank"':"")+' class="internalLink">'+(t||e)+"</a>";if(new RegExp(serviceList.isIE()?window.location.protocol+"//"+window.location.host+window.location.pathname:window.location.origin+window.location.pathname).test(e)){var o=purl(e),i=o.fparam("project"),s=o.fparam("task"),a=o.fparam("comment");n='<a href="'+e+'" title="'+e+'" '+(-1==e.indexOf("mailto")?'target="_blank"':"")+' class="internalLink">',a?n+="COMMENT #"+a:s?n+="TASK #"+s:i&&(n+="PROJECT #"+i),n+="</a>"}return n},getByCssClass:function(e,t){var n=null,o=t||document;if(document.getElementsByClassName)n=o.getElementsByClassName(e);else{for(var i=o.getElementsByTagName("*"),s=i.length,a=e.split(/\s+/),r=a.length,c=[],l=0;l<s;l++)for(var d=0;d<r;d++)if(-1!==i[l].className.search("\\b"+a[d]+"\\b")){c.push(i[l]);break}n=c}return n},disableContextMenu:function(e,t){webix.event(e.$view,"contextmenu",function(e){("INPUT"!==e.target.nodeName&&"TEXTAREA"!==e.target.nodeName&&function(e,t){var n=!0;return e&&e.length&&e.forEach(function(e){t.length&&-1!==t.indexOf(e)&&(n=!1)}),n}(t,e.target.className.split(" ").concat(e.target.parentNode.className.split(" ")).concat(e.target.parentNode.parentNode.className.split(" ")))||"button"===e.target.type)&&e.preventDefault()})},setStatusForUser:function(e,t){for(var n=serviceList.getElementByClass(mcConst.storageOpts.STATUSICO+e),o=0;o<n.length;o++)n[o].style.color=serviceList.getColorForStatus(t)},Base64:{_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,o,i,s,a,r,c="",l=0;for(e=Base64._utf8_encode(e);l<e.length;)i=(t=e.charCodeAt(l++))>>2,s=(3&t)<<4|(n=e.charCodeAt(l++))>>4,a=(15&n)<<2|(o=e.charCodeAt(l++))>>6,r=63&o,isNaN(n)?a=r=64:isNaN(o)&&(r=64),c=c+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(r);return c},decode:function(e){var t,n,o,i,s,a,r="",c=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<e.length;)t=serviceList.Base64._keyStr.indexOf(e.charAt(c++))<<2|(i=serviceList.Base64._keyStr.indexOf(e.charAt(c++)))>>4,n=(15&i)<<4|(s=serviceList.Base64._keyStr.indexOf(e.charAt(c++)))>>2,o=(3&s)<<6|(a=serviceList.Base64._keyStr.indexOf(e.charAt(c++))),r+=String.fromCharCode(t),64!==s&&(r+=String.fromCharCode(n)),64!==a&&(r+=String.fromCharCode(o));return r=serviceList.Base64._utf8_decode(r)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t+=String.fromCharCode(o):o>127&&o<2048?(t+=String.fromCharCode(o>>6|192),t+=String.fromCharCode(63&o|128)):(t+=String.fromCharCode(o>>12|224),t+=String.fromCharCode(o>>6&63|128),t+=String.fromCharCode(63&o|128))}return t},_utf8_decode:function(e){for(var t="",n=0,o=0,i=0,s=0;n<e.length;)(o=e.charCodeAt(n))<128?(t+=String.fromCharCode(o),n++):o>191&&o<224?(i=e.charCodeAt(n+1),t+=String.fromCharCode((31&o)<<6|63&i),n+=2):(i=e.charCodeAt(n+1),s=e.charCodeAt(n+2),t+=String.fromCharCode((15&o)<<12|(63&i)<<6|63&s),n+=3);return t}},isOdd:function(e){return e%2},replaceMcComponents:function(e,t){var n=e.split(mcConst.terminator2),o="",i="";return n.forEach(function(e,s){if(serviceList.isOdd(s))switch(o=e.split(mcConst.terminator3),e[0]){case")":o[0]=o[0].replace(")",""),mcConst.SmileysSet[o[0]]&&(i=mcConst.SmileysSet[o[0]][o[1]]),!i||!t&&mcConst.ClientSettings.SysEventsDisableEmotions?n[s]=o[1]:n[s]=serviceList.myReplaceFormated("<img src='#{path}/#{smile}'>",{path:MC_RESOURCE.TextSource.smileys+mcConst.SmileysSet[o[0]].name,smile:i});break;case"F":var a=o[0].split("#");a=a[a.length-1],n[s]=o[1];for(var r=0;r<a.length;r++)switch(a[r]){case"B":n[s]="<b>"+n[s]+"</b>";break;case"I":n[s]="<i>"+n[s]+"</i>";break;case"U":n[s]="<u>"+n[s]+"</u>";break;case"S":n[s]="<strike>"+n[s]+"</strike>"}break;case">":o[0].replace(">","");n[s]="<span class='brown bolder'>@"+o[1]+"</span>";break;case"A":var c=o[0].replace("A","");0===c.indexOf("\\")&&(c=c.replace("\\\\","local://").replace(/\\/g,"/")),n[s]=c+mcConst.myChatLinkTitle+o[1]}}),n.join("")},numberList:function(e,t){var n=e.toString().length,o=new Array(e||1).join(".").split(".");return o=o.map(function(e,o){var i=o.toString();return t?new Array(n+1-i.length).join("0")+i:i})},forvardZero:function(e,t,n){return e=e.toString(),new Array(t+1-e.length).join(n||"0")+e},toHex:function(e,t){var n="";for(e=parseInt(e,10);e>0;)n=hexCodes[e%16]+n,e=Math.floor(e/16);for(;n.length<t;)n="0"+n;return n},FadeControl:function(e){var t=e,n=null;this.in=function(){n="out";var e=new Date,o=function(){"in"===n?n=null:(t.style.opacity=+t.style.opacity+(new Date-e)/400,e=new Date,t.style.opacity<=1?window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,16):n=null)};o()},this.out=function(){n="in";var e=new Date,o=function(){"out"===n?n=null:(t.style.opacity=+t.style.opacity-(new Date-e)/400,e=new Date,t.style.opacity>0?window.requestAnimationFrame&&requestAnimationFrame(o)||setTimeout(o,16):n=null)};o()}},Capitalize:function(e){return e[0].toUpperCase()+e.substring(1).toLowerCase()},ObjToString:function(e){var t="";if(serviceList.isString(e)||serviceList.isNumber(e))t=e.toString()+"";else try{t=JSON.stringify(e)}catch(n){t=e.toString()+""}return t},typeFlag:function(e,t){var n=$$(e),o=$$(t).getValue();(o=o[o.length-1])&&(o.match(/[a-zA-Z]/)?(n.define("template","EN"),n.refresh()):o.match(/[а-яА-Я]/)?(n.define("template","RU"),n.refresh()):o.match(/[їЇіІєЄ]/)&&(n.define("template","UA"),n.refresh()))},buildForumStructure:function(e,t,n,o,s){for(var a=[],r=[],c=0,l=null;c<t.length;)(l=t[c])?l.Type===mcConst.msgTypes.topic&&s?t.splice(c,1):-1!==serviceList.inArrayNoStrict(l.ParentID,n)?(l.id=l.Type+"_"+l.ID,o[mcConst.msgTypes.section+"_"+l.ParentID].Item.data.push(l),o[l.id]={Item:l},l.Type===mcConst.msgTypes.section&&(a.push(l.ID),o[l.id].Item.data=[],o[l.id].Data=o[l.id].Item.data),t.splice(c,1)):(r.push(l),c++):i++,l=null;return t.length>0?serviceList.buildForumStructure(e,r,a,o,s):e},insertAtCursor:function(e,t,n){var o=0;if(document.selection){var i=document.selection.createRange();e.focus(),i.text=t,o=i.text.toString().length-1}else if(e.selectionStart||"0"==e.selectionStart){var s=e.selectionStart,a=e.selectionEnd,r=e.value.substring(0,s),c=e.value.substring(a,e.value.length);e.value=(n&&r.length&&"\n"!==r[r.length-1]?r+"\n":r)+t+(n&&c.length&&"\n"!==c[0]?"\n"+c:c),e.selectionStart=s+t.length+(n?1:0),e.selectionEnd=s+t.length+(n?1:0),o=e.selectionEnd}else e.value+=n&&e.value.length&&"\n"!==e.value[e.value.length-1]?"\n"+t:t,o=e.value.length-1;return o},parseAttachment:function(e,t,n,o,i,s){var a="",r="file:"!==location.protocol;if(e.indexOf(n)>=0){e=e.split(n);for(var c=0;c<e.length;c++)if(c||!e[c].length){var l=e[c].indexOf("}"),d=serviceList.copy(e[c],0,l),m=serviceList.copy(e[c],l+1,e[c].length-1),u="";t&&t.hasOwnProperty(d)?(n===mcConst.prefix.file?a=serviceList.myReplaceFormated('<a href="#{link}" class="internalLink" title="#{link}" target="_blank">#{name}</a>',{link:serviceList.getLocalHostPath(r)+"/"+mcConst.pathAliases.AliasFiles+"/kanban/"+t[d].Hash+"/"+d,name:serviceList.insertIco("fa-file-o","fs90")+d}):n===mcConst.prefix.image&&(imgIndex++,s&&s(t[d],d),a=serviceList.myReplaceFormated('<a href="#{hrefImg}" class="internalLink" target="_blank"><img src="#{loadImage}" alt=""></a>',{hrefImg:t[d].lnkHref?t[d].lnkHref:"#",loadImage:t[d].imgSrc?t[d].imgSrc:mcConst.imagesPath.loadImage}),i.loadThumbs([t[d].Hash,d])),o&&(u=o(m,t)),e[c]=a+(u||m)):o&&(u=o(m,t),e[c]=a+(u||m))}else o&&(e[c]=o(e[c],t));e=e.join("")}else o&&(e=o(e,t));return e},checkNumbersCounter:function(e){if("counter"===this.config.view&&-1===serviceList.inArray(e,mcConst.keyCodes.Digits.concat(mcConst.keyCodes.EditSymbols)))return!1},isImage:function(e){return-1!==serviceList.inArrayNoStrict(serviceList.extractFileExtension(e),["png","jpg","jpeg","gif","bmp"])},getCurrentChantTypeForFiles:function(e){var t=1;switch(e){case"UIN":t=mcConst.whereFiles.private;break;case"UID":t=mcConst.whereFiles.conf;break;case"Forum":t=mcConst.whereFiles.forum;break;case"Kanban":t=mcConst.whereFiles.kanban;break;case"BBS":t=mcConst.whereFiles.bbs}return t}},multiple={kanban:{FilterFiled:function(e){function t(t,n){i&&!e.noCloseBtn&&($$("clearBtn"+s).hide(),i=!1),e.thisFilter.setValue(""),e.thisFilter.$setValue(""),t?e.List.filter(""):o(n),e.onClear&&e.onClear()}function n(e,t,n,o){for(var i=[],s=!0,a=0;a<n.length;a++){var r=n[a];if(serviceList.isArray(t[r]))i.push(t[r].join("|").toLowerCase());else if(-1===r.indexOf(":"))void 0!==t[r]&&i.push(t[r].toString().toLowerCase());else{var c=r.split(":");i=i.concat(t[c[0]].toString().toLowerCase().split(c[1]))}}if(serviceList.isString(e))s=o?-1!==i.indexOf(e.toString().toLowerCase()):-1!==i.join("|").indexOf(e);else if(serviceList.isBoolean(e))s=-1!==i.indexOf(e.toString().toLowerCase());else if(serviceList.isArray(e))for(a=0;a<e.length;a++)if(-1===i.indexOf(e[a].toString().toLowerCase())){s=!1;break}return s}function o(o){if(e.List){var a=serviceList.trim(e.thisFilter.getValue().toString()).toLowerCase(),r=e.List._otherFilterOptions?Object.keys(e.List._otherFilterOptions):[],c=e.List._otherFilterOptions;if(""!==a||r.length){var l=[];e.List.filter(function(t){var o=!0,i=!0;if(e.filterParams&&0!=e.filterParams.length||(e.filterParams=["value"]),""!==a&&(o=n(a,t,e.filterParams)),o&&r.length)for(var s=0;s<r.length;s++){var d=c[r[s]].items;if(serviceList.isString(d))i=i&&n(d,t,c[r[s]].fields);else if(serviceList.isArray(d)){i=c[r[s]].union===mcConst.methods.AND;for(var m=0;m<d.length&&(i=c[r[s]].union===mcConst.methods.OR?i||n(d[m],t,c[r[s]].fields,!0):i&&n(d[m],t,c[r[s]].fields,!0),c[r[s]].union!==mcConst.methods.AND);m++);}if(!i)break}return!!(o=o&&i)&&!!l.push(t)}),e.onAfterFilter&&(e.onAfterFilter(l),l=null)}else t(!0),o||e.thisFilter.focus();i||""===a||e.noCloseBtn||(i=!0,$$("clearBtn"+s).show(),o||setTimeout(function(){e.thisFilter.focus()},5))}}var i=!1,s=Math.random(),a={rows:[{height:void 0===e.topSpacer?0:e.topSpacer},{cols:[{view:"search",padding:0,css:"noPaddingChild",placeholder:e.searchText||serviceList.Lang(10),keyPressTimeout:400,on:{onKeyPress:function(e,n){if(27===e&&!n.ctrlKey&&!n.shiftKey&&!n.altKey){var o=this.getValue().length;t(),o&&this.focus()}},onTimedKeypress:function(){o()},onAfterRender:function(){e.thisFilter=this,a.thisFilter=this,e.List=$$(e.listName),setTimeout(function(){a.thisFilter.getInputNode().setAttribute("autocomplete","off")},100)}}},{id:"clearBtn"+s,view:"button",type:"iconButton",icon:"times",width:27,hidden:!0,click:function(){setTimeout(function(){t()},50)}}]},{height:void 0===e.bottomSpacer?4:e.bottomSpacer}]};return e.id&&(a.id=e.id),e.rows&&(a=serviceList.Marge(a,e.rows)),a.relocateList=function(n,o){var i=!!e.List;e.listName=n,e.List=$$(n),e.List?i&&t(null,o):(e.listName="",e.List=null)},a.doFilter=o,a.clearFilter=t,a},createLink:function(e,t,n){return serviceList.isIE()?window.location.protocol+"//"+window.location.host+window.location.pathname+"#project="+e+(t?"&task="+t+(n?"&comment="+n:""):""):window.location.origin+window.location.pathname+"#project="+e+(t?"&task="+t+(n?"&comment="+n:""):"")},insertIco:function(e,t,n){return"<span class='webix_icon byCenter "+e+" "+(t||"fa-lg")+"' "+(n?serviceList.isString(n)?n:n.join(" "):"")+"></span>"}},admin:{FilterFiled:function(e){function t(){i&&($$("clearBtn"+o).hide(),i=!1),e.prevText="",e.thisFilter.$setValue(""),e.List.filter(""),e.onClear&&e.onClear()}function n(n,s){var a=e.thisFilter.getValue().toString(),r=serviceList.trim(a).toLowerCase();if(""==r)t(),e.escPressed||s||e.thisFilter.focus();else{var c=[];if((!e.prevText||e.prevText!=r||n)&&(e.prevText=r,e.List.filter(function(t){var n=[];e.filterParams&&0!=e.filterParams.length||(e.filterParams=["value"]);for(var o=0;o<e.filterParams.length;o++)serviceList.isArray(t[e.filterParams[o]])?n.push(t[e.filterParams[o]].join("|")):n.push(t[e.filterParams[o]]);var i=n.join("|");return-1!=(i=i.toString().toLowerCase()).indexOf(r)&&c.push(t),-1!=i.indexOf(r)}),e.onAfterFilter&&(e.onAfterFilter(c),c=null),!i)){i=!0;var l=serviceList.getCaretPosition(e.thisFilter.getInputNode());$$("clearBtn"+o).show(),e.thisFilter.$setValue(a),s||(e.thisFilter.focus(),serviceList.setCaretPosition(e.thisFilter.getInputNode(),l))}}}var o=Math.random(),i=!1,s={rows:[{cols:[{view:"text",padding:0,css:"noPaddingChild",tooltip:e.tooltip||"",placeholder:e.searchText||serviceList.Lang(71),keyPressTimeout:500,on:{onKeyPress:function(n,o){e.escPressed=!1,27!==n||o.ctrlKey||o.shiftKey||o.altKey||(e.escPressed=!0,e.nowCleared=""!=e.thisFilter.getValue().toString(),t(),e.nowCleared?this.focus():(this.blur(),webix.UIManager.setFocus(document)))},onTimedKeypress:function(){webix.UIManager.hasFocus(this)&&n()},onAfterRender:function(){e.thisFilter=this,s.thisFilter=this,e.List=$$(e.listName),this.getInputNode().setAttribute("autocomplete","off")}}},{id:"clearBtn"+o,view:"button",type:"iconButton",icon:"times",width:27,hidden:!0,click:t}]},{height:void 0==e.bottomSpacer?4:e.bottomSpacer}]};return e.id&&(s.id=e.id),s.doFilter=n,s.clearFilter=t,s},checkRights:function(e){var t=parseInt(e)-1;return"1"===mcConst.MyRightsSet.RightsSet[t]&&(!_gLock.navAccess||_gLock.navAccess&&!_gLock.navAccess[e])}},chat:{FilterFiled:function(e){function t(){s&&($$(i).hide(),s=!1),e.thisFilter.$setValue(""),e.List.filter(""),e.onClear&&e.onClear()}var n=serviceList.RandomHash(6),o=(e.id||n)+"Editor",i="clearBtn"+(e.clearID||n),s=!1,a={id:e.id||n+"FilterBlock",rows:[{cols:[{id:o,view:"text",padding:0,css:"noPaddingChild",placeholder:e.placeholder||"Search",keyPressTimeout:500,on:{onKeyPress:function(t,n){e.keyEvents.hasOwnProperty(t)&&e.keyEvents[t](e.List.getSelectedItem())&&n.preventDefault()},onTimedKeypress:function(){var n=serviceList.trim(this.getValue().toString()),o=n.toLowerCase();""===o?(t(),this.focus()):(e.List.filter(function(t){var n=[];e.filterParams&&0!==e.filterParams.length||(e.filterParams=["value"]);for(var i=0;i<e.filterParams.length;i++)serviceList.isArray(t[e.filterParams[i]])?n.push(t[e.filterParams[i]].join("|")):n.push(t[e.filterParams[i]]);var s=n.join("|");return-1!==(s=s.toString().toLowerCase()).indexOf(o)}),s||(s=!0,e.noClearBtn||$$(i).show(),this.$setValue(n),this.focus())),e.OnEnterText&&e.OnEnterText(n)},onAfterRender:function(){e.thisFilter=this,e.List=$$(e.listName),e.hotkeyID=serviceList.RandomHash(10),serviceList._hotkeys&&serviceList._hotkeys.addPreset(e.hotkeyID,[{key:mcConst.keyCodes.esc,func:function(){""!==e.thisFilter.getValue().toString()&&(e.nowCleared=!0),t(),e.thisFilter.focus()}}],e.thisFilter.getNode())},onDestruct:function(){serviceList._hotkeys.removePreset(e.hotkeyID)}}},{id:i,view:"button",type:"iconButton",icon:"times",width:27,hidden:!0,on:{onItemClick:t}}]},{height:void 0==e.bottomSpacer?4:e.bottomSpacer}]};return a.EDITOR=o,a.CLEAR=i,a.clearFilter=t,a}},forum:{FilterFiled:function(e){function t(){o&&($$("clearBtn"+n).hide(),o=!1),e.thisFilter.$setValue(""),e.List.filter(""),e.onClear&&e.onClear()}var n=Math.random(),o=!1,i={rows:[{height:void 0===e.topSpacer?0:e.topSpacer},{cols:[{view:"search",padding:0,css:"noPaddingChild",placeholder:serviceList.Lang(e.placeHolder||10),keyPressTimeout:600,on:{onKeyPress:function(e,n){27!==e||n.ctrlKey||n.shiftKey||n.altKey||(t(),this.focus())},onTimedKeypress:function(){var i=serviceList.trim(this.getValue().toString()).toLowerCase();if(e.List||(e.List=$$(e.listName)),""==i)t(),this.focus();else if(e.List.filter(function(t){var n=[];e.filterParams&&0!=e.filterParams.length||(e.filterParams=["value"]);for(var o=0;o<e.filterParams.length;o++)n.push(t[e.filterParams[o]]);var s=n.join("|");return-1!=(s=s.toString().toLowerCase()).indexOf(i)}),!o){o=!0;var s=serviceList.getCaretPosition(this.getInputNode());$$("clearBtn"+n).show(),this.$setValue(i),this.focus(),serviceList.setCaretPosition(this.getInputNode(),s)}},onAfterRender:function(){e.thisFilter=this,e.List=$$(e.listName)}}},{id:"clearBtn"+n,view:"button",type:"iconButton",icon:"times",width:27,hidden:!0,click:t}]},{height:void 0==e.bottomSpacer?4:e.bottomSpacer}]};return e.id&&(i.id=e.id),e.rows&&(i=serviceList.Marge(i,e.rows)),i.relocateList=function(n){e.List=$$(n),t()},i},createLink:function(e){return serviceList.isIE()?window.location.protocol+"//"+window.location.host+window.location.pathname+"#"+e:window.location.origin+window.location.pathname+"#"+e},disableContextMenu:function(e,t){webix.event(e.$view,"contextmenu",function(e){function n(e,t){var o=[],i=e.parentElement;return i&&(o=o.concat(i.className.split(" ")),t&&t--,"#document"!==i.nodeName&&t>0&&(o=o.concat(n(i,t)))),o}("INPUT"!==e.target.nodeName&&"TEXTAREA"!==e.target.nodeName&&function(e,t,o){var i=!0;return e&&e.length&&e.forEach(function(e){(t.length&&-1!==t.indexOf(e)||-1!==n(o,4).indexOf(e))&&(i=!1)}),i}(t,e.target.className.split(" "),e.target)||"button"===e.target.type)&&e.preventDefault()})}}};return _api&&multiple[_api]&&Object.keys(multiple[_api]).forEach(function(e){serviceList[e]=multiple[_api][e]}),serviceList}function mcUploadProgress(){webix.type(webix.ui.list,{name:"myUploader",template:function(e){var t=mcService.formatFileSize(e.size/100*e.percent);return mcService.myReplaceFormated("<div class='uploader_overall'>   <div class='uploader_status'>       <div class='uploader_progress' style='width:#{width}'></div>       <div class='uploader_message'>#{txt}</div>   </div></div>",{name:e.name,width:e.percent+"%",txt:t+(e.sizetext?" / "+e.sizetext+" ":" ")+e.percent+"%"})},status:function(e){return{server:e.sizetext+" - Done!",error:"Error",client:"Ready",transfer:e.sizetext}[e.status]},height:35})}function mcCmdParser(e,t,n,o){function i(e,n){if(t.customCallBack[e]&&t.customCallBack[e].length>0)return t.customCallBack[e].shift()(n),!0}function s(){return t.initSocketIo()}function a(){return t.destroySocketIo()}function r(e){return-1!==mcService.inArray(e,[3,4,14,15,21,23,24,44,60,71,79,80,81,82,92])&&mcConst.LoggedIn||!mcConst.LoggedIn}function c(e,n){if(!t.ErrorActions[e])return!1;t.ErrorActions[e](n)}function l(e){if(!t.ElectronErrors[e.code])return!1;t.ElectronErrors[e.code](e)}function d(e){mcConst.UserInfo=mcService.Marge(mcConst.UserInfo,e||{UIN:17,Nick:"Chapay",Sex:1,Avatar:54,LoginStyle:"login",AutoAwayTime:15,ServerSignature:"MyChat4/16....",OptionsPresetID:0,OptionsPresetCRC32:0,FotoCRC32:0,Domain:""}),!t.isWebClient&&mcConst.UserInfo.OptionsPresetCRC32&&mcConst.settingsCRC32!==mcConst.UserInfo.OptionsPresetCRC32&&(mcConst.settingsCRC32=mcConst.UserInfo.OptionsPresetCRC32,t.SendCMDToServer([mcConst._CMD_.cs_get_options_preset,mcConst.SessionID,mcConst.UserInfo.OptionsPresetID])),mcConst.UserInfo.State=mcConst.states.online,mcConst.LoggedIn=!0,mcService.SaveSessionSettings(mcConst.LoginInfo),t.$broadcast("hide"+mcConst.lockInterface,["all"]),t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_client_connected,mcConst.UserInfo]),t.restoreConnection||(mcConst.settingsCRC32=mcConst.UserInfo.OptionsPresetCRC32,t.$broadcast("hide"+mcConst.dataModels.Login,[]),console.log("Logged in!"))}function m(e){t.restoreConnection=!1,t.$broadcast("ReconnectLoop"),t.errorDialog||t.$broadcast("ErrorMsg",[S.Errors.Disconnected,mcConst.ErrorText[S.Errors.Disconnected]+"<br>"+mcLang(539)+"<br><br>"+mcConst.loadGif,"",function(){e&&mcService.ClearSessionSettings(!0,!0),location.search="",location.reload()},mcLang(540)])}function u(){t.$broadcast(window._messages_.dialogsList.loadPrivatesFromStorage,[]),t.$broadcast(window._messages_.dialogsList.loadHistoryDialogsList,[]),t.$broadcast(window._messages_.dialogsList.loadUserStatuses,[]),t.$broadcast(window._messages_.dialogsList.getIgnoreList,[])}function f(){mcConst.isWindowFocused=!0,t.$broadcast("on_mainWindowFocused",[])}function g(){mcConst.isWindowFocused=!1}var _={},p={},h={},v={},C=0;this.ProcessCMD=p,this.SendCMDToServer=_,t.ErrorActions={},t.ElectronErrors={};var S=mcConst._CMD_;t.ErrorActions[17]=function(e){mcConst.LoggedIn?t.$broadcast("removeDialogFromList",e):(t.isWebClient||t.UNIT.ctrlServersManager.setAutoConnectInfo("",!1,""),t.$broadcast("show"+mcConst.dataModels.Login,[]))},t.ErrorActions[11]=t.ErrorActions[17];var b=null;this.internalSender=function(e){if(!b)throw new Error("Electron handler not initialized!");b.send("ce_CMD",e)},this.MultiSender=function(){var n=arguments[0],o=arguments[1],i=!0;if((mcConst.socketIO||!t.isWebClient)&&!_[n]&&mcService.InObject(n,S)){for(var s="",a=1;a<arguments.length;a++)s+=arguments[a]+(a!==arguments.length-1?mcConst.CR:"");e.SendDataToServer({CMD:n,Data:s}),w(o),i=!1}return i},this.MultiParser=function(e,n){if(!h.hasOwnProperty(e))return!0;t.$broadcast("hide"+mcConst.lockInterface,[]),i(h[e],mcService.StringToObj(n))},t.$on("prepareElectron",function(){if(window.require){b=require("electron").ipcRenderer;var e=require("electron").webFrame;return e.setZoomFactor(1),e.setVisualZoomLevelLimits(1,1),e.setLayoutZoomLevelLimits(0,0),b.on("ec_CMD",function(e,t){var n=t[0],o=t[1];v.hasOwnProperty(n)?i(v[n],o):p.hasOwnProperty(n)?p[n](o):console.warn(mcLang(9,["ProcessCMD",n.toString()]))}),b.on("sc_CMD",function(e,n){var o=Object.keys(n)[0];t.ProcessCMD([o,n[o]])}),b}}),h[S.sc_dept_list]=S.cs_get_depts_list,h[S.sc_web_user_foto_file]=S.cs_web_get_user_foto_file,h[S.sc_get_channels_list]=S.cs_get_channels_list,h[S.sc_ignores_list]=S.cs_get_ignores_list,h[S.sc_online_users_states]=S.cs_get_online_users_states,h[S.sc_user_foto]=S.cs_get_uin_foto,h[S.sc_file_exists]=S.cs_is_file_exists,h[S.sc_image_thumbs]=S.cs_get_image_thumbs,h[S.sc_serv_stat]=S.cs_stat,h[S.sc_bbs_body]=S.cs_get_bbs,h[S.sc_public_ftp_info]=S.cs_get_public_ftp_info,h[S.sc_token_created]=S.cs_create_token,h[S.sc_apply_client_settings]=S.cs_get_options_preset,h[S.sc_sync_conf_history]=S.cs_sync_conf_history,h[S.sc_users_live_search]=S.cs_users_live_search,h[S.sc_private_dialogs]=S.cs_get_private_dialogs,h[S.sc_del_private_dialog]=S.cs_del_private_dialog,h[S.sc_private_read]=S.cs_private_msg_read,h[S.sc_private_got]=S.cs_private_msg_got,h[S.sc_private_dialog_msg_states]=S.cs_private_get_dialog_msg_states,h[S.sc_users_list_for_redirect_dialog]=S.cs_get_users_for_redirect_dialog,p[S.sc_login]=function(e){d(e)},p[S.sc_registered]=function(e){var n=mcService.StringToObj(e);t.isWebClient&&t.$broadcast("StopPingTimer",[]),setTimeout(function(){_[S.Login](n.UIN,mcConst.LoginInfo.pwd,mcConst.LoginInfo.servPwd,mcConst.LoginInfo.rm,mcConst.SessionID)},100)},p[S.sc_error]=function(e){var n=mcService.StringToObj(e)||{ErrNum:21,Params:["bla-bla-bla","test-test-test"]};n.ErrNum=parseInt(n.ErrNum),console.warn("ERR ["+n.ErrNum+"]: "+mcService.myReplace(mcConst.ErrorText[n.ErrNum],[].concat(n.Params))),C=n.ErrNum,(r(n.ErrNum)||t.ErrorActions[n.ErrNum]&&t.ErrorActions[n.ErrNum](n.Params))&&t.$broadcast("StopPingTimer",[]),!mcConst.LoggedIn&&t.loginFormNotShowed?t.isWebClient?(t.$broadcast("hide"+mcConst.lockInterface,[]),c(n.ErrNum,n.Params)):t.restoreConnection?n.ErrNum===mcConst._CMD_.Errors.WrongServerVersion?(t.$broadcast(window._messages_.main.hideAllErrors),t.$broadcast("ErrorMsg",[n.ErrNum,mcConst.ErrorText[n.ErrNum],n.Params,function(){t.$broadcast("hide"+mcConst.lockInterface,["all"]),c(n.ErrNum,n.Params),t.UNIT.ctrlServersManager.setAutoConnectInfo("",!1,""),location.reload()}])):m():t.$broadcast("ErrorMsg",[n.ErrNum,mcConst.ErrorText[n.ErrNum],n.Params,function(){t.$broadcast("hide"+mcConst.lockInterface,["all"]),c(n.ErrNum,n.Params),t.UNIT.ctrlServersManager.setAutoConnectInfo("",!1,""),mcConst.LoggedIn?location.reload():t.$broadcast("show"+mcConst.dataModels.Login,[])}]):(n.ErrNum!==mcConst._CMD_.Errors.NetworkError||!t.loginFormNotShowed&&n.ErrNum===mcConst._CMD_.Errors.NetworkError)&&t.$broadcast("ErrorMsg",[n.ErrNum,mcConst.ErrorText[n.ErrNum],n.Params,function(){mcConst.LoggedIn?r(n.ErrNum)&&(location.search="",location.reload()):t.$broadcast("enable"+mcConst.dataModels.Login,[]),t.$broadcast("hide"+mcConst.lockInterface,["all"]),c(n.ErrNum,n.Params)}])},p[S.sc_halt]=function(){t.$broadcast("StopPingTimer",[]),t.isWebClient?(a(),t.$broadcast("ErrorMsg",[S.Errors.Disconnected,mcConst.ErrorText[S.Errors.Disconnected],"",function(){location.search="",location.reload()}])):t.$broadcast("quitFromProgram",!0)},p[S.sc_get_all_rights]=function(e){for(var n=e.RightsSet,i=!mcConst.MyRightsSet.length,s=0;s<n.length;s++)mcConst.MyRightsSet[s]="0"!==n[s];if(!t.restoreConnection&&i&&(t.$broadcast("show"+mcConst.dataModels.ChatWrapper,[]),t.$broadcast("show"+mcConst.dataModels.ChatFrame,[mcConst.containers.center])),t.isWebClient)u();else{if(u(),t.$broadcast(window._messages_.clientData.enableGlobalHotKeys),t.$broadcast(window._messages_.main.hideAllErrors),t.restoreConnection)return void(t.restoreConnection=!1);mcConst.ServerInfo.ID&&!t.acConfig.serversInfo[mcConst.ServerInfo.ID].ServerID?t.$broadcast(window._messages_.serversManager.addServerOnSuccessConnect,mcConst.ServerInfo.ID):t.$broadcast(window._messages_.clientData.saveCurrentServerID,[t.acConfig.serversInfo[mcConst.ServerInfo.ID].ServerID]),mcConst.LoginInfo.rm?t.UNIT.ctrlServersManager.setAutoConnectInfo(mcConst.LoginInfo.pwd,mcConst.LoginInfo.rm,mcConst.LoginInfo.servPwd):t.UNIT.ctrlServersManager.setAutoConnectInfo("",!1,"")}t.customUserOptions instanceof UsersCustomOptions||(t.customUserOptions=new UsersCustomOptions(t),t.customUserOptions.load()),t.checkAbilityByRights(),t.startUrlOptions(),o&&o.loadStat&&o.loadStat(mcConst.ServerInfo.ID,mcConst.UserInfo.UIN),t.isWebClient&&(window.removeEventListener("focus",f),window.removeEventListener("blur",g),window.addEventListener("focus",f),window.addEventListener("blur",g))},p[S.sc_drop_connect]=function(){a(),mcConst.LoggedIn||!mcConst.PingTimer||t.restoreConnection?mcConst.LoggedIn||mcConst.PingTimer?(t.$broadcast("hide"+mcConst.dataModels.Broadcast,[]),t.$broadcast("StopPingTimer",[]),t.isWebClient?(mcConst.LoginInfo.pwd="",mcConst.LoginInfo.servPwd="",mcConst.LoginInfo.rm=!1,t.$broadcast("ErrorMsg",[S.Errors.Disconnected,mcConst.ErrorText[S.Errors.Disconnected],"",function(){location.search="",location.reload()}])):(t.$broadcast("closeKanban",[]),m(!0))):t.isWebClient||t.lastError!=S.Errors.Disconnected&&t.lastError!=S.Errors.Disconnected||(m(),t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_client_disconnected])):(t.$broadcast("StopPingTimer",[]),t.isWebClient?(mcService.SaveSessionSettings(mcConst.LoginInfo.login,"","",!1),t.$broadcast("hide"+mcConst.lockInterface,[]),mcConst.LoginInfo.pwd="",mcConst.LoginInfo.servPwd="",mcConst.LoginInfo.rm=!1,t.$broadcast("show"+mcConst.dataModels.Login,[])):mcConst.LoginInfo.rm&&!t.restoreConnection?(t.$broadcast("show"+mcConst.dataModels.Login,[mcConst.Lang,!0]),t.$broadcast("hide"+mcConst.lockInterface,["all"])):(mcService.SaveSessionSettings(mcConst.LoginInfo.login,"","",!1),t.$broadcast("hide"+mcConst.lockInterface,["all"]),mcConst.LoginInfo.pwd="",mcConst.LoginInfo.servPwd="",mcConst.LoginInfo.rm=!1,t.$broadcast("ErrorMsg",["0",mcLang(517),"",function(){t.$broadcast("show"+mcConst.dataModels.Login,[])}])))},p[S.Logs]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),t.$broadcast("LogsChunk",[n])},p[S.sc_get_common_contacts_list]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),i(S.cs_get_common_contacts_list,n)||t.$broadcast("newCommonContactList",[n])},p[S.sc_grant_private_access]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),t.$broadcast("OpenPrivateRequest",[n])},p[S.sc_private_info]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),i(S.cs_get_private_info,n)||t.$broadcast("fillPrivateInfo",[n])},p[S.sc_join_txt_channel]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),t.$broadcast("addNewConfData",[n]),i(S.cs_create_txt_channel,n)||i(S.cs_join_txt_channel,n)},p[S.sc_private]=function(e){var n=mcService.StringToObj(e);t.$broadcast("OnPrivateMessage",[n])},p[S.sc_put_msg2txt_channel]=function(e){var n=mcService.StringToObj(e);t.$broadcast("OnConfMessage",[n])},p[S.sc_join_newbies_txt_channel]=function(e){var n=mcService.StringToObj(e),o=n.UID;delete n.UID,t.$broadcast("confUserList",[o,mcService.convertObjToArray(n,"UIN")])},p[S.sc_leave_txt_channel]=function(e){var n=mcService.StringToObj(e);t.$broadcast("confLeaveUser",[n])},p[S.sc_kill_txt_ch]=function(e){var n=mcService.StringToObj(e);t.$broadcast("leaveConf",[n.UID])},p[S.sc_kick_from_txt_channel]=function(e){var n=mcService.StringToObj(e);t.$broadcast("confKickUser",[n])},p[S.sc_just_connect_disconnect_users]=function(e){var n=mcService.StringToObj(e);t.$broadcast("onlineOfflineUsers",[n])},p[S.sc_ulist_in_txt_ch]=function(e){var n=mcService.StringToObj(e),o=n.shift();t.$broadcast("confUserList",[o,n])},p[S.sc_user_state]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.dialogsList.changeUserState,[n])},p[S.sc_adm_command_complete]=function(e){e.Cmd,i(e.Cmd)},p[S.sc_apply_client_settings]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.Settings.changeUserProfile,[n])},p[S.sc_private_read_notify]=function(e){var n=mcService.StringToObj(e);t.$broadcast("on_private_read_notify",[n])},p[S.sc_private_got_notify]=function(e){var n=mcService.StringToObj(e);t.$broadcast("on_private_got_notify",[n])},p[S.sc_get_msgtemplates]=function(e){var n=mcService.StringToObj(e);t.$broadcast("quickMessagesList",[n])},p[S.sc_media_call]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_call",[n])},p[S.sc_media_call_accept]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_call_accept",[n])},p[S.sc_media_call_reject]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_call_reject",[n])},p[S.sc_media_call_close]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_call_close",[n])},p[S.sc_media_call_error]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_call_error",[n])},p[S.sc_media_call_busy]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_call_busy",[n])},p[S.sc_media_ready]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_ready",[n])},p[S.sc_media_offer]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_offer",[n])},p[S.sc_media_answer]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_answer",[n])},p[S.sc_media_ice_candidate]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_ice_candidate",[n])},p[S.sc_media_incoming_call_missed]=function(e){var n=mcService.StringToObj(e);t.$broadcast("sc_media_incoming_call_missed",[n])},p[S.sc_private_tech_message]=function(e){var n=mcService.StringToObj(e);t.$broadcast("addCustomMSG",[n])},p[S.sc_serv_stat]=function(e){var t=mcService.StringToObj(e);webix.ajax().post("http://mychat-server.com/stat.txt",JSON.stringify(t.Stat))},p[S.sc_web_services_info]=function(e){var n=mcService.StringToObj(e);mcConst.pathAliases=n,t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_web_services_info,n])},p[S.sc_server_ports]=function(e){var n=mcService.StringToObj(e);mcConst.UserInfo=mcService.Marge(mcConst.UserInfo,n),t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_server_ports,n])},p[S.sc_broadcast]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.Broadcast.onReceiveBroadcast,[n]),t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_show_on_top,!0,!0])},p[S.sc_files_success_recieved]=function(){t.$broadcast(window._messages_.downloadUpload.on_file_direct_download_complete)},p[S.sc_file_internal_sended_ok_idx]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.downloadUpload.on_file_direct_download_file_received,[n])},p[S.sc_typing_notify]=function(e){var n=mcService.StringToObj(e);t.$broadcast("onTypingNotify",[n])},p[S.sc_get_remote_uin_current_time]=function(e){var n=mcService.StringToObj(e);t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_send_my_current_time,mcConst.SessionID,n.UINFrom,mcService.formatDate(new Date,"dd.mm.yyyy.hh.nn.ss")])},p[S.sc_get_uin_info]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),i(S.cs_get_uin_info,n)||t.$broadcast("onGetUserProfileInfo",[n])},p[S.sc_channel_history_messages]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),i(S.cs_get_channel_history_messages,n)||t.$broadcast("onConfHistory",[n])},p[S.sc_bbs_changed]=function(){t.$broadcast("hide"+mcConst.lockInterface,[]),t.$broadcast("receiveBBS")},p[S.sc_get_contacts_list]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),i(S.cs_get_contacts_list,n)||t.$broadcast("fillPersonalContactList",[n])},p[S.sc_update_user_data]=function(e){var n=mcService.StringToObj(e);t.$broadcast("hide"+mcConst.lockInterface,[]),t.$broadcast("updateSmallUserInfo",[n])},p[S.sc_sync_private_history]=function(e){var n=mcService.StringToObj(e);i(S.cs_sync_private_history,n)||t.$broadcast(window._messages_.dialogsList.drawHistoryMessages,[n])},p[S.sc_files_transfer_accept]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.downloadUpload.on_file_direct_upload_accept,[n])},p[S.sc_files_transfer_progress]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.downloadUpload.on_files_transfer_progress,[{percent:n.Percents,size:mcService.formatFileSize(n.TotalSize),text:mcService.formatFileSize(n.CurrentTransfer)}])},p[S.sc_files_transfer_deny]=p[S.sc_files_transfer_abort]=p[S.sc_files_request_timeout]=p[S.sc_files_transfer_request_abort]=function(e){var n=mcService.StringToObj(e).UIN;t.$broadcast(window._messages_.downloadUpload.on_file_upload_aborted,[n])},p[S.sc_files_request_transfer]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.downloadUpload.on_file_request_transfer,[n]),t.$broadcast(window._messages_.chatFrame.showNotifyMessage,[!0,mcLang(600),n.DisplayName,!1,n.UIN])},p[S.sc_file_internal_send_idx]=function(e){var n=mcService.StringToObj(e);t.$broadcast(window._messages_.downloadUpload.on_file_direct_receive_abort,[n.UIN]),t.SendCMDToServer([mcConst._CMD_.cs_private_msg,mcConst.SessionID,JSON.stringify({UIN:n.UIN,Msg:mcLang(620),MsgType:mcConst._CMD_.msgType.TEXT})])},p[S.ec_file_direct_receive_client_disconnected]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_direct_receive_client_disconnected,[e])},v[S.ec_server_added]=S.ce_add_server,v[S.ec_server_saved]=S.ce_modify_server,v[S.ec_get_client_settings]=S.ce_get_client_settings,v[S.ec_load_autoconnect_server]=S.ce_load_autoconnect_server,v[S.ec_storage_get]=S.ce_storage_get,v[S.ec_statistics_get]=S.ce_statistics_get,v[S.ec_get_mc_client_info]=S.ce_get_mc_client_info,v[S.ec_ftp_list]=S.ce_ftp_list,v[S.ec_history_get_dialogs]=S.ce_history_get_dialogs,v[S.ec_get_logs_list]=S.ce_get_logs_list,v[S.ec_get_user_folder]=S.ce_get_user_folder,v[S.ec_file_set_new_folder_for_user]=S.ce_file_set_new_folder_for_user,v[S.ec_file_direct_receive_start]=S.ce_file_direct_receive_start,v[S.ec_get_logs_files]=S.ce_get_logs_files,p[S.ec_drop_connect]=p[S.sc_drop_connect],p[S.ec_get_server_list]=function(e){t.$broadcast("addServerHostToList",[e]),i(S.ce_get_server_list,e)},p[S.ec_test_server_ip]=function(e){t.$broadcast("hide"+mcConst.lockInterface,[]),i(S.ce_test_server_ip,e)},p[S.ec_complete_command]=function(e){e.Cmd,i(e.Cmd)},p[S.ec_error]=function(e){l(mcService.StringToObj(e))},p[S.ec_open_dialog]=function(e){t.$broadcast("selectDialog",[e.itemID])},p[S.ec_open_local_kanban]=function(e){t.$broadcast(window._messages_.dialogsCtrl.selectDialog,[mcConst.dataModels.Kanban]),t.$broadcast(window._messages_.kanban.openKanbanUrl,[e])},p[S.ec_ftp_progress]=function(e){t.$broadcast("onFtpProgress",[e])},p[S.ec_mainWindowFocused]=function(e){mcConst.isWindowFocused=!0,t.$broadcast("on_mainWindowFocused",[e])},p[S.ec_mainWindowBlur]=function(e){mcConst.isWindowFocused=!1},p[S.ec_get_clipboard_files_list]=function(e){t.$broadcast("pastFilesFromClipboard",[e])},p[S.ec_system_suspend]=function(){t.systemSuspened=!0},p[S.ec_system_resume]=function(){t.systemSuspened=!1,t.$broadcast("ReconnectLoop")},p[S.ec_download_update]=function(e){t.$broadcast("hide"+mcConst.lockInterface,["all"]),t.$broadcast("hide"+mcConst.dataModels.Login,[]),t.$broadcast("DownloadClientUpdate",[e])},p[S.ec_file_check_exist]=function(e){t.$broadcast("on_file_check_exist",[e])},p[S.ec_file_download_start]=function(e){t.$broadcast("on_file_download_start",[e])},p[S.ec_file_download_progress]=function(e){t.$broadcast("on_file_download_progress",[e])},p[S.ec_file_download_complete]=function(e){t.$broadcast("on_file_download_complete",[e])},p[S.ec_file_download_aborted]=function(e){t.$broadcast("on_file_download_aborted",[e])},p[S.ec_file_download_file_no_found]=function(e){t.$broadcast("on_file_download_file_no_found",[e])},p[S.ec_file_upload_start]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_start,[e])},p[S.ec_file_upload_prepare_start]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_prepare_start,[e])},p[S.ec_file_upload_prepare_progress]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_prepare_progress,[e])},p[S.ec_file_upload_progress]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_progress,[e])},p[S.ec_file_upload_complete]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_complete,[e])},p[S.ec_file_upload_aborted]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_aborted,[e])},p[S.ec_file_direct_upload_no_files]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_direct_upload_no_files,[e])},p[S.ec_file_direct_upload_progress]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_upload_progress,[e])},p[S.ec_file_direct_upload_complete]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_direct_upload_complete,[e])},p[S.ec_file_direct_upload_start]=function(e){t.$broadcast(window._messages_.downloadUpload.on_file_direct_upload_wait_accept,[e])},_[S.Login]=function(n,o,i,a,r){mcConst.LoginInfo.login=n.toString().replace("\\","/"),s(),e.SetCallBackFunctionByCMD(S.OK,function(){var e=this.split(mcConst.CR);mcConst.SessionID=e[0],console.log("SessionID: "+mcConst.SessionID),e.length>1&&(t.isWebClient?(mcConst.LoginInfo.pwd=e[1],mcConst.LoginInfo.servPwd=e[2]):(mcConst.LoginInfo.pwd=o,mcConst.LoginInfo.servPwd=i)),t.$broadcast("StartPingTimer",[])}),e.SetCallBackFunctionByCMD(S.Blocked,function(){var e=this;console.warn("Blocked"),t.$broadcast("hide"+mcConst.lockInterface,[]),mcService.SaveSessionSettings("","","",!1),t.$broadcast("ErrorMsg",[e,mcConst.ErrorText[e]])});var c=-1===mcConst.LoginInfo.login.indexOf("/");e.SendDataToServer({CMD:S.Login,Data:{Host:mcConst.ServerInfo.Host,Port:mcConst.ServerInfo.Port,Secured:mcService.convertIntToBool(mcConst.ServerInfo.Secured),SessionID:r,UIN:mcConst.LoginInfo.login,Pass:o,ServPass:i,RM:a,PingDelay:15,ClientType:"web",UserAgent:navigator.userAgent||"",Referral:document.referrer||"",Style:c?void 0!=o&&""!=o?mcConst._CMD_.loginStyle.STANDARD:mcConst._CMD_.loginStyle.NO_PASS:mcConst._CMD_.loginStyle.AD,State:mcConst.currentState,UTC:(new Date).getTimezoneOffset()/-60}})},_[S.Register]=function(n,o,i,a,r,c){mcConst.LoginInfo.login=n.toString().replace("\\","/"),s(),mcConst.LoginInfo.pwd=o,mcConst.LoginInfo.servPwd=i,console.log(mcConst.LoginInfo),e.SetCallBackFunctionByCMD(S.OK,function(){var e=this.split(mcConst.CR);mcConst.SessionID=e[0],t.$broadcast("StartPingTimer",[])}),e.SetCallBackFunctionByCMD(S.Blocked,function(){var e=this;t.$broadcast("hide"+mcConst.lockInterface,[]),mcService.SaveSessionSettings("","","",!1),t.$broadcast("ErrorMsg",[e,mcConst.ErrorText[e]])}),e.SendDataToServer({CMD:S.Register,Data:{Host:mcConst.ServerInfo.Host,Port:mcConst.ServerInfo.Port,Secured:mcService.convertIntToBool(mcConst.ServerInfo.Secured),UIN:mcConst.LoginInfo.login,Pass:o,ServPass:i,Gender:c,Email:r,RM:a,ClientType:"web",PingDelay:15,UserAgent:navigator.userAgent,Referral:document.referrer,Style:mcConst._CMD_.loginStyle.STANDARD,State:mcConst.currentState,UTC:(new Date).getTimezoneOffset()/-60}})},_[S.cs_login_by_token]=function(n){mcConst.socketIO=io({reconnection:!0,reconnectionAttempts:2,timeout:2e3}),mcConst.initWS(mcConst.socketIO),e.SetCallBackFunctionByCMD(S.OK,function(){var e=this.split(mcConst.CR);mcConst.SessionID=e[0],t.$broadcast("StartPingTimer",[])}),e.SetCallBackFunctionByCMD(S.Blocked,function(){var e=this;mcService.SaveSessionSettings("","","",!1),t.$broadcast("enable"+mcConst.dataModels.Login,[]),t.$broadcast("hide"+mcConst.lockInterface,[]),t.$broadcast("ErrorMsg",[e,mcConst.ErrorText[e]])}),e.SendDataToServer({CMD:S.cs_login_by_token,Data:{Token:n,ClientType:"chat",PingDelay:1,UserAgent:navigator.userAgent||" ",Referral:document.referrer||" ",State:mcConst.currentState,UTC:(new Date).getTimezoneOffset()/-60}})},_[S.Ping]=function(t){e.SendDataToServer({CMD:S.Ping,Data:t})},_[S.cs_quit]=function(t){e.SendDataToServer({CMD:S.cs_quit,Data:t,immediately:!0})};var w=_[S.Ping]}function mcDialogsList(e,t){function n(t,n){var o=e.GetChatID(),i=e.GetChatType(),s=t.UID;if(s&&!d.hasMessage(s,t.Idx)||!s&&(t.UINFrom&&l.hasPrivate(t.UINFrom)&&!l.hasMessage(t.UINFrom,t.Idx)||t.UINTo&&l.hasPrivate(t.UINTo)&&!l.hasMessage(t.UINTo,t.Idx))){if(e.$broadcast(window._messages_.chatFrame.addChatMessage,[t]),t.UID)d.addMessage(s,t.Idx);else if(l.hasPrivate(t.UINFrom)){var a=o==t.UINFrom&&"UIN"===i&&mcConst.isWindowFocused;!l.addMessage(t.UINFrom,t.Idx,a)||o==t.UINFrom&&"UIN"===i&&mcConst.isWindowFocused||e.SendCMDToServer([mcConst._CMD_.cs_private_msg_got,mcConst.SessionID,t.UINFrom,t.Idx]),o==t.UINFrom&&"UIN"===i&&t.Idx>=l.getReadIdx(o)&&a&&e.SendCMDToServer([mcConst._CMD_.cs_private_msg_read,mcConst.SessionID,o,t.Idx])}else l.hasPrivate(t.UINTo)&&l.addMessage(t.UINTo,t.Idx);t.History||t.UpSync||(t.State=l.statuses.get(t.UIN||t.UINFrom),[e.chatAliases.Kanban,e.chatAliases.BBS].indexOf(i)>=0||"UID"===i&&o!=t.UID&&!n?e.$broadcast("updateCounter",[t]):"UIN"===i&&t.UINFrom!=mcConst.UserInfo.UIN&&!n&&(o!=t.UINFrom&&o!=t.UINTo||void 0!=t.UID&&"UID"===i&&o!=t.UID)&&e.$broadcast("updateCounter",[t]))}}function o(t){if(mcConst.LoggedIn){var n=mcService.getStateStatuses(t),o=mcService.inArrayNoStrict(mcConst.UserInfo.UIN,n.Offline);"UID"==e.GetChatType()&&e.GetChatID();-1!=o&&n.Offline.splice(o,1);for(i=0;i<n.Online.length;i++)l.setState(n.Online[i],n.States[i]);for(var i=0;i<n.Offline.length;i++)l.setState(n.Offline[i],mcConst.states.offline),d.getConfList().forEach(function(e){mcService.findItemInArrayOfObj(d.getConfUsers(e),n.Offline[i],"UIN")>=0&&d.removeUsersFromConf(e,n.Offline[i])});n.Online&&n.Online.length>0&&n.Online.forEach(function(e,t){void 0!==n.States[t]&&(l.statuses.set(e,n.States[t])||r.setUserState(e,n.States[t]))}),n.Offline&&n.Offline.forEach(function(e){l.statuses.set(e,mcConst.states.offline)||r.setUserState(e,mcConst.states.offline)}),e.$broadcast("allUsersOnlineStatusesChanged",[r.getAllState()])}}function i(e){for(var t,n,o,i=(e=e.Data.split(mcConst.terminator)).shift(),s={};i>0;)t=e.shift(),n=e.shift(),o=e.shift(),s[t]={UIN:t,DisplayName:n,Ignores:o},i--;return s}function s(t){var n=l.isOpen(t.UIN);l.addPrivate(t),0==t.UIN&&e.$broadcast("selectTool"),t.HelloMsg&&!n&&e.$broadcast("addCustomMSG",[{UIN:t.UIN,Text:t.HelloMsg}])}var a={},r=new MCStatusesList(e),c=new MCHistoryDialogsList(e),l=new MCPrivatesList(e,n,c,r),d=new MCConferenceList(e,n,r,t),m=_messages_.dialogsList={getConfHistory:"getConfHistory",getQuickUserInfo:"getQuickUserInfo",OpenConf:"OpenConf",OpenPrivate:"OpenPrivate",OpenPrivateRequest:"OpenPrivateRequest",OnPrivateMessage:"OnPrivateMessage",OnConfMessage:"OnConfMessage",addNewConfData:"addNewConfData",confUserList:"confUserList",confLeaveUser:"confLeaveUser",confKickUser:"confKickUser",onlineOfflineUsers:"onlineOfflineUsers",getConfUsersList:"getConfUsersList",leaveConf:"leaveConf",onConfHistory:"onConfHistory",getPrivateHistory:"getPrivateHistory",getIgnoreList:"getIgnoreList",getUserIgnoreInfo:"getUserIgnoreInfo",getUserState:"getUserState",loadUserStatuses:"loadUserStatuses",getLastUserStates:"getLastUserStates",removeDialogFromList:"removeDialogFromList",loadPrivatesFromStorage:"loadPrivatesFromStorage",loadHistoryDialogsList:"loadHistoryDialogsList",historyRemoveUser:"historyRemoveUser",updateSmallUserInfo:"updateSmallUserInfo",changeUserState:"changeUserState",getHistoryMsgRange:"getHistoryMsgRange",drawHistoryMessages:"drawHistoryMessages",clearConfOnReconnect:"clearConfOnReconnect",clearPrivatesOnReconnect:"clearPrivatesOnReconnect",getFirstLastMsg:"getFirstLastMsg",getMyMessagesState:"getMyMessagesState",on_private_read_notify:"on_private_read_notify",on_private_got_notify:"on_private_got_notify","----":"----"};e.$on(m.updateSmallUserInfo,function(e,t){var n=t[0],o=n.UIN;n.DisplayName=n.Nick,l.updateUserInfo(o,n)}),e.$on(m.OpenPrivate,function(t,n){var o=n[0];o!=mcConst.UserInfo.UIN&&(l.hasPrivate(o)&&l.isOpen(o)?l.showPrivate(o):o.toString()&&e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_private_request,mcConst.SessionID,o,mcConst.Lang]))}),e.$on(m.OpenPrivateRequest,function(e,t){s.apply(null,t)}),e.$on(m.on_private_got_notify,function(e,t){var n=t[0].UIN,o=t[0].ID;l.setMyMsgGot(n,o)}),e.$on(m.on_private_read_notify,function(e,t){var n=t[0].UIN,o=t[0].ID;l.setMyMsgRead(n,o)}),e.$on(m.OnPrivateMessage,function(e,t){l.sendMessage.apply(null,t)}),e.$on(m.getMyMessagesState,function(e,t){var n=t[0];return l.getMyMsgReadState(n)}),e.$on(m.getPrivateHistory,function(e,t){l.getPrivateHistory.apply(null,t)}),e.$on(m.clearPrivatesOnReconnect,function(e,t){l.clearPrivates.apply(null,t)}),e.$on(m.getQuickUserInfo,function(e,t){var n=t[0],o=t[1];o&&o(l.getPrivateInfo(n))}),e.$on(m.loadPrivatesFromStorage,function(){l.loadFromStorage()}),e.$on(m.getHistoryMsgRange,function(t,n){var o=n[0];n[1]===e.chatAliases.UIN?l.getHistoryMsgRange(o):d.getConfHistory(o,mcConst.countHistoryMessagesLoad,!0)}),e.$on(m.drawHistoryMessages,function(e,t){l.drawHistoryMessages.apply(null,t)}),e.$on(m.getFirstLastMsg,function(e,t){var n=t[0];return t[1]?l.getFirstIdx(n):l.getLastIdx(n)}),e.$on(m.getConfHistory,function(e,t){d.getConfHistory.apply(null,t)}),e.$on(m.OpenConf,function(t,n){e.$broadcast("hide"+mcConst.dataModels.BBS),d.showConf.apply(null,n)}),e.$on(m.OnConfMessage,function(e,t){d.confMessage.apply(null,t)}),e.$on(m.addNewConfData,function(e,t){d.addConf.apply(null,t)}),e.$on(m.confUserList,function(e,t){d.addUsersToConf.apply(null,t)}),e.$on(m.confLeaveUser,function(e,t){d.removeUsersFromConf(t[0].UID,t[0].UIN)}),e.$on(m.confKickUser,function(t,n){n[0].UIN==mcConst.UserInfo.UIN?(webix.message(mcLang(550,[d.getConfName(n[0].UID),n[0].ModerDisplayName])),d.removeUsersFromConf(n[0].UID,n[0].UIN)):(e.$broadcast("addCustomMSG",[mcLang(551,[n[0].ModerDisplayName,n[0].UserDisplayName])]),d.removeUsersFromConf(n[0].UID,n[0].UIN))}),e.$on(m.getConfUsersList,function(e,t){var n=t[0],o=t[1];o&&o(d.getConfUsers(n))}),e.$on(m.leaveConf,function(e,t){d.leaveConf.apply(null,t)}),e.$on(m.onConfHistory,function(e,t){d.showConfHistory.apply(null,t)}),e.$on(m.clearConfOnReconnect,function(){d.clearUserList()}),e.$on(m.historyRemoveUser,function(e,t){c.removeUser.apply(null,t)}),e.$on(m.loadHistoryDialogsList,function(){c.load()}),e.$on(m.changeUserState,function(e,t){var n=t[0];r.setUserState(n.UIN,n.State),l.statuses.set(n.UIN,n.State)}),e.$on(m.getUserState,function(e,t){var n=t[0],o=t[1];o&&o(l.statuses.get(n))}),e.$on(m.loadUserStatuses,function(){r.loadUserStatuses()}),e.$on(m.getLastUserStates,function(e,t){var n=t[0];n&&n(l.statuses.getAll())}),e.$on(m.onlineOfflineUsers,function(e,t){o.apply(null,t)}),e.$on(m.getIgnoreList,function(t,n){e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_ignores_list,mcConst.SessionID,function(e){var t=n[0];a=i(e),t&&t(a)}])}),e.$on(m.getUserIgnoreInfo,function(e,t){var n=t[0].toString(),o=t[1],i=null;a[n]&&(i=a[n]),o&&o(i)}),e.$on(m.removeDialogFromList,function(t,n){var o=n[0];void 0!==o&&(e.$broadcast(window._messages_.dialogsCtrl.removePrivateFromDialogs,[o]),l.removePrivate(o))})}function setLocalizations(){webix.i18n.parseFormat="%d.%m.%Y",webix.i18n.locales.en=webix.i18n.locales["en-US"],webix.i18n.locales.ru={groupDelimiter:",",groupSize:3,decimalDelimeter:".",decimalSize:2,dateFormat:"%d.%m.%Y",timeFormat:"%h:%i %A",longDateFormat:"%d %F %Y",fullDateFormat:"%d/%m/%Y %h:%i %A",price:"${obj}",priceSettings:null,fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayFull:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],dayShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],hours:"Час",minutes:"Минут",done:"Готово"},controls:{select:"Выбрать"}},webix.i18n.locales.uk={groupDelimiter:",",groupSize:3,decimalDelimeter:".",decimalSize:2,dateFormat:"%d.%m.%Y",timeFormat:"%h:%i %A",longDateFormat:"%d %F %Y",fullDateFormat:"%d/%m/%Y %h:%i %A",price:"${obj}",priceSettings:null,fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],monthShort:["Січ","Лют","Бер","Квт","Тра","Чер","Лип","Сер","Вер","Жов","Лис","Гру"],dayFull:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"],dayShort:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],hours:"Годинн",minutes:"Хвилин",done:"Готово"},controls:{select:"Обрати"}}}function mcMedia(e,t){function n(e){clearTimeout(f),m&&m.parentNode&&webix.modalbox.hide(m),e&&u&&u.parentNode&&webix.modalbox.hide(u)}function o(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_ice_candidate,mcConst.SessionID].concat([].slice.call(arguments)))}function i(e){console.error(e),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_call_error,mcConst.SessionID,g]),d.setStateEvent(S.outgoing_call_my_error,mcLang(498,e)),C.CloseCall()}function s(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_offer,mcConst.SessionID].concat([].slice.call(arguments)))}function a(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_answer,mcConst.SessionID].concat([].slice.call(arguments)))}function r(){l.complete||(c.Start(),l.complete=!0,e.Stop(),u&&u.parentNode&&webix.modalbox.hide(u),_=new Create_cPanel(l,l.useVideo,l.receiveScreen,h),C.onShowMedia&&C.onShowMedia({useVideo:l.useVideo,receiveScreen:l.receiveScreen,video:h,audio:v,mirror:p,cPanel:_}))}var c=null,l=null,d=new CallStates,m=null,u=null,f=null,g=null,_=null,p=document.createElement("video"),h=document.createElement("video"),v=document.createElement("audio"),C=this,S=d.list;this.Share=!1,this.MID=0,this.useVideo=!1,this.onShowMedia=null,this.onCloseCall=null,this.infoMessage=null,this.callStates={stopCall:1,reject:2,close:3,error:4,busy:5,cancel:6,timeout:7},d.setUniversalStateEvent(function(){C.infoMessage&&C.infoMessage.apply(null,arguments),this!==S.outgoing_call_try&&this!==S.outgoing_call_started&&this!==S.outgoing_call_accepted&&this!==S.incoming_call_accepted&&this!==S.incoming_call_started&&this!==S.incoming_call_try&&d.clearState()}),this.setInfo=function(e,n,o){l.useVideo=n,l.receiveScreen=o,l.MID=e.MID,l.addIceServers(mcService.makeIceServers(e,t.isWebClient),t.isWebClient?"all":mcConst.ClientSettings.IceTransportPolicy)},this.callQuestions=function(n,o){function i(e){C.setInfo(n,e,n.Share),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_call_accept,mcConst.SessionID,n.UIN,e,n.MID]),setTimeout(function(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_ready,mcConst.SessionID,n.UIN])},250)}function s(){e.Stop(),e.PlaySound(e.Sounds.Reject),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_call_reject,mcConst.SessionID,n.UIN]),d.setStateEvent(S.incoming_call_rejected,mcLang(506))}var a=n.Video?[mcService.Lang(21),mcService.Lang(22),mcService.Lang(33)]:[mcService.Lang(21),mcService.Lang(33)];d.isMyCall=!1,d.setCustomCallEvent(S.incoming_call_try),g=n.UIN,m=webix.modalbox({buttons:a,text:mcService.Lang(39)+n.Nick,width:"400px",callback:function(e){switch(e){case"0":i(!1),o&&o();break;case"1":n.Video?(i(!0),o&&o()):s();break;case"2":s()}}})},this.myCall=function(n,o,i,s){function a(o){clearTimeout(f),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_call_reject,mcConst.SessionID,n]),d.setStateEvent(S.outgoing_call_rejected,mcLang(507)),C.CloseCall(o?C.callStates.timeout:C.callStates.cancel),e.PlaySound(e.Sounds.Reject),s&&s()}l.Share=i,d.isMyCall=!0,u=webix.alert({type:"alert-warning",ok:mcLang(509),text:mcLang(510),callback:function(){a()}}),f=setTimeout(function(){a(!0),webix.modalbox.hide(u)},3e4),g=n,d.setCustomCallEvent(S.outgoing_call_try),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_call,mcConst.SessionID,n,o,l.Share])},this.prepare=function(){return c=new mcService.MyTimer,l=new MediaCall,l.complete=!1,l.sendAnswer=a,l.sendOffer=s,l.sendCandidate=o,l.onError=i,l.showMedia=r,h.id=mcConst.videoStreamName,h.autoplay="autoplay",h.className="VideoCaller",v.id=mcConst.audioStreamName,v.autoplay="autoplay",v.className="AudioCaller",p.id=mcConst.mirrorStreamName,p.autoplay="autoplay",p.className="myVideo",p.muted="muted",C.recvReady=l.recvReady,C.recvOffer=l.recvOffer,C.recvCandidate=l.recvCandidate,C.recvAnswer=function(){d.setCustomCallEvent(S.outgoing_call_started),l.recvAnswer.apply(null,arguments)},l},this.CloseCall=function(t,o){if(n(!0),e.Stop(),C.onCloseCall&&C.onCloseCall({MID:l.MID,receiveScreen:l.useVideo,useVideo:l.receiveScreen,cPanel:_}),C.nowCalling()){var i=c.Stop();switch(t){case C.callStates.stopCall:d.isMyCall?d.setStateEvent(S.outgoing_call_my_close,mcLang(495,i)):d.setStateEvent(S.incoming_call_my_close,mcLang(494,[o.DisplayName,i]));break;case C.callStates.reject:d.isMyCall?d.setStateEvent(S.outgoing_call_rejected,mcLang(496)):d.setStateEvent(S.incoming_call_rejected,mcLang(500));break;case C.callStates.close:d.isMyCall?d.setStateEvent(S.outgoing_call_remote_close,mcLang(495,i)):d.setStateEvent(S.incoming_call_remote_close,mcLang(494,[o.DisplayName,i]));break;case C.callStates.error:d.setStateEvent(d.isMyCall?S.outgoing_call_remote_error:S.incoming_call_remote_error,mcLang(499));break;case C.callStates.busy:d.setStateEvent(S.outgoing_call_busy,mcLang(501))}g=null,webix.message(mcLang(493)),l.complete=!1,l.hangUp()}d.clearState(),_&&(_.destructor(),_=null)},this.preShow=function(e){n(),d.isMyCall?d.setCustomCallEvent(S.outgoing_call_accepted):d.setCustomCallEvent(S.incoming_call_started),e||l.useVideo||l.receiveScreen?(l.setMirror(p),l.setCallee(h)):l.setCallee(v)},this.nowCalling=function(){return d.currentState()!==S.free},this.getUIN=function(){return g}}function MCPrivatesList(e,t,n,o){function i(e,t){var n=null;return P.hasOwnProperty(e)?n=t?P[e]:mcService.Marge({},P[e]):console.warn("getPrivate: Privates list hasn't a private with UIN: "+e),n}function s(e){if(P.hasOwnProperty(e))return P[e].needHistory}function a(e){P.hasOwnProperty(e)&&(P[e].needHistory=!1)}function r(e){return P.hasOwnProperty(e)}function c(e){r(e)&&(i(e,!0).isOpen=!0)}function l(e){r(e)&&(i(e,!0).isOpen=!1)}function d(e){Object.keys(P).forEach(function(t){e(t,P[t])})}function m(e){return r(e)?P[e].firstMsgIdx:k}function u(e){return r(e)?P[e].IDMsgLast:-1}function f(e){return r(e)?P[e].IDMsgGot:0}function g(e){return r(e)?P[e].upSync:0}function _(e,t){return!P.hasOwnProperty(e)||!P[e].hasMsgIdx(t)}function p(e){var t=e.Data,n=e.UINWith;if(t&&t.length)for(var o=0;o<=t.length-1;o++){var s=t[o].UIN;if(t[o].Mod!==mcConst._CMD_.msgMods.DELETED&&_(s,t[o].Idx)){var a=t[o].UIN==mcConst.UserInfo.UIN?mcConst.UserInfo:i(t[o].UIN,!0),r=t[o].UIN==mcConst.UserInfo.UIN?n:mcConst.UserInfo.UIN,c=t[o].UIN!=mcConst.UserInfo.UIN&&S(n);if(!a){console.warn("User UIN: "+t[o].UIN+" closed. History skipped.");break}L({UINFrom:s,UINTo:r,Nick:a.Nick||a.DisplayName,StateFrom:a.State,Sex:a.Sex,Mod:t[o].Mod,Idx:t[o].Idx,Msg:t[o].Msg,dtUTC:t[o].dtUTC||t[o].dt,MsgType:t[o].MsgType,noNotify:c&&t[o].Idx<=c,History:!1,UpSync:c&&t[o].Idx<=c})}}}function h(t,n){(e.isWebClient||mcConst.ClientSettings.SysEventsLoadHistoryType&&mcConst.ClientSettings.LoadHistoryToPrivate)&&(a(t),e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_sync_private_history_last,mcConst.SessionID,t,n||mcConst.countHistoryMessagesLoad]))}function v(t,n){var o=u(t);if("-1"!==o.toString()){var i=f(t),s=g(t);if(s)o=s;else{if(o===i)return;o=o>i?i+1+"-"+o:"1-"+o}e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_sync_private_history,mcConst.SessionID,t,o,n||p])}}function C(e,t){if(r(e)){var n=i(e,!0);n.myMsg=mcService.Marge(n.myMsg,t)}}function S(e){return r(e)?i(e,!0).myMsg.IDMyMsgRead:0}function b(e){return r(e)?i(e,!0).myMsg.IDMyMsgGot:0}function w(e){return P[e].DisplayName}function y(t){e.GetChatTypeID()===e.createUIN(t)||b()||(c(t),e.SendCMDToServer([mcConst._CMD_.cs_private_get_dialog_msg_states,mcConst.SessionID,t,function(t){C(t.UIN,{UIN:t.UIN,IDMyMsgGot:t.IDMsgGot,IDMyMsgRead:t.IDMsgRead}),e.$broadcast("updateMessagesState",[t.UIN])}]),e.SetPrivate(t),e.needFoto=!!P[t].FotoCRC32,e.$broadcast("addNewPrivateDialog",[t.toString(),w(t),o.getUserState(t)]),e.$broadcast("fillChatFrame",[w(t),"",m(t)!==k||s(t)]),e.$broadcast("changeCenterView",[mcConst.dataModels.ChatFrame]),e.$broadcast("selectTool",[mcConst.dataModels.PrivateInfo]),s(t)&&h(t));var n=u(t),a=i(t,!0).IDMsgRead;n>0&&n!==a&&mcConst.isWindowFocused&&(i(t,!0).IDMsgRead=n,e.SendCMDToServer([mcConst._CMD_.cs_private_msg_read,mcConst.SessionID,t,n]))}function I(e){var t=!1;return e&&e.UIN!=mcConst.UserInfo.UIN&&(r(e.UIN)?e=mcService.Marge(P[e.UIN],e):(t=!0,e.needHistory=!0,e.isOpen=!1,e.messagesList=[],e.firstMsgIdx=k,e.IDMsgGot=e.IDMsgGot||0,e.IDMsgLast=e.IDMsgLast||0,e.IDMsgRead=e.IDMsgRead||0,e.hasMsgIdx=function(t){return-1!==e.messagesList.indexOf(t)}),e.DisplayName=e.Nick||e.DisplayName,e.myMsg={IDMyMsgRead:e.IDMyMsgRead||0,IDMyMsgGot:e.IDMyMsgGot||0},P[e.UIN]=e,e.hasOwnProperty("State")&&o.setUserState(e.UIN,e.State)),t}function T(t){if(r(t))return delete P[t],e.SendCMDToServer([mcConst._CMD_.cs_del_private_dialog,mcConst.SessionID,t]),!0}function D(t,n){if(r(t))return i(t,!0).State=o.setUserState(t,n),e.$broadcast("changeStateForUser",[t,n]),!0}function L(e){if(e.hasOwnProperty("UIN")&&!e.hasOwnProperty("UINFrom")&&(e.UINFrom=e.UIN,delete e.UIN),e.UINTo=e.UINTo.toString(),e.UINFrom=e.UINFrom.toString(),e.dt=mcService.utcTime(e),e.hasOwnProperty("UINFrom")){e.Idx=e.Idx||e.MsgIdx,e.UINFrom==mcConst.UserInfo.UIN||r(e.UINFrom)||I({UIN:e.UINFrom.toString(),Nick:e.Nick,IDMsgLast:e.Idx});var o=i(e.UINFrom!=mcConst.UserInfo.UIN?e.UINFrom:e.UINTo);o&&(t(e),e.History||n.addOrUpdateUser(o,e.dt))}else console.error("No user info in message: "),console.log(e)}function M(){d(l)}var P={},k=999999999,N=0;o.onStatesChange("privates",function(e){Object.keys(P).forEach(function(t){D(t,e[t])})}),this.showPrivate=y,this.addPrivate=function(e){I(e)&&e&&e.UIN!=mcConst.UserInfo.UIN&&n.addOrUpdateUser(e,mcService.formatDate(new Date,"dd.mm.yyyy.hh.nn.ss")),y(e.UIN)},this.updateUserInfo=function(e,t){P.hasOwnProperty(e)?(P[e]=mcService.Marge(P[e],t),D(t.UIN,t.State)):e!=mcConst.UserInfo.UIN&&console.warn("updateUserInfo: Can't update user info for UIN: "+e)},this.getPrivateHistory=h,this.hasPrivate=r,this.hasMessage=function(e,t){var n=i(e,!0);return n&&(n=n.hasMsgIdx(t)),n},this.addMessage=function(e,t,n){var o=!1;if(r(e)){var s=i(e,!0);-1===s.messagesList.indexOf(t)&&s.messagesList.push(t),s.IDMsgLast<=t&&(s.IDMsgLast=t,s.IDMsgGot<=t&&(s.IDMsgGot=t,n&&(s.IDMsgRead=t),o=!0)),(s.firstMsgIdx>=t||s.firstMsgIdx===k&&-1!==t)&&(s.firstMsgIdx=t)}return o},this.isOpen=function(e){if(r(e))return i(e,!0).isOpen},this.closeAllPrivates=M,this.getPrivateInfo=function(e){return i(e)},this.removePrivate=function(e){T(e)},this.setState=D,this.getFirstIdx=m,this.getLastIdx=u,this.getReadIdx=function(e){return r(e)?P[e].IDMsgRead:-1},this.setMyMsgGot=function(e,t){r(e)&&(i(e,!0).myMsg.IDMyMsgGot=t)},this.setMyMsgRead=function(e,t){r(e)&&(i(e,!0).myMsg.IDMyMsgRead=t,i(e,!0).myMsg.IDMyMsgGot=t)},this.getMyMsgReadState=function(e){if(r(e))return i(e,!0).myMsg},this.loadFromStorage=function(){var t=null,n=new mcService.TaskList,i=!1;n.AddTask(function(){e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_private_dialogs,mcConst.SessionID,function(e){t=e,n.Next()}])}),n.AddTask(function(){for(i=!mcService.isObjectEmpty(P),M();t.Data.length;){var s=t.Data.pop();s&&(s.State=mcConst.states.offline,i&&N&&t.DlgIdx>N&&r(s.UIN)&&u(s.UIN)<s.IDMsgLast&&S(s.UIN)<s.IDMsgRead?(s.upSync=u(s.UIN)+1+"-"+s.IDMsgLast,s.IDMyMsgRead=s.IDMsgRead,s.IDMyMsgGot=s.IDMsgGot):s.upSync="",I(s),i||e.$broadcast("updateCounter",[s,!0]))}N=t.DlgIdx,o.loadUserStatuses(),n.Next()}),n.AddTask(function(){d(function(t,n){i&&v(t),n.IDMsgGot<n.IDMsgLast&&(e.SendCMDToServer([mcConst._CMD_.cs_private_msg_got,mcConst.SessionID,n.UIN,n.IDMsgLast]),n.IDMsgGot=n.IDMsgLast)}),n.Next()}),n.Run()},this.statuses={get:o.getUserState,set:D,getAll:o.getAllState},this.sendMessage=L,this.clearPrivates=function(){P={}},this.getHistoryMsgRange=function(t){var n=m(t);"-1"!==n.toString()&&(n=n>mcConst.countHistoryMessagesLoad?n-mcConst.countHistoryMessagesLoad+"-"+n:"1-"+n,e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_sync_private_history,mcConst.SessionID,t,n]))},this.drawHistoryMessages=function(e){var t=e.Data,n=e.UINWith;if(t&&t.length)for(var o=t.length-1;o>=0;o--){var s=t[o].UIN;if(t[o].Mod!==mcConst._CMD_.msgMods.DELETED&&_(s,t[o].Idx)){var a=t[o].UIN==mcConst.UserInfo.UIN?mcConst.UserInfo:i(t[o].UIN,!0),r=t[o].UIN==mcConst.UserInfo.UIN?n:mcConst.UserInfo.UIN;if(!a){console.warn("User UIN: "+t[o].UIN+" closed. History skipped.");break}L({UINFrom:s,UINTo:r,Nick:a.Nick||a.DisplayName,StateFrom:a.State,Sex:a.Sex,Mod:t[o].Mod,Idx:t[o].Idx,Msg:t[o].Msg,dtUTC:t[o].dtUTC||t[o].dt,MsgType:t[o].MsgType,noNotify:!0,History:!0})}}},this.upSyncPrivateHistory=v}function MCConferenceList(e,t,n,o){function i(e){return p.hasOwnProperty(e)}function s(){return Object.keys(p)||[]}function a(e,t){var n=null;return i(e)?n=t?p[e]:mcService.Marge({},p[e]):console.warn("getConf: Conference list hasn't a conf with UID: "+e),n}function r(e,t){var n=[];return i(e)?t?n=p[e].users:p[e].users.forEach(function(e){n.push(mcService.Marge({},e))}):console.warn("getConfUsers: Conference list hasn't a conf with UID: "+e),n}function c(e){return p[e].Name||""}function l(t,n){i(t)?(e.SetConf(t),e.$broadcast("fillChatFrame",[a(t,!0).Name,a(t,!0).Topic,!0]),e.$broadcast("changeCenterView",[mcConst.dataModels.ChatFrame]),e.$broadcast("selectTool",[mcConst.dataModels.ConfUserList]),p[t].hasHistory||u(t)):e.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_join_txt_channel,mcConst.SessionID,t,n||"",function(t){e.$broadcast("selectDialog",["UID-"+t.UID])}])}function d(e){if(i(e))return delete p[e],!0}function m(t,n){if(i(t)){for(var s=r(t,!0);n.length>0;){var a=n[0];a.id=a.UIN.toString(),a.DisplayName||(a.DisplayName=a.Nick);var c=mcService.findItemInArrayOfObj(s,a.UIN,"UIN");c<0?s.push(a):s[c]=a,n.shift()}e.GetChatID()==t&&e.GetChatType()===e.chatAliases.UID&&e.$broadcast(window._messages_.confUsers.addUserToConf,[r(t)]),(e.isWebClient||mcConst.ClientSettings.SoundsSndJoin)&&o.PlaySound(o.Sounds.JoinConf),e.$broadcast(window._messages_.dialogsCtrl.updateChUserCount,[t,s.length])}else console.log("__addUsersToConf: uid="+t+" not in list")}function u(t,n,o){if(i(t)&&(e.isWebClient||mcConst.ClientSettings.SysEventsLoadHistoryType&&mcConst.ClientSettings.LoadHistoryToConf))if(n||(a(t,!0).noNeedHistory=!0),p[t].hasHistory=!0,o){var s=_(t)-mcConst.countHistoryMessagesLoad+"-"+(_(t)-1);e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_sync_conf_history,mcConst.SessionID,t,s,function(e){e.Users=mcService.convertArrayToObj(e.Users,"UIN"),f(e,!1)}])}else e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_channel_history_messages,mcConst.SessionID,t,mcConst.historyTypes.count,n||mcConst.countHistoryMessagesLoad,"","","",function(e){f(e,!!n)}])}function f(e,n){function o(c){c.Mod!=mcConst._CMD_.msgMods.DELETED&&(c.DisplayName=c.DisplayName||e.Users[c.UIN].DisplayName,c.Idx=c.Idx||c.MsgIdx,c.UIN=c.UIN.toString(),c.Nick=c.DisplayName,c.UID=s,c.dt=mcService.utcTime(c),c.History=!n,t(c,!0)),setTimeout(function(){r=r>=a?0:r;var e=n?i.shift():i.pop();e&&o(e)},r>=a?200:2)}var i=mcService.isString(e.Data)?JSON.parse(e.Data.replace(/\r\n/g,"\\r\\n")):e.Data,s=e.UID,a=100,r=0,c=n?i.shift():i.pop();c&&o(c)}function g(e){return i(e)?p[e].lastConvID:0}function _(e){return i(e)?p[e].firstConvID:h}var p={},h=999999999,v=null;n.onStatesChange("confs",function(){var t=e.GetChatType(),o=e.GetChatID();s().forEach(function(i){var s=[];r(i,!0).forEach(function(e){if("0"!==e.UIN.toString()&&n.getUserState(e.UIN)==mcConst.states.offline){var t=r(e.UIN,!0),o=mcService.findItemInArrayOfObj(t,e.UIN,"UIN");s.push(e.UIN),t.splice(o,1)}}),t===e.chatAliases.UID&&o==i&&e.$broadcast(window._messages_.confUsers.removeUserFromConf,[s])})}),this.showConf=l,this.addConf=function(t){var n=t.UID;if(v&&(clearTimeout(v),v=null),i(n)){var o=t.ConvID-g(n);p[n]=mcService.Marge(t,p[n]),u(n,o)}else p[n]=mcService.Marge(t,{users:[],messagesList:[],hasHistory:!1,firstConvID:h,lastConvID:0,hasMsgIdx:function(e){return-1!==this.messagesList.indexOf(e)}}),e.$broadcast("addNewConfToDialogs",[n,c(n)]),v||(v=setTimeout(function(){u(n),v=null},100));m(n,[{UIN:mcConst.UserInfo.UIN,DisplayName:mcConst.UserInfo.Nick,Sex:mcConst.UserInfo.Sex,State:mcConst.UserInfo.State}]),e.GetChatType()!==e.chatAliases.UID&&l(n)},this.addUsersToConf=m,this.removeUsersFromConf=function(t,n){if(i(t)){var s=r(t,!0);s.splice(mcService.findItemInArrayOfObj(s,n,"UIN"),1),e.GetChatID()==t&&e.GetChatType()===e.chatAliases.UID&&e.$broadcast(window._messages_.confUsers.removeUserFromConf,[n.toString()]),(e.isWebClient||mcConst.ClientSettings.SoundsSndLeave)&&o.PlaySound(o.Sounds.LeaveConf),n==mcConst.UserInfo.UIN?(e.$broadcast(window._messages_.dialogsCtrl.removeConfFromDialogs,[t]),d(t)):e.$broadcast(window._messages_.dialogsCtrl.updateChUserCount,[t,s.length])}},this.leaveConf=function(t){i(t)&&e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_leave_txt_channel,mcConst.SessionID,t])},this.getConfHistory=u,this.showConfHistory=f,this.confMessage=function(n){var s=n.UID;if(i(s)){var a=r(s,!0);n.Nick=a[mcService.findItemInArrayOfObj(a,n.UIN,"UIN")].DisplayName,n.Idx=n.Idx||n.MsgIdx,n.UIN=n.UIN.toString(),n.dt=mcService.utcTime(n),t(n),n.MsgType!==mcConst._CMD_.msgType.ADM_DELETE_MESSAGE&&(e.isWebClient||mcConst.ClientSettings.SoundsSndChat)&&o.PlaySound(o.Sounds.ConfMsg)}},this.getConf=a,this.clearUserList=function(){for(var e in p)p[e].users=[]},this.hasMessage=function(e,t){var n=a(e,!0);return n&&(n=n.hasMsgIdx(t)),n},this.addMessage=function(e,t){if(i(e)){var n=a(e,!0);-1===n.messagesList.indexOf(t)&&n.messagesList.push(t),n.lastConvID<=t&&(n.lastConvID=t),n.firstConvID>=t&&(n.firstConvID=t)}},this.getConfList=s,this.getConfUsers=r,this.getConfName=c}function MCStatusesList(e){function t(){i={}}function n(){return mcService.Marge({},i)}function o(e,t){return"0"===e.toString()?i[e]=mcConst.states.online:i[e]=void 0===t?mcConst.states.offline:parseInt(t),mcService.setStatusForUser(e,i[e]),i[e]}var i={},s={};this.setUserState=o,this.getUserState=function(e){return i.hasOwnProperty(e)?i[e]:mcConst.states.offline},this.removeState=function(e){if(i.hasOwnProperty(e))return delete i[e],!0},this.getAllState=n,this.clearState=t,this.loadUserStatuses=function(){e.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_online_users_states,mcConst.SessionID,function(i){i.Users&&i.Statuses&&(i.Users=i.Users.split(","),i.Statuses=i.Statuses.split(","),t(),i.Users.forEach(function(e,t){o(e,i.Statuses[t])}),o(0,mcConst.states.online),Object.keys(s).forEach(function(e){s[e](n())}),e.$broadcast("allUsersOnlineStatusesChanged",[n()]))}])},this.onStatesChange=function(e,t){s[e]=t},this.removeChangeHandler=function(e){s.hasOwnProperty(e)?delete s[e]:console.warn("removeChangeHandler: Not found name: "+e)}}function MCHistoryDialogsList(e){function t(){var e={};return Object.keys(i).forEach(function(t){e[t]=mcService.Marge({},i[t])}),e}function n(e){var t=null;return i.hasOwnProperty(e)&&(t=mcService.Marge({},i[e])),t}function o(e,t,n){i.hasOwnProperty(e)||(i[e]={DisplayName:t,UIN:e}),i[e].dtLastMessage=n}var i={};this.load=function(){e.Storage.historyDialogs.load(mcConst.UserInfo.UIN,mcConst.storageOpts.HISTORYDLG,function(n){n&&(i=mcService.StringToObj(n),e.$broadcast(window._messages_.historyDialogs.dListFillHistory,[t()]))})},this.addOrUpdateUser=function(t,s){var a=t.UINFrom||t.UIN;o(a,t.DisplayName,s),e.Storage.historyDialogs.save(mcConst.UserInfo.UIN,mcConst.storageOpts.HISTORYDLG,i,function(){e.$broadcast(window._messages_.historyDialogs.dListAddOrModifyUser,[n(a)])})},this.removeUser=function(t){i.hasOwnProperty(t)?(delete i[t],e.Storage.historyDialogs.save(mcConst.UserInfo.UIN,mcConst.storageOpts.HISTORYDLG,i)):console.error("History list has't UIN: "+t),e.$broadcast(window._messages_.historyDialogs.dListHistoryRemoveUser,[t])},this.getHistoryList=function(){return t()}}function McFramesList(){function e(e){var t=null;return window.mcService.isHtmlElement(e)&&e.id?t=e:window.mcService.isString(e)?((t=document.getElementById(e)||document.createElement("div")).className="framePaddingР30x10",t.id=e):(console.error("Can't create or find frame: "),console.error(e)),t&&(t.show=function(){o.show(t.id)},t.hide=function(){o.hide(t.id)},n[t.id]=t,i.appendChild(t)),t}function t(t,o){return n[t]?n[t]:o?null:e(t)}var n={},o=this,i=null;this.get=t,this.create=e,this.clear=function(e){var n=t(e);n&&(n.innerHTML="")},this.remove=function(e){var o=t(e,!0);o&&(n[o.id]&&delete n[o.id],o.parentElement.removeChild(o))},this.show=function(e){t(e).style.display="block"},this.hide=function(e){t(e).style.display="none"},this.hasFrame=function(e){return n.hasOwnProperty(e)},this.initView=function(e){i=e}}function UsersCustomOptions(e){function t(e){return o.hasOwnProperty(e)}function n(){e.Storage.dialogs.save(mcConst.ServerInfo.ID,mcConst.UserInfo.UIN,mcConst.storageOpts.cUserOpt,JSON.stringify(o))}var o={},i=null;this.load=function(){e.Storage.dialogs.load(mcConst.ServerInfo.ID,mcConst.UserInfo.UIN,mcConst.storageOpts.cUserOpt,function(e){o=mcService.StringToObj(e)||{}})},this.saveAll=n,this.getUser=function(e){return t(e)?o[e]:{}},this.getOption=function(e,n){return t(e)?o[e][n]:null},this.setUser=function(e,t){mcService.isObject(t)?o[e]=t:console.warn("UsersCustomOptions.setUser: can't save options, is not an object!")},this.setUserOption=function(e,s,a){t(e)||(o[e]={}),o[e][s]=a,i||(i=setTimeout(function(){n()},100))}}function CtrlServersManager(e){var t=e.acConfig.serversInfo,n=mcConst.ServerInfo;this.getServerInfoByID=function(e){return t.hasOwnProperty(e)?mcService.Marge({},t[e]):null},this.addServerInfo=function(e){return mcService.isObject(e)&&e.ID?(t[e.ID]=t[e.ID]?mcService.Marge(t[e.ID],e):e,t[e.ID]):(console.error("addServerInfo incorrect data: "+e),!1)},this.hasServerByID=function(e){return t.hasOwnProperty(e)},this.setCurrentServerByID=function(e){return t.hasOwnProperty(e)?(n.Port=t[e].Port,n.Host=t[e].ServHost,n.ID=e,n.IPv6=mcService.isValidIpAddressV6(t[e].ServHost),n.Secured=t[e].Secured,mcService.Marge({},t[e])):(n.Port=null,n.Host=null,n.ID=null,n.IPv6=!1,n.Secured=!1,!1)},this.getCurrentServer=function(){return mcService.Marge({},n)},this.removeServerByID=function(e){t.hasOwnProperty(e)?delete t[e]:console.error("removeServerByID, unknown id: "+e)},this.mapServers=function(e){var n=[],o=null;for(var i in t){o=mcService.Marge({},t[i]);var s=e?e(o):o;s&&n.push(s)}return n},this.getServerIdByOrderPosition=function(e){return Object.keys(t)[e]},this.getServerIdByServID=function(e){var n=null;for(var o in t)if(t[o].ServerID==e){n=t[o].ID;break}return n},this.getAutoConnectInfo=function(t){e.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_load_autoconnect_server,t])},this.setAutoConnectInfo=function(t,n,o){e.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_save_autoconnect_server,t,n,o,mcConst.UserInfo.UIN,mcConst.LoginInfo.login])}}function initClientData(e,t,n,o){function i(){mcConst.LoggedIn?(l(),n([mcConst._CMD_.ce_hide_window],!0),o&&o.saveStat&&o.saveStat(mcConst.ServerInfo.ID,mcConst.UserInfo.UIN,function(){n([mcConst._CMD_.ce_quit_from_program],!0)}),mcConst.LoggedIn=!1,n([mcConst._CMD_.cs_quit,mcConst.SessionID])):setTimeout(function(){n([mcConst._CMD_.ce_quit_from_program],!0)},10)}function s(){n([mcConst._CMD_.ce_hide_program],!0)}function a(){t.$broadcast(window._messages_.mainMenu.logoutMenu)}function r(){n([mcConst._CMD_.ce_toggle_min_max],!0)}function c(e){n([mcConst._CMD_.ce_toggle_kiosk,e],!0)}function l(){t.hotKeyDispatcher.removePreset(u)}function d(e){n([mcConst._CMD_.ce_get_client_settings,function(n){mcConst.ClientSettings=mcService.Marge(mcConst.ClientSettings,mcService.StringToObj(n.client_settings)||{}),mcConst.ClientDbVer=n.verdb,mcConst.ClientSettingsData=n,mcConst.settingsCRC32=n.settings_crc32,t.UNIT.ctrlServersManager.setCurrentServerByID(t.UNIT.ctrlServersManager.getServerIdByServID(mcConst.ClientSettings.ServID)),null===mcConst.ClientSettings.ServID&&(mcConst.LoginInfo.rm=!1),e&&e()}],!0)}function m(){var e=document.styleSheets[document.styleSheets.length-1],n="._messagesFontSize .messageText, ._messagesFontSize .messageUserName, ._messagesFontSize .messageKanban";switch(e.cssRules.length>1&&e.removeRule(0),mcConst.ClientSettings.SpecialMessagesFontSize){case"0":e.addRule(n,"font-size: 85%",0);break;case"1":e.addRule(n,"font-size: 100%",0);break;case"2":e.addRule(n,"font-size: 110%",0);break;case"3":e.addRule(n,"font-size: 120%",0)}var o=$$("btnSendText");o&&o[mcConst.ClientSettings.GeneralShowSendButton?"show":"hide"](),t.spellCheckManager&&(mcConst.ClientSettings.GeneralSpellCheck?t.spellCheckManager.stat()||t.spellCheckManager.start(mcConst.Lang):t.spellCheckManager.stop()),t.thumbsSize=mcConst.imageSize[mcConst.ClientSettings.SysEventsImagesThumbsSize],mcConst.countHistoryMessagesLoad=mcConst.ClientSettings.SysEventsHistory_1_Num}mcConst.ClientSettings={NetworkReconnectTime:"10",GeneralShowSendButton:"1",GeneralConfirmExit:"1",GeneralMainWindow:"0",GeneralCtrlEnterSend:"0",GeneralSpellCheck:"1",GeneralDoubleClickPagesClose:"1",SpecialMessagesFontSize:"1",SoundsAllSoundsOff:"0",EventsPopupOnNewBBS:"1",EventsPopupOnChannelMessage:"0",EventsPopupOnPrivateMessage:"0",EventsTimeStamp:"1",EventsShowPopupTrayWindow:"1",EventsTrayBBSMsg:"1",EventsTrayChMsg:"1",EventsTrayPvMsg:"1",EventsTrayBlinkOnTaskBar:"1",EventsTrayDontHide:"0",SoundsSndNewMsg:"1",SoundsSndBadWord:"1",SoundsSndLeave:"1",SoundsSndJoin:"1",SoundsSndChatType:"1",SoundsSndChatBS:"1",SoundsSndStatus:"1",SoundsSndError:"1",SoundsSndPrivate:"1",SoundsSndChatRet:"1",SoundsSndSignal:"1",SoundsSndChat:"1",SoundsSndBroadcast:"1",SoundsSndFilesExchangeRequest:"1",SoundsSndFilesExchangeDone:"1",SoundsSndScreenShot:"1",SoundsSndMediaBusy:"1",SoundsSndMediaCall:"1",SoundsSndMediaCallReject:"1",SoundsSndMediaEndCall:"1",SoundsSndMediaIncomingCall:"1",SoundsSndNewMsgFile:"newmsg.mp3",SoundsSndBadWordFile:"badword.mp3",SoundsSndLeaveFile:"leave.mp3",SoundsSndJoinFile:"join.mp3",SoundsSndChatTypeFile:"chattype.mp3",SoundsSndChatBSFile:"chatbs.mp3",SoundsSndStatusFile:"status.mp3",SoundsSndErrorFile:"error.mp3",SoundsSndPrivateFile:"private.mp3",SoundsSndChatRetFile:"chatret.mp3",SoundsSndSignalFile:"signal.mp3",SoundsSndChatFile:"chat.mp3",SoundsSndBroadcastFile:"broadcast.mp3",SoundsSndScreenShotFile:"screenshot.mp3",SoundsSndFilesExchangeRequestFile:"filesrequest.mp3",SoundsSndFilesExchangeDoneFile:"filesdone.mp3",SoundsSndMediaBusyFile:"mediabusy.mp3",SoundsSndMediaCallFile:"mediacall.mp3",SoundsSndMediaCallRejectFile:"mediacallreject.mp3",SoundsSndMediaEndCallFile:"mediaendcall.mp3",SoundsSndMediaIncomingCallFile:"mediaincomingcall.mp3",NetworkSecured:"0",NetworkProxyType:"0",NetworkProxyHost:"",NetworkProxyPort:"1080",NetworkProxyAuth:"0",NetworkProxyUserName:"",NetworkProxyUserPass:"",GeneralWindowsStart:"1",GeneralStartPassword:"0",GeneralDailyUpdatesCheck:"1",GeneralOpenPrivateByOneClick:"1",GeneralFadeWindows:"1",GeneralShowUsersCounterOnTheTabs:"1",GeneralShowMainToolsPanel:"1",GeneralTipOfTheDayNum:"3",GeneralShowTipOfTheDay:"0",GeneralDisableAvatars:"1",GeneralQuickMsgAutoSend:"0",GeneralAutoHideMainWindow:"0",GeneralRememberOpenContactGroups:"",EventsDateTimeStampFormat:"[hh:nn:ss]",EventsTrayWindowDuration:"5",EventsOpenPrivateOnPersonalOrAlert:"0",HotKeysHotKeyMyChat:"<Win>+F12",HotKeysHotKeyMyChatScreenShot:"<Win>+F9",HotKeysUseGlobalHotKeys:"1",HotKeysEscHide:"1",SmileysSmileysSet:"classic",SysEventsShowSysEvents:"1",SysEventsEnterTxtxCh:"1",SysEventsLeaveTxtxCh:"1",SysEventsQuitChat:"1",SysEventsChangeTheme:"1",SysEventsBanUser:"1",SysEventsTurnOut:"1",SysEventsIgnore:"1",SysEventsConnectionLost:"1",SysEventsConnectionRestored:"1",SysEventsDisableEmotions:"0",SysEventsEnableSmileysAnimation:"1",SysEventsAutoreplaceSmileys:"1",SysEventsUseMessagesFontLayouts:"1",SysEventsLoadHistoryType:"1",SysEventsHistory_1_Num:"50",SysEventsAutoFillBroadcastUsersList:"1",SysEventsShowImagesInChat:"1",SysEventsImagesThumbsSize:"2",LogsServer:"1",LogsTxtChannels:"1",LogsPrivates:"1",LogsFiles:"1",SecurityOptionsPassword:"",LanguagesLanguage:"russian.ini",SendFilesInputFilesDir:"",SendFilesBasePort:"10000",SendFilesDataPort:"10001",SendFilesBufferSize:"3",SendFilesSayYes:"0",SendFilesRememberSelectInputFilesFolder:"1",SendFilesRandomPorts:"1",SendFilesRandomPortStart:"10000",SendFilesRandomPortEnd:"20000",SendFilesRenameRecievedDuplicates:"",Colorscolor_ch_pv_back:"13758972",Colorscolor_inp_back:"13758972",Colorscolor_userslist_back:"13758972",Colorscolor_userslist_text:"0",Colorscolor_own_nick_text:"255",Colorscolor_active_link:"255",Colorscolor_visited_link:"8388736",Colorscolor_timestamp:"10526880",Colorscolor_hello_nick:"13209",Colorscolor_users_nick_text:"16711680",UpdateUseAccountForUpdates:"0",UpdateUpdateLogin:"",UpdateUpdatePassword:"",UpdateUpdateDomain:"",UpdateForceUpdateFromMyChatServerInActiveDirectory:"0",SpecialToolsPanelType:"1",SpecialPagesPanel:"3",AdditionalPrivateInfoFields:"EMAIL,WORK_PHONE,WORK_DIVDEPT,HOME_BIRTHDAY",AdditionalProgramCaption:"%program% %ver% - %nickname% %company% (%state%)",AdditionalSystemTrayText:"",InterfaceTrayIconListNumber:"0",InterfaceCommonBackground:"",InterfaceBackgroundPlacement:"",MediaNetworkTransportTCP:"1",MediaNetworkTransportUDP:"1",IceTransportPolicy:"all",LoadHistoryToConf:"1",LoadHistoryToPrivate:"1"};var u="SYSTEM_EVENTS";t.UNIT={ctrlServersManager:new CtrlServersManager(t)},t.clientSysInfo={},t.$broadcast("prepareElectron"),e.prepareActions=function(o){var i=new mcService.TaskList;n([mcConst._CMD_.ce_set_language,o],!0),webix.storage.local.get(mcConst.storageFields.AutoRld)?mcService.ClearSessionSettings(!0):i.AddTask(function(){n([mcConst._CMD_.ce_load_autoconnect_server,function(e){mcConst.LoginInfo.login=e.nick||e.uin,mcConst.LoginInfo.pwd=e.pwd,mcConst.LoginInfo.servPwd=e.srvpwd,mcConst.LoginInfo.rm=mcService.convertIntToBool(e.autoconnect),i.Next()}],!0)}),i.AddTask(function(){n([mcConst._CMD_.ce_get_server_list,function(e){for(var n in e)t.UNIT.ctrlServersManager.addServerInfo(e[n]);i.Next()}],!0)}),i.AddTask(function(){d(i.Next)}),i.AddTask(function(){e.$broadcast("show"+mcConst.dataModels.Login,[o]),m()}),i.Run()};var f=window._messages_.clientData={sendCMDToElectron:"sendCMDToElectron",enableGlobalHotKeys:"enableGlobalHotKeys",disableGlobalHotKeys:"disableGlobalHotKeys",saveCurrentServerID:"saveClientSettings",saveClientSettings:"saveClientSettings",quitFromProgram:"quitFromProgram",getSystemInfo:"getSystemInfo",getClientConnectInfo:"getClientConnectInfo",toggleKioskMode:"toggleKioskMode"};e.$on(f.getClientConnectInfo,function(e,t){d(t[0])}),e.$on(f.toggleKioskMode,function(e,t){c.apply(null,t)}),e.$on(f.sendCMDToElectron,function(e,t){n(t,!0)}),e.$on(f.enableGlobalHotKeys,function(){t.hotKeyDispatcher.addPreset(u,[{key:mcConst.keyCodes.x,altKey:!0,func:function(){mcConst.ClientSettings.GeneralConfirmExit?t.$broadcast(window._messages_.main.confirmExit,[i]):i()}},{key:mcConst.keyCodes.esc,func:s},{key:mcConst.keyCodes.f11,func:r},{key:mcConst.keyCodes.a,altKey:!0,func:a}],document),n([mcConst._CMD_.ce_hide_or_close_by_x,!1],!0)}),e.$on(f.disableGlobalHotKeys,function(){l(),n([mcConst._CMD_.ce_hide_or_close_by_x,!0],!0)}),e.$on(f.saveCurrentServerID,function(e,t){mcConst.ClientSettings.ServID=t&&t.length?t[0]:mcConst.ClientSettings.ServID,n([mcConst._CMD_.ce_set_client_settings,mcConst.ClientSettings],!0),m()}),e.$on(f.getSystemInfo,function(e,o){n([mcConst._CMD_.ce_get_mc_client_info,function(e){t.clientSysInfo=e,o&&o()}],!0)}),e.$on(f.quitFromProgram,function(e,n){mcConst.ClientSettings.GeneralConfirmExit&&!n?t.$broadcast(window._messages_.main.confirmExit,[i]):i()})}function McTextFinder(e){function t(e){f=mcService.getCaretPosition(e.getInputNode()),u[m]&&(u[m].focus(),u[m].className+=" findItemSelected"),e.focus(),mcService.setCaretPosition(e.getInputNode(),f)}function n(e,n,g){if(""!==(n=mcService.trim(n.toLowerCase()))&&n!==d){l&&o(e),f=0;for(var _=e.getElementsByClassName(i),p=0;p<_.length;p++){for(var h,v=_[p].childNodes,C=0;C<v.length;C++)if("#text"===(h=v[C]).nodeName||"A"===h.nodeName){var S="A"===h.nodeName?"innerHTML":"data",b=h[S].toLowerCase();if(b.length>=n.length&&("A"!==h.nodeName||""!==h.innerText)){var w=b.indexOf(n),y={};if(-1!==w){for(;-1!==w;)y[w]=a,y[w+n.length]=c,w=b.indexOf(n,w+1);h[S]=h[S].insertTextAtIndices(y),l=!0}}}l&&(_[p].innerHTML=_[p].innerHTML.replace(new RegExp(a,"g"),s).replace(new RegExp(c,"g"),r))}d=n,u=document.getElementsByClassName("findItem"),m=0,t(g)}else n===d&&u[m]&&(u[m].className=u[m].className.replace(" findItemSelected",""),++m===u.length&&(m=0),t(g))}function o(e){var t=e.getElementsByClassName(i);u[m]&&u[m].className&&(u[m].className=u[m].className.replace(" findItemSelected",""));for(var n=0;n<t.length;n++)t[n].innerHTML=t[n].innerHTML.replace(new RegExp(s,"g"),"").replace(new RegExp(r,"g"),"");l=!1,d=""}var i="messageText",s='<fndel class="findItem" tabindex="0">',a="``open``",r="</fndel>",c="``close``",l=!1,d="",m=0,u=[],f=0;String.prototype.insertTextAtIndices=function(e){return this.replace(/./g,function(t,n){return e[n]?e[n]+t:t})};var g=window._messages_.textFinder={find_chat_text:"find_chat_text",find_clear:"find_clear"};e.$on(g.find_chat_text,function(e,t){n.apply(null,t)}),e.$on(g.find_clear,function(e,t){o.apply(null,t)})}function McSpellChecker(){var e=require("electron").webFrame,t=require("electron-spell-check-provider"),n="",o=null,i=!1;this.start=function(s){switch(s){case"ru":n="ru_RU";break;case"en":n="en_US";break;default:n="en_US"}n&&(o=new t(n),e.setSpellCheckProvider(n,!0,o.on("misspelling",function(e){window.getSelection().toString()&&o.addMenuItems({isMisspelled:!0,spellingSuggestions:e.slice(0,4)})})),i=!0)},this.stop=function(){i&&e.setSpellCheckProvider(n,!1,{spellCheck:function(e){return!0}}),i=!1},this.stat=function(){return i}}function __treeContacts(e,t){var n=e.__view||$$(e.Name);if(n)n.getParentView().show(),$$("pin"+e.Name).setValue(!1);else{var o={id:e.Name+"_parent",rows:[{cols:[{hidden:!t,view:"label",label:t,align:"center"},{view:"toggle",type:"iconButton",id:"pin"+e.Name,offIcon:"nezamok",onIcon:"lock",width:30,css:"btnPaddingToggle4",paddingX:3,on:{onChange:e.pinTool},tooltip:mcLang(511)}]},new mcService.FilterFiled({listName:e.Name,css:"noBorderAll",noClearBtn:!0,placeholder:mcLang(48),filterParams:["DisplayName"]}),{id:e.Name,view:"tree",type:"lineTree",select:!0,scroll:isMobile,borderless:!0,activeTitle:!0,data:e.data||[],css:"myScroll noBGColor"+(isMobile?"":" scrollMenuYX"),on:{onItemClick:e.openPrivate},template:function(e,t){var n="";return e.folder?(e.fName=e.fName||e.DisplayName,e.hasOwnProperty("DisplayName")&&delete e.DisplayName,n=mcService.insertIco("fa-users","smaller")+"<span style='color:#00720d;'>"+e.fName+"</span>"):n=e.TeamLead?"<span class='webix_icon fa-user smaller "+mcConst.storageOpts.STATUSICO+e.UIN+"' style='color:"+mcService.getColorForStatus(e.State)+"'></span><span style='color: rgb(12, 132, 228)'>"+e.DisplayName+"</span>":"<span class='webix_icon fa-user smaller "+mcConst.storageOpts.STATUSICO+e.UIN+"' style='color:"+mcService.getColorForStatus(e.State)+"'></span>"+e.DisplayName,t.icon(e,t)+"<span style='cursor: pointer;'>"+n+"</span>"}}]};$$(e.container).addView(o),(n=$$(e.Name)).parentContainer=$$(e.Name+"_parent"),e.__view=n,mcService.disableContextMenu(n)}return n}function initLogin(e){var t=null;$$(e.Name)&&$$(e.Name).destructor();var n=webix.ui({view:"popup",width:300,height:150,body:{autoheight:!0,css:"wrap",borderless:!0,template:mcService.insertIco("fa-info-circle")+mcService.Lang(64)}}),o=webix.ui({view:"popup",width:300,height:120,body:{autoheight:!0,css:"wrap",borderless:!0,template:mcService.insertIco("fa-info-circle")+mcService.Lang(175)}}),i={id:"loginForm",view:"form",rules:{loginField:webix.rules.isNotEmpty,passwordField:function(t){return-1===e.loginField.getValue().toString().replace("\\","/").indexOf("/")||!!mcService.trim(t)}},elements:[{rows:[{cols:[{id:"loginField",name:"loginField",view:"text",labelWidth:140,value:e.login,required:!0,invalidMessage:"<span class='red h10'>"+mcService.Lang(66)+"</span>",placeholder:mcService.Lang(1),on:{onKeyPress:function(t){if(13===t)return""!==e.passwordField.getValue()?e.loginBtnClick.call(e.loginForm):e.passwordField.focus(),!1}}},{view:"button",template:mcService.insertIco("fa-question"),width:34,borderless:!0,css:"finger webixBlue loginHelper",click:function(){o.show(this.getNode())}}]},{cols:[{id:"passwordField",name:"passwordField",view:"text",labelWidth:140,type:"password",keyPressTimeout:100,invalidMessage:"<span class='red h10'>"+mcService.Lang(66)+"</span>",placeholder:mcService.Lang(2),on:{onKeyPress:e.keyLogin,onTimedKeyPress:function(){e.checkLangPass(e.loginDispLang,e.passwordField)}}},{id:"loginDispLang",template:"EN",width:34,css:"loginHelper",borderless:!0}]},{height:38}]}]},s={id:"registrationForm",view:"form",hidden:!0,rules:{regLoginField:webix.rules.registerLogin,regPasswordField:webix.rules.isNotEmpty,regEmailField:webix.rules.isEmail},elements:[{rows:[{id:"regLoginField",name:"regLoginField",view:"text",value:"",required:"true",placeholder:mcService.Lang(56),invalidMessage:"<span class='red h10'>"+mcService.Lang(581)+"</span>",on:{onKeyPress:e.checkRegisterChars}},{id:"regPasswordField",name:"regPasswordField",view:"text",type:"password",required:"true",placeholder:mcService.Lang(58),invalidMessage:"<span class='red h10'>"+mcService.Lang(66)+"</span>",on:{onKeyPress:e.keyRegister}},{id:"regEmailField",name:"regEmailField",view:"text",type:"email",placeholder:mcService.Lang(59),invalidMessage:"<span class='red h10'>"+mcService.Lang(66)+"</span>",on:{onKeyPress:e.keyRegister}}]}]},a={view:"form",rows:[].concat(e.isWebClient?{hidden:!e.isWebClient,cols:[{id:"servPassField",view:"text",type:"password",placeholder:mcService.Lang(3),on:{onKeyPress:e.keyLogin}},{view:"button",template:mcService.insertIco("fa-question"),width:34,borderless:!0,css:"finger webixBlue loginHelper",click:function(){n.show(this.getNode())}}]}:{cols:[{id:"loginSelectServer"+e.Name,view:"richselect",options:e.serverList,value:e.serverList.length?e.serverList[0].id:0,placeholder:mcLang(515),on:{onFocus:function(){e.loginSelectServer.blur()},onItemClick:e.checkEmptyList,onChange:e.changeServerHost}},{id:"toggleServerInfo",view:"button",type:"icon",icon:"gear",width:34,css:"iconNoPadding",tooltip:mcLang(516),click:e.showServerManager}]}).concat({id:"rememberField",view:"checkbox",labelWidth:0,value:e.remember,css:"finger",labelRight:e.isWebClient?mcLang(4):mcLang(533),on:{onChange:function(t){e.remember=mcService.convertIntToBool(t)}}},{view:"button",value:mcService.Lang(13),id:"loginBtn",click:function(){(this.getFormView().validate()||e.isWebClient)&&("loginForm"==$$("_loginType").getValue()?e.loginBtnClick.call(e.loginForm):e.registerBtnClick.call(e.registrationForm))}})};return isMobile?(i.maxWidth=550,i.minWidth=300,s.maxWidth=550,s.minWidth=300,t=webix.ui({id:e.Name,view:"scrollview",css:"noBGColor",body:{rows:[{view:"tabview",id:"_loginType",borderless:!0,cells:[{header:mcLang(5),body:i},{header:mcLang(55),body:s}]},a]}})):($$("loginLang")||webix.ui({view:"richselect",id:"loginLang",container:"languageChanger",value:e.lang,css:"noBGColorAll",options:{template:"#value#",data:[{id:"en",value:'<img src="'+mcConst.imagesPath.flags+'en32.png" align="left">&nbsp; english'},{id:"uk",value:'<img src="'+mcConst.imagesPath.flags+'uk32.png" align="left">&nbsp; українська'},{id:"ru",value:'<img src="'+mcConst.imagesPath.flags+'ru32.png" align="left">&nbsp; русский'}]},on:{onChange:e.changeLang}}),t=webix.ui({id:e.Name,view:"window",width:370,position:"center",head:!1,body:{rows:[{view:"tabview",id:"_loginType",borderless:!0,cells:[{header:mcLang(5),body:i},{header:mcLang(55),body:s}]},a]},on:{onHide:function(){e.doLogin||t.show()}}})),e.loginForm=$$("loginForm"),e.passwordField=$$("passwordField"),e.loginDispLang=$$("loginDispLang"),e.loginField=$$("loginField"),e.servPassField=$$("servPassField"),e.loginBtn=$$("loginBtn"),e.registrationForm=$$("registrationForm"),e.regLoginField=$$("regLoginField"),e.regPasswordField=$$("regPasswordField"),e.regEmailField=$$("regEmailField"),e.loginSelectServer=$$("loginSelectServer"+e.Name),setTimeout(function(){e.loginField.focus()},10),t.show(),t}function loginController(e,t,n){function o(){mcService.SaveSessionSettings(mcConst.LoginInfo.login,"","",!1),mcConst.LoginInfo.pwd="",mcConst.LoginInfo.servPwd="",mcConst.LoginInfo.rm=!1,e.show(e.lang)}function i(){var t=l.getCurrentServer().ID||l.getServerIdByOrderPosition(0);t&&e.loginSelectServer.setValue(t)}function s(t){var n=mcService.findItemInArrayOfObj(e.serverList,t.ID,"id");(t=l.addServerInfo(t))&&(e.serverList[-1===n?e.serverList.length:n]={id:t.ID,ord:mcService.convertBool(!!t.ServerID),value:"<span class='"+(t.ServerID?"green":"linkColor")+"'>"+(t.ServName?t.ServName+", ":"")+t.ServHost+": "+t.Port+"</span>"},-1===n?e.loginSelectServer.getList().add(e.serverList[e.serverList.length-1]):(e.loginSelectServer.define("options",e.serverList),e.loginSelectServer.refresh()),e.loginSelectServer.getList().sort("ord","dsc","int"))}function a(){e.doLogin=!0,(d=$$(e.Name))&&d.isVisible&&d.isVisible()&&d.hide(),t.loginFormNotShowed=!0,mcService.hideFrame("languageChanger")}function r(o){var i=o?o[0]:mcConst.Lang,s=void 0!=e.lang&&e.lang!=i,a=n.param("token");if(webix.storage.local.put("admLang",e.lang),a)t.SendCMDToServer([mcConst.lockInterface,mcConst._CMD_.cs_login_by_token,a]),window.history.pushState(null,document.title,window.location.pathname+window.location.hash.replace("token="+a,""));else if(d&&d.show&&!s)e.doLogin=!1,d.show(),t.loginFormNotShowed=!1;else if(!d||d&&d.isVisible&&!d.isVisible()||o[0]&&e.lang!=o[0]){e.doLogin=!1,e.isWebClient=t.isWebClient;var r="",c="",l="",m="",u="";d&&(r=e.loginField.getValue()||mcConst.LoginInfo.login,c=e.passwordField.getValue(),l=e.regLoginField.getValue(),m=e.regPasswordField.getValue(),u=e.regEmailField.getValue()),e.show.apply(null,o),e.loginField&&(e.loginField.setValue(e.login||r),e.passwordField.setValue(c),e.regLoginField.setValue(l),e.regPasswordField.setValue(m),e.regEmailField.setValue(u))}}function c(t){var n=e.loginSelectServer.getValue();if(n){var o=l.getServerInfoByID(n),i=o?o.ServPass:"",s=i&&mcService.isString(o.ServPass)?o.ServPass:"";!0===i&&""==s?webix.ui({view:"window",width:240,head:!1,position:"center",modal:!0,body:{view:"form",rules:{goServPwd:webix.rules.isNotEmpty},rows:[{view:"text",type:"password",placeholder:mcLang(3),name:"goServPwd",require:!0},{cols:[{view:"button",value:mcLang(13),hotkey:"enter",click:function(){this.getFormView().validate()&&(s=this.getFormView().getValues().goServPwd,o.ServPass=s,l.addServerInfo(o),t(s),this.getTopParentView().close())}},{view:"button",value:mcLang(33),click:function(){this.getTopParentView().close()}}]}]},on:{onShow:function(){this.getChildViews()[0].focus("goServPwd")}}}).show():t(s)}else webix.alert(mcLang(530))}e.Name=mcConst.dataModels.Login,e.remember=!1,e.serverList=[],e.doLogin=!1;var l=t.isWebClient?null:t.UNIT.ctrlServersManager,d=null;t.ErrorActions[14]=function(){t.isWebClient?(t.loginFormNotShowed=!1,mcService.SaveSessionSettings(mcConst.LoginInfo.login,"","",!1),mcConst.LoginInfo.pwd="",mcConst.LoginInfo.servPwd="",mcConst.LoginInfo.rm=!1,d||initLogin(e),webix.ready(function(){setTimeout(function(){e.passwordField.focus()},100)})):o()},t.ErrorActions[80]=function(){t.isWebClient?t.ErrorActions[14]():o()},t.ErrorActions[81]=function(e){t.$broadcast("ErrorMsg",[81,mcConst.ErrorText[81],e,function(){t.ErrorActions[14]()}])},e.checkRegisterChars=function(e,n){return-1===t.restrictedSymbols.indexOf(n.key)},e.keyLogin=function(t,n){if(13===t&&!n.ctrlKey&&!n.shiftKey&&!n.altKey)return"loginForm"==$$("_loginType").getValue()?e.loginBtnClick.call(e.loginForm):e.registerBtnClick.call(e.registrationForm),!1},e.keyRegister=e.keyLogin,e.checkEmptyList=function(){0==e.loginSelectServer.getList().count()&&e.showServerManager()},e.checkLangPass=function(e,t){var n=e,o=t.getValue()[t.getValue().length-1];o&&(o.match(/[a-zA-Z]/)?(n.define("template","EN"),n.refresh()):o.match(/[а-яА-Я]/)?(n.define("template","RU"),n.refresh()):o.match(/[їЇіІєЄ]/)&&(n.define("template","UA"),n.refresh()))},e.loginBtnClick=function(){function n(n){var o=e.loginField.getValue().toString().replace("\\","/"),i=e.passwordField.getValue();-1===o.indexOf("/")||i?t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.Login,o,i,n,mcConst.LoginInfo.rm]):webix.message({type:"error",text:mcService.Lang(7),expire:mcConst.errMessageExpire})}this.validate()?(e.isWebClient?(mcConst.LoginInfo.servPwd=e.servPassField.getValue(),n(mcConst.LoginInfo.servPwd)):c(function(e){n(e)}),mcConst.LoginInfo.login=e.loginField.getValue(),mcConst.LoginInfo.rm=e.remember):webix.message({type:"error",text:mcService.Lang(7),expire:mcConst.errMessageExpire})},e.registerBtnClick=function(){function n(n){t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.Register,e.regLoginField.getValue(),e.regPasswordField.getValue(),n,mcConst.LoginInfo.rm,e.regEmailField.getValue(),0])}this.validate()&&(e.isWebClient?n(e.servPassField.getValue()):c(function(e){n(e)}),mcConst.LoginInfo.login=e.regLoginField.getValue(),mcConst.LoginInfo.rm=e.remember)},e.changeLang=function(e){t.$broadcast("ChangLanguage",mcService.detectLang(e))},e.changeServerHost=function(e){l.setCurrentServerByID(e)},e.showServerManager=function(){a(),t.$broadcast("show"+mcConst.dataModels.ServerManager,[function(){r(),mcService.showFrame("languageChanger"),e.loginSelectServer.setValue(null),e.getMcList()}])},e.show=function(n,o){var i=void 0!=e.lang&&e.lang!=n;e.lang=n||mcConst.Lang,e.login=mcConst.LoginInfo.login||"",e.remember=mcConst.LoginInfo.rm,webix.storage.local.put(mcConst.storageFields.lang,e.lang),!i&&e.remember?(t.loginFormNotShowed=!d||d&&d.isVisible&&!d.isVisible(),o&&t.$broadcast("ErrorMsg",["223",mcConst.ErrorText[223]+"<br>"+mcLang(539)+"<br><br>"+mcConst.loadGif,"",function(){t.$broadcast("show"+mcConst.dataModels.Login,[])}]),setTimeout(function(){t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.Login,mcConst.LoginInfo.login,mcConst.LoginInfo.pwd,mcConst.LoginInfo.servPwd,mcConst.LoginInfo.rm])},o?500:10)):webix.ready(function(){d=initLogin(e),e.getMcList(),t.loginFormNotShowed=!1})},e.getMcList=function(){if(!e.isWebClient){e.serverList=[];var n=l.getCurrentServer().ID;if(e.loginSelectServer.getList().clearAll(),e.loginSelectServer.setValue(),l.mapServers(s),n)e.loginSelectServer.setValue(n);else{var o=l.getServerIdByServID(mcConst.ClientSettings.ServID);o?e.loginSelectServer.setValue(o):t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_get_server_list])}}},e.$on("addServerHostToList",function(t,n){if(d&&e.loginSelectServer){for(var o in n[0])s.call(null,n[0][o]);i()}}),e.$on("enable"+e.Name,function(){d&&d.enable()}),e.$on("hide"+e.Name,function(){a()}),e.$on("show"+e.Name,function(e,t){r(t)}),t.$broadcast("windowResize",[function(){isMobile&&d&&d.resize()}])}function initServerManager(e){var t=null;return $$(e.Name)&&$$(e.Name).destructor(),t=webix.ui({id:e.Name,view:"window",width:370,position:"center",head:{view:"toolbar",margin:-4,cols:[{id:"managerTitle"+e.Name,view:"label",label:e.mainTitle},{view:"icon",icon:"times-circle",click:e.hideServerManager,tooltip:mcLang(528)}]},body:{id:"formServerManager"+e.Name,view:"form",padding:4,rules:{servHost:mcService.isValidHostName,servPort:webix.rules.isNumber},rows:[{rows:[{id:"loginSelectServer"+e.Name,view:"richselect",options:e.serverList,placeholder:mcLang(531),value:e.serverList.length?e.serverList[0].id:0,on:{onChange:e.changeServerHost,onFocus:function(){e.loginSelectServer.blur()}}},{id:"mainServerInfo",padding:4,hidden:!0,rows:[{cols:[{id:"servHost",name:"servHost",view:"text",label:mcService.Lang(512),labelWidth:160,invalidMessage:"<span class='red h10'>"+mcService.Lang(532)+"</span>",labelAlign:"right",required:!0},{id:"checkConnect"+e.Name,view:"button",type:"icon",icon:"bolt",css:"iconNoPadding green byCenter",width:36,click:e.checkServerConnect,tooltip:mcLang(523)}]},{id:"servPort",name:"servPort",view:"text",label:mcService.Lang(513),labelWidth:160,value:2004,invalidMessage:"<span class='red h10'>"+mcService.Lang(524)+"</span>",labelAlign:"right",required:!0}]},{id:"additionalServerInfo",padding:4,hidden:!0,rows:[{id:"servName",view:"text",labelWidth:160,labelAlign:"right",label:mcService.Lang(514)},{id:"servPass",view:"text",type:"password",labelWidth:160,labelAlign:"right",label:mcService.Lang(3)},{id:"servSSL",view:"checkbox",labelWidth:0,value:e.remember,css:"finger",labelRight:mcService.Lang(522)}]},{id:"addAndDel",height:40,cols:[{view:"button",type:"icon",icon:"plus-square",css:"iconNoPadding",label:mcLang(518),click:function(){e.editServer(526,!0)}},{id:"addBtn"+e.Name,view:"button",type:"icon",icon:"pencil-square",css:"iconNoPadding",disabled:!0,label:mcLang(521),click:function(){e.editServer(527)}},{id:"delBtn"+e.Name,view:"button",type:"icon",icon:"minus-square",css:"iconNoPadding",disabled:!0,label:mcLang(519),click:e.delServer}]},{height:1},{id:"logResult",view:"label",hidden:!0,css:"red"},{id:"okAndCancel",hidden:!0,height:40,cols:[{id:"saveServer"+e.Name,view:"button",type:"icon",icon:"check-circle",css:"iconNoPadding green byCenter",label:mcLang(77),click:e.saveServerEdit},{view:"button",type:"icon",icon:"times-circle",css:"iconNoPadding red byCenter",label:mcLang(33),click:e.cancelServerEdit}]},{height:3}]}]},on:{onHide:function(){e.needHide||t.show()}}}),e.servHost=$$("servHost"),e.servPort=$$("servPort"),e.servName=$$("servName"),e.servPass=$$("servPass"),e.servSSL=$$("servSSL"),e.addBtn=$$("addBtn"+e.Name),e.delBtn=$$("delBtn"+e.Name),e.checkConnect=$$("checkConnect"+e.Name),e.saveServer=$$("saveServer"+e.Name),e.logResult=$$("logResult"),e.addAndDel=$$("addAndDel"),e.okAndCancel=$$("okAndCancel"),e.loginSelectServer=$$("loginSelectServer"+e.Name),e.formServerManager=$$("formServerManager"+e.Name),e.additionalServerInfo=$$("additionalServerInfo"),e.mainServerInfo=$$("mainServerInfo"),e.managerTitle=$$("managerTitle"+e.Name),t.show(),t}function serverManagerController(e,t){function n(){e.servHost.setValue(""),e.servPort.setValue(2004),e.servName.setValue(""),e.servPass.setValue(""),e.servSSL.setValue(!1)}function o(t){var n=g.getServerInfoByID(t);n&&!p&&(e.servHost.setValue(n.ServHost),e.servPort.setValue(n.Port),e.servName.setValue(n.ServName||""),e.servPass.setValue(mcService.isString(n.ServPass)?n.ServPass:""),e.servSSL.setValue(mcService.convertIntToBool(n.Secured)))}function i(){e.okAndCancel.isVisible()&&(e.okAndCancel.hide(),e.addAndDel.show(),e.mainServerInfo.hide(),r(),e.loginSelectServer.show(),e.logResult.hide(),e.managerTitle.define("label",e.mainTitle),e.managerTitle.refresh(),t.hotKeyDispatcher.removePreset(h))}function s(){if(!e.addAndDel.isVisible())return!0;e.addAndDel.hide(),e.okAndCancel.show(),e.mainServerInfo.show();var n=e.loginSelectServer.getValue();e.loginSelectServer.hide(),e.loginSelectServer.setValue(n),e.logResult.hide(),e.loginSelectServer.getList().isVisible()&&e.loginSelectServer.getList().hide(),t.hotKeyDispatcher.addPreset(h,[{key:mcConst.keyCodes.esc,func:e.cancelServerEdit},{key:mcConst.keyCodes.enter,func:e.saveServerEdit}],document,!0)}function a(){e.additionalServerInfo.isVisible()||e.additionalServerInfo.show()}function r(){e.additionalServerInfo.isVisible()&&e.additionalServerInfo.hide()}function c(t){var n=mcService.findItemInArrayOfObj(e.serverList,t.ID,"id");(t=g.addServerInfo(t))&&(e.serverList[-1===n?e.serverList.length:n]={id:t.ID,ord:mcService.convertBool(!!t.ServerID),value:"<span class='"+(t.ServerID?"green":"linkColor")+"'>"+(t.ServName?t.ServName+", ":"")+t.ServHost+": "+t.Port+"</span>"},-1===n?e.loginSelectServer.getList().add(e.serverList[e.serverList.length-1]):(e.loginSelectServer.define("options",e.serverList),e.loginSelectServer.refresh()),e.loginSelectServer.getList().sort("ord","dsc","int"),e.addBtn.enable(),e.delBtn.enable())}function l(){return mcService.trim(e.servHost.getValue()).toLocaleLowerCase()}function d(){return mcService.trim(e.servName.getValue())}function m(){return mcService.trim(e.servPass.getValue())}function u(){var t=parseInt(mcService.trim(e.servPort.getValue()));return isNaN(t)&&(t=2004),(t<=0||t>65535)&&(t=2004),t}function f(){return e.servSSL.getValue()}e.Name=mcConst.dataModels.ServerManager,e.serverList=[],e.runCallBack=null;var g=t.UNIT.ctrlServersManager,_=null,p=!1,h="edit_server_info";t.ElectronErrors[mcConst._CMD_.errElectron.eDuplicateServer]=function(e){webix.alert(e.msg),t.customCallBack[p?mcConst._CMD_.ce_add_server:mcConst._CMD_.ce_modify_server].shift()},t.ElectronErrors[mcConst._CMD_.errElectron.eUnknownServerID]=function(e){webix.alert(e.msg),t.customCallBack[mcConst._CMD_.ce_modify_server].shift()},e.changeServerHost=function(e){g.setCurrentServerByID(e)},e.editServer=function(t,i){s(),a(),p=i,n(),o(e.loginSelectServer.getValue()),e.managerTitle.define("label","<div style='text-align: center'>"+mcLang(t).toUpperCase()+"</div>"),e.managerTitle.refresh(),e.servHost.focus()},e.cancelServerEdit=function(){i()},e.saveServerEdit=function(){var n=mcService.Marge({},p?{}:g.getServerInfoByID(e.loginSelectServer.getValue()),{ServPass:m(),ServName:d(),Port:u(),ServHost:l(),Secured:f()});e.formServerManager.validate()&&t.$broadcast("sendCMDToElectron",[!n.ServerID||p?mcConst._CMD_.ce_add_server:mcConst._CMD_.ce_modify_server,n.ServHost,n.Port,n.ServName,"",n.ServPass,"","",n.Secured,n.ServerID,function(t){t&&t.ServerID&&(n.ServerID=t.ServerID,n.ID=t.ID,n.id=t.ID),c(n),e.loginSelectServer.setValue(n.ID),e.cancelServerEdit()}])},e.checkServerConnect=function(){var n=l(),o=u();e.formServerManager.validate()&&t.$broadcast("sendCMDToElectron",[mcConst.lockInterface,mcConst._CMD_.ce_test_server_ip,n,o,function(t){var n=mcService.isObject(t[0])?t[0].message||t[0].code:"";e.logResult.show(),e.logResult.define("label","<div style='text-align: center; color: "+(n?"red":"green")+";'>"+(n?"Error: "+n:mcLang(529))+"</div>"),e.logResult.refresh()}])},e.delServer=function(){var n=e.loginSelectServer.getValue(),o=e.loginSelectServer.getText();webix.confirm({type:"confirm-warning",text:mcLang(525,o),ok:mcService.Lang(519),cancel:mcService.Lang(33),callback:function(o){if(o){var i=e.loginSelectServer.getList(),s=g.getServerInfoByID(n).ServerID;i.remove(n),0==i.count()&&(e.addBtn.disable(),e.delBtn.disable()),s&&t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_del_server,s]),g.removeServerByID(n),0!=i.count()?e.loginSelectServer.setValue(g.getServerIdByOrderPosition(0)):e.loginSelectServer.setValue(null)}}})},e.show=function(){_=initServerManager(e)},e.getMcList=function(){e.serverList=[];var n=g.getCurrentServer().ID;e.loginSelectServer.getList().clearAll(),e.loginSelectServer.setValue(),g.mapServers(c),n&&e.loginSelectServer.setValue(n),t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_get_server_list])},e.hideServerManager=function(){e.needHide=!0,$$(e.Name).hide(),t.hotKeyDispatcher.removePreset(h),e.runCallBack&&e.runCallBack()};var v=window._messages_.serversManager={addServerHostToList:"addServerHostToList",addServerOnSuccessConnect:"addServerOnSuccessConnect"};e.$on(v.addServerHostToList,function(t,n){if(e.loginSelectServer){for(var o in n[0])c.call(null,n[0][o]);mcConst.ServerInfo.ID&&e.loginSelectServer.setValue(mcConst.ServerInfo.ID),e.changeServerHost(g.getCurrentServer().ID||g.getServerIdByOrderPosition(0))}}),e.$on(v.addServerOnSuccessConnect,function(e,n){var o=g.getServerInfoByID(n);o&&!o.ServerID&&t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_add_server,o.ServHost,o.Port,o.ServName,"",o.ServPass,"","",function(e){g.addServerInfo(e),t.$broadcast(window._messages_.clientData.saveCurrentServerID,[e.ServerID])}])}),e.$on("hide"+e.Name,function(){e.needHide=!0,$$(e.Name).destructor()}),e.$on("show"+e.Name,function(t,n){e.needHide=!1,e.mainTitle="<div style='font-size: 11pt; text-align: center'>"+mcLang(520).toUpperCase()+"</div>",e.show(),e.getMcList(),e.runCallBack=n[0]||null})}function initCommonContacts(e){return __treeContacts(e,mcLang(10))}function commonContactsController(e,t){function n(t){o.clearAll(),o.parse(mcService.convertDataToTree(t)),e.data=o.data,s&&mcService.updateStatuses(s,e.data),i?o.setState(i):i=o.getState()}e.Name=mcConst.dataModels.CommonContacts;var o=null,i=null,s=null;e.openPrivate=function(e){var n=$$(this).getItem(e).UIN;n&&t.$broadcast("OpenPrivate",[n])},e.pinTool=function(n){t.$broadcast(n?"pinTool":"unPinTool",[e.Name])},e.getData=function(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_common_contacts_list,mcConst.SessionID,n])},e.show=function(){t.setTool(e.Name),o=initCommonContacts(e)},e.$on("allUsersOnlineStatusesChanged",function(t,n){s=n[0],mcService.updateStatuses(s,e.data),o&&o.refresh()}),e.$on("newCommonContactList",function(e,t){o&&(i=o.getState(),n.apply(null,t))}),e.$on("hide"+e.Name,function(){i=o.getState(),o.getParentView().hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show(),e.getData()})}function initPersonalContacts(e){var t=__treeContacts(e,mcLang(17));return $$("addNewGroup"+e.Name)||t.parentContainer.addView({view:"button",id:"addNewGroup"+e.Name,value:mcLang(561),click:function(){e.contextPersonalContacts.emitAction("createGroup")}}),e.contextPersonalContacts||(e.contextPersonalContacts=e._contextMenuList.editButtons({buttons:[].concat([{name:"createGroup",type:"add",confirm:e.contextMenu.addGroup,addToContext:!0,showedInList:!1,contextCss:"byCenter whiteAll noUpperCase",label:mcLang(561),title:mcLang(561),editTitle:mcLang(35),okTitle:mcLang(77),cancelTitle:mcLang(33)}]).concat([{name:"addContact",type:"add",confirm:e.contextMenu.addUser,addToContext:!0,showedInList:!1,contextCss:"byCenter whiteAll noUpperCase",label:mcLang(562),title:mcLang(562),editTitle:mcLang(564),okTitle:mcLang(77),cancelTitle:mcLang(33)}]).concat([{name:"editGroup",type:"edit",confirm:e.contextMenu.renameGroup,addToContext:!0,showedInList:!1,contextCss:"byCenter whiteAll noUpperCase",label:mcLang(563),title:mcLang(563),editTitle:mcLang(35),okTitle:mcLang(77),cancelTitle:mcLang(33)}]).concat([{name:"delItem",type:"del",confirm:e.contextMenu.del,addToContext:!0,showedInList:!1,contextCss:"byCenter whiteAll noUpperCase",delName:"DisplayName",label:mcLang(519),cancelTitle:mcLang(33),title:mcLang(565)}]),fillItems:["DisplayName"],list:e.Name,onShowContext:e.onShowPopMenu,onHideContext:e.removeHotKeys,contextOpt:{width:170,padding:0,btnHeight:30}}),e.contextPersonalContacts.attachContext()),t}function personalContactsController(e,t){function n(t){o.clearAll(),o.parse(mcService.convertDataToTree(t)),e.data=o.data,s&&mcService.updateStatuses(s,e.data),i?o.setState(i):i=o.getState()}e.Name=mcConst.dataModels.PersonalContacts;var o=null,i=null,s=null;e._contextMenuList=window.mcWidgets.ButtonsListWithContext?new window.mcWidgets.ButtonsListWithContext(t):null,e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(e.Name,[{lockPrev:!0,key:mcConst.keyCodes.esc,func:function(){e.contextPersonalContacts.hideContext()}}],document,!0)},e.removeHotKeys=function(){setTimeout(function(){t.hotKeyDispatcher.removePreset(e.Name)},10)},e.onShowPopMenu=function(){var t=this.getContext();t.obj.select(t.id);var n=t.obj.getItemNode(t.id);e.registerHotKeys(),this.getChildViews()[0].getChildViews()[2][t.obj.getItem(t.id).IsGroup?"enable":"disable"](),this.blockEvent(),this.show(n,{y:12},"bottom"),this.unblockEvent()},e.contextMenu={addGroup:function(e){var n=this,s=mcService.trim(e.getValue());if(!n.validate()||!s)return!0;i=o.getState(),t.SendCMDToServer([mcConst._CMD_.cs_add_personal_contact_group,mcConst.SessionID,s])},addUser:function(e,n,s){var a=this,r=parseInt(e.getValue());if(!a.validate()||isNaN(r))return webix.message(mcLang(566)),setTimeout(function(){e.focus()},20),!0;i=o.getState(),t.SendCMDToServer([mcConst._CMD_.cs_add_new_contact,mcConst.SessionID,r,s.ParentID])},del:function(e){i=o.getState(),t.SendCMDToServer([mcConst._CMD_.cs_delete_id_from_personal_contacts,mcConst.SessionID,e.id])},renameGroup:function(e,n,s){var a=this,r=mcService.trim(e.getValue());if(!a.validate()||!r)return!0;i=o.getState(),t.SendCMDToServer([mcConst._CMD_.cs_rename_contacts_group,mcConst.SessionID,s.GroupID,r])}},e.openPrivate=function(e){var n=$$(this).getItem(e).UIN;n&&t.$broadcast("OpenPrivate",[n])},e.pinTool=function(n){t.$broadcast(n?"pinTool":"unPinTool",[e.Name])},e.getData=function(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_contacts_list,mcConst.SessionID,n])},e.show=function(){t.setTool(e.Name),o=initPersonalContacts(e)};var a=_messages_.personalContacts={allUsersOnlineStatusesChanged:"allUsersOnlineStatusesChanged",fillPersonalContactList:"fillPersonalContactList"};t.$on(a.allUsersOnlineStatusesChanged,function(t,n){s=n[0],mcService.updateStatuses(s,e.data),o&&o.refresh()}),t.$on(a.fillPersonalContactList,function(e,t){n.apply(null,t)}),e.$on("hide"+e.Name,function(){i=o.getState(),o.getParentView().hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show(),e.getData()})}function initConfUserList(e){var t=$$(e.Name);if(t)t.show(),e.confUserList.clearAll(),e.confUserList.parse(e.data);else{var n={id:e.Name,rows:[{cols:[{view:"label",label:mcLang(26),align:"center"},{view:"button",type:"icon",icon:"sign-out",width:30,css:"btnPaddingToggle4",paddingX:1,click:e.leaveConf,tooltip:mcLang(28)}]},new mcService.FilterFiled({listName:"userList"+e.Name,css:"noBorderAll",noClearBtn:!0,placeholder:mcLang(48),filterParams:["DisplayName"]}),{view:"list",id:"userList"+e.Name,data:e.data,css:"myScroll noBGColor lineHeight20"+(isMobile?"":" scrollMenu"),select:!0,scroll:isMobile,borderless:!0,template:function(e){return mcService.myReplaceFormated("<span class='webix_icon fa-user smaller #{status}' style='#{statusColor}'></span>#{name}",{status:mcConst.storageOpts.STATUSICO+e.UIN,statusColor:"color:"+mcService.getColorForStatus(e.State),name:e.DisplayName})},type:{height:24},on:{onItemClick:e.openPrivate}}]};$$(e.container).addView(n),t=$$(e.Name),e.confUserList=$$("userList"+e.Name),mcService.disableContextMenu(t)}return e.confUserList.sort("DisplayName","asc"),t}function confUserListController(e,t){function n(t){(t=mcService.isArray(t)?t:t.toString().split(",")).forEach(function(t){e.confUserList.getItem(t)&&e.confUserList.remove(t),mcService.delArrayItem(e.data,mcService.findItemInArrayOfObj(e.data,t,"UIN"))})}function o(){e.confUserList&&e.confUserList.clearAll()}e.Name=mcConst.dataModels.ConfUserList;var i=null;e.data=[],e.openPrivate=function(e){var n=$$(this).getItem(e).UIN;return n!=mcConst.UserInfo.UIN&&t.$broadcast("OpenPrivate",[n]),!1},e.leaveConf=function(){t.$broadcast("leaveConf",[t.GetChatID()])},e.getData=function(){t.$broadcast("getConfUsersList",[t.GetChatID(),function(t){e.data=t,e.show()}])},e.show=function(){"UID"===t.GetChatType()&&(t.setTool(e.Name),i=initConfUserList(e))};var s=window._messages_.confUsers={removeUserFromConf:"removeUserFromConf",addUserToConf:"addUserToConf",clearUserForUID:"clearUserForUID",allUsersOnlineStatusesChanged:"allUsersOnlineStatusesChanged"};e.$on(s.clearUserForUID,function(){o()}),t.$on(s.allUsersOnlineStatusesChanged,function(t,o){var i=[],s=o[0];e.data.forEach(function(e){e.UIN==mcConst.UserInfo.UIN||e.State!=mcConst.states.offline&&void 0!==e.State||i.push(e.UIN)}),n(i),mcService.updateStatuses(s,e.data)}),e.$on(s.addUserToConf,function(t,n){if(i){var o=n[0];e.confUserList.parse(o),e.confUserList.sort("DisplayName","asc")}}),e.$on(s.removeUserFromConf,function(e,t){n.apply(null,t)}),e.$on("hide"+e.Name,function(){i&&i.hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.getData()})}function initPrivateInfo(e){var t=$$(e.Name),n="userActions";return t?t.show():($$(e.container).addView({id:e.Name,rows:[{id:n+"SwitchTool",view:"segmented",css:"yellowSelect noBorderAll noCurve",value:2,options:[{id:"1",value:mcLang(538)},{id:"2",value:mcLang(537)}],on:{onChange:e.changeView}},{id:"userInfo"+e.Name,rows:[{id:"uFoto",template:" ",height:175,css:"byCenter noBGColor framePaddingW10 fotoLineHeight",borderless:!0},{height:5},{cols:[{width:4,css:"noBGColor"},{view:"button",type:"icon",id:"startShareCall",click:function(){e.startShareCall()},icon:"desktop",css:"icoButton byCenter button_primary icnBtnPd03",width:35},{view:"button",type:"icon",id:"startVoiceCall",click:function(){e.startVoiceCall()},icon:"phone",label:mcService.Lang(21),css:"icoButton byCenter button_primary icnBtnPd03"},{view:"button",type:"icon",id:"startVideoCall",click:function(){e.startVideoCall()},icon:"video-camera",label:mcService.Lang(22),css:"icoButton byCenter button_success icnBtnPd03"},{view:"button",type:"icon",id:"stopCall",click:function(){e.stopCall()},icon:"times",label:mcService.Lang(23),css:"icoButton byCenter button_danger button_raised icnBtnPd03",hidden:!0},{width:4,css:"noBGColor"}]},{id:"uPrivateInfo",template:"User Info",scroll:"y",css:"myScroll noBGColor selectable",borderless:!0},{height:40,cols:[{template:"<div id='uPrivateTypingNotify'><img id='animateTypingNotify' class='hidden' src='"+mcConst.imagesPath.all+"pero.gif' ></div>",width:32,height:30,padding:0,borderless:!0,css:"noBGColor"},{rows:[{id:"uPrivateState",template:mcService.Lang(29),css:"noBGColor framePaddingW10",height:18,borderless:!0},{id:"uPrivateTypingTextNotify",template:" ",borderless:!0,css:"noBGColor framePaddingW10",height:24}]}]}]},{id:n+e.Name,hidden:!0,rows:[{id:n+"DisplayName",view:"template",template:" ",borderless:!0,autoheight:!0},{height:1,css:"borderBottom"},{height:2},{view:"scrollview",borderless:!0,css:"noBGColor myScroll",body:{rows:[{view:"button",type:"icon",icon:"exchange",label:mcLang(582),click:e.directSend,css:"noUpperCase byCenter",height:30},{id:n+"RedirectBtn",view:"button",type:"icon",icon:"reply",label:mcLang(618),on:{onItemClick:e.showRedirect},css:"noUpperCase byCenter",height:30},{id:n+"RedirectUserWrap",hidden:!0,rows:[new mcService.FilterFiled({listName:n+"RedirectUserList",css:"noBorderAll",clearID:"RedirectUser",id:"FilterRedirectUser",placeholder:mcLang(48),filterParams:["DisplayName","UIN"],keyEvents:{13:function(t){var n=t||e.RedirectUserList.getSelectedItem()||e.RedirectUserList.getItem(e.RedirectUserList.getFirstId());if(n)return e.doRedirect(n),!0},27:function(){e.hideRedirectList()}}}),{id:n+"RedirectUserList",view:"list",css:"myScroll noBGColor",template:function(e){return e.DisplayName},on:{onItemDblClick:function(t){e.doRedirect(e.RedirectUserList.getItem(t))}}},{view:"button",value:mcLang(33),click:function(){e.hideRedirectList()}}]},{height:1,css:"borderBottom"},{id:n+"ReceiveFiles",view:"checkbox",value:e.userConfig.autoReceive,opt:"autoReceive",labelRight:mcLang(602),labelWidth:0,css:"finger font14l",click:e.changeOptions},{gravity:0}]}},{view:"button",value:mcLang(552),click:e.removeUserFromDialogs}]}]}),t=$$(e.Name),e.uPrivateInfo=$$("uPrivateInfo"),e.uFoto=$$("uFoto"),e.callBTN.startVoiceCall=$$("startVoiceCall"),e.callBTN.startVideoCall=$$("startVideoCall"),e.callBTN.startShareCall=$$("startShareCall"),e.callBTN.stopCall=$$("stopCall"),e.userActionsDisplayName=$$("userActionsDisplayName"),e.chckReceiveFiles=$$(n+"ReceiveFiles"),e.RedirectUserWrap=$$(n+"RedirectUserWrap"),e.RedirectUserList=$$(n+"RedirectUserList"),e.RedirectBtn=$$(n+"RedirectBtn"),e.SwitchTool=$$(n+"SwitchTool"),e.PrivateState=$$("uPrivateState"),e.PrivateTypingTextNotify=$$("uPrivateTypingTextNotify"),e.userActions=$$("userActions"+e.Name),e.userInfo=$$("userInfo"+e.Name),e.callBTN.startShareCall.getNode().title=mcLang(604),e.callBTN.startVideoCall.getNode().title=mcLang(606),e.callBTN.startVoiceCall.getNode().title=mcLang(605)),t}function privateInfoController(e,t,n,o){function i(t,n){e.data=t;var o=e.data.What.split(","),i=[mcService.myReplaceFormated('<div class="byCenter bolder brown lHeight30 finger" onclick="window._userActions.openUserProfile(#{uin},\'#{name}\')">#{sex}#{name}</div>',{uin:d,name:e.data.DISPLAYNAME,sex:u[e.data.SEX]}),m.UIN+n];e.userActionsDisplayName.define("template",i[0]),e.userActionsDisplayName.refresh(),e.data.HOME_BIRTHDAY=mcService.toNormalDate(e.data.HOME_BIRTHDAY);for(var s=2;s<o.length;s++)""!==e.data[o[s]]&&("HOME_BIRTHDAY"===o[s]&&"01.01.1900"!==e.data[o[s]]||"HOME_BIRTHDAY"!==o[s])&&i.push("&nbsp;"+m[o[s]]+e.data[o[s]]);e.uPrivateInfo.setHTML(i.join("<br>"))}function s(n,o){t.$broadcast("getUserIgnoreInfo",[o,function(e){e&&"1"==e.Ignores[1]&&(n.What+=",IGNORE",n.IGNORE=mcService.Lang(50))}]),i(n,o),t.$broadcast("getUserState",[o,c]),e.userConfig=t.customUserOptions.getUser(o),e.chckReceiveFiles.setValue(e.userConfig.autoReceive)}function a(){if(l&&l.isVisible()){var t=mcService.getFrame("uPrivateTypingNotify");t&&-1===t.className.indexOf("noBG")&&(t.className+=" noBG"),mcService.showFrame("animateTypingNotify"),e.PrivateTypingTextNotify.define("template",mcService.Lang(49)),e.PrivateTypingTextNotify.refresh()}}function r(){clearTimeout(f),f=null,mcService.hideFrame("animateTypingNotify"),l&&l.className&&-1!==l.className.indexOf("noBG")&&(l.className=l.className.replace(" noBG","")),e.PrivateTypingTextNotify.define("template"," "),e.PrivateTypingTextNotify.refresh()}function c(t){if(e.PrivateState){switch(parseInt(t)){case mcConst.states.offline:e.PrivateState.define("template",mcService.Lang(29));break;case mcConst.states.online:case mcConst.states.webOnline:e.PrivateState.define("template",'<span class="green">'+mcService.Lang(30)+"</span>");break;case mcConst.states.away:e.PrivateState.define("template",'<span class="blue">'+mcService.Lang(31)+"</span>");break;case mcConst.states.dnd:e.PrivateState.define("template",'<span class="red">'+mcService.Lang(32)+"</span>")}e.PrivateState.refresh(),mcConst.states.offline==t?(e.callBTN.startShareCall.disable(),e.callBTN.startVideoCall.disable(),e.callBTN.startVoiceCall.disable()):(e.callBTN.startShareCall.enable(),e.callBTN.startVideoCall.enable(),e.callBTN.startVoiceCall.enable())}}e.Name=mcConst.dataModels.PrivateInfo;var l=null,d=0,m={UIN:'<i class="fa fa-asterisk"></i>&nbsp;',EMAIL:'<i class="fa fa-envelope-o"></i>&nbsp;',WORK_PHONE:'<i class="fa fa-phone"></i>&nbsp;',WORK_DIVDEPT:'<i class="fa fa-sitemap"></i>&nbsp;',HOME_BIRTHDAY:'<i class="fa fa-birthday-cake"></i>&nbsp;',WORK_POSITION:'<i class="fa fa-briefcase"></i>&nbsp;',WORK_COMPANYNAME:'<i class="fa fa-building-o"></i>&nbsp;',CLIENTVERSION:'<i class="fa fa-comments"></i>&nbsp;',ROLE:'<i class="fa fa-users"></i>&nbsp;',IGNORE:'<i class="fa fa-ban red"></i>&nbsp;'},u={0:"<span class='fa fa-user'></span>",1:"<span class='fa fa-male'></span>",2:"<span class='fa fa-female'></span>"},f=null,g=!1;e.PrivateTypingTextNotify=null,e.noImage='<img id="uFotoCanvas" src="'+mcConst.imagesPath.all+'noimage.png" border="0">',e.uPrivateInfo=null,e.uFoto=null,e.PrivateState=null,e.userConfig={},e.callBTN={startVoiceCall:null,startVideoCall:null,stopCall:null},window._userActions.openUserProfile=function(e,n){t.$broadcast("changeCenterView",[mcConst.dataModels.UserProfile,e]),t.$broadcast("selectTool")},webix.ready(function(){n.prepare(),n.onShowMedia=function(e){t.$broadcast("showVideoFrame",[e])},n.onCloseCall=function(n){e.hideStopCall(),t.$broadcast("hideVideoFrame",[n]),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_exit_from_mid,mcConst.SessionID,n.MID])},n.infoMessage=function(e){t.$broadcast("addCustomMSG",[e])}}),e.showStopCall=function(){e.callBTN.startVideoCall&&(e.callBTN.startShareCall.hide(),e.callBTN.startVideoCall.hide(),e.callBTN.startVoiceCall.hide(),e.callBTN.stopCall.show())},e.hideStopCall=function(){e.callBTN.stopCall&&(e.callBTN.stopCall.hide(),e.callBTN.startShareCall.show(),e.callBTN.startVideoCall.show(),e.callBTN.startVoiceCall.show())},e.startVoiceCall=function(){e.showStopCall(),n.myCall(d,!1,!1,e.hideStopCall)},e.startVideoCall=function(){e.showStopCall(),n.myCall(d,!0,!1,e.hideStopCall)},e.startShareCall=function(){e.showStopCall(),n.myCall(d,!1,!0,e.hideStopCall)},e.stopCall=function(){n.nowCalling()&&(t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_media_call_close,mcConst.SessionID,n.getUIN()]),n.CloseCall(n.callStates.stopCall,{DisplayName:e.data.DISPLAYNAME}),o.PlaySound(o.Sounds.End),t.isWebClient||t.$broadcast(window._messages_.clientData.toggleKioskMode,[!1]))},e.showRedirect=function(){g=!1,t.GetChatType()===t.chatAliases.UIN&&t.GetChatID()&&(e.RedirectBtn.disable(),t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_get_users_for_redirect_dialog,mcConst.SessionID,t.GetChatID(),function(t){g=t.WebSupport,e.RedirectUserWrap.show(),e.RedirectUserList.parse(t.Users),$$("FilterRedirectUserEditor").focus()}]))},e.hideRedirectList=function(){$$("clearBtnRedirectUser").callEvent("onItemClick"),e.RedirectUserWrap.hide(),e.RedirectUserList.clearAll(),e.RedirectBtn.enable()},e.doRedirect=function(n){n&&t.GetChatType()===t.chatAliases.UIN&&(e.hideRedirectList(),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_redirect_private_talk,mcConst.SessionID,t.GetChatID(),n.UIN]),g&&t.$broadcast(_messages_.dialogsList.removeDialogFromList,[t.GetChatID()]))},e.changeOptions=function(){var n=this.getValue(),o=this.config.opt;e.userConfig[o]=n,t.customUserOptions.setUserOption(d,o,n)},e.directSend=function(){t.$broadcast(window._messages_.downloadUpload.sendFilesToUser)},e.drawFoto=function(t){t&&t.CRC32&&(e.uFoto.define("template",'<img id="uFotoCanvas" src="data:image/jpg;base64,'+t.Foto+'">'),e.uFoto.refresh())},e.changeView=function(t){"1"===t?(e.userInfo.hide(),e.userActions.show()):(e.userActions.hide(),e.userInfo.show())},e.removeUserFromDialogs=function(){t.$broadcast("removeDialogFromList",[t.GetChatID()])},e.getData=function(n){d!=n&&(t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_uin_foto,mcConst.SessionID,n,e.drawFoto]),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_private_info,mcConst.SessionID,n,"DISPLAYNAME,SEX,UIN,EMAIL,WORK_PHONE,WORK_DIVDEPT,HOME_BIRTHDAY,WORK_POSITION,WORK_COMPANYNAME,CLIENTVERSION,ROLE",function(e){s(e,n)}]),t.setTool(e.Name))},e.show=function(n){l=initPrivateInfo(e),d!=n&&(e.uPrivateInfo.define("template",""),e.uPrivateInfo.refresh(),e.uFoto.define("template",0==t.needFoto?e.noImage:" "),e.uFoto.refresh())},t.$on("sc_media_call",function(i,s){var a=s[0];o.PlaySound(o.Sounds.Receive),t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_show_on_top]),n.callQuestions(a,function(){t.$broadcast("OpenPrivate",[a.UIN]),e.showStopCall()})}),t.$on("sc_media_call_accept",function(e,t){var o=t[0];n.setInfo(o,o.Video,!1),n.preShow(o.Video)}),t.$on("sc_media_call_reject",function(e,t){t[0].UIN==n.getUIN()&&n.CloseCall(n.callStates.reject)}),t.$on("sc_media_call_close",function(t,i){i[0].UIN==n.getUIN()&&n.nowCalling()&&(n.CloseCall(n.callStates.close,{DisplayName:e.data.DISPLAYNAME}),o.PlaySound(o.Sounds.End))}),t.$on("sc_media_call_error",function(e,t){var i=t[0],s=mcService.isObject(i)?JSON.stringify(i):i;console.warn("Media error code: "+s),n.nowCalling()&&(n.CloseCall(n.callStates.error),o.PlaySound(o.Sounds.End))}),t.$on("sc_media_call_busy",function(){n.CloseCall(n.callStates.busy)}),t.$on("sc_media_ready",function(e,t){t[0].UIN==n.getUIN()&&n.recvReady(t[0].UIN)}),t.$on("sc_media_offer",function(e,t){n.preShow(),n.recvOffer(t[0])}),t.$on("sc_media_answer",function(e,t){n.recvAnswer(t[0])}),t.$on("sc_media_ice_candidate",function(e,t){n.recvCandidate(t[0])}),t.$on("sc_media_incoming_call_missed",function(e,t){});var _=_messages_.privateInfo={stopCurrentCall:"stopCurrentCall",addIgnoreInPrivateInfo:"addIgnoreInPrivateInfo",removeIgnoreInPrivateInfo:"removeIgnoreInPrivateInfo",fillPrivateInfo:"fillPrivateInfo",onlineOfflineUsers:"onlineOfflineUsers",onTypingNotify:"onTypingNotify",HideStopCall:"HideStopCall",redirectUserTo:"redirectUserTo"};e.$on(_.stopCurrentCall,function(){e.stopCall()}),e.$on(_.addIgnoreInPrivateInfo,function(t,n){n[0]==d&&(e.data.What+=",IGNORE",e.data.IGNORE=mcService.Lang(50),i(e.data,d))}),e.$on(_.removeIgnoreInPrivateInfo,function(t,n){n[0]==d&&(e.data.What=e.data.What.toString().replace(",IGNORE",""),e.data.IGNORE&&delete e.data.IGNORE,i(e.data,d))}),e.$on(_.fillPrivateInfo,function(e,t){s(t[0],d)}),e.$on(_.onlineOfflineUsers,function(t,n){var o=mcService.getStateStatuses(n[0]);mcService.inArrayNoStrict(d,o.Online)>=0?c(mcConst.states.online):mcService.inArrayNoStrict(d,o.Offline)>=0&&(c(mcConst.states.offline),e.stopCall())}),e.$on(_.onTypingNotify,function(e,t){t[0].UIN==d&&(f||(a(),f=setTimeout(function(){r()},5800)))}),e.$on(_.HideStopCall,function(){e.hideStopCall()}),e.$on(_.redirectUserTo,function(){t.GetChatType()===t.chatAliases.UIN&&t.GetChatID&&(t.$broadcast("selectTool",[mcConst.dataModels.PrivateInfo,!t.$broadcast(_messages_.chatWrapper.isVisibleRightSide)]),e.SwitchTool.setValue("1"),e.RedirectBtn.callEvent("onItemClick"))}),e.$on("hide"+e.Name,function(){l.hide(),d=-1}),e.$on("show"+e.Name,function(o,i){e.container=i[0];var s=t.GetChatID();s==d&&t.getTool()==e.Name||(e.show(s),e.getData(s),d=s,n.nowCalling()&&e.showStopCall())})}function initCommonFiles(e){var t=$$(e.Name);return t?t.show():($$(e.container).addView({id:e.Name,rows:[{view:"list",id:"ftpList"+e.Name,template:function(e){return e.name},select:!0}]}),t=$$(e.Name),e.fileList=$$("ftpList"+e.Name)),t}function commonFilesController(e,t){function n(e){o&&e.indexOf(0===mcService.getLocalHostPath(t.isWebClient))?o.define("src",e):console.error("Wrong URL for iFrame:"+e)}e.Name=mcConst.dataModels.CommonFiles;var o=null;e.pinTool=function(n){t.$broadcast(n?"pinTool":"unPinTool",[e.Name])},e.getData=function(){var n=new mcService.TaskList;n.AddTask(function(){t.SendCMDToServer([mcConst._CMD_.cs_get_public_ftp_info,mcConst.SessionID,function(e){mcConst.FTP.CommonUser=e.Login,mcConst.FTP.CommonPWD=e.Pass,n.Next()}])}),n.AddTask(function(){t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_ftp_login,mcConst.FTP.CommonUser,mcConst.FTP.CommonPWD,function(){n.Next()}])}),n.AddTask(function(){t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_ftp_list,"./",function(t){console.log(t),e.fileList.clearAll(),e.fileList.parse(t)}])}),n.Run()},e.show=function(){t.setTool(e.Name),o=initCommonFiles(e)};var i=_messages_.commonFiles={openCommonFilesUrl:"openCommonFilesUrl"};e.$on(i.openCommonFilesUrl,function(e,t){n.apply(null,t)}),e.$on("hide"+e.Name,function(){o.hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.pathFTP=mcService.getLocalHostPath(!0),e.show(),e.getData()})}function initHistoryDialogs(e){var t=$$(e.Name);if(t)t.show(),$$("pin"+e.Name).setValue(!1);else{var n=new mcService.FilterFiled({listName:"historyList"+e.Name,css:"noBorderAll",noClearBtn:!0,placeholder:mcLang(48),filterParams:["DisplayName"]});$$(e.container).addView({id:e.Name,rows:[{cols:[{view:"label",label:mcLang(578),align:"center"},{view:"toggle",type:"iconButton",id:"pin"+e.Name,offIcon:"nezamok",onIcon:"lock",width:30,css:"btnPaddingToggle4",paddingX:3,on:{onChange:e.pinTool},tooltip:mcLang(511)}]},n,{view:"unitlist",css:"myScroll lineHeight20 noBGColor"+(isMobile?"":" scrollMenuYX"),scroll:!1,id:"historyList"+e.Name,uniteBy:function(e){return e.date},type:{headerHeight:25,height:25},scheme:{$sort:function(e,t){return mcService.sortAB(t.sortDate,e.sortDate)}},template:function(e){return e.DisplayName+" <span class='messageKanbanTime toRight'>("+e.time+")</span>"},data:e.data,on:{onItemClick:e.openPrivate}}]}),t=$$(e.Name),e.historyList=$$("historyList"+e.Name)}return t}function historyDialogsController(e,t){function n(e){var t=e.dtLastMessage.split(".");return t&&(e.date=mcService.myReplaceFormated("#{day} #{month}, #{year}",{day:t[0],month:webix.i18n.calendar.monthShort[t[1]-1],year:t[2]}),e.time=mcService.myReplaceFormated("#{hour}:#{min}:#{sec}",{hour:t[3],min:t[4],sec:t[5]})),e.sortDate=mcService.sortableDate(e.dtLastMessage),e}function o(t){e.data=mcService.convertObjToArray(t||e.data),e.data.forEach(function(e){n(e),e.id="hs_"+e.UIN}),e.historyList&&(e.historyList.clearAll(),e.historyList.parse(e.data))}function i(t){if(t&&void 0!==t.UIN){var o="hs_"+t.UIN;if(t.id=o,e.historyList){var i=e.historyList.getItem(o);i?(i=mcService.Marge(i,n(t)),e.historyList.updateItem(o,i),e.historyList.moveTop(o)):e.historyList.add(n(t),0)}else{var s=mcService.findItemInArrayOfObj(e.data,t.UIN,"UIN");-1===s?e.data.unshift(n(t)):e.data[s]=n(t)}}}function s(e){}e.Name=mcConst.dataModels.HistoryDialogs;var a=null;e.data=[],e.openPrivate=function(n){var o=e.historyList.getItem(n);o&&t.$broadcast("OpenPrivate",[o.UIN])},e.pinTool=function(n){t.$broadcast(n?"pinTool":"unPinTool",[e.Name])},e.show=function(){t.setTool(e.Name),a=initHistoryDialogs(e)};var r=_messages_.historyDialogs={dListAddOrModifyUser:"dListAddOrModifyUser",dListFillHistory:"dListFillHistory",dListHistoryRemoveUser:"dListHistoryRemoveUser"};e.$on(r.dListHistoryRemoveUser,function(e,t){s.apply(null,t)}),e.$on(r.dListAddOrModifyUser,function(e,t){i.apply(null,t)}),e.$on(r.dListFillHistory,function(e,t){o.apply(null,t)}),e.$on("hide"+e.Name,function(){a.hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show()})}function initReceiveFiles(e){var t=$$(e.Name);return t||($$(e.container).addView({id:e.Name,rows:[{cols:[{view:"label",label:mcLang(588),align:"center"},{view:"toggle",type:"iconButton",id:"pin"+e.Name,offIcon:"nezamok",onIcon:"lock",width:30,css:"btnPaddingToggle4",paddingX:3,on:{onChange:e.pinTool},tooltip:mcLang(511)}]},{id:"receiveInfo"+e.Name,view:"template",template:"&nbsp;",borderless:!0,padding:2,css:"noBGColor",autoheight:!0},{height:5},{id:"filesList"+e.Name,view:"list",css:"lineHeight20 noBGColor borderBottom",type:{height:"auto"},template:function(e){return e.fileName+" <span class='messageKanbanTime'>("+mcService.formatFileSize(e.size)+")</span>"},data:e.data},{height:5},{css:"borderBottom",rows:[{view:"button",type:"icon",icon:"folder",label:mcLang(595),click:e.changeReceiveFolder,tooltip:mcLang(596),css:"noUpperCase"},{id:"receiveFolder"+e.Name,view:"template",template:"&nbsp;",borderless:!0,autoheight:!0,css:"noBGColor brown"},{height:5}]},{height:5},{height:30,cols:[{view:"button",value:mcLang(592),click:e.startReceive},{view:"button",value:mcLang(33),click:e.cancelReceive,type:"danger"}]},{height:5}]}),t=$$(e.Name),e.pinFiles=$$("pin"+e.Name),e.filesList=$$("filesList"+e.Name),e.receiveInfo=$$("receiveInfo"+e.Name),e.receiveFolder=$$("receiveFolder"+e.Name)),t.show(),t}function receiveFilesController(e,t){function n(t){e.data=t,e.receiveInfo.define("template",mcService.myReplaceFormated("<div class='borderBottom lHeight28'>#{tFrom} <span class='bolder brown'>#{from}</span><br>#{tSize} <span class='bolder brown'>#{size}</span><br></div>",{tFrom:mcLang(593),tSize:mcLang(594),from:e.data.DisplayName,size:mcService.formatFileSize(e.data.Size),count:e.data.Count})),e.receiveInfo.refresh(),e.receiveFolder.define("template",e.data.DownloadPath),e.receiveFolder.refresh(),e.filesList.clearAll(),e.filesList.parse(e.data.FilesList)}e.Name=mcConst.dataModels.ReceiveFiles;var o=null;e.data=null,e.pinTool=function(n){t.$broadcast(n?"pinTool":"unPinTool",[e.Name])},e.changeReceiveFolder=function(){t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_file_set_new_folder_for_user,e.data.DownloadPath,function(t){e.data.DownloadPath=t,e.receiveFolder.define("template",e.data.DownloadPath),e.receiveFolder.refresh()}])},e.startReceive=function(){t.$broadcast(window._messages_.downloadUpload.acceptReceiveFiles,[e.data.DownloadPath])},e.cancelReceive=function(){t.$broadcast(window._messages_.downloadUpload.rejectReceiveFiles)},e.show=function(){t.setTool(e.Name),o=initReceiveFiles(e),e.pinFiles.getValue()?e.pinTool(!0):e.pinFiles.callEvent("onItemClick")};var i=_messages_.receiveFiles={setReceiveFilesInfo:"setReceiveFilesInfo"};e.$on(i.setReceiveFilesInfo,function(e,t){n.apply(null,t)}),e.$on("hide"+e.Name,function(){o.hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show()})}function initDialogs(e){function t(t,n,o){switch(t){case"arcToolsList"+e.Name:n(t,!0);break;case"arcChannelsList"+e.Name:case"arcDialogsList"+e.Name:n(t),o(t)}}function n(t){e.resizer_1.config.opened.hasOwnProperty(t)||(e.resizer_1.config.opened[t]=!0),Object.keys(e.resizer_1.config.opened).length>=2&&e.resizer_1.config.opened.hasOwnProperty("arcToolsList"+e.Name)&&(e.resizer_1.show(),e.setHeightTool(e.sizes.tool))}function o(t){mcService.checkRights(mcConst._CMD_.RS.QMessengerStyle)||(e.resizer_2.config.opened.hasOwnProperty(t)||(e.resizer_2.config.opened[t]=!0),2===Object.keys(e.resizer_2.config.opened).length&&(e.resizer_2.show(),e.setHeightConf(e.sizes.conf)))}function i(t){e.resizer_1.config.opened.hasOwnProperty(t)&&delete e.resizer_1.config.opened[t],(Object.keys(e.resizer_2.config.opened).length<=1||!e.resizer_1.config.opened.hasOwnProperty("arcToolsList"+e.Name))&&(e.resizer_1.hide(),e.setHeightTool())}function s(t){mcService.checkRights(mcConst._CMD_.RS.QMessengerStyle)||(e.resizer_2.config.opened.hasOwnProperty(t)&&delete e.resizer_2.config.opened[t],e.resizer_2.hide(),e.setHeightConf())}var a=$$(e.Name);if(a)a.show();else{var r={id:"arcDialogsList"+e.Name,view:"accordionitem",css:"lineHeight24 accordionListHeader",header:mcLang(20),minHeight:100,borderless:!0,headerHeight:24,headerAltHeight:24,body:{rows:[{id:"dialogsList"+e.Name,view:"list",data:e.data||[],css:"noBGColor listColorWhite lineHeight20 myScroll scrollMenu",borderless:!0,select:!0,template:function(e){var t=mcService.myReplaceFormated("<span class='webixtype_base webix_badge' id='badge#{id}' style='#{show};'>#{value}</span>",{id:e.id,show:"display:"+(e.badge?"block":"none"),value:e.badge});return"<span style='margin-left: -5px; margin-right: -5px'>"+mcService.myReplaceFormated("<span class='webix_icon fa-user smaller #{icon}' style='#{color}'></span>",{icon:mcConst.storageOpts.STATUSICO+e.UIN,color:"color:"+mcService.getColorForStatus(e.State)})+e.Name+t+"</span>"},scroll:"y",type:{headerHeight:30,height:24},on:{onItemClick:e.clickOnDialogItem,onAfterSelect:e.openPrivateDialog,onBeforeSelect:e.beforeSelect,onItemDblClick:e.removePrivateDialog}},{height:10}]}},c={id:"arcToolsList"+e.Name,view:"accordionitem",css:"lineHeight24 accordionListHeader",borderless:!0,headerHeight:24,headerAltHeight:24,collapsed:!0,header:mcLang(541),body:{id:"toolsList"+e.Name,view:"list",css:"noBGColor listColorWhite lineHeight20 myScroll scrollMenu",borderless:!0,select:!0,scroll:"y",data:[{Name:"Kanban",badge:0,id:mcConst.dataModels.Kanban+"-tool"},{Name:mcLang(556),badge:0,id:mcConst.dataModels.BBS+"-tool"}],template:"<span style='margin-left: -5px; margin-right: -5px'>#Name#</span>",type:{headerHeight:30,height:24},on:{onAfterSelect:e.selectTools}}},l={id:"arcChannelsList"+e.Name,view:"accordionitem",css:"lineHeight24 accordionListHeader",minHeight:90,borderless:!0,headerHeight:24,headerAltHeight:24,collapsed:!0,hidden:!!mcService.checkRights(mcConst._CMD_.RS.QMessengerStyle),header:mcLang(24),body:{rows:[{id:"channelsList"+e.Name,view:"list",css:"noBGColor listColorWhite lineHeight20 myScroll scrollMenu",borderless:!0,select:!0,scroll:"y",type:{headerHeight:30,height:24},template:function(e){var t=mcService.myReplaceFormated("<span class='webixtype_base webix_badge' id='badge#{id}' style='#{show};'>#{value}</span>",{id:e.id,show:"display:"+(e.badge?"block":"none"),value:e.badge});return"<span style='margin-left: -5px; margin-right: -5px'>"+(e.userCount?"<span class='userCount'>("+e.userCount+")</span> ":"")+e.Name+t+"</span>"},on:{onItemClick:e.clickOnDialogItem,onAfterSelect:e.openChannelDialog}},{id:"channelManager",view:"button",css:"imgBtn icoButton noBorderAll button_transparent textUnderline",value:mcLang(25),click:e.openChannelsManager}]},on:{onViewResize:function(){e.sizes.conf=this.getNode().offsetHeight,e.saveOptions(),e.arcDialogsList.refresh()}}};$$(e.container).addView({id:e.Name,minHeight:80,rows:[{id:"_accor1",view:"accordion",multi:!0,borderless:!0,rows:[c],on:{onViewResize:function(){e.sizes.tool=this.$getSize()[3],e.saveOptions()}}},{id:"resizer_1"+e.Name,view:"resizer",borderless:!0,hidden:!0,opened:{}},{id:"_accor2",view:"accordion",multi:!0,borderless:!0,rows:[l,{id:"resizer_2"+e.Name,view:"resizer",borderless:!0,hidden:!0,opened:{}},r]}]}),a=$$(e.Name),e.dialogsList=$$("dialogsList"+e.Name),e.arcDialogsList=$$("arcDialogsList"+e.Name),e.toolsList=$$("toolsList"+e.Name),e.arcToolsList=$$("arcToolsList"+e.Name),e.channelsList=$$("channelsList"+e.Name),e.arcChannelsList=$$("arcChannelsList"+e.Name),e.resizer_1=$$("resizer_1"+e.Name),e.resizer_2=$$("resizer_2"+e.Name),e._accor1=$$("_accor1"),e._accor2=$$("_accor2"),e._accor1.attachEvent("onAfterExpand",function(i){e.sizes.open.tool=!0,t(i,n,o),e.saveOptions()}),e._accor1.attachEvent("onAfterCollapse",function(n){e.sizes.open.tool=!1,t(n,i,s),e.saveOptions()}),e._accor2.attachEvent("onAfterExpand",function(i){switch(i){case"arcChannelsList"+e.Name:e.sizes.open.conf=!0;break;case"arcDialogsList"+e.Name:e.sizes.open.priv=!0}t(i,n,o),e.saveOptions()}),e._accor2.attachEvent("onAfterCollapse",function(n){switch(n){case"arcChannelsList"+e.Name:e.sizes.open.conf=!1;break;case"arcDialogsList"+e.Name:e.sizes.open.priv=!1}t(n,i,s),e.saveOptions()}),mcService.disableContextMenu(a)}return t("arcDialogsList"+e.Name,n,o),t("arcChannelsList"+e.Name,n,o),a}function dialogsController(e,t,n){function o(){for(var t=e.dialogsList.serialize(),n=[],o=0;o<t.length;o++)n.push(t[o].UIN);return n}function i(){b=[].concat(e.sizes.open.conf?e.channelsList.serialize():[]).concat(e.sizes.open.priv?e.dialogsList.serialize():[])}function s(t,n,s,a){var r="dUIN-"+t,c=e.dialogsList.getItem(r);if(!c&&t){var l={isPrivate:!0,id:r,UIN:t,Name:n,badge:a||0,State:s};e.data.push(l),e.dialogsList.add(l,0),e.dialogsList.refresh(),_[r]=l,p=o(),i()}else a&&(c.badge=a,e.dialogsList.updateItem(r,c))}function a(n){var s=0;isNaN(parseInt(n))||(s="dUIN-"+n);var a=e.dialogsList.getItem(s),r=e.dialogsList.getIndexById(s);_.hasOwnProperty(s)&&a&&(delete _[s],e.dialogsList.remove(a.id),e.dialogsList.refresh(),p=o(),i(),t.$broadcast("removeFrameChat",[t.chatAliases.UIN,n]));var c=e.dialogsList.count();0===c?e.$broadcast(window._messages_.dialogsList.OpenPrivate,["0"]):(r===c&&r--,-1!==r&&(r=0),setTimeout(function(){e.dialogsList.select(e.dialogsList.getIdByIndex(r))},100))}function r(t,n){var o="dUID-"+t,s={};s.id=o,s.UID=t,s.badge=0,s.isConf=!0,s.Name=n,g[o]=s,e.channelsList.add(g[o],0),i()}function c(n){var o="dUID-"+n;if(g[o]){delete g[o],e.channelsList.remove(o),t.$broadcast("removeFrameChat",[t.chatAliases.UID,n]),i();var s=e.channelsList.getFirstId(o);if(s)e.channelsList.select(s);else{var a=e.dialogsList.getFirstId();a?e.dialogsList.select(a):(t.SetPrivate(0),t.$broadcast("fillChatFrame",["Elisa"])),t.$broadcast("selectTool",[mcConst.dataModels.CommonContacts])}}}function l(n){if(0===n.indexOf("UIN")&&e.arcDialogsList){if(e.arcDialogsList.expand(),e.dialogsList.getItem("d"+n)){var o=e.dialogsList.getSelectedItem();o&&o.id==="d"+n?t.$broadcast("OpenPrivate",[t.GetChatID()]):e.dialogsList.select("d"+n)}}else 0===n.indexOf("UID")&&e.arcChannelsList?(e.arcChannelsList.expand(),e.channelsList.select("d"+n)):e.arcToolsList&&(e.arcToolsList.expand(),e.toolsList.select(n.split("-")[0]+C))}function d(t){b.length&&(e.channelsList.unselectAll(),e.dialogsList.unselectAll(),e.toolsList.unselectAll(),b[t].isConf?e.channelsList.select(b[t].id):b[t].isPrivate&&e.dialogsList.select(b[t].id),e.clickOnDialogItem(b[t].id))}function m(e){if(!y){var n=e&&b.length?b.length-1:0;if(w)switch(t.GetChatType()){case t.chatAliases.UIN:case t.chatAliases.UID:n=mcService.findItemInArrayOfObj(b,w,"id"),n=e?n>0?n-1:b.length-1:n<b.length-1?n+1:0;break;case t.chatAliases.BBS:case t.chatAliases.Kanban:n=e&&b.length?b.length-1:0}d(n),y=setTimeout(function(){y=null},70)}}function u(t,n){var o="dUID-"+t;if(g.hasOwnProperty(o)){var i=e.channelsList.getItem(o);i.userCount=n,g[o].userCount=n,e.channelsList.updateItem(o,i)}}e.Name=mcConst.dataModels.Dialogs,e.data=[];var f=null,g={},_={},p=[],h=0,v=null,C="-tool",S=null,b=[],w=null,y=null;e.sizes={conf:120,tool:120,open:{conf:!0,tool:!1,priv:!0}},window._userActions.openUserPrivate=function(){var e=this.getAttribute("uin");e!=mcConst.UserInfo.UIN&&t.$broadcast(window._messages_.dialogsList.OpenPrivate,[e])};var I=new function(){var e={};this.update=function(n,o){if(o){var i=mcService.getFrame("badge"+n);i&&(i.innerHTML=o,mcService.showFrame("badge"+n)),e[n]=o}else mcService.hideFrame("badge"+n),e[n]&&delete e[n],t.isWebClient||0!==Object.keys(e).length||t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_break_blink])},this.checkBadges=function(n){var o=Object.keys(e).length;return o||!n||t.isWebClient||t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_break_blink]),o},this.clearAll=function(){Object.keys(e).forEach(function(e){mcService.hideFrame("badge"+e)}),e={}}};e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(e.Name,[{key:mcConst.keyCodes.tab,ctrlKey:!0,func:function(){m()}},{key:mcConst.keyCodes.pagedown,ctrlKey:!0,func:function(){m()}},{key:mcConst.keyCodes.pageup,ctrlKey:!0,func:function(){m(!0)}},{key:mcConst.keyCodes.tab,shiftKey:!0,func:function(){m(!0)}}],document)},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(e.Name)},e.saveOptions=function(){S||(S=setTimeout(function(){t.Storage.dialogs.save(null,null,mcConst.storageOpts.DIALOGOPT,JSON.stringify({sizes:e.sizes}),function(){S=null}),i()},300))},e.setHeightConf=function(t){e.arcChannelsList.define("height",t),e.arcChannelsList.resize(),e._accor2.resizeChildren()},e.setHeightTool=function(t){e._accor1.define("height",t),e._accor1.resize(),e._accor1.resizeChildren()},e.beforeSelect=function(){h=e.dialogsList.getSelectedId()},e.openChannelsManager=function(){t.$broadcast("show"+mcConst.dataModels.ConfManager,[])},e.selectTools=function(n){switch(e.dialogsList.unselectAll(),e.channelsList.unselectAll(),n){case mcConst.dataModels.Forum+C:break;case mcConst.dataModels.BBS+C:t.SetBBS();break;case mcConst.dataModels.Kanban+C:t.SetKanban()}w=null,t.$broadcast("changeCenterView",[n.replace(C,"")]),t.$broadcast("selectTool")},e.clickOnDialogItem=function(n){e.dialogsList.getItem(n)&&t.$broadcast("changeCenterView",[mcConst.dataModels.ChatFrame,n])},e.openPrivateDialog=function(n){var o=e.dialogsList.getItem(n);if(o){var i=_[n];0!==i.badge&&(i.badge=0,I.update(n,i.badge)),e.channelsList.unselectAll(),e.toolsList.unselectAll(),w=n,t.$broadcast("OpenPrivate",[o.UIN])}},e.openChannelDialog=function(n){var o=e.channelsList.getItem(n),i=g[n];0!==i.badge&&(i.badge=0,I.update(n,i.badge)),w=n,e.dialogsList.unselectAll(),e.toolsList.unselectAll(),t.$broadcast("OpenConf",[o.UID])},e.updateCounter=function(t,n){var a=t.UID,r=(t.UINFrom||t.UIN).toString(),c=t.Nick||t.DisplayName;if(mcConst.UserInfo.UIN!=r){var l=void 0!==a?"dUID-"+a:"dUIN-"+r,d=void 0!==a?e.channelsList:e.dialogsList;if(r&&!t.UID&&s(r,c,t.State,t.hasOwnProperty("IDMsgLast")?t.IDMsgLast-t.IDMsgRead:0),d.moveTop(l),p=o(),d.getSelectedId()!==l){var m=_[l]||g[l];m&&(n||m.badge++,I.update(l,m.badge),i())}}},e.show=function(){mcService.updateStatuses(v,e.data),f=initDialogs(e),e.registerHotKeys()},e.removePrivateDialog=function(e){e&&(t.isWebClient||mcConst.ClientSettings.GeneralDoubleClickPagesClose)&&t.$broadcast("removeDialogFromList",[e.split("-")[1]])};var T=_messages_.dialogsCtrl={allUsersOnlineStatusesChanged:"allUsersOnlineStatusesChanged",getUserSequence:"getUserSequence",isConfOpen:"isConfOpen",addNewConfToDialogs:"addNewConfToDialogs",removePrivateFromDialogs:"removePrivateFromDialogs",removeConfFromDialogs:"removeConfFromDialogs",addNewPrivateDialog:"addNewPrivateDialog",selectDialog:"selectDialog",updateCounter:"updateCounter",receiveBBS:"receiveBBS",updateChUserCount:"updateChUserCount",on_mainWindowFocused:"on_mainWindowFocused",clearDialogsList:"clearDialogsList"};e.$on(T.allUsersOnlineStatusesChanged,function(t,n){v=n[0],mcService.updateStatuses(v,e.data),e.dialogsList&&e.dialogsList.refresh()}),e.$on(T.on_mainWindowFocused,function(){mcConst.LoggedIn&&(I.checkBadges(!0),l(t.GetChatTypeID()))}),e.$on(T.getUserSequence,function(e,t){var n=t[0];n&&n(p)}),e.$on(T.isConfOpen,function(e,t){var n=t[0],o=t[1];o&&o(g.hasOwnProperty(n))}),e.$on(T.addNewConfToDialogs,function(e,t){r.apply(null,t)}),e.$on(T.clearDialogsList,function(){_={},p=[],h=0,v=null,b=[],e.dialogsList.clearAll(),t.$broadcast(_messages_.dialogsList.clearPrivatesOnReconnect)}),e.$on(T.removePrivateFromDialogs,function(e,t){a.apply(null,t)}),e.$on(T.removeConfFromDialogs,function(e,t){c.apply(null,t)}),e.$on(T.addNewPrivateDialog,function(e,t){s.apply(null,t)}),e.$on(T.receiveBBS,function(){!t.isWebClient&&mcConst.ClientSettings.EventsPopupOnNewBBS&&t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_show_on_top]),n.Play(n.Sounds.BBS),setTimeout(function(){e.arcToolsList.expand(),e.toolsList.select(mcConst.dataModels.BBS+C),t.$broadcast(window._messages_.BBS.refreshBBS,[mcConst.ClientSettings.EventsTrayBBSMsg])},10)}),e.$on(T.selectDialog,function(e,t){l.apply(null,t)}),e.$on(T.updateCounter,function(t,n){e.updateCounter.apply(null,n)}),e.$on(T.updateChUserCount,function(e,t){u.apply(null,t)}),e.$on("hide"+e.Name,function(){f.hide(),e.removeHotKeys()}),e.$on("show"+e.Name,function(n,o){e.container=o[0],e.wndSize=t.wndSize,e.show(),t.Storage.dialogs.load(null,null,mcConst.storageOpts.DIALOGOPT,function(t){var n=mcService.StringToObj(t);mcService.isObject(n)&&(e.sizes=n.sizes,e.setHeightConf(e.sizes.conf),e.setHeightTool(e.sizes.tool),e.arcDialogsList[e.sizes.open.priv?"expand":"collapse"](),e.arcToolsList[e.sizes.open.tool?"expand":"collapse"](),e.arcChannelsList[e.sizes.open.conf?"expand":"collapse"]())})})}function initMainMenu(e){var t=$$(e.Name);if(t)t.show();else{mcLang(534),mcLang(535);var n={id:e.Name,css:"darkenNavBG",rows:[{view:"button",label:mcLang(45),click:e.profile,css:"imgBtn icoButton button_transparent",type:"icon",icon:"book"},{view:"button",label:mcLang(586),click:e.logs,css:"imgBtn icoButton button_transparent",hidden:e.isWebClient,type:"icon",icon:"file-text-o"},{view:"button",label:mcLang(15),click:e.settings,css:"imgBtn icoButton button_transparent",hidden:e.isWebClient,type:"icon",icon:"cog"},{},{view:"button",label:mcLang(536),click:e.logout,css:"imgBtn icoButton button_transparent",type:"icon",icon:"sign-out"},{view:"button",label:mcLang(47),hidden:e.isWebClient,click:e.quit,css:"imgBtn icoButton button_warning button_transparent",type:"icon",icon:"power-off"}]};$$(e.container).addView(n),t=$$(e.Name),mcService.disableContextMenu(t)}return t}function mainMenuController(e,t){e.Name=mcConst.dataModels.MainMenu;var n={PROFILE:1,SETTINGS:2,LOGS:3},o=null,i=0;e.profile=function(){t.$broadcast("changeCenterView",[mcConst.dataModels.UserProfile,mcConst.UserInfo.UIN]),i=n.PROFILE},e.logs=function(){t.$broadcast("changeCenterView",[mcConst.dataModels.ViewLogs,mcConst.UserInfo.UIN]),i=n.LOGS},e.settings=function(){t.$broadcast("changeCenterView",[mcConst.dataModels.Settings]),i=n.SETTINGS},e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset("MAIN_MENU",[{key:mcConst.keyCodes.esc,lockPrev:!0,func:function(){t.$broadcast("showHideMenu")}}],document)},e.changeStatus=function(e){},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset("MAIN_MENU")},e.logout=function(){mcService.ClearSessionSettings(!0,!0),t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_quit,mcConst.SessionID]),setTimeout(function(){t.$broadcast("StopPingTimer"),location.search="",location.reload()},200)},e.quit=function(){t.$broadcast("quitFromProgram")},e.show=function(){e.isWebClient=t.isWebClient,o=initMainMenu(e),e.registerHotKeys()};var s=_messages_.mainMenu={logoutMenu:"logoutMenu"};e.$on(s.logoutMenu,e.logout),e.$on("hide"+e.Name,function(){switch(e.removeHotKeys(),o.hide(),i){case n.PROFILE:break;case n.LOGS:case n.SETTINGS:t.$broadcast("changeCenterView",[mcConst.dataModels.ChatFrame,"d"+t.GetChatTypeID()])}}),e.$on("show"+e.Name,function(n,o){e.container=o[0],e.wndSize=t.wndSize,e.show()})}function initConfManagerView(e){var t=$$(e.Name);if(t)e.createNewConfBtn.disable(),e.existingConfs.clearAll();else{var n=new mcService.FilterFiled({listName:"existingConfs"+e.Name,placeholder:mcLang(35),css:"noBorder",noClearBtn:!0,filterParams:["Name","Topic"],id:"conManagerFilterField",OnEnterText:function(t){""===t?e.createNewConfBtn.disable():e.createNewConfBtn.enable(),e.confName=t}});t=webix.ui({view:"window",modal:!0,position:"center",id:e.Name,width:isMobile?e.wndSize.width:400,height:e.wndSize.height,head:{cols:[{width:42},{view:"label",label:'<div class="byCenter toUpper">'+mcService.Lang(25)+"</div>"},{view:"button",type:"icon",width:42,icon:"times",css:"button_transparent",click:function(){t.hide()}}]},body:{rows:[n,{view:"list",id:"existingConfs"+e.Name,maxHeight:300,scroll:!0,data:[],template:function(e){return"<b>"+mcService.insertIco(e.Secured?"fa-key":"fa-users",12)+e.Name+"</b>"+(""==e.Topic?"":" (<i>"+e.Topic+"</i>)")},on:{onItemClick:function(t){e.selectedConf=t,e.openConf(t,null,e.existingConfs.getItem(t).Secured)}}},{view:"button",id:"createNewConfBtn",value:mcLang(5),disabled:!0,click:e.openOrCreate}]},on:{onShow:e.registerHotKeys,onDestruct:e.hideWnd}}),e.existingConfs=$$("existingConfs"+e.Name),e.createNewConfBtn=$$("createNewConfBtn"),e.confFilter=$$(n.EDITOR)}return t}function confManagerController(e,t){e.Name=mcConst.dataModels.ConfManager;var n=null,o={};e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(e.Name,[{key:mcConst.keyCodes.esc,func:function(){""===e.confFilter.getValue()?e.hideWnd():e.confFilter.$setValue("")}},{key:mcConst.keyCodes.enter,func:function(){e.openOrCreate(),e.confFilter.$setValue("")}}],document,!0)},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(e.Name)},e.createNewConf=function(n){t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_create_txt_channel,mcConst.SessionID,n,"","","0011101100",function(t){e.openConf(t.UID,null,t.Secured)}])},e.openOrCreate=function(){e.confName||(e.confName=e.confFilter.getValue());var t=mcService.findItemInArrayOfObj(o,e.confName,"Name");-1===t?e.createNewConf(e.confName):e.openConf(o[t].id,null,o[t].Secured),e.hideWnd()},e.passEnter=function(){var n=$$("confPassword"+e.Name);return n&&n.destructor(),n=webix.ui({id:"confPassword"+e.Name,view:"window",modal:!0,position:"center",head:!1,body:{rows:[{view:"text",type:"password",placeholder:mcLang(2)},{cols:[{view:"button",value:mcLang(5),click:function(){e.openConf(e.selectedConf,n.getChildViews()[0].getChildViews()[0].getValue()),n.closeWnd()}},{view:"button",value:mcLang(33),click:function(){n.closeWnd()}}]}]},on:{onShow:function(){var i=n.getChildViews()[0].getChildViews()[0];t.hotKeyDispatcher.addPreset("preset_enter_pwd",[{key:mcConst.keyCodes.enter,func:function(){var t=mcService.findItemInArrayOfObj(o,e.confName,"Name"),s=-1,a=i.getValue();t&&(s=e.selectedConf||o[t].id),t&&a&&(e.openConf(s,a),n.closeWnd())}},{key:mcConst.keyCodes.esc,func:function(){n.closeWnd()}}],document,!0),i.focus()},onDestruct:function(){t.hotKeyDispatcher.removePreset("preset_enter_pwd")}}}),n.closeWnd=function(){n.hide(),n.getChildViews()[0].getChildViews()[0].setValue(""),n.destructor()},n.show(),n},e.openConf=function(n,i,s){var a="dUID-"+n;t.$broadcast("changeCenterView",[mcConst.dataModels.ChatFrame,a]),s&&!o[a]?t.$broadcast("isConfOpen",[a,function(o){o?(e.hideWnd(),t.$broadcast("OpenConf",[n])):e.passEnter()}]):(e.hideWnd(),t.$broadcast("OpenConf",[n,i]))},e.getData=function(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_channels_list,mcConst.SessionID,function(t){o=mcService.convertObjToArray(t,"id"),e.existingConfs.parse(o)}])},e.hideWnd=function(){e.removeHotKeys(),n.hide()},e.show=function(){(n=initConfManagerView(e)).show(),setTimeout(function(){e.confFilter.focus()},800)},e.$on("hide"+e.Name,e.hideWnd),e.$on("show"+e.Name,function(){e.wndSize=t.wndSize,e.show(),e.getData()})}function initChatFrame(e){var t={id:e.Name,rows:[{view:"button",type:"icon",icon:"chevron-down",id:"displayName"+e.Name,label:"Elisa",css:"imgBtn frameTopBtnCenter",click:e.titleMenu},{id:"searchWrapper"+e.Name,hidden:!0,padding:0,css:"noBorderAll borderTopBottom",height:30,cols:[{id:"searchChatText"+e.Name,view:"text",css:"noBGColorAll",borderless:!0,placeholder:mcService.Lang(579)},{id:"btnCloseSearchText"+e.Name,view:"button",type:"icon",icon:"close",width:35,css:"noBG iconNoPadding byCenter",click:e.hideFindChatText}]},e.duViews.progressWrapper,e.duViews.downloadFilesQuestion,{id:"videoFrameWrapper",hidden:!0,css:"relative noBGColor byCenter",borderless:!0,gravity:2,minHeight:90,template:'<div id="'+mcConst.videoContainer+'" style="height: 100%;"></div>'},{view:"resizer",id:"videoResizer",hidden:!0},{id:"chatTextOutput"+e.Name,view:"template",minHeight:100,borderless:!0,css:"myScroll noBGColorAll selectable "+(isMobile?"":"scrollMenu"),scroll:!1,template:'<div id="loadMoreHistory" class="right loadHistory hidden"><a href="#" class="selected">'+mcLang(577)+'</a></div><div id="UIN-0" class="framePaddingР30x10"></div>'},{view:"resizer",id:"inputResizer"+e.Name,css:"noBGColorAll noBorder"},{id:"inputWrapper",height:57,minHeight:57,hidden:!0,cols:[{id:"clipPopupButton",view:"button",type:"icon",icon:"paperclip",css:"ico30 borderTop",hidden:!1,width:56,on:{onItemClick:function(){var t=this.getNode();setTimeout(function(){e.clipPopupWindow.show(t,{pos:"top",x:0,y:-10})},100)}}},{id:"enterChatText"+e.Name,view:"textarea",css:"noBGColorAll borderTop",borderless:!0,placeholder:mcService.Lang(27),on:{onKeyPress:e.typingNotify}},{id:"btnSendText",view:"button",type:"icon",icon:"send",width:35,css:"noBG noBorderAll iconNoPadding byCenter borderTop",click:function(){e.sendText(),setTimeout(function(){e.enterChatText.focus()},50)}}],on:{onViewResize:e.saveTextInputSize}}]};return e.clipPopupWindow=webix.ui({view:"context",id:"clipPopup",head:!1,css:"noUpperCase",padding:0,body:{width:200,rows:[{view:"button",type:"icon",icon:"file-image-o",css:"icoButton",label:mcService.Lang(53),click:e.popupInsertImage},{view:"button",type:"icon",icon:"files-o",css:"icoButton",label:mcService.Lang(568),click:e.popupInsertFile}]}}),$$(e.container).addView(t),e.displayName=$$("displayName"+e.Name),e.chatTextOutputW=$$("chatTextOutput"+e.Name),e.chatTextOutput=$$("chatTextOutput"+e.Name).$view.lastChild,e.inputResizer=$$("inputResizer"+e.Name),e.inputWrapper=$$("inputWrapper"),e.enterChatText=$$("enterChatText"+e.Name),e.btnSendText=$$("btnSendText"),e.clipPopupButton=$$("clipPopupButton"),e.searchWrapper=$$("searchWrapper"+e.Name),e.searchChatText=$$("searchChatText"+e.Name),e.videoResizer=$$("videoResizer"),e.videoFrameWrapper=$$("videoFrameWrapper"),e.chatTextOutputW.getNode().onmousedown=e.scrollControl,e.loadMoreHistory=document.getElementById("loadMoreHistory"),e.loadMoreHistory.onclick=e.addHistoryMessages,e.chatTextOutput.style.position="relative",e.initDU(),isMobile&&(e.chatTextOutput.style.height="initial",e.chatTextOutputW.$view.id="forMobile",(new TouchScroll).init({id:"forMobile",draggable:!0,wait:!1})),$$(e.Name)}function chatFrameController(e,t,n){function o(e,o,i,s,a){var r=(o=o||"").slice(0,100)+(o.length>100?"...":""),c=(s?"UID-":"UIN-")+a;e&&((t.isWebClient||mcConst.ClientSettings.SoundsSndChat)&&s?n.PlaySound(n.Sounds.ConfMsg,!0):!t.isWebClient&&!mcConst.ClientSettings.SoundsSndPrivate||s||n.PlaySound(n.Sounds.Private,!0),t.isWebClient?t.GetChatTypeID()!==c&&mcService.CreateNotification({title:i.slice(0,30)+(i.length>30?"..":"")+":",body:r,timeOut:5e3,click:function(){s?t.$broadcast("OpenConf",[a]):t.$broadcast("OpenPrivate",[a])}}):(s&&(t.isWebClient||mcConst.ClientSettings.EventsTrayChMsg)||!s&&(t.isWebClient||mcConst.ClientSettings.EventsTrayPvMsg))&&t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_show_notify,i.slice(0,30)+(i.length>30?"..":"")+":",r,c]))}function i(e){return e?mcService.ReplaceURLs(e,{callback:function(e,t){var n="";return/png|jpg|jpeg$/.test(t)&&(n='<br/><img class="thumbImage" src="'+t+'">'),t?'<a href="'+t+'" title="'+t+'" target="_blank">'+(n||e)+"</a>":e}}):""}function s(){return(k.id||k).split("-")[1]}function a(){return(k.id||k).split("-")[0]}function r(e){setTimeout(function(){var t=e.Msg,n=!!e.UID,o=document.getElementById(n?"conf-"+e.UID+"-"+t:"priv-"+t);o&&(o.innerHTML="")},100)}function c(e,n){var i,s=B.get(n),a=document.createElement("div"),r=e.MsgType?e.Msg.split(mcConst.CRLF):e.Msg.split(mcConst.newLine),c=(e.UINFrom||e.UIN)!=mcConst.UserInfo.UIN,l=e.UINFrom||e.UIN,d=e.Nick,m=e.dt?e.dt.split("."):"",u="",f=e.Msg.split(mcConst.CRLF),g=f[0],_=void 0!==e.UID,p=e.History?s.firstChild:s.lastChild,h=!!p&&p.getAttribute("uin")==l,v="",S=!1,b=!1;switch(""===m?(m=mcService.formatDate(new Date,"hh:nn:ss"),u=mcService.formatDate(new Date,"dd.mm.yyyy")):(u=m.length>=6?m[0]+"."+m[1]+"."+m[2]:m,m=m.length>=6?m[3]+":"+m[4]+":"+m[5]:m),a.setAttribute("uin",l),a.setAttribute("Idx",e.Idx),a.setAttribute("postDate",u),a.setAttribute("id",_?"conf-"+e.UID+"-"+e.Idx:"priv-"+e.Idx),a.style.wordBreak="break-word",a.className=c?"messageUser ":"messageMy ",a.className+=" _messagesFontSize",(!h||e.History||!e.History&&s.lastChild&&s.lastChild.getAttribute("postDate")!==u)&&(v=mcService.myReplaceFormated('<div id="__#{id}" class="grayBorderTop"><div class="messageUserName" uin="#{uin}" onclick="_userActions.replyToUser.apply(this)" oncontextmenu="window._userActions.userMenu.apply(this)">#{nick}<span class="messageTime messageTimeHistory">#{date}</span></div></div>',{uin:l,id:e.Idx,nick:d,date:t.isWebClient||mcConst.ClientSettings.EventsTimeStamp?u:""})),e.MsgType){case mcConst._CMD_.msgType.OLD_SHIT:case mcConst._CMD_.msgType.INTEGRATION_API:case mcConst._CMD_.msgType.TEXT:for(var w=0;w<r.length;w++)r[w]=r[w].replace(/</gi,"&lt;");r.forEach(function(t,n){e.MsgType||(0===t.indexOf(mcConst.mcPara)?r[n]=t.replace(mcConst.mcPara,""):0===t.indexOf(mcConst.mcParaCenter)?(S=!0,r[n]="<div class='byCenter messageTextP60'>"+t.replace(mcConst.mcParaCenter,"")+"</div>"):0===t.indexOf(mcConst.mcParaRight)&&(S=!0,r[n]="<div class='byRight messageTextP60'>"+t.replace(mcConst.mcParaRight,"")+"</div>"))}),r=r.join("<br/>"),r=mcService.replaceMcComponents(r,t.isWebClient),i=r=mcService.ReplaceURLs(r,{callback:function(e,n){var o="";return n&&n.indexOf(mcConst.myChatLinkTitle)>0?(o=(n=n.split(mcConst.myChatLinkTitle))[1],n=n[0]):/(\.png|\.jpg|\.jpeg)$/.test(n)&&0===n.indexOf(mcService.getLocalHostPath(t.isWebClient))&&(o='<br/><img class="thumbImage" src="'+n+'">'),n?'<a href="'+n+'" title="'+n+'" target="_blank">'+(o||e)+"</a>":e}});break;case mcConst._CMD_.msgType.IMAGE:r=mcService.myReplaceFormated('<a id="link_#{idx}" href="noimage" target="_blank"><img id="img_#{idx}" src="#{loadImage}" dt="#{dt}" alt=""></a>',{idx:f[0]+e.Idx,loadImage:mcConst.imagesPath.loadImage,dt:f[2]}),O.addImageToLoad(g,e.Idx),b=!0,i=mcLang(570);break;case mcConst._CMD_.msgType.FILE:var y=f[1],I=f[2],T=f[3],D=mcService.extractFileName(y);r=mcService.myReplaceFormated('<i class="fa fa-file-o" aria-hidden="true"></i><a id="link_#{hash}#{id}" hash="#{hash}" filepath="#{filepath}" filedt="#{filedt}" filesize="#{filesize}" href="#{href}" nick="#{nick}" uin="#{uin}" target="_blank" onclick="window._userActions.openOrDownloadFile.apply(this, arguments)" class="font120 fileLink">#{file}</a>&nbsp;&nbsp;<i class="fa fa-download finger" aria-hidden="true" title="#{dTitle}" onclick="window._userActions.downloadFile.apply(this)"></i>&nbsp;'+(t.isWebClient?"":'<i class="fa fa-folder-open-o finger" onclick="window._userActions.openInFolder.apply(this, arguments)" title="#{oTitle}" aria-hidden="true"></i>&nbsp;')+"(#{formatedSize})</span>",{id:e.Idx,nick:d,uin:l,hash:g,href:mcService.getLocalHostPath(t.isWebClient)+"/"+mcConst.pathAliases.AliasFiles+"/"+g+"/"+encodeURI(D),file:D,time:m,filepath:y,filedt:I,filesize:T,dTitle:mcLang(573),oTitle:mcLang(574),formatedSize:mcService.formatFileSize(T)}),i=mcLang(571,D)}a.innerHTML=mcService.myReplaceFormated("#{userName}<div id='hsMsg-#{Idx}' Idx='#{Idx}' class='showOnHover' uin='#{uin}' postDate='#{postDate}' onmouseover='window._userActions.hideStatus.apply(this)' onmouseout='window._userActions.showStatus.apply(this)' style='#{style}'><span id='#{Idx}-st-#{uin}' class='#{state} statusItem'></span>"+(mcService.checkRights(mcConst._CMD_.RS.QAdmAccessToRemoveConfMessages)&&_||!_&&mcService.checkRights(mcConst._CMD_.RS.QAllowRemovePrivateMessages)?"<span class='webix_icon fa-trash-o fAwesome needShow messageTrash #{noTime}' Idx='#{Idx}' onclick='window._userActions.deleteMessage.apply(this)' title='#{delHint}'></span>":"")+"<span class='messageTime'> #{time} </span><span class='messageText #{w100}'>#{text}</span></div>",{userName:v,w100:S?"width100":"messageTextP60",uin:l,Idx:e.Idx,postDate:u,style:"wordBreak: break-word",text:r,time:t.isWebClient||mcConst.ClientSettings.EventsTimeStamp?m:"",delHint:mcLang(519),noTime:t.isWebClient||mcConst.ClientSettings.EventsTimeStamp?"":"messageTrashNoTime",state:e.UID?"":c?"":A.IDMyMsgRead>=e.Idx?"messageRead":A.IDMyMsgGot>=e.Idx?"messageGot":"messageSend"}),e.History&&!e.UpSync?(h&&s.firstChild&&s.firstChild.getAttribute("postDate")===u?s.firstChild.removeChild(s.firstChild.firstChild):s.insertBefore(document.createElement("br"),s.firstChild),s.insertBefore(a,s.firstChild)):(h||s.appendChild(document.createElement("br")),s.appendChild(a),e.noNotify||o(c,i,d,_,_?e.UID:l)),b&&O.loadThumbs([f[0],f[1],e.Idx],function(){C(!1,!e.History,e.History&&U)})}function l(e,n,i){mcService.isObject(e)&&(e.Text=e.Text||e.Msg);var s=B.get(n),a=document.createElement("div"),r=void 0!==e.Text?e.Text.split("L$"):e.split("L$"),c=void 0!==e.UIN?e.UIN:void 0!==e.UINFrom?e.UINFrom:t.GetChatID(),l=mcService.formatDate(e.dt||new Date,"hh:nn:ss"),d=c!=mcConst.UserInfo.UIN;""===mcService.trim(r[0])&&r.shift();for(var m=0;m<r.length;m++)r[m]=r[m].replace(/</gi,"&lt;"),r[m]=r[m].replace(/\u000b/gi,"");switch((r=mcService.ReplaceURLs(r.join("<br/>"),{callback:function(e,t){var n="";return/png|jpg|jpeg$/.test(t)&&(n='<br/><img class="thumbImage" src="'+t+'">'),t?'<a href="'+t+'" title="'+t+'" target="_blank">'+(n||e)+"</a>":e}})).indexOf(mcConst.CRLF)>=0&&(r=r.replace(new RegExp(mcConst.CRLF,"g"),"<br/>")),a.className=(e.Type?"":"brown ")+"framePaddingW5",a.style.wordBreak="break-word",e.MsgType){case mcConst._CMD_.msgType.CONF_TURN_OUT:}if(a.innerHTML+='<br><div class="borderTop relative _messagesFontSize">'+(!t.isWebClient&&!mcConst.ClientSettings.EventsTimeStamp||i?"":'<span class="messageTime">'+l+"</span> ")+'<span class="messageText messageTextP60"><i class="fa fa-bullhorn" aria-hidden="true"></i> '+r+"</span> </div>",a.setAttribute("uin",c),e.Idx&&a.setAttribute("Idx",e.Idx),e.History)s.insertBefore(a,s.firstChild);else{s.appendChild(a);var u=void 0!==e.UID;o(d,r,"",u,u?e.UID:c)}}function d(e,n,i){var s=B.get(n),a=document.createElement("div"),r="",c=void 0!==e.UIN?e.UIN:void 0!==e.UINFrom?e.UINFrom:t.GetChatID(),l=mcService.formatDate(e.dt||new Date,"hh:nn:ss"),d=c!=mcConst.UserInfo.UIN,m=mcService.StringToObj(e.Msg);if(m.UIN==mcConst.UserInfo.UIN?r=mcLang(615,[m.DisplayNameTo,m.DisplayNameFrom]):m.UINFrom==mcConst.UserInfo.UIN?r=mcLang(616,[m.DisplayName,m.DisplayNameTo]):m.UINTo==mcConst.UserInfo.UIN&&(r=mcLang(617,[m.DisplayName,m.DisplayNameFrom])),a.className=(e.Type?"":"brown ")+"framePaddingW5",a.style.wordBreak="break-word",a.innerHTML+='<br><div class="borderTop relative _messagesFontSize">'+(!t.isWebClient&&!mcConst.ClientSettings.EventsTimeStamp||i?"":'<span class="messageTime">'+l+"</span> ")+'<span class="messageText messageTextP60"><i class="fa fa-bullhorn" aria-hidden="true"></i> '+r+"</span> </div>",a.setAttribute("uin",c),e.Idx&&a.setAttribute("Idx",e.Idx),e.History)s.insertBefore(a,s.firstChild);else{s.appendChild(a);var u=void 0!==e.UID;o(d,r,"",u,u?e.UID:c)}}function m(e,n){var s,a=B.get(n),r=document.createElement("div"),c=JSON.parse(e.Msg),l=void 0!==e.UIN?e.UIN:void 0!==e.UINFrom?e.UINFrom:t.GetChatID(),d=e.dt?mcService.formatDate(e.dt,"dd.mm.yyyy hh:nn:ss"):mcService.formatDate(new Date,"hh:nn:ss"),m="";if(c.TaskName){switch(c.What){case mcConst.KanbanEvents.TASK_ADDED:case mcConst.KanbanEvents.TASK_PERFORMER_CHANGED:m=mcLang(543,[mcService.createKanbanLink(c.ProjectID,c.TaskID),c.DisplayName,i(c.TaskName),i(c.Description)]),s="KANBAN Task:<br>"+c.TaskName;break;case mcConst.KanbanEvents.COMMENT_ADDED:m=mcLang(544,[mcService.createKanbanLink(c.ProjectID,c.TaskID,c.CommentID),c.DisplayName,i(c.TaskName),i(c.Comment)]),s="KANBAN Comment:<br>"+c.Comment;break;case mcConst.KanbanEvents.TASK_MOVED:m=mcLang(545,[mcService.createKanbanLink(c.ProjectID,c.TaskID),c.DisplayName,i(c.TaskName),c.OldStageName+" &gt; "+c.StageName]),s="KANBAN Task:<br>"+c.TaskName;break;case mcConst.KanbanEvents.TASK_CHANGED:m=mcLang(546,[mcService.createKanbanLink(c.ProjectID,c.TaskID),c.DisplayName,i(c.TaskName),i(c.Description)]),s="KANBAN Task:<br>"+c.TaskName;break;case mcConst.KanbanEvents.TASK_DELETED:m=mcLang(547,[mcService.createKanbanLink(c.ProjectID,c.TaskID),c.DisplayName,i(c.TaskName),i(c.Description),c.ProjectName]),s="KANBAN Task:<br>"+c.TaskName;break;case mcConst.KanbanEvents.PROJECT_CLOSED:m=mcLang(548,[mcService.createKanbanLink(c.ProjectID,c.TaskID),c.DisplayName,c.ProjectName]),s="KANBAN Project:<br>"+c.ProjectName}r.className="framePaddingW5",r.style.wordBreak="break-word",r.innerHTML+='<div class="borderTop marginTop10 _messagesFontSize"><i class="fa fa-bullhorn" aria-hidden="true"></i><span class="messageKanbanTime toRight lineHeight24">'+d+'</span> <span class="messageKanban">'+m+"</span></div><br>",r.setAttribute("uin",l),e.Idx&&r.setAttribute("Idx",e.Idx),e.History?a.insertBefore(r,a.firstChild):(a.appendChild(r),o(!0,s,c.DisplayName,!1,l))}}function u(e,n){var o=B.get(n),i=document.createElement("div"),s=e.UIN,a=mcService.formatDate(new Date,"hh:nn:ss"),r="",c=e.FilesList,l=e.Count,d=e.Size,m=e.Path,u=0,f=!1,g=597;switch(e.MsgType){case mcConst._CMD_.msgType.SHOW_RECEIVED_FILES:g=597;break;case mcConst._CMD_.msgType.SHOW_UPLOADED_FILES:g=599}r=mcService.myReplaceFormated("<span class='finger bolder #{addClass}'>#{msg}</span>",{msg:mcLang(g,[l,mcService.formatFileSize(d)]),addClass:"fileLink"}),c.forEach(function(e){(e.received||e.sended)&&u<10?r+=mcService.myReplaceFormated("<div><span class='brown'>#{name}</span> (#{size})</div>",{name:e.fileName,size:mcService.formatFileSize(e.size)}):f=!0,u++}),u>10&&(r+="<div>"+mcLang(598,u-10)+"</div>"),i.className="framePaddingW5",i.style.wordBreak="break-word",i.innerHTML+=mcService.myReplaceFormated('<br><div class="borderTop _messagesFontSize"><span class="messageTime">#{time}</span> <span filepath="#{path}" class="messageText" title="#{oTitle}" onclick="window._userActions.openFolder.apply(this)"><i class="fa fa-folder-open-o" aria-hidden="true"></i> #{text}</span></div>',{time:t.isWebClient||mcConst.ClientSettings.EventsTimeStamp?a:"",text:r,path:m,oTitle:mcLang(574)}),i.setAttribute("uin",s),o.appendChild(i)}function f(n){var o;switch(o=n.hasOwnProperty("UID")?t.createUID(n.UID):t.createUIN(v(n)),B.hasFrame(o)||B.create(o).hide(),n.Idx=n.Idx||n.MsgIdx,n.History||n.UINFrom!=mcConst.UserInfo.UIN||t.$broadcast(window._messages_.dialogsList.getUserState,[v(n),function(e){e===mcConst.states.offline&&l(mcLang(572),o,!0)}]),n.MsgType){case mcConst._CMD_.msgType.OLD_SHIT:case mcConst._CMD_.msgType.TEXT:case mcConst._CMD_.msgType.IMAGE:case mcConst._CMD_.msgType.INTEGRATION_API:case mcConst._CMD_.msgType.FILE:n.Mod!==mcConst._CMD_.msgMods.DELETED&&(c(n,o),U=n.History&&!e.chatTextOutputW.getNode().scrollTop),!n.History&&((t.isWebClient||mcConst.ClientSettings.EventsPopupOnPrivateMessage)&&!n.hasOwnProperty("UID")||(t.isWebClient||mcConst.ClientSettings.EventsPopupOnChannelMessage)&&n.hasOwnProperty("UID"))&&(t.$broadcast(window._messages_.dialogsCtrl.selectDialog,[o]),t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_show_on_top]));break;case mcConst._CMD_.msgType.KANBAN_NOTIFY:m(n,o);break;case mcConst._CMD_.msgType.CONF_ALERT:case mcConst._CMD_.msgType.CONF_PERSONAL:break;case mcConst._CMD_.msgType.ADM_DELETE_MESSAGE:r(n,o);break;case mcConst._CMD_.msgType.PRIVATE_REDIRECT:var i=mcService.StringToObj(n.Msg);n.History||i.UIN!=mcConst.UserInfo.UIN||i.UINTo==t.GetChatID()||t.$broadcast("OpenPrivate",[i.UINTo]),d(n,o);break;default:l(n,o)}k!=o&&k.id!=o||C(!1,!n.History,n.History&&U)}function g(n){var o=null;o=n.MsgType==mcConst._CMD_.msgType.KANBAN_NOTIFY?"UIN-0":n.hasOwnProperty("UIN")?"UIN-"+n.UIN:"UID-"+n.UID,B.hasFrame(o)||B.create(o).hide(),n.MsgType==mcConst._CMD_.msgType.KANBAN_NOTIFY?(t.$broadcast("updateCounter",[n]),m(n,o)):n.MsgType===mcConst._CMD_.msgType.SHOW_RECEIVED_FILES?u(n,o):n.MsgType===mcConst._CMD_.msgType.SHOW_UPLOADED_FILES?u(n,o):l(n,o),U=n.History&&!e.chatTextOutputW.getNode().scrollTop,k!=o&&k.id!=o||C(!1,!n.History,n.History&&U)}function _(e){for(var t={en:"qwertyuiop[]asdfghjkl;'zxcvbnm,.QWERTYUIOP{}ASDFGHJKL:ZXCVBNM<>`~\"",ru:"йцукенгшщзхъфывапролджэячсмитьбюЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЯЧСМИТЬБЮёЁЭ",ua:"йцукенгшщзхїфівапролджєячсмитьбюЙЦУКЕНГШЩЗХЇФІВАПРОЛДЖЯЧСМИТЬБЮ`~Є"},n=new Array(e.length),o=-1,i=0;i<e.length;i++)(o=t.en.indexOf(e[i]))>=0?n[i]=t[mcConst.Lang][o]:(o=t.ru.indexOf(e[i]),n[i]=o>=0?t.en[o]:e[i]);return n.join("")}function p(o,i,s){var a=mcService.trim(i||e.enterChatText.getValue());""!==a&&(a=void 0===s||s===mcConst._CMD_.msgType.TEXT?a.replace(/\n/gi,"\r\n"):a,(t.isWebClient||mcConst.ClientSettings.SoundsSndChatRet)&&n.PlaySound(n.Sounds.EnterBtn),t.SendCMDToServer([mcConst._CMD_.cs_private_msg,mcConst.SessionID,JSON.stringify({UIN:o||t.GetChatID(),Msg:a,MsgType:s||mcConst._CMD_.msgType.TEXT})]))}function h(o,i,s){var a=mcService.trim(i||e.enterChatText.getValue());""!==a&&(a=void 0===s||s===mcConst._CMD_.msgType.TEXT?a.replace(/\n/gi,"\r\n"):a,(t.isWebClient||mcConst.ClientSettings.SoundsSndChatRet)&&n.PlaySound(n.Sounds.EnterBtn),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_put_msg2txt_channel,mcConst.SessionID,JSON.stringify({UIN:mcConst.UserInfo.UIN,UID:o||t.GetChatID(),Msg:a,MsgType:s||mcConst._CMD_.msgType.TEXT})]))}function v(e){return mcConst.UserInfo.UIN==e.UINFrom?e.UINTo:e.UINFrom}function C(t,n,o){N&&(o?($&&(clearTimeout($),$=null),e.chatTextOutput.scrollHeight!==x&&(e.chatTextOutputW.getNode().scrollTop+=e.chatTextOutput.scrollHeight-x,x=e.chatTextOutput.scrollHeight)):t?(x=e.chatTextOutput.scrollHeight,e.chatTextOutputW.getNode().scrollTop=x):$||($=setTimeout(function(){$=null,x=e.chatTextOutput.scrollHeight,n?e.chatTextOutputW.getNode().scroll({top:x,left:0,behavior:"smooth"}):e.chatTextOutputW.getNode().scrollTop=x},100)))}function S(n,o,i){var s=t.GetChatTypeID();if(N){switch(N.show(),B.hide(P),E=[n,o],k=B.get(s),P=s,k.show(),t.$broadcast("selectDialog",[s]),e.displayName.show(),e.displayName.define("label",n+(o?": "+o:"")),e.displayName.refresh(),C(),i?mcService.showView(e.loadMoreHistory):mcService.hideView(e.loadMoreHistory),t.GetChatType()){case t.chatAliases.UIN:e.topLabelList=H(),$$(e.container).getNode().className="webix_view noMargin gradient2 webix_layout_line",e.inputWrapper.show(),e.inputResizer.show();break;case t.chatAliases.UID:e.topLabelList=W(),$$(e.container).getNode().className="webix_view noMargin gradient webix_layout_line",e.inputWrapper.show(),e.inputResizer.show()}b()}}function b(){if(mcConst.LoggedIn&&e.enterChatText){var t=mcService.getCaretPosition(e.enterChatText.$view);e.displayName.focus(),setTimeout(function(){e.enterChatText.focus(),mcService.setCaretPosition(e.enterChatText.$view,t)},50)}}function w(n,o,i,s){var a=o||t.GetChatID();switch(n||t.GetChatType()){case"UIN":p(a,i,s);break;case"UID":h(a,i,s)}return s!==mcConst._CMD_.msgType.IMAGE&&s!==mcConst._CMD_.msgType.FILE&&setTimeout(function(){e.enterChatText.setValue(""),e.enterChatText.$setValue("")},10),!1}function y(n,o){var i=e.videoFrameWrapper.getNode().firstChild;n?(i.className=i.className.replace(" maxSize",""),i.style.position="relative",o.cPanel&&(o.cPanel.body.style.position="absolute")):(i.className+=" maxSize",i.style.position="fixed",o.cPanel&&(o.cPanel.body.style.position="fixed")),t.isWebClient||t.$broadcast(window._messages_.clientData.toggleKioskMode,[!n])}function I(n){if(n&&(n.useVideo||n.receiveScreen)){var o=e.videoFrameWrapper,i=o.getNode().firstChild;o.show(),e.videoResizer.show(),e.videoFrameContainer=document.getElementById(mcConst.videoContainer),e.videoFrameContainer.appendChild(n.video),n.receiveScreen?(i.style.overflow="auto",i.style.position="relative"):(i.style.overflow="none",i.style.position="",e.videoFrameContainer.appendChild(n.mirror),n.video.style.maxWidth="100%"),N.getTopParentView().adjust(),n.cPanel.init(i),i.onmousemove=function(){n.cPanel.onmousemove()},n.cPanel.closeCall=function(){t.$broadcast(window._messages_.privateInfo.stopCurrentCall)},n.cPanel.fitFill=function(t,n){t?(e.videoFrameContainer.style.height="100%",n.className+=" fit"):(e.videoFrameContainer.style.height="",n.className=n.className.replace(" fit",""))},n.cPanel.minMax=function(e){y(e,n)},n.cPanel.show()}}function T(n){e.videoFrameWrapper.getNode().onmousemove=null,e.videoFrameWrapper.hide(),e.videoResizer.hide(),e.videoFrameContainer&&(e.videoFrameContainer.innerHTML=""),e.videoFrameContainer=null,N.getTopParentView().adjust(),!t.isWebClient&&n&&y(!0,n)}function D(e,n){for(var o=null,i=t.$broadcast(window._messages_.dialogsList.getFirstLastMsg,[e,!0]),s=n;s>=i;s--)if(o=document.getElementById(s+"-st-"+mcConst.UserInfo.UIN)){if(0===o.className.indexOf("messageGot")||0===o.className.indexOf("messageRead"))break;o.className="messageGot statusItem"}}function L(e,n){for(var o=null,i=t.$broadcast(window._messages_.dialogsList.getFirstLastMsg,[e,!0]),s=n;s>=i;s--)if(o=document.getElementById(s+"-st-"+mcConst.UserInfo.UIN)){if(0===o.className.indexOf("messageRead"))break;o.className="messageRead statusItem"}}e.Name=mcConst.dataModels.ChatFrame,e.displayName=null,e.chatTextOutput=null,e.enterChatText=null,e.clipPopupButton=null,e.clipPopupLoaderImg=null,e.videoFrameWrapper=null;var M=0,P="UIN-0",k=null,N=null,E=[],x=0,F=57,$=null,A={UIN:-1,IDMyMsgGot:0,IDMyMsgRead:0},U=!1,R={},O=null,B=new McFramesList,H=function(){return[{view:"button",value:mcService.Lang(41),click:function(){this.getTopParentView().hide(),webix.confirm({title:mcService.Lang(42),ok:mcService.Lang(43),cancel:mcService.Lang(44),type:"confirm-error",text:E[0],width:310,callback:function(e){if(e){var n=t.GetChatID();t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_set_custom_ignore,mcConst.SessionID,n,mcConst.ignores.private]),t.$broadcast("getIgnoreList",[]),t.$broadcast("addIgnoreInPrivateInfo",[n])}}})}},{view:"button",value:mcService.Lang(51),click:function(){var e=t.GetChatID();this.getTopParentView().hide(),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_del_custom_ignore,mcConst.SessionID,e,mcConst.ignores.private]),t.$broadcast("getIgnoreList",[]),t.$broadcast("removeIgnoreInPrivateInfo",[e]),webix.message(mcService.Lang(52,E[0]))}}]},W=function(){return[{view:"button",value:mcService.Lang(28),click:function(){this.getTopParentView().hide(),t.$broadcast("leaveConf",[s()])}}]};window._userActions.deleteMessage=function(){var e=this.getAttribute("Idx"),n=s(),o="",i="";n&&a()===t.chatAliases.UID?(o=this.parentElement.getElementsByClassName("messageText")[0],(i=mcService.copy(o.innerText,0,20)+(o.innerText.length>20?"...":""))||(i="<div style='margin-left: 20px'>"+o.innerHTML+"</div>"),webix.confirm({type:"confirm-warning",text:mcLang(587,i),ok:mcService.Lang(519),cancel:mcService.Lang(33),callback:function(o){o&&t.SendCMDToServer([mcConst._CMD_.cs_moder_delete_conf_message,mcConst.SessionID,n,e])}})):n&&a()===t.chatAliases.UIN&&(o=this.parentElement.getElementsByClassName("messageText")[0],(i=mcService.copy(o.innerText,0,20)+(o.innerText.length>20?"...":""))||(i="<div style='margin-left: 20px'>"+o.innerHTML+"</div>"),webix.confirm({type:"confirm-warning",text:mcLang(587,i),ok:mcService.Lang(519),cancel:mcService.Lang(33),callback:function(o){o&&t.SendCMDToServer([mcConst._CMD_.cs_delete_private_message,mcConst.SessionID,n,e])}}))},window._userActions.downloadFile=function(){var e=this.parentElement.childNodes[1],n=e.href,o={uin:e.getAttribute("uin"),displayName:e.getAttribute("nick"),filePath:e.getAttribute("filepath"),fileDT:e.getAttribute("filedt"),hash:e.getAttribute("hash")};t.isWebClient?window.open(n):O.downloadUrl(n,o)},window._userActions.openOrDownloadFile=function(e){var n=this.href,o={uin:this.getAttribute("uin"),displayName:this.getAttribute("nick"),filePath:this.getAttribute("filepath"),fileDT:this.getAttribute("filedt"),hash:this.getAttribute("hash")};return t.isWebClient||(e.preventDefault(),O.openDownloadUrl(n,o)),!1},window._userActions.openInFolder=function(){var e=this.parentElement.childNodes[1].getAttribute("hash"),t=this.parentElement.childNodes[1].getAttribute("uin");O.openInFolder(e,t)},window._userActions.openFolder=function(){var e=this.getAttribute("filepath");O.openFolder(e)},window._userActions.replyToUser=function(){if(this.getAttribute("uin")!=mcConst.UserInfo.UIN){var t=this.innerHTML;e.enterChatText.setValue(e.enterChatText.getValue()+" @"+mcService.copy(t,0,t.indexOf("<span")).replace(/\:$/,"")+" "),b()}},window._userActions.userMenu=function(){this.getAttribute("uin")!=mcConst.UserInfo.UIN&&b()},window._userActions.hideStatus=function(){mcService.hideView(this.querySelector(".statusItem"))},window._userActions.showStatus=function(){mcService.showView(this.querySelector(".statusItem"))},e.popupInsertPhrase=function(){},e.scrollControl=function(t){t.clientX>e.chatTextOutputW.getNode().outerWidth&&console.log("click on scroll")},e.sendText=w,e.popupInsertFile=function(){this.getTopParentView().hide(),e.uploadFile(mcConst._CMD_.msgType.FILE,!1,!1)},e.popupInsertImage=function(){this.getTopParentView().hide(),e.uploadFile(mcConst._CMD_.msgType.IMAGE,!1,!1)},e.addHistoryMessages=function(){U=!0,t.$broadcast(window._messages_.dialogsList.getHistoryMsgRange,[t.GetChatID(),t.GetChatType()])},e.saveTextInputSize=function(){F=e.inputWrapper.$getSize()[3],t.Storage.dialogs.save(null,null,mcConst.storageOpts.INPUTOPTS,F)},e.loadTextInputSize=function(){t.Storage.dialogs.load(null,null,mcConst.storageOpts.INPUTOPTS,function(t){t&&!O.isActive()&&(e.inputWrapper.define("height",t),e.inputWrapper.resize(),e.inputWrapper.resizeChildren())})},e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(mcConst.dataModels.ChatFrame,[{key:mcConst.keyCodes.enter,func:function(){e.sendText()}},{key:mcConst.keyCodes.enter,ctrlKey:!0,func:function(){t.isWebClient||mcConst.ClientSettings.GeneralCtrlEnterSend?e.sendText():e.enterChatText.getInputNode().value+="\n"}},{key:mcConst.keyCodes.f8,func:function(){var t=e.enterChatText.getInputNode(),n=mcService.getSelectedText(t);n.infix?(e.enterChatText.setValue(n.prefix+_(n.infix)+n.postfix),mcService.setSelectionText(t,n.selectionStart,n.selectionEnd)):(e.enterChatText.setValue(_(e.enterChatText.getValue())),mcService.setCaretPosition(t,n.selectionEnd))}}],e.enterChatText.getNode()),t.hotKeyDispatcher.addPreset(mcConst.dataModels.ChatFrame+"global",[{key:mcConst.keyCodes.f5,func:function(){e.clipPopupWindow.hide(),e.uploadFile(mcConst._CMD_.msgType.FILE,!1,!1)}},{key:mcConst.keyCodes.f6,func:function(){t.$broadcast(_messages_.privateInfo.redirectUserTo)}},{key:mcConst.keyCodes.f,ctrlKey:!0,func:function(){e.searchWrapper.show(),e.searchChatText.focus()}},{key:mcConst.keyCodes.v,shiftKey:!0,ctrlKey:!0,func:function(){O.sendFilesToUser(!0)}},{key:mcConst.keyCodes.f4,ctrlKey:!0,func:function(){t.$broadcast(_messages_.dialogsList.removeDialogFromList,[t.GetChatID()])}}],document),t.hotKeyDispatcher.addPreset(mcConst.dataModels.ChatFrame+"find",[{key:mcConst.keyCodes.enter,func:function(){t.$broadcast("find_chat_text",[k,e.searchChatText.getValue(),e.searchChatText])}},{key:mcConst.keyCodes.esc,lockPrev:!0,func:e.hideFindChatText}],e.searchChatText.getNode())},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(mcConst.dataModels.ChatFrame),t.hotKeyDispatcher.removePreset(mcConst.dataModels.ChatFrame+"global"),t.hotKeyDispatcher.removePreset(mcConst.dataModels.ChatFrame+"find")},e.hideFindChatText=function(){e.searchWrapper.hide(),e.searchChatText.setValue(""),t.$broadcast("find_clear",[k]),setTimeout(function(){e.enterChatText.focus()},50)},e.titleMenu=function(){switch(t.GetChatType()){case t.chatAliases.UIN:t.$broadcast("selectTool",[mcConst.dataModels.PrivateInfo,!0]);break;case t.chatAliases.UID:t.$broadcast("selectTool",[mcConst.dataModels.ConfUserList,!0])}},e.changeScrollPosition=function(){var t=e.chatTextOutputW.getNode(),n=t.scrollHeight,o=n-x;o>=0?t.scrollTop+=o:t.scrollTop-=o,x=n},e.typingNotify=function(o,i){i.altKey||i.ctrlKey||(-1!==mcConst.keyCodes.PrintSymbols.indexOf(o)?(t.isWebClient||mcConst.ClientSettings.SoundsSndChatType)&&n.PlaySound(n.Sounds.Typing):o!==mcConst.keyCodes.delete&&o!==mcConst.keyCodes.backspace||!e.enterChatText.getValue()||!t.isWebClient&&!mcConst.ClientSettings.SoundsSndChatBS||n.PlaySound(n.Sounds.DeleteAct)),"UIN"===t.GetChatType()&&10===++M&&(M=0,t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_typing_notify,mcConst.SessionID,t.GetChatID()]))},e.show=function(){N?N.show():(O=new DownloadUploadManager(t,w),e.uploadFile=O.uploadFile,e.initDU=O.initViews,e.duViews=O.getViews(),N=initChatFrame(e),B.initView(e.chatTextOutput),B.show(P),k||(k=B.get(P)),O.onPasteItemFromClipboard(e.enterChatText.$view)),C(),e.registerHotKeys(),setTimeout(function(){O.loadAllImages(function(){C()})},100)};var j=_messages_.chatFrame={showMirrorVideoFrame:"showMirrorVideoFrame",blurChatTextOutput:"blurChatTextOutput",showVideoFrame:"showVideoFrame",hideVideoFrame:"hideVideoFrame",clearChatFrame:"clearChatFrame",fillChatFrame:"fillChatFrame",addChatMessage:"addChatMessage",addCustomMSG:"addCustomMSG",clearConfMessages:"clearConfMessages",clearPrivateMessages:"clearPrivateMessages",removeFrameChat:"removeFrameChat",on_mainWindowFocused:"on_mainWindowFocused",focusToEnterChat:"focusToEnterChat",scrollDownChat:"scrollDownChat",showNotifyMessage:"showNotifyMessage",updateMessagesState:"updateMessagesState",on_private_got_notify:"on_private_got_notify",on_private_read_notify:"on_private_read_notify",quickMessagesList:"quickMessagesList","----":"----"};e.$on(j.quickMessagesList,function(e,t){R=t[0]}),e.$on(j.updateMessagesState,function(e,n){var o=n[0],i=t.createUIN(o);A={UIN:-1,IDMyMsgGot:0,IDMyMsgRead:0},o!=mcConst.UserInfo.UIN&&t.GetChatTypeID()===i&&A.UIN!=o&&(A=mcService.Marge(A,t.$broadcast(window._messages_.dialogsList.getMyMessagesState,[o])),t.GetChatTypeID()===i&&(L.apply(null,[o,A.IDMyMsgRead]),A.IDMyMsgGot>A.IDMyMsgRead&&D.apply(null,[o,A.IDMyMsgGot])))}),e.$on(j.on_private_got_notify,function(e,t){D.apply(null,[t[0].UIN,t[0].ID])}),e.$on(j.on_private_read_notify,function(e,t){L.apply(null,[t[0].UIN,t[0].ID])}),e.$on(j.showNotifyMessage,function(e,t){o.apply(null,t)}),e.$on(j.scrollDownChat,function(e,t){C.apply(null,t)}),e.$on(j.focusToEnterChat,b),e.$on(j.on_mainWindowFocused,function(){b()}),e.$on(j.showMirrorVideoFrame,function(){mcService.showFrame(mcConst.myVideoStream)}),e.$on(j.blurChatTextOutput,function(){e.clipPopupWindow.hide(),e.enterChatText.blur()}),e.$on(j.showVideoFrame,function(e,t){I.apply(null,t)}),e.$on(j.hideVideoFrame,function(e,t){T.apply(null,t)}),e.$on(j.clearChatFrame,function(e,t){}),e.$on(j.fillChatFrame,function(t,n){U=!1,S.apply(null,n),e.hideFindChatText()}),e.$on(j.addChatMessage,function(e,t){f.apply(null,t)}),e.$on(j.addCustomMSG,function(e,t){g.apply(null,t)}),e.$on(j.clearConfMessages,function(e,t){var n=t[0];B.clear("UID-"+n)}),e.$on(j.clearPrivateMessages,function(e,t){var n=t[0];B.clear("UIN-"+n)}),e.$on(j.removeFrameChat,function(e,t){var n=t[0],o=t[1];B.remove(n+"-"+o)}),e.$on("hide"+e.Name,function(){e.removeHotKeys(),e.hideFindChatText(),N.hide()}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show(),e.loadTextInputSize()}),t.$broadcast("windowResize",[function(){if(N&&N.isVisible()){var t=webix.UIManager.getFocus();t&&t.config.id===e.enterChatText.config.id&&e.enterChatText.focus()}}])}function initBbsFrame(e){function t(e){return new Array(e||1).join(".").split(".").map(function(e,t){return t.toString()})}var n=$$(e.Name);return n?n.show():($$(e.container).addView({id:e.Name,rows:[{view:"button",type:"icon",icon:"chevron-down",id:"displayName"+e.Name,label:mcLang(556),click:e.titleMenu,css:"whiteBG imgBtn button_info frameTopBtnCenter",on:{onItemClick:function(){var t=this.getNode();setTimeout(function(){e.clipPopupWindow.show(t,{pos:"bottom",x:5,y:10})},100)}}},{id:"bbsContent"+e.Name,view:"template",borderless:!0,css:"myScroll selectable "+(isMobile?"":"scrollMenu"),scroll:!1,template:"&nbsp;",gravity:3},{id:"bbsResizer"+e.Name,view:"resizer",hidden:!0},{id:"inputWrapper"+e.Name,gravity:2,hidden:!0,css:"whiteBG",rows:[{view:"toolbar",height:32,css:"borderTop",padding:0,cols:[{view:"datepicker",id:"bbsLifeTime"+e.Name,value:new Date,labelPosition:"left",labelAlign:"right",label:mcLang(559)+":",labelWidth:110,width:240,suggest:{type:"calendar",body:{minDate:new Date((new Date).getTime()-mcConst.oneDay),maxDate:new Date("3000.01.01")}}},{id:"bbsHours"+e.Name,view:"richselect",width:55,value:23,borderless:!0,suggest:{fitMaster:!1,width:65,data:t(24)}},{view:"label",label:":",align:"center",width:1,padding:0},{id:"bbsMinutes"+e.Name,view:"richselect",width:55,value:59,borderless:!0,suggest:{fitMaster:!1,width:65,data:t(60)}},{id:"bbsToTop"+e.Name,view:"checkbox",value:!1,labelWidth:0,labelRight:mcLang(560),width:20,css:"finger"},{},{view:"button",type:"icon",icon:"close",css:"noBG noBorderAll byCenter button_danger iconNoPadding",tooltip:mcLang(12),click:e.closeBBS,width:35},{width:5},{id:"btnSendText"+e.Name,view:"button",type:"icon",icon:"send",css:"noBG noBorderAll iconNoPadding byCenter",tooltip:mcLang(558),click:e.sendBBS,width:35},{width:5}]},{id:"enterBBSText"+e.Name,view:"textarea",css:"noBGColorAll borderTop",borderless:!0,placeholder:mcLang(27)}]}]}),e.clipPopupWindow=webix.ui({view:"popup",id:"topMenu"+e.Name,head:!1,css:"noUpperCase",width:200,padding:0,body:{rows:[{view:"button",type:"icon",icon:"plus",css:"icoButton",label:mcLang(557),click:function(){this.getTopParentView().hide(),e.addNewBBS()}}]}}),n=$$(e.Name),e.bbsContent=$$("bbsContent"+e.Name),e.enterBBSText=$$("enterBBSText"+e.Name),e.bbsResizer=$$("bbsResizer"+e.Name),e.inputWrapper=$$("inputWrapper"+e.Name),e.btnSendText=$$("btnSendText"+e.Name),e.bbsToTop=$$("bbsToTop"+e.Name),e.bbsLifeTime=$$("bbsLifeTime"+e.Name),e.bbsHours=$$("bbsHours"+e.Name),e.bbsMinutes=$$("bbsMinutes"+e.Name)),n}function bbsController(e,t,n){function o(t){var n=document.createElement("div"),o=t.Msg.replace(/\u041e\u00ac/g,""),i=t.UIN,s=t.DisplayName,a=t.dtCreated?t.dtCreated.split("."):"",r="",c=e.bbsContent.getNode().firstChild;r=6===a.length?a[0]+"."+a[1]+"."+a[2]+"&nbsp;":a,a=6===a.length?a[3]+":"+a[4]+":"+a[5]+"&nbsp;":a,o=mcService.ReplaceURLs(o,{callback:function(e,t){var n="";return/png|jpg|jpeg$/.test(t)&&(n='<br/><img class="thumbImage" src="'+t+'">'),t?'<a href="'+t+'" title="'+t+'" target="_blank">'+(n||e)+"</a>":e}}).replace(/\r\n/g,"<br>"),n.className=t.Top?"messageUser":"messageMy",n.innerHTML=mcService.myReplaceFormated("<div id='#{id}' class='bbsMessage'><div><span class='bbsTime brown'>#{time}</span> <span class='bbsDate gray'>#{date}</span> <span class='bbsName linkColor finger' uin='#{uin}' onclick='_userActions.openUserPrivate.apply(this)'>#{name}</span></div><br><div class='bbsText'>#{text}</div></div>",{id:t.ID,time:a,date:r,name:s,text:o,uin:i}),n.setAttribute("uin",i),n.setAttribute("Idx",t.ID),n.style.wordBreak="break-word",c.insertBefore(document.createElement("br"),c.firstChild),c.insertBefore(n,c.firstChild)}e.Name=mcConst.dataModels.BBS;var i=null;new McDeferredLoadImages;e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(mcConst.dataModels.BBS,[{key:mcConst.keyCodes.enter,func:e.sendText},{key:mcConst.keyCodes.esc,func:e.closeBBS}],e.enterBBSText.getNode()),t.hotKeyDispatcher.addPreset(mcConst.dataModels.BBS+"global",[{key:mcConst.keyCodes.n,altKey:!0,func:e.addNewBBS}],document)},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(mcConst.dataModels.BBS),t.hotKeyDispatcher.removePreset(mcConst.dataModels.BBS+"global")},e.addNewBBS=function(){e.inputWrapper.show(),e.bbsResizer.show(),e.enterBBSText.focus()},e.closeBBS=function(){e.inputWrapper.hide(),e.bbsResizer.hide(),setTimeout(function(){e.enterBBSText.setValue(""),e.enterBBSText.$setValue(""),e.enterBBSText.focus()},10)},e.sendBBS=function(){var o=mcService.trim(e.enterBBSText.getValue()),i=mcService.formatDate(e.bbsLifeTime.getValue(),"dd.mm.yyyy.")+e.bbsHours.getValue()+"."+e.bbsMinutes.getValue()+".00",s=mcService.convertIntToBool(e.bbsToTop.getValue());return(t.isWebClient||mcConst.ClientSettings.SoundsSndChatRet)&&n.PlaySound(n.Sounds.EnterBtn),""!==o&&(o=o.replace(/\n/g,"\r\n"),t.SendCMDToServer([mcConst._CMD_.cs_add_new_bbs,mcConst.SessionID,JSON.stringify({Expired:i,Sticky:s,Msg:o})]),setTimeout(e.closeBBS,50)),!1},e.show=function(){i=initBbsFrame(e)},e.getData=function(n){t.SendCMDToServer([mcConst._CMD_.cs_get_bbs,mcConst.SessionID,function(i){if(e.bbsContent.getNode().firstChild.innerHTML="&nbsp;",i&&i.length>0){var s=[],a=[],r=i[0];if(n&&r){var c=r.Msg.replace(/\u041e\u00ac/g,""),l=c.slice(0,100)+(c.length>100?"...":"");t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_show_notify,r.DisplayName.slice(0,30)+(r.DisplayName.length>30?"..":"")+":",l,r.ID])}i.forEach(function(e){e.Top?s.push(e):a.push(e)}),s.sort(function(e,t){return mcService.sortAB(e.dtCreated,t.dtCreated)}),a.sort(function(e,t){return mcService.sortAB(e.dtCreated,t.dtCreated)}),a.forEach(function(e){o(e)}),s.forEach(function(e){o(e)})}}])};var s=_messages_.BBS={refreshBBS:"refreshBBS"};e.$on(s.refreshBBS,function(t,n){var o=n[0];i&&e.getData(o)}),e.$on("hide"+e.Name,function(){i&&i.isVisible()&&(e.removeHotKeys(),i.hide())}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show(),e.getData(),e.registerHotKeys()})}function initKanbanFrame(e){var t=$$(e.Name);return t?t.showFrame():($$(e.container).addView({id:e.Name,view:"iframe",css:"iFrameFit",src:e.kanbanURL+e.getToken(e.kanbanURL),on:{}}),(t=$$(e.Name)).showFrame=function(){t.define("width",void 0),t.resize(),mcService.showFrame(e.Name)},t.hideFrame=function(){t.define("width","0"),t.resize(),mcService.hideFrame(e.Name)}),t}function kanbanController(e,t,n){function o(n){e.token?(s=n.indexOf(e.token)>0?n:n+e.getToken(n),i&&n.indexOf(0===mcService.getLocalHostPath(t.isWebClient))?(i.define("src",s),s=null):console.warn("Wrong URL for iFrame:"+s)):t.SendCMDToServer([mcConst._CMD_.cs_create_token,mcConst.SessionID,t.chatAliases.Kanban.toLowerCase(),e.kanbanURL,function(t){e.token=t.Token,e.kanbanURL=n||e.kanbanURL,i.config.src||i.define("src",e.kanbanURL+e.getToken(e.kanbanURL))}])}e.Name=mcConst.dataModels.Kanban;var i=null,s=null;e.token=null,e.kanbanURL="",e.getToken=function(t){return e.token?(-1===t.indexOf("?")&&-1===t.indexOf("#")?"?":"&")+"token="+e.token:""},e.registerHotKeys=function(){},e.removeHotKeys=function(){},e.show=function(){i=initKanbanFrame(e)};var a=_messages_.kanban={openKanbanUrl:"openKanbanUrl",closeKanban:"closeKanban"};e.$on(a.openKanbanUrl,function(e,t){o.apply(null,t)}),e.$on(a.closeKanban,function(){i&&(e.token=null,e.kanbanURL=null,i.define("src",""))}),e.$on("hide"+e.Name,function(){e.removeHotKeys(),i&&i.isVisible()&&i.hideFrame()}),e.$on("show"+e.Name,function(n,o){e.container=o[0],e.kanbanURL||t.SendCMDToServer([mcConst._CMD_.cs_create_token,mcConst.SessionID,t.chatAliases.Kanban.toLowerCase(),e.kanbanURL,function(n){e.token=n.Token,e.show(),i.config.src||(e.kanbanURL=mcService.getLocalHostPath(t.isWebClient)+"/"+mcConst.pathAliases.AliasKanban+"/",i.define("src",e.kanbanURL+e.getToken(e.kanbanURL)))}]),e.show()})}function initUserProfile(e){function t(e,t,n,o,i,s){return{view:"text",id:"up"+e,labelPosition:"top",css:"noBGAll",placeholder:mcLang(t)||t,label:mcLang(n)||n,on:{onTimedKeyPress:o||function(){}},disabled:i,hidden:void 0!=s&&s}}var n=$$(e.Name);if(n)n.show();else{var o=e.wndSize.width>=800?600:e.wndSize.width,i=(e.wndSize.height>=800||e.wndSize.height,[{id:"0",value:mcService.Lang(74)},{id:"1",value:mcService.Lang(75)},{id:"2",value:mcService.Lang(76)}]),s={id:"profileBody"+e.Name,css:"myScroll scrollMenu",rows:[{height:4}]},a={width:180,rows:[{height:3},{id:"upFoto",template:e.noImage,height:170,borderless:!0,css:"byCenter"}]},r={id:"fotoEditBtns"};r[o<600?"cols":"rows"]=[{view:"uploader",label:mcService.Lang(78),css:"",id:"upLoadFoto",autosend:!1,upload:"",multiple:!1,accept:".jpg,.png,.jpeg",on:{onBeforeFileAdd:e.uploadFoto}},{view:"button",label:mcService.Lang(79),css:"button_danger",id:"upClearFoto",click:e.clearFoto}],a.rows.push(r);var c=[{view:"text",id:"upUIN",value:e.data.UIN,labelWidth:100,label:"UIN:",disabled:!0},{view:"text",id:"upFirstName",value:e.data.FirstName,labelWidth:100,label:mcService.Lang(68),on:{onTimedKeyPress:e.change},disabled:e.notMyProfile},{view:"text",id:"upMiddleName",value:e.data.MiddleName,labelWidth:100,label:mcService.Lang(69),on:{onTimedKeyPress:e.change},disabled:e.notMyProfile},{view:"text",id:"upLastName",value:e.data.LastName,labelWidth:100,label:mcService.Lang(70),on:{onTimedKeyPress:e.change},disabled:e.notMyProfile},{view:"text",id:"upNick",value:e.data.Nick,labelWidth:100,label:mcService.Lang(57),on:{onTimedKeyPress:e.change},disabled:e.notMyProfile},{view:"select",id:"upSex",value:e.data.Sex,labelWidth:100,label:mcService.Lang(71),on:{onChange:e.change},disabled:e.notMyProfile,options:i},{view:"text",id:"upEmail",value:e.data.Email,labelWidth:100,label:mcService.Lang(72),on:{onTimedKeyPress:e.change},disabled:e.notMyProfile}];s.rows.push({cols:[{width:15},{rows:c},a,{width:5}]});var l={padding:14,rows:[{view:"text",id:"upCompNetName",value:e.data.CompNetName,disabled:!0,hidden:!e.data.CompNetName,labelWidth:100,label:mcLang(116)},{view:"text",id:"upIP",value:e.data.IP,disabled:!0,hidden:!e.data.IP,labelWidth:100,label:mcLang(115)},{view:"text",id:"upMAC",value:e.data.MAC,disabled:!0,hidden:!e.data.MAC,labelWidth:100,label:mcLang(114)},{view:"text",id:"upLastAccess",value:e.data.LastAccess,disabled:!0,hidden:!e.data.LastAccess,labelWidth:200,label:mcLang(113)}]},d={cols:[{width:5},{view:"accordion",multi:!0,borderless:!0,css:"headerAccordion",rows:[{header:mcService.Lang(127),collapsed:!0,css:"prInp",body:{rows:[{height:7},t("WorkCompanyName",118,126,e.change,e.notMyProfile),t("WorkPosition","",124,e.change,!0,!e.data.WorkPosition),t("WorkDept","",123,e.change,!0,!e.data.WorkDept),t("WorkOffice",118,122,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkOffice),t("WorkPhone",118,121,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkPhone),t("WorkFax",118,120,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkFax),t("WorkPager",118,119,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkPager),t("WorkCity",118,164,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkCity),t("WorkStreetAddress",118,163,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkStreetAddress),t("WorkState",118,165,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkState),t("WorkZIP",118,166,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkZIP),{view:"select",id:"upWorkCountry",value:e.data.WorkCountry,labelPosition:"top",label:mcLang(167),on:{onChange:e.change},options:mcService.GetCountriesList(),css:"noBGAll",disabled:e.notMyProfile,hidden:e.notMyProfile&&!e.data.WorkZIP},t("WorkWWW",118,178,e.change,e.notMyProfile,e.notMyProfile&&!e.data.WorkWWW),{height:10}]}},{header:mcService.Lang(148),collapsed:!0,css:"prInp",body:{rows:[{height:7},{view:"datepicker",id:"upBirthday",value:e.data.Birthday,labelPosition:"top",placeholder:mcLang(118),label:mcLang(149)+":",on:{onChange:e.change},disabled:e.notMyProfile,hidden:e.notMyProfile&&!e.data.Birthday,suggest:{type:"calendar",body:{minDate:new Date("1900.01.01"),maxDate:new Date("3000.01.01")}}},{view:"select",id:"upMaritalStatus",value:e.data.MaritalStatus,labelPosition:"top",label:mcLang(150)+":",on:{onChange:e.change},options:mcService.GetMaritalStatusList(),css:"noBGAll",disabled:e.notMyProfile,hidden:e.notMyProfile&&!e.data.MaritalStatus},t("HomePhone",118,159,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomePhone),t("HomeFax",118,160,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeFax),t("HomeCellular",118,161,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeCellular),t("HomeStreetAddress",118,163,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeStreetAddress),t("HomeCity",118,164,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeCity),t("HomeState",118,165,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeState),t("HomeZIP",118,166,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeZIP),{view:"select",id:"upHomeCountry",value:e.data.HomeCountry,labelPosition:"top",label:mcLang(167),on:{onChange:e.change},options:mcService.GetCountriesList(),css:"noBGAll",disabled:e.notMyProfile,hidden:e.notMyProfile&&!e.data.HomeCountry},t("HomeWWW",118,168,e.change,e.notMyProfile,e.notMyProfile&&!e.data.HomeWWW),{height:10}]}}]},{width:11}]};s.rows.push({height:7}),s.rows.push(l),s.rows.push({height:7}),s.rows.push(d),s.rows.push({height:7}),$$(e.container).addView({id:e.Name,css:"color54",rows:[{css:"header",cols:[{view:"button",type:"icon",icon:"arrow-left",label:mcService.Lang(63),width:140,css:"headerBtn whiteBG",click:e.closeProfile},{id:"profileHeaderDisplayName",view:"template",template:e.displayName,autoheight:!0,borderless:!0,height:34,css:"byCenter myScroll"},{view:"button",id:"saveBtn"+e.Name,type:"icon",icon:"check",label:mcService.Lang(77),click:e.saveProfile,css:"headerBtn",width:140,hidden:!0}]},{height:3,css:"whiteBG"},{view:"scrollview",body:s}]}),n=$$(e.Name),e.uFoto=$$("upFoto"),e.saveBtn=$$("saveBtn"+e.Name),e.profileHeaderDisplayName=$$("profileHeaderDisplayName"),e.fotoEditBtns=$$("fotoEditBtns"),isMobile&&($$("profileBody"+e.Name).$view.id="_profileBody"+e.Name,(new TouchScroll).init({id:"_profileBody"+e.Name,draggable:!0,wait:!1}))}return n}function userProfileController(e,t){e.Name=mcConst.dataModels.UserProfile,e.userData=null,e.noImage='<img id="upFotoCanvas" src="'+mcConst.imagesPath.all+'noimage.png" border="0">',e.displayName="";var n=null;e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(e.Name,[{key:mcConst.keyCodes.esc,lockPrev:!0,func:e.closeProfile}],document)},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(e.Name)},e.drawFoto=function(t){t&&t.CRC32?e.uFoto.define("template",'<img id="uFotoCanvas" src="data:image/jpg;base64,'+t.Foto+'">'):e.uFoto.define("template",e.noImage),e.uFoto.refresh()},e.clearFoto=function(){webix.confirm({type:"confirm-warning",text:mcService.Lang(553),ok:mcService.Lang(519),cancel:mcService.Lang(33),callback:function(e){e&&(t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_set_uin_foto,mcConst.SessionID,""]),$$("upFoto").define("template",'<img id="upFotoCanvas" src="" border="0">'),$$("upFoto").refresh(),webix.message(mcService.Lang(554)))}})},e.uploadFoto=function(e){var n=e.file,o=e.type.toLowerCase(),i=!0;if(!n||"jpg"!=o&&"png"!=o)t.$broadcast("ErrorMsg",["client",mcService.Lang(555)+n.name]),t.$broadcast("hide"+mcConst.lockInterface,[]),i=!1;else{t.$broadcast(mcConst.lockInterface,[]);var s=new FileReader;s.onload=function(e){$$("upFoto").define("template",'<canvas id="upFotoCanvas" height="'+mcConst.userFoto.h+'" width="'+mcConst.userFoto.w+'"></canvas>'),$$("upFoto").refresh();var n=new Image;n.src=e.target.result,n.onload=function(){var e=document.createElement("canvas"),o=document.getElementById("upFotoCanvas");e.width=n.width,e.height=n.height,e.height<=mcConst.userFoto.h&&e.width<=mcConst.userFoto.w?(o.width=e.width,o.height=e.height):e.width>=e.height?(o.width=mcConst.userFoto.w,o.height=e.height/(e.width/mcConst.userFoto.w)):(o.width=e.width/(e.height/mcConst.userFoto.h),o.height=mcConst.userFoto.h);var i=e.getContext("2d");i.fillStyle="#fff",i.fillRect(0,0,e.width,e.height),i.drawImage(n,0,0,n.width,n.height),canvasResize(e,o,function(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_set_uin_foto,mcConst.SessionID,o.toDataURL("image/jpeg").replace("data:image/jpeg;base64,","")]),t.$broadcast("hide"+mcConst.lockInterface,[])})}},s.onerror=function(){t.$broadcast("ErrorMsg",["client",mcService.Lang(555)+n.name]),t.$broadcast("hide"+mcConst.lockInterface,[]),i=!1},s.readAsDataURL(n)}if(!i)return i},e.closeProfile=function(){t.$broadcast("changeCenterView")},e.saveProfile=function(){e.data.Birthday=mcService.formatDate(e.data.Birthday,"dd.mm.yyyy"),t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_set_uin_info,mcConst.SessionID,JSON.stringify(e.data)]),webix.alert(mcLang(117)),e.notMyProfile||e.saveBtn.hide()},e.change=function(){var t=this.data.id.toString().replace(/^up/,""),n=this.getValue();mcService.isString(n)?(n=mcService.trim(n.replace(/\u2022|\u0002|\u0003|\u000b|\r|\n/g,"")))||(e.data[t]=n):e.data[t]=n,e.notMyProfile||e.saveBtn.show()},e.getData=function(n){var o=new mcService.TaskList;o.AddTask(function(){t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.cs_get_uin_info,mcConst.SessionID,n,function(t){e.data=t,o.Next()}])}),o.AddTask(function(){t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_uin_foto,mcConst.SessionID,e.data.UIN,function(t){e.show(),e.drawFoto(t)}])}),o.Run()},e.show=function(){e.notMyProfile=e.data.UIN!=mcConst.UserInfo.UIN,e.displayName=e.data.DisplayNick||mcConst.UserInfo.Nick,n=initUserProfile(e),Object.keys(e.data).forEach(function(t){var n=$$("up"+t);n&&n.setValue&&(n.setValue(e.data[t]),-1===["CompNetName","IP","MAC","LastAccess","UIN"].indexOf(t)&&n[e.notMyProfile?"disable":"enable"]())}),e.saveBtn.hide(),e.fotoEditBtns[e.notMyProfile?"hide":"show"](),e.profileHeaderDisplayName.define("template",e.displayName),e.profileHeaderDisplayName.refresh()},e.$on("onGetUserProfileInfo",function(n,o){e.data=o[0],t.$broadcast("SendCMDToServer",[mcConst._CMD_.cs_get_uin_foto,mcConst.SessionID,e.data.UIN,function(t){e.show(),e.drawFoto(t)}])}),e.$on("hide"+e.Name,function(){n.hide(),e.removeHotKeys()}),e.$on("show"+e.Name,function(n,o){e.container=o[0],e.wndSize=t.wndSize,e.getData(o[1]||mcConst.UserInfo.UIN),e.registerHotKeys()}),t.$broadcast("windowResize",[function(e,t){isMobile&&n&&(n.define("height",t),n.resize(),n.resizeChildren())}])}function initViewLogsFrame(e){var t=$$(e.Name);return t?t.show():($$(e.container).addView({id:e.Name,rows:[{css:"header",cols:[{view:"template",template:mcLang(586),autoheight:!0,borderless:!0,height:34,css:"byCenter myScroll"},{id:"logsCalendar"+e.Name,view:"daterangepicker",css:"finger",value:{start:new Date,end:new Date},on:{onChange:e.selectLogsRange},suggest:{view:"daterangesuggest",body:{calendarCount:1}}}]},{id:"logsContent"+e.Name,view:"template",borderless:!0,css:"selectable scrollMenu myScroll",scroll:!1,template:"<div></div>",gravity:3}]}),t=$$(e.Name),e.logsCalendar=$$("logsCalendar"+e.Name),e.logsContent=$$("logsContent"+e.Name)),t}function viewLogsController(e,t,n){function o(t,n){var o=document.createElement("div");o.setAttribute("day",n),t=t.replace(/\r\n/gi,"<br/>"),o.className="monospaceAll font85 framePaddingР10",o.style.wordBreak="break-word",o.innerHTML=t,e.logsContent.$view.firstChild.appendChild(o),e.logsContent.$view.scrollTop=e.logsContent.$view.scrollHeight}function i(){e.logsContent.define("template","<div></div>"),e.logsContent.refresh()}function s(e,n){i(),t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_get_logs_files,e,n,function(e){Object.keys(e).forEach(function(t){o(e[t],t)})}])}e.Name=mcConst.dataModels.ViewLogs;var a=null,r="";e.registerHotKeys=function(){},e.selectLogsRange=function(){var t=e.logsCalendar.getValue();s(t.start,t.end)},e.removeHotKeys=function(){},e.show=function(){a=initViewLogsFrame(e),r=$$(e.container).getNode().className,$$(e.container).getNode().className="webix_view noMargin webix_layout_line"},e.getData=function(){t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_get_logs_list,function(t){var n=e.logsCalendar.getPopup().getBody().getChildViews()[0].getChildViews(),o=new Date(t.minDate.split(".")),i=new Date(t.maxDate.split("."));n[0].define("minDate",o),n[0].define("maxDate",i),s(i,i)}])};_messages_.VievLogs={};e.$on("hide"+e.Name,function(){a&&a.isVisible()&&(e.removeHotKeys(),a.hide(),i(),$$(e.container).getNode().className=r)}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show(),e.getData(),e.registerHotKeys()})}function initSettingsView(e){var t=$$(e.Name);if(t)t.show();else{var n={1:mcLang({id:591,from:"admin"}),2:mcLang({id:1345,from:"admin"}),3:mcLang({id:1350,from:"admin"}),4:mcLang({id:1357,from:"admin"}),5:mcLang({id:1367,from:"admin"}),6:mcLang({id:1371,from:"admin"}),7:mcLang({id:1373,from:"admin"}),8:mcLang({id:1336,from:"admin"}),9:mcLang({id:1402,from:"admin"}),10:mcLang({id:29,from:"admin"}),11:mcLang({id:1430,from:"admin"}),12:mcLang({id:598,from:"admin"}),13:mcLang({id:1445,from:"admin"}),14:mcLang({id:1451,from:"admin"}),15:mcLang({id:838,from:"admin"}),16:mcLang({id:1461,from:"admin"}),17:mcLang({id:1464,from:"admin"}),18:mcLang({id:574,from:"admin"}),19:mcLang({id:1851,from:"admin"})},o=[{rows:[{template:n[3],head:3,id:"rmctrlHeader3",css:"dialogsHeader font115 byCenter white lHeight28",height:28},{padding:7,rows:[{id:"rcitm_GeneralConfirmExit",head:3,view:"checkbox",labelRight:mcLang({id:1352,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{height:10},{id:"rcitm_GeneralMainWindow",head:3,view:"radio",css:"finger paraPadding20",value:"0",vertical:!0,label:mcLang({id:1353,from:"admin"}),labelPosition:"top",height:100,options:[{id:"0",value:mcLang({id:683,from:"admin"})},{id:"1",value:mcLang({id:1355,from:"admin"})},{id:"2",value:mcLang({id:1356,from:"admin"})}],on:{onChange:e.universalChanger}},{height:10},{id:"rcitm_SpecialMessagesFontSize",head:3,view:"radio",css:"finger paraPadding20",value:"0",vertical:!0,label:mcLang({id:1664,from:"admin"}),labelPosition:"top",height:120,options:[{id:"0",value:mcLang({id:1667,from:"admin"})},{id:"1",value:mcLang({id:1668,from:"admin"})},{id:"2",value:mcLang({id:1669,from:"admin"})},{id:"3",value:mcLang({id:1670,from:"admin"})}],on:{onChange:e.universalChanger}},{id:"rcitm_EventsTimeStamp",head:4,view:"checkbox",labelRight:mcLang({id:1372,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[4],head:4,id:"rmctrlHeader4",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_GeneralShowSendButton",head:4,view:"checkbox",labelRight:mcLang({id:1358,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_GeneralCtrlEnterSend",head:4,view:"checkbox",labelRight:mcLang({id:1359,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_GeneralSpellCheck",head:4,view:"checkbox",labelRight:mcLang({id:1360,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_GeneralDoubleClickPagesClose",head:4,view:"checkbox",labelRight:mcLang(614),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[5],head:5,id:"rmctrlHeader5",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_EventsPopupOnNewBBS",head:5,view:"checkbox",labelRight:mcLang({id:1368,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_EventsPopupOnChannelMessage",head:5,view:"checkbox",labelRight:mcLang({id:1369,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_EventsPopupOnPrivateMessage",head:5,view:"checkbox",labelRight:mcLang({id:1370,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[7],head:7,id:"rmctrlHeader7",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_EventsShowPopupTrayWindow",head:7,view:"checkbox",labelRight:mcLang({id:1374,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_EventsTrayBBSMsg",head:7,view:"checkbox",labelRight:mcLang({id:1368,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_EventsTrayChMsg",head:7,view:"checkbox",labelRight:mcLang({id:1369,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_EventsTrayPvMsg",head:7,view:"checkbox",labelRight:mcLang({id:1370,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{height:10},{head:7,cols:[{id:"rcitm_EventsTrayDontHide",head:7,view:"radio",value:"1",vertical:!0,width:300,label:mcLang({id:1334,from:"admin"}),labelPosition:"top",css:"finger paraPadding20",height:70,options:[{id:"1",value:mcLang({id:1378,from:"admin"})},{id:"0",value:mcLang({id:1380,from:"admin"})}],on:{onChange:e.universalChanger}},{rows:[{height:42},{cols:[{id:"rcitm_EventsTrayWindowDuration",head:7,view:"counter",value:10,step:1,min:1,max:999,width:100,on:{onChange:e.universalChanger,onKeyPress:e.checkNumbers}},{template:mcLang({id:1379,from:"admin"}),height:38,autoheight:!0,css:"lHeight38",borderless:!0}]}]}]},{id:"rcitm_EventsTrayBlinkOnTaskBar",head:7,view:"checkbox",labelRight:mcLang({id:1842,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[9],head:9,id:"rmctrlHeader9",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_SoundsAllSoundsOff",head:9,rows:[{id:"sub_SoundsAllSoundsOff",head:9,view:"checkbox",labelRight:mcLang({id:1403,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]},{cols:[{rows:[{head:9,view:"accordion",multi:!0,rows:[{id:"rcitm_SoundsAllSoundsOffCustom",view:"accordionitem",header:mcLang({id:1681,from:"admin"}),collapsed:!0,body:{padding:7,rows:[{id:"rcitm_SoundsSndError",hidden:!0,head:9,view:"checkbox",labelRight:mcLang({id:1386,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndJoin",head:9,view:"checkbox",labelRight:mcLang({id:1404,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndLeave",head:9,view:"checkbox",labelRight:mcLang({id:1405,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChat",head:9,view:"checkbox",labelRight:mcLang({id:1406,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndStatus",hidden:!0,head:9,view:"checkbox",labelRight:mcLang({id:1407,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndSignal",hidden:!0,head:9,view:"checkbox",labelRight:mcLang({id:1408,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatType",head:9,view:"checkbox",labelRight:mcLang({id:1409,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatBS",head:9,view:"checkbox",labelRight:mcLang({id:1410,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatRet",head:9,view:"checkbox",labelRight:mcLang({id:1411,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndNewMsg",head:9,view:"checkbox",labelRight:mcLang({id:1412,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndPrivate",head:9,view:"checkbox",labelRight:mcLang({id:1413,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndBadWord",hidden:!0,head:9,view:"checkbox",labelRight:mcLang({id:1414,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndBroadcast",head:9,view:"checkbox",labelRight:mcLang({id:1415,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndScreenShot",head:9,view:"checkbox",labelRight:mcLang({id:1416,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndFilesExchangeRequest",head:9,view:"checkbox",labelRight:mcLang({id:1417,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndFilesExchangeDone",head:9,view:"checkbox",labelRight:mcLang({id:1418,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaCall",head:9,view:"checkbox",labelRight:mcLang({id:1419,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaBusy",head:9,view:"checkbox",labelRight:mcLang({id:1420,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaCallReject",head:9,view:"checkbox",labelRight:mcLang({id:1421,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaIncomingCall",head:9,view:"checkbox",labelRight:mcLang({id:1422,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaEndCall",head:9,view:"checkbox",labelRight:mcLang({id:1423,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}},{id:"rcitm_SoundsFilesCustom",hidden:!0,view:"accordionitem",header:mcLang({id:1694,from:"admin"}),collapsed:!0,body:{padding:7,rows:[{id:"rcitm_SoundsSndErrorFile",hidden:!0,head:9,view:"text",label:mcLang({id:1702,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndJoinFile",head:9,view:"text",label:mcLang({id:1698,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndLeaveFile",head:9,view:"text",label:mcLang({id:1697,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatFile",head:9,view:"text",label:mcLang({id:1706,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndStatusFile",hidden:!0,head:9,view:"text",label:mcLang({id:1701,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndSignalFile",hidden:!0,head:9,view:"text",label:mcLang({id:1705,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatTypeFile",head:9,view:"text",label:mcLang({id:1699,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatBSFile",head:9,view:"text",label:mcLang({id:1700,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndChatRetFile",head:9,view:"text",label:mcLang({id:1704,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndNewMsgFile",head:9,view:"text",label:mcLang({id:1695,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndPrivateFile",head:9,view:"text",label:mcLang({id:1703,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndBadWordFile",hidden:!0,head:9,view:"text",label:mcLang({id:1696,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndBroadcastFile",head:9,view:"text",label:mcLang({id:1707,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndScreenShotFile",head:9,view:"text",label:mcLang({id:1708,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndFilesExchangeRequestFile",head:9,view:"text",label:mcLang({id:1709,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndFilesExchangeDoneFile",head:9,view:"text",label:mcLang({id:1710,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaBusyFile",head:9,view:"text",label:mcLang({id:1711,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaCallFile",head:9,view:"text",label:mcLang({id:1712,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaCallRejectFile",head:9,view:"text",label:mcLang({id:1713,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaEndCallFile",head:9,view:"text",label:mcLang({id:1714,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SoundsSndMediaIncomingCallFile",head:9,view:"text",label:mcLang({id:1715,from:"admin"}),labelPosition:"top",value:"",css:"finger",on:{onChange:e.universalChanger}}]}}]}]},{gravity:0}]}]}]},{rows:[{template:n[10],head:10,id:"rmctrlHeader10",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_SysEventsShowImagesInChat",head:10,view:"checkbox",labelRight:mcLang({id:1425,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_SysEventsImagesThumbsSize",head:10,view:"select",label:mcLang({id:1822,from:"admin"}),labelWidth:300,width:500,value:"0",options:[{id:"0",value:mcLang({id:1823,from:"admin"})},{id:"1",value:mcLang({id:1824,from:"admin"})},{id:"2",value:mcLang({id:1825,from:"admin"})}],on:{onChange:e.universalChanger}},{id:"rcitm_SysEventsDisableEmotions",head:10,view:"checkbox",labelRight:mcLang({id:1427,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[13],head:13,id:"rmctrlHeader13",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_57",head:13,rows:[{cols:[{id:"rcitm_SysEventsLoadHistoryType",head:13,view:"radio",value:"0",vertical:!0,width:300,label:mcLang({id:1449,from:"admin"}),labelPosition:"top",css:"finger paraPadding20",height:70,options:[{id:"0",value:mcLang({id:1446,from:"admin"})},{id:"1",value:mcLang({id:1447,from:"admin"})}],on:{onChange:e.universalChanger}},{rows:[{height:42},{cols:[{id:"rcitm_SysEventsHistory_1_Num",head:13,view:"counter",value:10,step:1,min:1,max:999,width:100,on:{onChange:e.universalChanger,onKeyPress:e.checkNumbers}},{template:mcLang({id:1450,from:"admin"}),borderless:!0,css:"lHeight38"}]}]}]},{cols:[{width:30},{id:"rcitm_LoadHistoryToConf",head:12,view:"checkbox",labelRight:mcLang({id:1880,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]},{cols:[{width:30},{id:"rcitm_LoadHistoryToPrivate",head:12,view:"checkbox",labelRight:mcLang({id:1881,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]}]}]},{rows:[{template:n[15],head:15,id:"rmctrlHeader15",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_63",head:15,cols:[{id:"rcitm_SendFilesRandomPorts",head:15,view:"radio",value:"1",vertical:!0,width:225,label:mcLang({id:1454,from:"admin"}),labelPosition:"top",css:"finger paraPadding20",height:70,options:[{id:"0",value:mcLang({id:1455,from:"admin"})},{id:"1",value:mcLang({id:1456,from:"admin"})}],on:{onChange:e.universalChanger}},{rows:[{height:7},{cols:[{id:"rcitm_SendFilesBasePort",head:15,view:"counter",value:10,step:1,min:1,max:65e3,width:130,labelWidth:30,label:"&nbsp;",on:{onChange:e.universalChanger,onKeyPress:e.checkNumbers}},{id:"rcitm_SendFilesDataPort",head:15,view:"counter",value:10,step:1,min:1,max:65e3,width:130,labelWidth:30,label:"&nbsp;",on:{onChange:e.universalChanger,onKeyPress:e.checkNumbers}}]},{cols:[{id:"rcitm_SendFilesRandomPortStart",head:15,view:"counter",value:10,label:mcLang({id:1339,from:"admin"}),labelWidth:30,step:1,min:1,max:65e3,width:130,on:{onChange:e.universalChanger,onKeyPress:e.checkNumbers}},{id:"rcitm_SendFilesRandomPortEnd",head:15,view:"counter",value:10,label:mcLang({id:634,from:"admin"}),labelWidth:30,step:1,min:1,max:65e3,width:130,on:{onChange:e.universalChanger,onKeyPress:e.checkNumbers}}]}]}]},{maxWidth:600,rows:[{id:"rcitm_SendFilesInputFilesDir",head:15,view:"text",value:"",keyPressTimeout:500,label:mcLang({id:1457,from:"admin"}),labelPosition:"top",on:{onTimedKeyPress:e.universalChanger}}]}]}]},{hidden:!0,rows:[{template:n[17],head:17,id:"rmctrlHeader17",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_GeneralDailyUpdatesCheck",head:17,view:"checkbox",labelRight:mcLang({id:1465,from:"admin"}),labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[19],head:19,id:"rmctrlHeader19",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_Transport",head:19,cols:[{template:mcLang({id:1852,from:"admin"}),borderless:!0,autoheight:!0,width:200},{id:"rcitm_MediaNetworkTransportTCP",head:19,view:"checkbox",width:60,labelRight:"TCP",labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{id:"rcitm_MediaNetworkTransportUDP",head:19,view:"checkbox",width:60,labelRight:"UDP",labelWidth:0,value:"",css:"finger",on:{onChange:e.universalChanger}},{}]},{id:"rcitm_IceTransportPolicy",head:19,view:"select",label:mcLang({id:1856,from:"admin"}),labelWidth:200,width:500,value:"classic",options:[{id:"relay",value:mcLang({id:1854,from:"admin"})},{id:"all",value:mcLang({id:1855,from:"admin"})}],on:{onChange:e.universalChanger}}]}]},{rows:[{template:n[18],head:18,id:"rmctrlHeader18",css:"dialogsHeader font115 byCenter white lHeight28",height:26},{padding:7,rows:[{id:"rcitm_AdditionalPrivateInfoFields",head:18,view:"text",label:mcLang({id:1470,from:"admin"}),labelPosition:"top",value:"",on:{onTimedKeyPress:e.universalChanger}},{id:"rcitm_AdditionalProgramCaption",head:18,view:"text",label:mcLang({id:1471,from:"admin"}),labelPosition:"top",value:"",on:{onTimedKeyPress:e.universalChanger}},{id:"rcitm_AdditionalSystemTrayText",head:18,view:"text",label:mcLang({id:1472,from:"admin"}),labelPosition:"top",value:"",on:{onTimedKeyPress:e.universalChanger}}]}]}];$$(e.container).addView({id:e.Name,rows:[{view:"template",template:mcLang(15),autoheight:!0,borderless:!0,height:34,css:"byCenter header"},{view:"scrollview",borderless:!0,scroll:!1,css:"scrollMenu myScroll",body:{padding:0,css:"font14l",rows:[].concat(o)}}]}),t=$$(e.Name)}return t}function settingsController(e,t){e.Name=mcConst.dataModels.Settings;var n=null,o="",i=!0,s={EventsTrayDontHide:{set:function(e){$$("rcitm_EventsTrayDontHide").setValue(mcService.convertBool(e))},get:function(){return mcService.convertIntToBool($$("rcitm_EventsTrayDontHide").getValue())}},SendFilesRandomPorts:{set:function(e){$$("rcitm_SendFilesRandomPorts").setValue(mcService.convertBool(e))},get:function(){return mcService.convertIntToBool($$("rcitm_SendFilesRandomPorts").getValue())}},SoundsAllSoundsOff:{set:function(e){$$("sub_SoundsAllSoundsOff").setValue(mcService.convertBool(e))},get:function(){return $$("rcitm_SoundsAllSoundsOff").config.hidden?null:mcService.convertIntToBool($$("sub_SoundsAllSoundsOff").getValue())}},SysEventsHistory_1_Num:{set:function(e){$$("rcitm_SysEventsHistory_1_Num").setValue(e)},get:function(){return $$("rcitm_SysEventsHistory_1_Num").getValue()}},SysEventsLoadHistoryType:{set:function(e){$$("rcitm_SysEventsLoadHistoryType").setValue(mcService.convertBool(e))},get:function(){return $$("rcitm_SysEventsLoadHistoryType").getValue()}},SendFilesInputFilesDir:{set:function(e){$$("rcitm_SendFilesInputFilesDir").setValue(e)},get:function(){return $$("rcitm_SendFilesInputFilesDir").getValue()}}};["SendFilesBasePort","SendFilesDataPort","SendFilesRandomPortStart","SendFilesRandomPortEnd"].forEach(function(e){s[e]={set:function(t){$$("rcitm_"+e).setValue(t)},get:function(){return $$("rcitm_"+e).getValue()}}}),["LoadHistoryToConf","LoadHistoryToPrivate"].forEach(function(e){s[e]={set:function(t){$$("rcitm_"+e).setValue(mcService.convertBool(t))},get:function(){return $$("rcitm_57").config.hidden?null:mcService.convertIntToBool($$("rcitm_"+e).getValue())}}}),["MediaNetworkTransportTCP","MediaNetworkTransportUDP"].forEach(function(e){s[e]={set:function(t){$$("rcitm_"+e).setValue(mcService.convertBool(t))},get:function(){return $$("rcitm_Transport").config.hidden?null:mcService.convertIntToBool($$("rcitm_"+e).getValue())}}}),["SoundsSndError","SoundsSndJoin","SoundsSndLeave","SoundsSndChat","SoundsSndStatus","SoundsSndSignal","SoundsSndChatType","SoundsSndChatBS","SoundsSndChatRet","SoundsSndNewMsg","SoundsSndPrivate","SoundsSndBadWord","SoundsSndBroadcast","SoundsSndScreenShot","SoundsSndFilesExchangeRequest","SoundsSndFilesExchangeDone","SoundsSndMediaCall","SoundsSndMediaBusy","SoundsSndMediaCallReject","SoundsSndMediaIncomingCall","SoundsSndMediaEndCall"].forEach(function(e){s[e]={set:function(t){$$("rcitm_"+e).setValue(mcService.convertBool(t))},get:function(){return $$("rcitm_SoundsAllSoundsOffCustom").config.hidden?null:mcService.convertIntToBool($$("rcitm_"+e).getValue())}}}),["SoundsSndNewMsgFile","SoundsSndBadWordFile","SoundsSndLeaveFile","SoundsSndJoinFile","SoundsSndChatTypeFile","SoundsSndChatBSFile","SoundsSndStatusFile","SoundsSndErrorFile","SoundsSndPrivateFile","SoundsSndChatRetFile","SoundsSndSignalFile","SoundsSndChatFile","SoundsSndBroadcastFile","SoundsSndScreenShotFile","SoundsSndFilesExchangeRequestFile","SoundsSndFilesExchangeDoneFile","SoundsSndMediaBusyFile","SoundsSndMediaCallFile","SoundsSndMediaCallRejectFile","SoundsSndMediaEndCallFile","SoundsSndMediaIncomingCallFile"].forEach(function(e){s[e]={set:function(t){$$("rcitm_"+e).setValue(t)},get:function(){return $$("rcitm_SoundsFilesCustom").config.hidden?null:$$("rcitm_"+e).getValue()}}}),e.registerHotKeys=function(){},e.checkNumbers=function(e){if("counter"===this.config.view&&-1===mcService.inArray(e,mcConst.keyCodes.Digits.concat(mcConst.keyCodes.EditSymbols)))return!1},e.universalChanger=function(){var e=null,n=null,o=!1;if(i){for(var a in mcConst.ClientSettings)e=null,s.hasOwnProperty(a)?null!==(e=s[a].get())&&e!=mcConst.ClientSettings[a]&&(mcConst.ClientSettings[a]=e,o=!0):(n=$$("rcitm_"+a))&&!n.config.hidden&&null!==(e="checkbox"===n.config.view?mcService.convertIntToBool(n.getValue()):n.getValue())&&e!=mcConst.ClientSettings[a]&&(mcConst.ClientSettings[a]=e,o=!0);o&&t.$broadcast(window._messages_.clientData.saveClientSettings)}},e.removeHotKeys=function(){},e.show=function(){n=initSettingsView(e),o=$$(e.container).getNode().className,$$(e.container).getNode().className="webix_view noMargin webix_layout_line"},e.getData=function(){var e=null;i=!1,Object.keys(mcConst.ClientSettings).forEach(function(t){s.hasOwnProperty(t)?s[t].set(mcConst.ClientSettings[t]):(e=$$("rcitm_"+t))&&!e.config.hidden&&("checkbox"===e.config.view?e.setValue(mcService.convertIntToBool(mcConst.ClientSettings[t])):e.setValue(mcConst.ClientSettings[t]))}),i=!0};var a=_messages_.Settings={changeUserProfile:"changeUserProfile"};e.$on(a.changeUserProfile,function(n,o){mcConst.ClientSettings=mcService.Marge(mcConst.ClientSettings,o[0]),t.$broadcast(window._messages_.clientData.saveClientSettings),e.getData()}),e.$on("hide"+e.Name,function(){n&&n.isVisible()&&(e.removeHotKeys(),n.hide(),$$(e.container).getNode().className=o)}),e.$on("show"+e.Name,function(t,n){e.container=n[0],e.show(),e.getData(),e.registerHotKeys()})}function initUpdateWrapper(e){var t=$$(e.Name);return t&&t.destructor(),(t=webix.ui({id:e.Name,view:"window",width:350,position:"center",head:!1,body:{padding:5,rows:[{template:"<div class='byCenter font115 lHeight36'>"+mcLang(613)+"</div>",borderless:!0,autoheight:!0,on:{onAfterRender:e.download}},e.duViews.progressWrapper]}})).show(),t}function updateController(e,t){function n(){s=!1,o&&o.isVisible()&&o.close()}e.Name=mcConst.dataModels.Update,e.containers=mcConst.containers;var o=null,i={},s=!1,a=new DownloadUploadManager(t,function(){});e.download=function(){s=!0,a.initViews(),a.downloadUrl(mcService.getLocalHostPath(!1),{downloadUpdate:!0},!0)};var r=window._messages_.clientUpdate={DownloadClientUpdate:"DownloadClientUpdate",on_file_download_aborted:"on_file_download_aborted",on_file_download_complete:"on_file_download_complete",on_file_download_file_no_found:"on_file_download_file_no_found"};e.$on(r.on_file_download_aborted,function(){s&&t.$broadcast("show"+mcConst.dataModels.Login,[])}),e.$on(r.on_file_download_file_no_found,function(){s&&t.$broadcast("ErrorMsg",[mcConst._CMD_.Errors.WrongServerVersion,mcConst.ErrorText[mcConst._CMD_.Errors.WrongServerVersion],"",function(){t.$broadcast("show"+mcConst.dataModels.Login,[])}])}),e.$on(r.on_file_download_complete,function(){s&&(n(),e.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_restart_client]))}),e.$on(r.DownloadClientUpdate,function(t,n){i=n[0],mcConst.UserInfo.PortNode=i.NodePort,mcConst.UserInfo.HTTPS=i.HTTPS,e.duViews=a.getViews(),o=initUpdateWrapper(e)}),e.$on("hide"+e.Name,n)}function initBroadcastView(e,t){var n=$$(e.Name);return n||(n=webix.ui({id:e.Name,view:"window",position:"center",modal:!0,width:document.body.offsetWidth-40,height:document.body.offsetHeight-40,head:!1,body:{padding:5,rows:[{id:"brTitle",template:"&nbsp;",height:38,css:"byCenter lHeight36"},{id:"brCntWrapper",cols:[{id:"brUserList",view:"list",width:200,select:!0,minWidth:200,maxWidth:500,type:{height:50},template:function(t){return mcService.myReplaceFormated("<div class='lHeight26'><div class='firstLineList'>#{name}</div><div>#{date}#{onlySee}#{confirm}#{reply}</div></div>",{name:t.DisplayName,date:mcService.formatDate(mcService.utcTime(t.dtCreatedUTC),"hh:nn dd.mm.yyyy"),onlySee:t.msg_type===e.msgType.regular?" "+mcService.insertIco("fa-eye"," "):"",confirm:t.msg_type===e.msgType.needRead?" "+mcService.insertIco("fa-check-square-o"," "):"",reply:t.msg_type===e.msgType.needAnswer?" "+mcService.insertIco("fa-comments-o"," "):""})},on:{onAfterSelect:e.selectBroadcast,onBeforeSelect:e.backupAnswer}},{view:"resizer"},{rows:[{cols:[{rows:[e.dwlMngr.progressWrapper,{id:"brMsgContent",template:"&nbsp;",css:"framePaddingAll10"},{id:"brAnswerResizer",view:"resizer",hidden:!0},{id:"brAnswer",view:"textarea",css:"noBGColorAll",hidden:!0,height:60,placeholder:mcLang(621)},{rows:[{id:"brImReadMsgWrap",cols:[{id:"brImReadMsg",view:"checkbox",value:!1,labelWidth:0,labelRight:mcLang(607),css:"finger",on:{onChange:e.readMsg}},{},{id:"brCloseWnd",view:"button",width:150,value:mcLang(12),click:e.closeBroadcast}]},{height:20}]}]},{id:"brFilesResizer",view:"resizer"},{id:"brFileListWrap",hidden:!0,rows:[{height:3},{id:"brFilesCount",template:mcLang(622),css:"byCenter",autoheight:!0,borderless:!0},{height:3},{id:"brFileList",view:"list",width:200,select:!1,minWidth:200,maxWidth:500,css:"lHeight17All font80 filesList",type:{height:"auto"},template:function(e){return mcService.myReplaceFormated("<span class='bolder'>#{fName}</span><br><span class='gray'>#{sizeTitle}: #{size}</span>",{fName:e.OriginalFileName,size:mcService.formatFileSize(e.Size),sizeTitle:mcLang(590)})},on:{onItemClick:e.downloadFile}}]}]}]}]}]}}),e.initDU()),t.forEach(function(e){e.id=e.ID}),e.brUserList=$$("brUserList"),e.brTitle=$$("brTitle"),e.brMsgContent=$$("brMsgContent"),e.brImReadMsgWrap=$$("brImReadMsgWrap"),e.brImReadMsg=$$("brImReadMsg"),e.brCntWrapper=$$("brCntWrapper"),e.answerResizer=$$("brAnswerResizer"),e.answer=$$("brAnswer"),e.brFileListWrap=$$("brFileListWrap"),e.brFilesResizer=$$("brFilesResizer"),e.brFileList=$$("brFileList"),e.brFilesCount=$$("brFilesCount"),e.brUserList.parse(t),e.brUserList.select(e.brUserList.getFirstId()),n.show(),n}function broadcastController(e,t,n){function o(){var n=mcService.ObjToString(a),o=!0,c={};r.forEach(function(n){n.msg_type===e.msgType.needRead&&a[n.ID]&&a[n.ID].read||n.msg_type===e.msgType.needAnswer&&a[n.ID]&&a[n.ID].ReplyText||n.msg_type===e.msgType.regular&&a[n.ID]||(t.$broadcast("ErrorMsg",[-1,mcLang(612),"",function(){}]),o=!1),n.read_notify&&(c[n.ID]={UIN:n.uinOwner})}),o&&e.brUserList&&(t.SendCMDToServer([mcConst._CMD_.cs_broadcast_just_readed,mcConst.SessionID,n]),t.SendCMDToServer([mcConst._CMD_.cs_broadcast_readed_notify,mcConst.SessionID,mcService.ObjToString(c)]),i&&i.isVisible()&&(e.removeHotKeys(),i.hide()),r=[],a={},s=null,e.brUserList.clearAll(),t.isWebClient||t.$broadcast(window._messages_.clientData.sendCMDToElectron,[mcConst._CMD_.ce_disable_always_on_top]))}e.Name=mcConst.dataModels.Broadcast;var i=null,s=(new McDeferredLoadImages,null),a={},r=[],c=!0,l=null;e.msgType={regular:0,needRead:1,needAnswer:2},e.readMsg=function(e){s&&c&&(a[s].read=mcService.convertIntToBool(e))},e.registerHotKeys=function(){},e.removeHotKeys=function(){},e.closeBroadcast=function(){var t=e.brUserList.getItem(s);a[s]&&t&&t.msg_type===e.msgType.needAnswer&&(a[s].ReplyText=e.answer.getValue()),o()},e.downloadFile=function(n){var o=e.brFileList.getItem(n);if(o&&o.Hash){var i=r[mcService.findItemInArrayOfObj(r,s,"ID")],a=mcService.getLocalHostPath(t.isWebClient)+"/"+mcConst.pathAliases.AliasFiles+"/"+o.Hash+"/"+encodeURI(o.OriginalFileName),c={uin:i.uinOwner,displayName:i.DisplayName,filePath:"",fileDT:o.UTCWriteTime,hash:o.Hash};t.isWebClient||l.openDownloadUrl(a,c)}},e.selectBroadcast=function(t){var n=e.brUserList.getItem(t);c=!1,s=t,e.brTitle.define("template",mcLang(611)+n.DisplayName+" <span class='Gray monospaceAll'>"+mcService.formatDate(mcService.utcTime(n.dtCreatedUTC),"[hh:nn dd.mm.yyyy]")+"</span>"),e.brMsgContent.define("template",n.msg.split("L$").join("<br>")),e.brTitle.refresh(),e.brMsgContent.refresh(),e.brImReadMsg[n.msg_type===e.msgType.needRead?"show":"hide"](),e.answerResizer[n.msg_type===e.msgType.needAnswer?"show":"hide"](),e.answer[n.msg_type===e.msgType.needAnswer?"show":"hide"](),e.brFileListWrap[n.files_list&&n.files_list.length?"show":"hide"](),e.brFilesResizer[n.files_list&&n.files_list.length?"show":"hide"](),e.brFileList.clearAll(),e.currentFilesCount=0,n.files_list&&(e.brFileList.parse(n.files_list),e.currentFilesCount=n.files_list.length,e.brFilesCount.define("template",mcLang(622)+" ["+e.currentFilesCount+"]"),e.brFilesCount.refresh()),a.hasOwnProperty(s)||(a[s]={ReplyText:""}),n.msg_type===e.msgType.needRead?e.brImReadMsg.setValue(a[s].read):n.msg_type===e.msgType.needAnswer&&e.answer.setValue(a[s].ReplyText),c=!0},e.backupAnswer=function(){var t=e.brUserList.getItem(s);a[s]&&t&&t.msg_type===e.msgType.needAnswer&&(a[s].ReplyText=e.answer.getValue(),e.answer.setValue(""))},e.show=function(n){r=n,l||(l=new DownloadUploadManager(t,function(e,t,n,o,i){}),e.initDU=l.initViews,e.dwlMngr=l.getViews(mcLang(33))),i=initBroadcastView(e,r)};var d=_messages_.Broadcast={onReceiveBroadcast:"onReceiveBroadcast"};e.$on(d.onReceiveBroadcast,function(t,n){e.show.apply(null,n),e.registerHotKeys()}),e.$on("hide"+e.Name,function(){o()})}function initSendBroadcastView(e,t){var n=$$(e.Name);return n||(n=webix.ui({id:e.Name,view:"window",position:"center",modal:!0,width:document.body.offsetWidth-60,height:document.body.offsetHeight-60,head:!1,body:{rows:[{template:res,borderless:!0,scroll:"y"},{view:"button",value:mcLang(12),click:function(){this.getTopParentView().hide(),this.getTopParentView().destructor()}}]}})),n.show(),n}function sendBroadcastController(e,t,n){e.Name=mcConst.dataModels.Broadcast;var o=null;new McDeferredLoadImages;e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(mcConst.dataModels.BBS,[{key:mcConst.keyCodes.enter,func:e.sendText},{key:mcConst.keyCodes.esc,func:e.closeBBS}],e.enterBBSText.getNode()),t.hotKeyDispatcher.addPreset(mcConst.dataModels.BBS+"global",[{key:mcConst.keyCodes.n,altKey:!0,func:e.addNewBBS}],document)},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(mcConst.dataModels.BBS),t.hotKeyDispatcher.removePreset(mcConst.dataModels.BBS+"global")},e.addNewBroadcast=function(){e.inputWrapper.show(),e.bbsResizer.show(),e.enterBBSText.focus()},e.closeBroadcast=function(){e.inputWrapper.hide(),e.bbsResizer.hide(),setTimeout(function(){e.enterBBSText.setValue(""),e.enterBBSText.$setValue(""),e.enterBBSText.focus()},10)},e.sendBroadcast=function(){var o=mcService.trim(e.enterBBSText.getValue()),i=mcService.formatDate(e.bbsLifeTime.getValue(),"dd.mm.yyyy.")+e.bbsHours.getValue()+"."+e.bbsMinutes.getValue()+".00",s=mcService.convertIntToBool(e.bbsToTop.getValue());return(t.isWebClient||mcConst.ClientSettings.SoundsSndChatRet)&&n.PlaySound(n.Sounds.EnterBtn),""!==o&&(o=o.replace(/\n/g,"\r\n"),t.SendCMDToServer([mcConst._CMD_.cs_add_new_bbs,mcConst.SessionID,JSON.stringify({Expired:i,Sticky:s,Msg:o})]),setTimeout(e.closeBBS,50)),!1},e.show=function(t){o=initBroadcastView(e,t)},e.getData=function(n){t.SendCMDToServer([mcConst._CMD_.cs_get_bbs,mcConst.SessionID,function(o){if(e.bbsContent.getNode().firstChild.innerHTML="&nbsp;",o&&o.length>0){var i=[],s=[],a=o[0];if(n&&a){var r=a.Msg.replace(/\u041e\u00ac/g,""),c=r.slice(0,100)+(r.length>100?"...":"");t.$broadcast("sendCMDToElectron",[mcConst._CMD_.ce_show_notify,a.DisplayName.slice(0,30)+(a.DisplayName.length>30?"..":"")+":",c,a.ID])}o.forEach(function(e){e.Top?i.push(e):s.push(e)}),i.sort(function(e,t){return mcService.sortAB(e.dtCreated,t.dtCreated)}),s.sort(function(e,t){return mcService.sortAB(e.dtCreated,t.dtCreated)}),s.forEach(function(e){addMSG(e)}),i.forEach(function(e){addMSG(e)})}}])};var i=_messages_.Broadcast={onReceiveBroadcast:"onReceiveBroadcast"};e.$on(i.onReceiveBroadcast,function(t,n){e.show.apply(null,n),e.registerHotKeys()}),e.$on("hide"+e.Name,function(){o&&o.isVisible()&&(e.removeHotKeys(),o.hide())})}function initChatWrapper(e){var t=null,n=[{id:"mainMenu"+e.Name,view:"toggle",type:"icon",css:"ico20 button_warning button_transparent noUpperCase",offIcon:"bars",onIcon:"close",offLabel:e.myName,onLabel:e.myName,on:{onChange:e.showMainMenu}},{id:e.containers.left,css:"noBGColorAll",rows:[{gravity:0}]}],o=[{id:e.containers.right,rows:[{gravity:0}]}],i={view:"toolbar",padding:0},s=[{id:"btn_"+mcConst.dataModels.CommonContacts,view:"toggle",type:"icon",icon:"sitemap",width:34,css:"iconNoPadding",tooltip:mcLang(10),on:{onItemClick:e.clickToolBtn}},{id:"btn_"+mcConst.dataModels.PersonalContacts,view:"toggle",type:"icon",icon:"users",width:34,css:"iconNoPadding",tooltip:mcLang(17),on:{onItemClick:e.clickToolBtn}},{id:"btn_"+mcConst.dataModels.HistoryDialogs,view:"toggle",type:"icon",icon:"history",width:34,css:"iconNoPadding",tooltip:mcLang(578),on:{onItemClick:e.clickToolBtn}},{id:"btn_"+mcConst.dataModels.PrivateInfo,view:"toggle",type:"icon",icon:"comment",width:34,css:"iconNoPadding",tooltip:mcLang(46),hidden:!0,on:{onItemClick:e.clickToolBtn}},{id:"btn_"+mcConst.dataModels.ConfUserList,view:"toggle",type:"icon",icon:"comments",width:34,css:"iconNoPadding",tooltip:mcLang(26),hidden:!0,on:{onItemClick:e.clickToolBtn}},{id:"btn_"+mcConst.dataModels.CommonFiles,view:"toggle",type:"icon",icon:"files-o",width:34,css:"iconNoPadding",tooltip:mcLang(567),hidden:!0,on:{onItemClick:e.clickToolBtn}},{id:"btn_"+mcConst.dataModels.ReceiveFiles,view:"toggle",type:"icon",icon:"exchange",width:34,css:"iconNoPadding",tooltip:mcLang(588),hidden:!0,on:{onItemClick:e.clickToolBtn}}];return isMobile?(i.height=37,i.css="bgDarkness WhiteMenu",i.cols=[{}].concat(s),(t=webix.ui({view:"carousel",scrollSpeed:"600ms",navigation:{type:"flip",items:!1,buttons:!1},cols:[{id:"leftSide",width:e.wndSize.width,css:"bgDarkness",rows:n},{id:e.containers.center,width:e.wndSize.width,css:"noMargin gradient",rows:[{gravity:0}]},{id:"rightSideResizer",width:0,hidden:!0},{rows:[i,{id:"rightSide",width:e.wndSize.width,css:"bgMC noMargin",rows:o}]}]})).getChildViews()[0].attachEvent("onAfterScroll",e.scrollView),t.setActive(e.containers.center),webix.attachEvent("onTouchEnd",e.correctSwipe)):(i.width=34,i.rows=s.concat({}),t=webix.ui({type:"layout",rows:[{cols:[{id:"leftSide",width:210,css:"bgDarkness",rows:n,minWidth:210,maxWidth:250},{id:"leftSideResizer",view:"resizer",css:"noBorder bgDarkness"},{id:e.containers.center,css:"noMargin gradient",cols:[{gravity:0}]},{id:"rightSideResizer",view:"resizer",css:"noBorder bgMC noMargin",hidden:!0},{id:"rightSide",width:250,css:"bgMC noMargin",minWidth:210,maxWidth:350,hidden:!0,rows:o}].concat(i)}]})),e.toolBtn.CommonContacts=$$("btn_"+mcConst.dataModels.CommonContacts),e.toolBtn.PersonalContacts=$$("btn_"+mcConst.dataModels.PersonalContacts),e.toolBtn.PrivateInfo=$$("btn_"+mcConst.dataModels.PrivateInfo),e.toolBtn.ConfUserList=$$("btn_"+mcConst.dataModels.ConfUserList),e.toolBtn.CommonFiles=$$("btn_"+mcConst.dataModels.CommonFiles),e.toolBtn.HistoryDialogs=$$("btn_"+mcConst.dataModels.HistoryDialogs),e.toolBtn.ReceiveFiles=$$("btn_"+mcConst.dataModels.ReceiveFiles),e.mainMenu=$$("mainMenu"+e.Name),e.leftSide=$$("leftSide"),e.leftSideResizer=$$("leftSideResizer"),e.rightSide=$$("rightSide"),e.rightSideResizer=$$("rightSideResizer"),e.centerBlock=$$(e.containers.center).getNode(),e.rightSideBlock=e.rightSide.getNode(),t}function chatWrapperController(e,t){function n(){_=""}function o(e){_=e}function i(n){switch(n){case mcConst.dataModels.PrivateInfo:"UIN-0"===t.GetChatTypeID()?e.toolBtn.PrivateInfo.hide():e.toolBtn.PrivateInfo.show(),e.toolBtn.ConfUserList.hide(),d("privateBg");break;case mcConst.dataModels.ConfUserList:e.toolBtn.PrivateInfo.hide(),e.toolBtn.ConfUserList.show(),d("bgMC");break;case mcConst.dataModels.CommonContacts:case mcConst.dataModels.HistoryDialogs:case mcConst.dataModels.PersonalContacts:case mcConst.dataModels.CommonFiles:break;case mcConst.dataModels.ReceiveFiles:e.toolBtn[mcConst.dataModels.ReceiveFiles].show();break;default:e.toolBtn.PrivateInfo.hide(),e.toolBtn.ConfUserList.hide(),_||(e.rightSide.hide(),e.rightSideResizer.hide())}}function s(n,o){""===_?(e.changeTool(n),o&&n&&e.toolBtn[n].callEvent("onItemClick")):i(n,_),t.$broadcast(window._messages_.chatFrame.focusToEnterChat)}function a(){var t=C?mcConst.minChatFrameWidth+S+40:mcConst.minChatFrameWidth;!C&&e.centerBlock.offsetWidth<=t&&e.rightSide.isVisible()?(S=e.rightSideBlock.offsetWidth,s(v,!0),C=!0):C&&e.centerBlock.offsetWidth>t&&(s(v,!0),S=0,C=!1)}function r(){e.containers[mcConst.dataModels.CommonContacts]=mcConst.containers.right,e.containers[mcConst.dataModels.PersonalContacts]=mcConst.containers.right,e.containers[mcConst.dataModels.PrivateInfo]=mcConst.containers.right,e.containers[mcConst.dataModels.ConfUserList]=mcConst.containers.right,e.containers[mcConst.dataModels.CommonFiles]=mcConst.containers.right,e.containers[mcConst.dataModels.HistoryDialogs]=mcConst.containers.right,e.containers[mcConst.dataModels.ReceiveFiles]=mcConst.containers.right,e.containers[mcConst.dataModels.Dialogs]=mcConst.containers.left,e.containers[mcConst.dataModels.MainMenu]=mcConst.containers.left,e.containers[mcConst.dataModels.ChatFrame]=mcConst.containers.center,e.containers[mcConst.dataModels.UserProfile]=mcConst.containers.center,e.containers[mcConst.dataModels.BBS]=mcConst.containers.center,e.containers[mcConst.dataModels.Kanban]=mcConst.containers.center,e.containers[mcConst.dataModels.ViewLogs]=mcConst.containers.center,e.containers[mcConst.dataModels.Settings]=mcConst.containers.center,b.data[mcConst.dataModels.CommonContacts]=mcService.Lang(10),b.data[mcConst.dataModels.PersonalContacts]=mcService.Lang(17),b.data[mcConst.dataModels.PrivateInfo]=mcService.Lang(46),b.data[mcConst.dataModels.ConfUserList]=mcService.Lang(26),b.data[mcConst.dataModels.CommonFiles]=mcService.Lang(567),b.data[mcConst.dataModels.HistoryDialogs]=mcService.Lang(578),b.data[mcConst.dataModels.ReceiveFiles]=mcService.Lang(588),b.onChange=e.changeTool}function c(n){if(n&&-1===[mcConst.dataModels.Settings,mcConst.dataModels.ViewLogs,mcConst.dataModels.BBS,mcConst.dataModels.UserProfile,mcConst.dataModels.Kanban].indexOf(n))switch(w){case mcConst.dataModels.CommonContacts:case mcConst.dataModels.PersonalContacts:case mcConst.dataModels.HistoryDialogs:switch(t.GetChatAlias()){case t.chatAliases.Conf:e.toolBtn[mcConst.dataModels.ConfUserList].show();break;case t.chatAliases.Privat:e.toolBtn[mcConst.dataModels.PrivateInfo].show()}break;default:var o=e.toolBtn[w];w&&o.show(),w&&o.getValue()!==y?o.callEvent("onItemClick"):s(w)}else s()}function l(n,o){n&&n!==g?(t.$broadcast("hide"+g),f=g,g=n,t.$broadcast("show"+n,[e.containers[n],o]),o&&"dUIN-0"===o||c(n)):!n&&f?(t.$broadcast("hide"+g),g=f,t.$broadcast("show"+f,[e.containers[f],o]),o&&"dUIN-0"===o||c(f)):n===mcConst.dataModels.UserProfile&&(g=n,t.$broadcast("show"+n,[e.containers[n],o]))}function d(t){e.rightSideResizer.getNode().className="webix_view webix_resizer_x noBorder noMargin "+t,e.rightSide.getNode().className="webix_view noMargin webix_layout_line "+t}function m(n){switch(n){case mcConst.dataModels.ReceiveFiles:e.toolBtn[n].isVisible()&&(e.toolBtn[n].setValue(!1),e.toolBtn[n].hide(),v===n&&(t.GetChatType()===t.chatAliases.UIN?e.changeTool(mcConst.dataModels.PrivateInfo):t.GetChatType()===t.chatAliases.UID?e.changeTool(mcConst.dataModels.ConfUserList):(e.rightSide.hide(),e.rightSideResizer.hide())))}}e.Name=mcConst.dataModels.ChatWrapper,e.toolBtn={},e.containers=mcConst.containers;var u=null,f=mcConst.dataModels.ChatFrame,g=mcConst.dataModels.ChatFrame,_="",p=1,h=!1,v=null,C=!1,S=0,b={data:{},currentTool:null,setValue:function(e,t){var n=this.currentTool;this.currentTool=this.data.hasOwnProperty(e)?e:null,this.currentTool&&this.onChange&&this.currentTool!==n&&!t&&this.onChange(this.currentTool,n)},getValue:function(){return this.currentTool},onChange:null},w=null,y=null,I=[mcConst.dataModels.CommonContacts,mcConst.dataModels.HistoryDialogs,mcConst.dataModels.PersonalContacts,mcConst.dataModels.PrivateInfo,mcConst.dataModels.ConfUserList,mcConst.dataModels.CommonFiles,mcConst.dataModels.ReceiveFiles];e.registerHotKeys=function(){t.hotKeyDispatcher.addPreset(e.Name,[{key:mcConst.keyCodes.esc,shiftKey:!0,func:function(){s(v,!0)}}],document)},e.removeHotKeys=function(){t.hotKeyDispatcher.removePreset(e.Name)},e.showMainMenu=function(){e.mainMenu.getValue()?(webix.html.addCss(e.mainMenu.getNode(),"darkenNavBG"),webix.html.removeCss(e.leftSideResizer.getNode(),"bgDarkness"),webix.html.addCss(e.leftSideResizer.getNode(),"darkenNavBG"),t.$broadcast("hide"+mcConst.dataModels.Dialogs),t.$broadcast("show"+mcConst.dataModels.MainMenu,[e.containers[mcConst.dataModels.MainMenu]]),_||-1!==[t.chatAliases.Conf,t.chatAliases.Privat].indexOf(t.GetChatAlias())||(w=null)):(webix.html.removeCss(e.mainMenu.getNode(),"darkenNavBG"),webix.html.addCss(e.leftSideResizer.getNode(),"bgDarkness"),webix.html.removeCss(e.leftSideResizer.getNode(),"darkenNavBG"),t.$broadcast("hide"+mcConst.dataModels.MainMenu),t.$broadcast("show"+mcConst.dataModels.Dialogs,[e.containers[mcConst.dataModels.Dialogs]]))},e.changeTool=function(o,s){var a=t.GetChatType();s=s||b.getValue(),v=o,"UIN-0"===t.GetChatTypeID()&&o===mcConst.dataModels.PrivateInfo&&i(),"UIN-0"===t.GetChatTypeID()&&o===mcConst.dataModels.PrivateInfo||o===mcConst.dataModels.ConfUserList&&a===t.chatAliases.UIN||o===mcConst.dataModels.PrivateInfo&&a===t.chatAliases.Conf?(b.setValue(s),e.changeToolBtn.apply(e.toolBtn[s])):(n(),b.setValue(o,!0),!h&&o&&(e.changeToolBtn.apply(e.toolBtn[o]),e.rightSide.show(),e.rightSideResizer.show()),i(o),o&&t.$broadcast("show"+o,[e.containers[o]])),e.rightSide.isVisible()&&(C=!1)},e.changeToolBtn=function(){I.forEach(function(t){e.toolBtn[t].setValue(!1)}),this&&this.setValue&&(this.setValue(!0),w=this.config.id.split("_")[1],y=this.getValue())},e.clickToolBtn=function(){var n=b.getValue();if(w=this.config.id.split("_")[1],y=this.getValue(),n!==w||y)h=!1,e.changeTool(w);else{if(isMobile)return!1;e.rightSide.hide(),e.rightSideResizer.hide(),t.$broadcast("hide"+n),h=!0}},e.scrollView=function(){t.$broadcast("blurChatTextOutput",[])},e.correctSwipe=function(e,t){if(e&&t){var n=t.x-e.x;n>100?p=0===p?0:p-1:n<-100&&(p=2===p?2:p+1),u.getActiveIndex()!==p&&u.setActiveIndex(p)}};var T=_messages_.chatWrapper={carouselChange:"carouselChange",showHideMenu:"showHideMenu",selectTool:"selectTool",changeCenterView:"changeCenterView",pinTool:"pinTool",unPinTool:"unPinTool",hideTool:"hideTool",hideAllTools:"hideAllTools",isVisibleRightSide:"isVisibleRightSide"};e.$on(T.hideAllTools,function(){I.forEach(function(t){e.toolBtn[t].getValue()&&e.toolBtn[t].callEvent("onItemClick")})}),e.$on(T.isVisibleRightSide,function(){return e.rightSide.isVisible()}),e.$on(T.hideTool,function(e,t){m.apply(null,t)}),e.$on(T.carouselChange,function(e,t){var n=t[0];u.setActive(n)}),e.$on(T.showHideMenu,function(){e.mainMenu.toggle()}),e.$on(T.selectTool,function(e,t){s.apply(null,t)}),e.$on(T.changeCenterView,function(e,t){l.apply(null,t)}),e.$on(T.pinTool,function(e,t){o.apply(null,t)}),e.$on(T.unPinTool,function(){n()}),e.$on("hide"+e.Name,function(){u.hide()}),e.$on("show"+e.Name,function(){e.wndSize=mcService.getWindowSize(),e.myName=mcConst.UserInfo.Nick,r(),u=initChatWrapper(e),t.$broadcast("show"+mcConst.dataModels.Dialogs,[e.containers[mcConst.dataModels.Dialogs]]),setTimeout(a,200),t.registerRightsCheck("_warpper",function(){e.toolBtn.CommonContacts[mcService.checkRights(mcConst._CMD_.RS.QShowCommonContactsList)?"show":"hide"](),e.toolBtn.PersonalContacts[mcService.checkRights(mcConst._CMD_.RS.QAllowContactsListsTotal)?"show":"hide"](),e.leftSide[mcService.checkRights(mcConst._CMD_.RS.QCommonAllowDialogs)?"show":"hide"](),e.leftSideResizer[mcService.checkRights(mcConst._CMD_.RS.QCommonAllowDialogs)?"show":"hide"]()}),e.registerHotKeys();var n=e.leftSide.getNode(),o=e.rightSide.getNode();n.ondragover=o.ondragover=n.ondrop=o.ondrop=e.centerBlock.ondragover=function(e){e.dataTransfer.files.length&&e.preventDefault()},e.centerBlock.ondrop=function(e){var n=e.dataTransfer;n.files.length&&(t.$broadcast(window._messages_.downloadUpload.on_file_drop,[n]),e.preventDefault())}}),t.$broadcast("windowResize",[function(t,n){u&&(isMobile?(e.wndSize.width=t,e.wndSize.height=n,u.define("height",n),u.define("width",t),e.leftSide.define("width",t),$$(e.containers.center).define("width",t),e.rightSide.define("width",t),e.leftSide.resize(),$$(e.containers.center).resize(),e.rightSide.resize(),u.resize()):a())}])}function mainController(e,t,n,o,i,s,a){function r(){f&&f.destructor(),f=webix.ui({view:"window",modal:!0,head:mcService.Lang(18),position:"center",width:220,height:mcConst.lockWindowHeight,body:{template:"<div align='center'><img src='"+mcConst.imagesPath.loading+"'></div>"}})}function c(n,o,i,s,a){e.errorMessagesIsShowed=!0,t.errorDialog=webix.alert({title:-1===n?"":mcService.Lang(11,n),ok:a||mcService.Lang(12),type:"alert-error",width:400,text:mcService.myReplace(o,i),callback:function(){s&&s(),t.lastError=n;var o=e.errorMessages.shift();void 0!==o&&setTimeout(function(){c.apply(null,o)},20),e.errorMessagesIsShowed=!1,t.errorDialog=null}})}function l(e,t){if(!mcService.isArray(t))throw new Error(mcService.myReplace(mcService.Lang(8),[e]));var o=t.shift();n[e][o]?n[e][o].apply(null,t):console.warn(mcService.myReplace(mcService.Lang(9),[e.toString(),o.toString()]))}function d(o,i){o[0]===mcConst.lockInterface&&(o.shift(),e.$emit(mcConst.lockInterface,[])),mcService.isFunction(o[o.length-1])&&(t.customCallBack[o[0]]||(t.customCallBack[o[0]]=[]),t.customCallBack[o[0]].push(o.pop())),i?n.internalSender(o):(a&&a.setValueByCMD.apply(null,o),n.MultiSender.apply(null,o)&&l("SendCMDToServer",o))}function m(e){a&&a.setValueByCMD.apply(null,e),n.MultiParser.apply(null,e)&&l("ProcessCMD",e)}var u=[];window.cLog&&cLog(mcConst._CMD_.ce_console_log,d);var f=null,g=null;if(e.lockCount=0,e.lockTimer=null,e.errorMessages=[],e.errorMessagesIsShowed=!1,window.McTextFinder&&McTextFinder(t),t.hotKeyDispatcher=new mcService.HotkeyManager,mcService._hotkeys=t.hotKeyDispatcher,t.acConfig={serversInfo:{}},t.restrictedSymbols='"/\\[]:;|=,+*?<>',t.thumbsSize=mcConst.imageSize.big,t.mcStorage=mcService.Marge({},mcConst.dataModels),t.customCallBack={},t.needFoto=!1,t.errorDialog=null,t.Purl=purl(),t.customUserOptions=null,t.chatAliases={Conf:mcConst.dataModels.ConfUserList,UIN:"UIN",UID:"UID",Forum:mcConst.dataModels.Forum,Privat:mcConst.dataModels.PrivateInfo,Kanban:mcConst.dataModels.Kanban,BBS:mcConst.dataModels.BBS},t.wndSize=mcService.getWindowSize(),t.isWebClient="file:"!==location.protocol,t.SendCMDToServer=d,t.ProcessCMD=m,!t.isWebClient)try{initClientData.apply(null,[e,t,d,a])}catch(e){}var _=null;t.setTool=function(e){_!==e&&(t.hidePrevTool(_),_=e)},t.getTool=function(){return _},t.hidePrevTool=function(){_&&t.$broadcast("hide"+_,[])};var p={},h={id:"-1",type:t.chatAliases.UIN,alias:mcConst.dataModels.PrivateInfo};t.GetChatID=function(){return h.id},t.GetChatType=function(){return h.type},t.GetChatAlias=function(){return h.alias},t.GetChatTypeID=function(){return h.type+"-"+h.id},t.createUIN=function(e){return t.chatAliases.UIN+"-"+e},t.createUID=function(e){return t.chatAliases.UID+"-"+e},t.SetPrivate=function(e){h={id:e,type:t.chatAliases.UIN,alias:mcConst.dataModels.PrivateInfo}},t.SetKanban=function(){h={id:"0",type:t.chatAliases.Kanban,alias:mcConst.dataModels.Kanban}},t.SetBBS=function(){h={id:"0",type:t.chatAliases.BBS,alias:mcConst.dataModels.BBS}},t.SetConf=function(e){h={id:e,type:t.chatAliases.UID,alias:mcConst.dataModels.ConfUserList}},t.checkAbilityByRights=function(e){if(e)p[e]?p[e]():console.error("Was't set rights check for the \""+e+'"');else for(var t in p)p[t]()},t.registerRightsCheck=function(e,t){p[e]=t},t.startUrlOptions=function(){var e=t.Purl.param("uin");e&&t.$broadcast("OpenPrivate",[e])},t.spellCheckManager=null,t.initSocketIo=function(){window.hasOwnProperty("io")&&mcService.isFunction(window.io)&&!mcConst.socketIO&&(mcConst.socketIO=io({reconnection:!0,reconnectionAttempts:5,timeout:1e4}),mcConst.initWS(mcConst.socketIO))},t.destroySocketIo=function(){mcConst.socketIO&&(mcConst.socketIO.disconnect(),mcConst.socketIO=null)},window._userActions={},window.moment=moment||{},window.isMobile=browserDetect.mobile,webix.Date.startOnMonday=!0,mcService.clearPlaneObj(t.mcStorage),mcConst.LoginInfo=mcService.LoadSessionSettings();var v=_messages_.main={SendCMDToServer:"SendCMDToServer",ProcessCMD:"ProcessCMD",StartPingTimer:"StartPingTimer",StopPingTimer:"StopPingTimer",ReconnectLoop:"ReconnectLoop",ChangLanguage:"ChangLanguage",ErrorMsg:"ErrorMsg",hideAllErrors:"hideAllErrors",windowResize:"windowResize",confirmExit:"confirmExit"};e.$on(v.confirmExit,function(e,t){var n=t[0];n&&webix.confirm({type:"confirm-error",text:mcLang(603),ok:mcLang(43),cancel:mcLang(44),callback:function(e){e&&n()}})}),e.$on(v.SendCMDToServer,function(e,t){d(t)}),e.$on(v.ProcessCMD,function(e,t){m(t)}),e.$on(v.StartPingTimer,function(){mcConst.PingTimer=new o(mcConst.PingInterval,mcConst.SessionID,{onError:function(){t.isWebClient?(mcConst.LoggedIn=!1,e.$emit("ErrorMsg",["223",mcConst.ErrorText[223],"",function(){location.search="",location.reload()}])):(t.restoreConnection=!1,t.$broadcast("ReconnectLoop"),t.$broadcast("ErrorMsg",["223",mcConst.ErrorText[223]+"<br>"+mcLang(539)+"<br><br>"+mcConst.loadGif,"",function(){mcService.ClearSessionSettings(!0,!0),location.search="",location.reload()},mcLang(540)]))},onStop:function(){mcConst.LoggedIn=!1,mcConst.PingTimer=null,mcConst.SessionID="",t.destroySocketIo(),t.isWebClient||t.$broadcast("disableGlobalHotKeys")}})}),e.$on(v.StopPingTimer,function(){mcConst.PingTimer&&(mcConst.LoggedIn&&a&&a.saveStat&&a.saveStat(mcConst.ServerInfo.ID,mcConst.UserInfo.UIN),mcConst.PingTimer.StopPingTimer(),mcConst.PingTimer=null)}),e.$on(v.ReconnectLoop,function(){mcConst.PingTimer||t.restoreConnection||!t.loginFormNotShowed||t.systemSuspened||(t.restoreConnection=!0,g||(g=setTimeout(function(){g=null,t.SetPrivate(-1),t.$broadcast(window._messages_.confUsers.clearUserForUID),t.$broadcast(window._messages_.dialogsList.clearConfOnReconnect),t.$broadcast("SendCMDToServer",[mcConst.lockInterface,mcConst._CMD_.Login,mcConst.LoginInfo.login,mcConst.LoginInfo.pwd,mcConst.LoginInfo.servPwd,mcConst.LoginInfo.rm])},!t.isWebClient&&mcConst.ClientSettings.NetworkReconnectTime?1e3*mcConst.ClientSettings.NetworkReconnectTime:mcConst.reconnectTime)))}),e.$on(v.ChangLanguage,function(n,o){(function(n,o){setLocalizations(),"ua"===(o=s.param("lang")||o).toLowerCase()&&(o="uk"),moment.locale(o),mcConst.Lang=o,webix.Date.startOnMonday="en"!==mcConst.Lang,webix.skin.set("material"),webix.skin.material.optionHeight=30,i(MC_RESOURCE.TextSource.smileys+"smileys.json").success(function(e){mcConst.SmileysSet=mcService.isObject(e)?e:JSON.parse(e)}),i(MC_RESOURCE.TextSource.languages+o+".languages.json").success(function(e){mcConst.LanguagesList=mcService.isObject(e)?e:JSON.parse(e)}),i(MC_RESOURCE.TextSource.errors.client+o+".errors.json").success(function(e){mcConst.ErrorText=mcService.isObject(e)?e:JSON.parse(e)}),i(MC_RESOURCE.TextSource.www.admin+o+".json").success(function(e){mcConst.LMSG_admin=mcService.isObject(e)?e:JSON.parse(e)}),i(MC_RESOURCE.TextSource.www.chat+o+".json").success(function(n){mcConst.LMSG=mcService.isObject(n)?n:JSON.parse(n),t.isWebClient?e.$broadcast("show"+mcConst.dataModels.Login,[o]):e.prepareActions(o),r(),mcService.CheckNotification(),webix.i18n.setLocale(o)}),window.McSpellChecker&&(t.spellCheckManager=new McSpellChecker)}).apply(null,o)}),e.$on(mcConst.lockInterface,function(){0===e.lockCount&&(e.lockTimer=setTimeout(function(){f.show(),mcService.getElementByClass("webix_modal")[0].className+=" noLockScreen"},100)),e.lockCount++}),e.$on("hide"+mcConst.lockInterface,function(t,n){"all"==n[0]&&(e.lockCount=0),e.lockCount>0&&e.lockCount--,0!==e.lockCount&&mcConst.PingTimer||(clearTimeout(e.lockTimer),f.hide())}),e.$on(v.ErrorMsg,function(t,n){e.errorMessagesIsShowed?e.errorMessages.length&&e.errorMessages[e.errorMessages.length-1][0]!==n[0]&&e.errorMessages.push(n):c.apply(null,n)}),e.$on(v.hideAllErrors,function(){e.errorMessagesIsShowed=[],t.errorDialog&&webix.modalbox.hide(t.errorDialog),t.errorDialog=null,e.errorMessagesIsShowed=!1}),e.$on(v.windowResize,function(e,t){mcService.isFunction(t[0])&&u.push(t[0])}),e.$emit(v.ChangLanguage,mcService.detectLang(webix.storage.local.get(mcConst.storageFields.lang))),webix.rules.isNotEmpty=function(e){return""!=mcService.trim(e)},webix.rules.registerLogin=function(e){var n=!1,o=mcService.trim(e);if(""!==o)for(var i=0;i<o.length;i++){if(-1!==t.restrictedSymbols.indexOf(o[i])){n=!1;break}n=!0}return n},webix.rules.isNumber=function(e){return/^\d+$/gi.test(e)},webix.protoUI({name:"activeList"},webix.ui.unitlist,webix.ActiveContent),webix.protoUI({name:"moveTemplate"},webix.ui.view,webix.Movable,webix.EventSystem),webix.protoUI({name:"suggest",defaults:{filter:function(e,t){return-1!==e.value.toString().toLowerCase().indexOf(t.toLowerCase())}}},webix.ui.suggest),webix.ready(function(){!webix.env.touch&&webix.ui.scrollSize&&webix.CustomScroll.init()}),window.onbeforeunload=function(){if(t.isWebClient){if(mcConst.LoggedIn)return mcService.Lang(40)}else d([mcConst._CMD_.cs_quit,mcConst.SessionID])},window.onunload=function(){mcConst.LoggedIn&&d([mcConst._CMD_.cs_quit,mcConst.SessionID])},mcService.addEvent(window,"resize",function(){t.wndSize=mcService.getWindowSize();for(var e=0;e<u.length;e++)u[e](t.wndSize.width,t.wndSize.height)})}!function(e){var t={};if("object"==typeof exports)if("function"==typeof require){var n=require("./ecmd").ECMD;t=e(),Object.keys(n).forEach(function(e){t[e]=n[e]}),exports.CMD=t}else exports.CMD=e();else t=e(),window&&window.mcConst&&window.mcConst._CMD_&&Object.keys(t).forEach(function(e){window.mcConst._CMD_[e]=t[e]}),window.getCMD=function(){return window.hasOwnProperty("_ECMD_")&&Object.keys(window._ECMD_).forEach(function(e){t[e]=window._ECMD_[e]}),t}}(function(){"use strict";return{Login:"login",Register:"register",Reminde:"reminde",OK:"OK",Ping:"ping",History:"history",NewFoto:"newfoto",Logs:"logs",StopLogs:"stopLogs",Blocked:"blocked",cLog:"cLog",sc_drop_connect:"9999",cs_hello:"0001",cs_login:"0003",cs_register_new_user:"0004",cs_domain_login:"0005",cs_restore_account:"0006",cs_work_time_upload_old_data:"0007",cs_restore_connect_to_channels:"0008",cs_get_bbs:"0009",cs_get_adv_new_data:"000A",cs_special_ping:"000B",cs_ping:"000B",cs_get_channels_list:"000D",cs_get_actions_list:"000E",cs_work_time_control_active_caption:"000F",cs_get_small_user_info:"0010",cs_private_request:"0011",cs_get_hello_msg:"0012",cs_pong:"0013",cs_get_contacts_list:"0014",cs_get_common_contacts_list:"0015",cs_put_msg2txt_channel:"0016",cs_private_msg:"0017",cs_join_txt_channel:"0018",cs_leave_txt_channel:"0019",cs_add_new_bbs:"001A",cs_create_txt_channel:"001D",cs_get_uin_info:"001E",cs_get_uin_foto:"001F",cs_get_remote_uin_current_time:"0020",cs_send_my_current_time:"0021",cs_get_user_computer_info:"0022",cs_get_active_window_caption:"0023",cs_active_window_caption:"0024",cs_get_ignores_list:"0025",cs_update_ignores_list:"0026",cs_get_favorite_channels:"0027",cs_add_favorite_channel:"0028",cs_delete_favorite_channel:"0029",cs_get_msgtemplates:"002A",cs_update_msgtemplates:"002B",cs_set_account_password:"002C",cs_add_personal_contact_group:"001B",cs_delete_id_from_personal_contacts:"001C",cs_add_new_contact:"002D",cs_rename_contacts_group:"002F",cs_move_personal_contact:"0030",cs_open_remote_computer_shares:"0031",cs_forcibly_join_to_text_channel:"0032",cs_change_txtch_topic:"0033",cs_get_public_ftp_info:"0034",cs_get_channel_history_messages:"0035",cs_rename_text_channel:"0036",cs_ignore_get:"0037",cs_add_ignore:"0038",cs_clear_text_channel:"0039",cs_personal_message2txtch:"003A",cs_block_mac_by_uin:"003B",cs_block_ip_by_uin:"003C",cs_kill_user:"003D",cs_kick_from_txt_channel:"003E",cs_private_beep:"003F",cs_get_server_uptime:"0040",cs_get_server_version:"0041",cs_halt_user:"0042",cs_set_state:"0043",cs_typing_notify:"0044",cs_get_user_state:"0045",cs_set_uin_foto:"0046",cs_quit:"0047",cs_files_offline_ok:"0048",cs_files_offline_late:"0049",cs_files_offline_delete:"004A",cs_get_user_quick_info:"004B",cs_raw_data:"004C",cs_raw_data_txt_channel:"004D",cs_action:"004E",cs_stat:"0058",cs_fatal_error_info:"0054",cs_files_request_transfer:"004F",cs_files_transfer_deny:"0050",cs_files_transfer_accept:"0051",cs_files_transfer_abort:"0052",cs_files_internal_send_idx:"0053",cs_files_transfer_request_abort:"0055",cs_files_internal_sended_ok_idx:"0056",cs_files_transfer_progress:"0061",cs_files_success_recieved:"0062",cs_files_request_timeout:"0057",cs_get_users_list:"0059",cs_set_uin_info:"0068",cs_find_users:"0060",cs_get_private_info:"0078",cs_send_messages_buffer:"0079",cs_media_call:"007A",cs_media_call_accept:"007B",cs_media_call_reject:"007C",cs_media_call_close:"0080",cs_media_call_error:"0081",cs_media_call_busy:"008E",cs_web_get_user_foto_file:"007D",cs_web_support_i_am_busy:"0094",cs_adm_list_users:"0086",cs_adm_get_server_info:"0090",cs_adm_get_user_profile:"0091",cs_adm_list_roles:"008B",cs_adm_set_user_password:"0097",cs_adm_create_user:"0096",cs_adm_remove_user:"0095",cs_adm_modify_user_profile:"0098",cs_adm_clear_user_foto:"0099",cs_adm_get_server_options:"009A",cs_adm_get_server_net_interfaces:"009C",cs_adm_get_user_info_by_preset:"009D",cs_adm_set_server_options:"009B",cs_adm_remove_all_logs:"009E",cs_adm_make_backup_server_db:"009F",cs_adm_set_user_foto:"00A0",cs_adm_get_job_positions_list:"0093",cs_adm_job_positions_del:"00A4",cs_adm_job_positions_add:"00A3",cs_adm_job_positions_set_sequence:"00A2",cs_adm_job_positions_modify:"00A5",cs_adm_role_add:"00A6",cs_adm_role_delete:"00A7",cs_adm_role_modify:"00A8",cs_adm_role_set_rights:"00A9",cs_adm_role_users_list:"00AA",cs_adm_role_apply_to_users:"00AB",cs_adm_check_smtp:"00AD",cs_adm_enter_mychat_reg_data:"00AE",cs_adm_enter_mychat_guest_reg_data:"00AF",cs_adm_get_websupport_groups:"00B0",cs_adm_add_user_to_websupport_group:"00B1",cs_adm_delete_user_from_websupport:"00B2",cs_adm_add_websupport_group:"00B3",cs_adm_delete_websupport_group:"00B4",cs_adm_rename_websupport_group:"00B5",cs_adm_get_websupport_group_users:"00B6",cs_adm_get_custom_options:"00B7",cs_adm_get_total_contacts_list:"00B8",cs_adm_tcl_add_group:"00B9",cs_adm_tcl_del_ids_list:"00BA",cs_adm_tcl_add_users_list_to_group:"00E3",cs_adm_tcl_move_users_and_groups:"00E4",cs_adm_tcl_rename_group:"00E5",cs_adm_import_users:"00BB",cs_adm_return_server_to_zero_state:"00BD",cs_adm_set_custom_options:"00BC",cs_adm_get_licenses:"00BE",cs_adm_get_antiflood_filter_data:"00BF",cs_adm_set_antiflood_filter_data:"00C0",cs_adm_modify_flood_except_users:"00C1",cs_adm_get_flood_except_users_list:"00C2",cs_adm_get_allow_ip_list:"00C3",cs_adm_add_new_ip_to_allow_list:"00C4",cs_adm_delete_allow_ip:"00C5",cs_adm_clear_allow_ip_list:"00C6",cs_adm_get_blocked_ip_list:"00C7",cs_adm_add_ip_to_block_list:"00C8",cs_adm_delete_blocked_ip:"00C9",cs_adm_clear_blocked_ip_list:"00CA",cs_adm_get_blocked_mac_list:"00CB",cs_adm_delete_blocked_mac:"00CC",cs_adm_add_mac_to_block_list:"00CD",cs_adm_clear_blocked_mac_list:"00CE",cs_adm_get_deny_nicks_list:"00CF",cs_adm_add_deny_nick:"00D0",cs_adm_delete_deny_nick:"00D1",cs_adm_clear_deny_nicks_list:"00D2",cs_adm_get_deny_conf_list:"00D3",cs_adm_add_deny_conf:"00D4",cs_adm_delete_deny_conf:"00D5",cs_adm_clear_deny_conf_list:"00D6",cs_adm_get_bad_words_filters_data:"00D7",cs_adm_set_bad_words_filter_data:"00D8",cs_adm_get_bad_words_list:"00D9",cs_adm_add_bad_word_to_filters:"00DA",cs_adm_del_bad_word_from_filters:"00DB",cs_adm_clear_bad_words_list:"00DC",cs_adm_load_badwords_except_confs:"00DD",cs_adm_add_badwords_except_conf:"00DE",cs_adm_del_badwords_except_conf:"00DF",cs_adm_clear_badwords_except_confs:"00E0",cs_adm_export_users_to_csv:"00E1",cs_adm_multiply_modify_users:"00E2",cs_get_online_users_states:"00E6",cs_get_depts_list:"00E7",cs_adm_get_all_text_confs:"00E8",cs_adm_force_update_global_contacts:"00E9",cs_adm_get_bans_list:"00EA",cs_adm_del_bans:"00EB",cs_adm_get_moderators:"00EC",cs_adm_get_conf_names_by_uid_list:"00ED",cs_adm_delete_moderators:"00EE",cs_adm_add_moderator:"00EF",cs_adm_del_moderator_confs:"00F0",cs_get_random_uin:"00F3",cs_set_custom_ignore:"00F4",cs_del_custom_ignore:"00F5",cs_adm_get_auto_conf_list:"00F6",cs_adm_del_auto_conf:"00F7",cs_adm_add_auto_conf:"00F8",cs_adm_update_auto_conf:"00F9",cs_adm_add_group_to_auto_conf:"00FA",cs_adm_del_group_from_auto_conf:"00FB",cs_adm_get_bbs_msg_list:"00FC",cs_adm_bbs_clear_actual:"00FD",cs_adm_bbs_get_msg:"00FE",cs_adm_bbs_modify_msg:"00FF",cs_adm_bbs_del_messages:"0100",cs_adm_add_bbs_message:"0101",cs_adm_save_ad_options:"0102",cs_adm_get_ad_options:"0103",cs_adm_import_ad_users:"0104",cs_adm_get_update_packet_data:"0105",cs_adm_upload_update_packet:"0106",cs_adm_get_online_users_list:"0107",cs_adm_kill_users:"0108",cs_adm_halt_users:"0109",cs_adm_get_ad_users_list:"010A",cs_sync_private_history_last:"010B",cs_sync_private_history:"010C",cs_adm_get_script:"010D",cs_adm_get_script_event_states:"010E",cs_adm_script_check_syntax:"010F",cs_adm_script_onoff:"0110",cs_adm_script_run:"0111",cs_adm_script_delete:"0112",cs_adm_script_save:"0113",cs_adm_script_create:"0114",cs_adm_restart_server_services:"0115",cs_adm_get_active_conf_list:"011B",cs_adm_kill_txt_conf:"011C",cs_adm_get_users_in_conf:"011D",cs_adm_kick_users_from_conf:"011E",cs_info:"077C",cs_adm_remove_conversations:"0183",cs_kanban_get_projects_list:"0117",cs_kanban_get_stages_list:"0118",cs_kanban_get_tasks_list:"0119",cs_kanban_get_tags_list:"011A",cs_kanban_add_project:"0120",cs_kanban_add_stage:"0121",cs_kanban_delete_stage:"0122",cs_kanban_modify_stage:"0123",cs_kanban_add_task:"013B",cs_kanban_task_move:"013C",cs_kanban_task_remove:"013D",cs_kanban_task_edit:"013E",cs_kanban_add_comment:"013F",cs_kanban_get_comments:"0140",cs_kanban_delete_comment:"0141",cs_kanban_close_project:"0142",cs_kanban_reopen_project:"0143",cs_kanban_delete_project:"0144",cs_kanban_edit_project:"0145",cs_kanban_get_personal_options:"0149",cs_kanban_save_personal_options:"014A",cs_kanban_get_project_rights:"014B",cs_kanban_get_project_info:"014C",cs_kanban_get_task_info:"014D",cs_kanban_get_last_performers:"0153",cs_kanban_get_project_tags_list:"0168",cs_kanban_get_dashboard:"0169",cs_get_personal_options:"0149",cs_save_personal_options:"014A",cs_browser_info:"0124",cs_media_offer:"0125",cs_media_answer:"0126",cs_media_ice_candidate:"0127",cs_media_change_settings:"0128",cs_media_ready:"0129",cs_media_exit_from_mid:"012A",cs_import_personal_contacts:"012B",cs_adm_get_client_options_presets:"012C",cs_adm_del_client_options_preset:"012D",cs_adm_create_client_options_preset:"012E",cs_adm_update_client_options_preset:"012F",cs_adm_apply_roles_to_options_presets:"0131",cs_adm_add_new_user_group:"0132",cs_adm_get_user_groups:"0133",cs_adm_get_group_users_list:"0134",cs_adm_add_users_to_group:"0135",cs_adm_remove_users_from_group:"0136",cs_adm_rename_group_of_users:"0137",cs_adm_delete_groups_list:"0138",cs_adm_set_integration_tools_options:"0139",cs_adm_get_integration_tool_options:"013A",cs_adm_get_check_domains_list:"0146",cs_adm_add_check_domain:"0147",cs_adm_delete_check_domain:"0148",cs_adm_get_allowed_and_blocked_plugins:"014E",cs_adm_add_allowed_or_blocked_plugins:"014F",cs_adm_delete_allowed_or_blocked_plugin:"0150",cs_adm_change_mychat_server:"0151",cs_adm_get_script_info:"0152",cs_forum_get_structure:"0156",cs_forum_create_section:"0157",cs_forum_delete_section:"0158",cs_forum_change_section:"0159",cs_forum_create_topic:"015A",cs_forum_change_topic:"015B",cs_forum_create_post:"015C",cs_forum_delete_post:"015D",cs_forum_delete_topic:"015E",cs_forum_change_post:"015F",cs_forum_get_topic_posts:"0160",cs_forum_get_section_info:"0161",cs_get_book:"0164",cs_is_file_exists:"0165",cs_get_image_thumbs:"0166",cs_create_token:"0154",cs_login_by_token:"0155",cs_get_removed_user_info:"016F",cs_adm_get_integration_telegram_users:"016B",cs_adm_integration_telegram_delete_user:"016C",cs_adm_integration_telegram_modify_user:"016D",cs_adm_integration_telegram_clear_users_list:"016E",cs_integration_icq_set_account:"0170",cs_integration_icq_send_message:"0171",cs_adm_delete_conf_message:"0172",cs_adm_get_history_info_private:"0173",cs_adm_get_history_private:"0174",cs_adm_get_history_info_conf:"0175",cs_adm_get_history_conf:"0176",cs_adm_get_history_private_user_pairs:"0177",cs_adm_check_ports:"017A",cs_moder_delete_conf_message:"017B",cs_adm_reconnect_users2autoconf:"017D",cs_adm_get_blocked_hwid_list:"017E",cs_adm_delete_blocked_hwid:"017F",cs_adm_clear_blocked_hwid_list:"0180",cs_adm_add_hwid_to_block_list:"0181",cs_adm_get_system_logs:"0182",cs_get_options_preset:"0130",cs_broadcast_readed_notify:"005E",cs_broadcast_just_readed:"005F",cs_adm_modify_check_domain:"0185",cs_adm_get_domains_list:"0186",cs_adm_forum_get_subs_groups:"0187",cs_adm_forum_add_subs_group:"0188",cs_adm_forum_delete_subs_group:"0189",cs_adm_forum_clear_subs:"018A",cs_adm_forum_add_subs_user:"018B",cs_adm_forum_delete_subs_user:"018C",cs_adm_forum_get_subs_users:"018D",cs_sync_conf_history:"0179",cs_get_forum_subs:"018E",cs_forum_toggle_subs:"018F",cs_set_custom_options:"0190",cs_get_custom_options:"0191",cs_adm_integration_quiz_check_question:"0193",cs_adm_integration_quiz_add_question:"0194",cs_adm_integration_quiz_del_question:"0195",cs_adm_integration_quiz_modify_question:"0196",cs_adm_integration_quiz_get_stat:"0197",cs_adm_integration_quiz_clear_stat:"0198",cs_adm_enter_quiz_reg_data:"0199",cs_users_live_search:"019A",cs_get_private_dialogs:"019B",cs_del_private_dialog:"019C",cs_private_msg_read:"019D",cs_private_msg_got:"019E",cs_private_get_dialog_msg_states:"019F",cs_adm_delete_private_message:"01A0",cs_delete_private_message:"01A1",cs_redirect_private_talk:"01A2",cs_get_users_for_redirect_dialog:"01A3",adm_ldap_get_user_list:"ldap_get_user_list",adm_ldap_get_user_info:"ldap_get_user_info",adm_ldap_user_list:"ldap_user_list",adm_ldap_user_info:"ldap_user_info",sc_hello:"8000",sc_error:"8001",sc_accept_connection:"8002",sc_free_edition:"8003",sc_get_all_rights:"8004",sc_login:"8005",sc_remote_set_options_file:"8007",sc_get_channels_list:"8008",sc_bbs_changed:"8009",sc_offline_private:"800A",sc_private:"800B",sc_get_small_user_info:"800C",sc_show_advert_block:"800D",sc_hide_advert_block:"800E",sc_pong:"800F",sc_actions_list:"8010",sc_files_offline_exists:"8011",sc_grant_private_access:"8012",sc_join_txt_channel:"8013",sc_txt_channel_hello_msg:"8014",sc_txt_channel_give_grant:"8015",sc_ulist_in_txt_ch:"8016",sc_join_newbie_txt_channel:"8017",sc_join_newbies_txt_channel:"8073",sc_online_notify:"8018",sc_broadcast:"8019",sc_user_online:"801A",sc_trial:"801B",sc_remote_set_options:"801C",sc_get_msgtemplates:"801D",sc_get_contacts_list:"801E",sc_get_common_contacts_list:"801F",sc_ping:"2080",sc_ignore:"8021",sc_user_state:"8022",sc_leave_txt_channel:"8023",sc_kill_txt_ch:"8024",sc_bbs_body:"8025",sc_add_personal_contact_group:"8026",sc_delete_personal_contact_group:"8027",sc_txt_channel_created:"8028",sc_get_uin_info:"8029",sc_get_remote_uin_current_time:"802A",sc_user_current_time:"802B",sc_user_foto:"802C",sc_user_computer_info:"802D",sc_get_active_window_caption:"802E",sc_user_active_window_caption:"802F",sc_ignores_list:"8030",sc_favorite_channels_list:"8031",sc_change_password:"8032",sc_add_new_contact:"8033",sc_delete_contact:"8034",sc_rename_contacts_group:"8035",sc_move_personal_contact:"8036",sc_open_remote_computer_shares:"8037",sc_txtch_topic_changed:"8038",sc_public_ftp_info:"8039",sc_channel_history_messages:"803A",sc_rename_text_channel:"803B",sc_user_ignore_info:"803C",sc_clear_text_channel:"803D",sc_personal_message2txtch:"803E",sc_kick_from_txt_channel:"803F",sc_private_beep:"8040",sc_server_uptime:"8041",sc_server_version:"8042",sc_user_offline:"8043",sc_halt:"8044",sc_typing_notify:"8045",sc_update_user_data:"8046",sc_change_server:"8047",sc_user_quick_info:"8048",sc_raw_data:"8049",sc_raw_data_txt_channel:"804A",sc_files_offline_send_accept:"804B",sc_files_request_transfer:"804C",sc_files_transfer_deny:"804D",sc_files_transfer_accept:"804E",sc_files_transfer_abort:"804F",sc_file_internal_send_idx:"8050",sc_files_transfer_request_abort:"8051",sc_file_internal_sended_ok_idx:"8052",sc_files_request_timeout:"8053",sc_files_transfer_progress:"8059",sc_files_success_recieved:"805B",sc_registered:"805E",sc_find_users_list:"8058",sc_users_list:"8055",sc_serv_stat:"8054",sc_private_info:"806F",sc_media_call:"8070",sc_media_call_accept:"8071",sc_media_call_reject:"8072",sc_media_call_close:"8075",sc_media_call_error:"8076",sc_media_call_busy:"8081",sc_media_incoming_call_missed:"80D7",sc_media_offer:"80D2",sc_media_answer:"80D3",sc_media_ice_candidate:"80D4",sc_media_change_settings:"80D5",sc_media_ready:"80D6",sc_web_user_foto_file:"8074",sc_web_support_i_am_busy:"8087",sc_adm_set_topic:"8079",sc_adm_list_channels:"807A",sc_adm_list_users:"807B",sc_adm_get_server_info:"8083",sc_adm_get_user_profile:"8084",sc_adm_list_roles:"807F",sc_adm_user_created:"8088",sc_adm_get_job_positions_list:"8086",sc_adm_server_options:"8089",sc_adm_server_net_interfaces:"808A",sc_adm_user_info_by_preset:"808B",sc_adm_command_complete:"808C",sc_adm_job_positions_added:"808E",sc_adm_job_positions_modified:"808F",sc_adm_role_added:"8090",sc_adm_role_modified:"8091",sc_adm_role_users_list:"8092",sc_adm_smtp_checked:"8093",sc_invite_to_webchat_sended_ok:"8094",sc_adm_websupport_groups:"8095",sc_adm_websupport_group_added:"8096",sc_adm_websupport_group_users:"8097",sc_adm_websupport_group_renamed:"8098",sc_adm_custom_options:"8099",sc_adm_total_contacts_list:"809A",sc_adm_tcl_group_added:"809B",sc_adm_tcl_users_added:"80A9",sc_adm_users_imported:"809C",sc_adm_server_licenses:"809D",sc_adm_antiflood_filter_data:"809E",sc_adm_flood_except_users_list:"809F",sc_adm_allow_ip_list:"80A0",sc_adm_blocked_ip_list:"80A1",sc_adm_blocked_mac_list:"80A2",sc_adm_blocked_nicks_list:"80A3",sc_adm_blocked_confs_list:"80A4",sc_adm_bad_words_filter_data:"80A5",sc_adm_bad_words_list:"80A6",sc_adm_bad_words_except_confs:"80A7",sc_adm_export_users_to_csv_file:"80A8",sc_online_users_states:"80AA",sc_dept_list:"80AB",sc_caches:"80AC",sc_adm_all_text_confs:"80AD",sc_just_connect_disconnect_users:"80AE",sc_adm_bans_list:"80AF",sc_adm_moderators_list:"80B0",sc_adm_conf_names_list_by_uid:"80B1",sc_put_msg2txt_channel:"80B4",sc_adm_auto_conf_list:"80B5",sc_adm_auto_conf_created:"80B6",sc_txtch_update_modes:"80B7",sc_adm_bbs_msg_list:"80B9",sc_adm_bbs_msg_data:"80BA",sc_adm_ad_users_imported:"80BB",sc_adm_ad_options:"80BC",sc_adm_update_packet_data:"80BD",sc_adm_online_users_list:"80BE",sc_adm_ad_users_list:"80BF",sc_sync_private_history:"80C0",sc_adm_script_data:"80C1",sc_adm_all_script_states:"80C2",sc_adm_script_checked:"80C3",sc_adm_script_executed:"80C4",sc_adm_script_created:"80C5",sc_adm_script_deleted:"80C6",sc_adm_script_saved:"80C7",sc_adm_script_log:"80C8",sc_adm_active_conf_list:"80CC",sc_adm_conf_users_list:"80CD",sc_kanban_projects_list:"80C9",sc_kanban_stages_list:"80CA",sc_kanban_tags_list:"80CB",sc_kanban_tasks_list:"80CE",sc_kanban_project_created:"80D0",sc_kanban_stage_created:"80D1",sc_kanban_task_created:"80E1",sc_kanban_task_comment_added:"80E2",sc_kanban_task_comments_list:"80E3",sc_kanban_personal_options_list:"80E5",sc_kanban_event:"80E6",sc_kanban_project_info:"80E7",sc_kanban_task_info:"80E8",sc_kanban_last_performers_list:"80EB",sc_kanban_project_tags_list:"80FE",sc_kanban_dashboard:"80FF",sc_personal_options_list:"80E5",sc_apply_client_settings:"80DB",sc_adm_client_options_presets_list:"80D8",sc_adm_client_options_preset_created:"80D9",sc_adm_client_options_preset_updated:"80DA",sc_adm_new_user_group_created:"80DD",sc_adm_users_groups_list:"80DE",sc_adm_group_users_list:"80DF",sc_adm_integration_tool_options:"80E0",sc_adm_get_check_domains_list:"80E4",sc_adm_allowed_and_blocked_plugins:"80E9",sc_adm_script_info:"80EA",sc_forum_structure:"80EF",sc_forum_section_or_topic_created:"80F0",sc_forum_post_created:"80F2",sc_forum_section_or_topic_changed:"80F3",sc_forum_section_or_topic_or_post_deleted:"80F4",sc_forum_post_changed:"80F5",sc_forum_topic_posts:"80F6",sc_forum_section_info:"80F7",sc_broadcast_sent_ok:"8100",sc_private_tech_message:"80EE",sc_command_complete:"80F1",sc_book_data:"80FB",sc_file_exists:"80FC",sc_image_thumbs:"80FD",sc_token_created:"80ED",sc_adm_backup_server_db_ok:"8101",sc_hide_text_conf:"8102",sc_adm_integration_telegram_users_list:"8103",sc_adm_integration_telegram_user_added:"8104",sc_removed_user_info:"8105",sc_login_finish:"8106",sc_adm_history_info_private:"8107",sc_adm_history_private:"8108",sc_adm_history_info_conf:"8109",sc_adm_history_conf:"810A",sc_adm_history_private_user_pairs:"810B",sc_sync_conf_history:"810D",sc_info:"810E",sc_adm_clear_console:"810F",sc_adm_blocked_hwid_list:"8110",sc_adm_system_logs:"8111",sc_web_services_info:"8114",sc_server_ports:"8115",sc_adm_domains_list:"8116",sc_adm_forum_subs_groups_list:"8117",sc_adm_forum_subs_users_list:"8118",sc_forum_subs:"8119",sc_custom_options:"811A",sc_adm_integration_quiz_check_question:"811B",sc_adm_integration_quiz_question_added:"811C",sc_adm_integration_quiz_stat:"811D",sc_exec_func_result:"811E",sc_users_live_search:"811F",sc_private_dialogs:"8120",sc_del_private_dialog:"8121",sc_private_read:"8122",sc_private_read_notify:"8123",sc_private_got:"8124",sc_private_got_notify:"8125",sc_private_dialog_msg_states:"8126",sc_private_redirect_complete:"8127",sc_users_list_for_redirect_dialog:"8128",sn_config:"1",sn_start:"2",sn_stop:"3",sn_quit:"4",sn_invite:"5",sn_iApi:"6",sn_ip_filter:"7",sn_iApi_key:"8",sn_https_error:"9",sn_rest_request:"10",sn_icq_connect:"11",sn_icq_send_message:"12",sn_info:"14",sn_path_info:"15",sn_operators:"16",ns_started:"1001",ns_stopped:"1002",ns_bye:"1003",ns_check_invite:"1004",ns_invite_sent:"1005",ns_integrationAPI:"1006",ns_ip_filter:"1007",ns_iApi_key:"1008",ns_https_error:"1009",ns_rest_request:"1010",ns_icq_connected:"1011",ns_icq_contact_list:"1012",ns_icq_send_message:"1013",ns_get_by_groups:"1015",ns_get_by_uins:"1016",ClientType:{WIN32:"win32",FTP:"ftp",WEB_ADMIN:"admin",WEB_KANBAN:"kanban",WEB_CHAT:"web",WEB_SUPPORT:"websupport",COMMON:"common",INTEGRATION_API:"integrationapi",WEB_FORUM:"forum",WIN32_NEXT:"win32next",MACOS:"macos",ANDROID:"android",LINUX:"linux",GUEST:"mcguest",ALL:"any",UNKNOWN:"unknown"},PrivateTask:{DEFAULT:0,SEND_FILES:1,SEND_FILES_FROM_EXPLORER:2,VOICE_CALL:3,VIDEO_CALL:4,MY_SCREEN_SHARING:5},serverLogLevel:{NOTHING:0,SERVER_ERRORS:10,NETWORK_ERRORS:20,SERVER_INFO:30,CONNECTIONS:800,NETWORK:900,VERBOSE:1e3},serverLogEvents:{MYCHAT_TRAFFIC_IN:1,MYCHAT_TRAFFIC_OUT:2,ALL_INPUT_TRAFFIC:3},RS:{QLogin:1,QBBSPost:2,QBBSView:3,QTxtChCreate:4,QTxtChSay:5,QTxtChJoin:6,QPrivateOpen:7,QPrivatesGetMessages:8,QUserDetailsChange:9,QFilesSend:10,QFilesReceive:11,QOperatorBan:12,QOperatorTurnOutFromChannel:13,QKill:14,QBlockIP:15,QBlockMAC:16,QOperatorTxtChTopicSet:17,QFTPPublic:18,QFTPPersonal:19,QRemoteAdm:20,QOperatorClearChannelText:21,QContactsListChange:22,QBroadcasts:23,QAllowPersonalMsg:24,QAllowAlertMsg:25,QAllowSysInfoView:26,QSendImages:27,QAllowIgnores:28,QAllowInvites:29,QImagesPrivates:30,QShowCommonContactsList:31,QHalt:32,QTxtChRename:33,QTxtChDelete:34,QForciblyInvites:35,QBlockUIN:36,QAllowPlugins:37,QAllowOptionsChange:38,QAllowMyFavoriteChannels:39,QAllowCloseProgram:40,QAllowContactsListsTotal:41,QAllowAccountsManager:42,QWEBAllowViewLogsSelfPrivates:43,QWEBAllowViewLogsAllChannels:44,QWEBAllowViewLogsAllPrivates:45,QAllowFindUsersTool:46,QAllowActions:47,QAllowClientLogPrivatesAndChannels:48,QMessengerStyle:49,QAllowOpenComputer:50,QExceptionAllowRecievePrivates:51,QAllowViewRemoteUserMACAddress:52,QAllowViewRemoteUserActiveProcess:53,QWEBAllowViewFTPLog:54,QWEBAllowViewSystemLog:55,QEnableTaskWorkersJobTimeControlSystem:56,QWEBSupportAllowAccess:57,QWEBAllowAdmin:58,QAllowProgramBlockTool:59,QAllowNetworkStatusChange:60,QEnableAllowedClientsPluginsList:61,QEnableBlockedCLientsPluginsList:62,QEnablePluginsManagement:63,QAllowImagesInBroadcasts:64,QEnableFontLayoutsInMessages:65,QAllowCreateHiddenChannels:66,QEnableTransferFilesOnlyViaServer:67,QEnableImmunityFromBans:68,QEnableAdvertBlock:69,QBlockPrivatesExceptPersonalContacts:70,QBlockPrivatesExceptCommonContacts:71,QEnableImmunityFromIgnores:72,QIntegrationAPIEnableSendMsgFromAnyUser:73,QEnableVoiceCalls:74,QEnableVideoCalls:75,QAllowGetVoiceCalls:76,QAllowGetVideoCalls:77,QAllowAddNewPlugins:78,QAllowDeletePlugins:79,QAllowChangeAccountPassword:80,QAllowAccessForeignersToPersonalFiles:81,QAllowPublishLinkToPersonalFiles:82,QFTPPublicWrite:83,QFTPPersonalWrite:84,QAllowSendInvites:85,QWEBAllowViewNodeJSLogs:86,QWEBAllowViewAuditLogs:87,QKanbanAccess:134,QCommonAllowMainMenu:144,QCommonAllowDialogs:145,QForumAccess:146,QForumCreateSections:147,QForumChangeSections:148,QForumCreateTopics:149,QForumChangeTopics:150,QForumCreatePosts:151,QForumChangePosts:152,QForumChangeSelfPosts:153,QForumDeleteSections:154,QForumDeleteTopics:155,QForumDeletePosts:156,QForumDeleteSelfPosts:157,QBroadcastsOnlyInMyGroups:158,QTxtChViewHidden:159,QICQAccess:160,QTxtConfSendFiles:161,QPrivSendMessages:162,QPrivInsertFiles:163,QAllowRemoveConfMessages:164,QAdmAccessToRemoveConfMessages:165,QAllowViewHistoryTool:166,QAllowViewRemoteUserProfile:174,QAllowFilterHardware:175,QAllowSettingsFolders:176,QAdmAccessLicensesWipe:177,QAdmToolWipe:178,QEnableScreenSharing:179,QAllowGetScreenSharing:180,QForumChangeTopicsColor:181,QForumSubsNotify:182,QForumInsertImages:183,QForumInsertFiles:184,QKanbanAddTask:186,QAdmAccessLicensesQuiz:187,QAdmAccessToRemovePrivMessages:188,QCommonAllowScreenshotTool:189,QAllowRemovePrivateMessages:190,QCommonAllowQuickMessages:191,QAllowRedirectDialogs:192},msgType:{OLD_SHIT:0,TEXT:1,IMAGE:2,BEEP:3,OLD_FILE:4,MARKDOWN:5,ACTION:6,LAN_LINK:7,ANY_LINK:8,PREVIEW_CUSTOM_LINK:9,INTEGRATION_API:10,SOURCE_CODE:11,MEDIA_CALL:12,IGNORE:13,SERVICE:14,CONF_PERSONAL:15,CONF_ALERT:16,CONF_CHANGE_TOPIC:17,CONF_BAN:18,CONF_TURN_OUT:19,BROADCAST_NOTIFY:20,COMMENT:21,KANBAN_NOTIFY:22,FILE:23,LOCATION:24,CONTACT:25,AUDIO:26,VIDEO:27,ADM_DELETE_MESSAGE:28,FORUM_NOTIFY:29,SHOW_RECEIVED_FILES:"srf",SHOW_UPLOADED_FILES:"suf",PRIVATE_REDIRECT:30},msgClientType:{WIN32:0,WEB:1,MACOS:2,LINUX:3,ANDROID:4},loginStyle:{STANDARD:"0",AD:"1",NO_PASS:"2",AD_TRANSPARENT:"3"},msgMods:{NONE:0,MODIFIED:1,DELETED:2},Errors:{WrongPassword:14,UserNotExist:17,WrongServerVersion:81,NetworkError:224,Disconnected:223,"---":"---"},nsInternalErrors:{TELEGRAM_SCRIPT_NOT_FOUND:1,TELEGRAM_SCRIPT_DISABLED:2,INVALID_SCRIPT_RESULT:3,SCRIPT_TIMED_OUT:4,SCRIPT_SYNTAX:5,SCRIPT_RUNTIME:6,SCRIPT_NO_ONREQUESTBYREST:7,SCRIPT_INVALID_ONREQUESTBYREST:8},updateConsoleCMD:"--updateClient",normalStart:"--start",_last_:"_last_"}}),function(e){if("object"==typeof exports)exports.ECMD=e();else if(window){var t=e();window.mcConst&&window.mcConst._CMD_?Object.keys(t).forEach(function(e){window.mcConst._CMD_[e]=t[e]}):window._ECMD_=t}}(function(){"use strict";return{ce_get_server_list:"7001",ce_test_server_ip:"7002",ce_set_language:"7003",ce_modify_server:"7004",ce_add_server:"7005",ce_del_server:"7006",ce_quit_from_program:"7007",ce_get_client_settings:"7008",ce_set_client_settings:"7009",ce_hide_program:"700A",ce_show_notify:"700B",ce_save_autoconnect_server:"700C",ce_load_autoconnect_server:"700D",ce_hide_or_close_by_x:"700E",ce_storage_get:"700F",ce_storage_save:"7010",ce_storage_remove:"7011",ce_open_internal_url:"7012",ce_statistics_get:"7013",ce_statistics_save:"7014",ce_get_mc_client_info:"7015",ce_break_blink:"7016",ce_show_on_top:"7017",ce_ftp_login:"7018",ce_ftp_quit:"7019",ce_ftp_list:"701A",ce_ftp_download:"701B",ce_ftp_upload:"701C",ce_console_log:"701E",ce_file_download_abort:"701D",ce_file_upload_abort:"701F",ce_file_upload_start:"7020",ce_file_upload_prepare_abort:"7021",ce_file_check_exist:"7023",ce_file_download_url:"7025",ce_get_clipboard_files_list:"7022",ce_hide_window:"7024",ce_file_open_in_folder:"7026",ce_file_open_or_download:"7028",ce_special_link_user_info:"7027",ce_history_get_dialogs:"7029",ce_history_set_dialogs:"702A",ce_history_remove_dialogs:"702B",ce_file_direct_upload_start:"702C",ce_file_direct_upload_abort:"702D",ce_file_direct_upload_complete:"702E",ce_file_direct_upload_prepare:"702F",ce_get_logs_list:"7030",ce_get_user_folder:"7031",ce_file_set_new_folder_for_user:"7032",ce_file_direct_receive_start:"7033",ce_stop_ftp_server:"7034",ce_remove_ftp_user:"7035",ce_file_open_folder:"7036",ce_get_logs_files:"7037",ce_toggle_min_max:"7038",ce_toggle_kiosk:"7039",ce_web_services_info:"703A",ce_client_disconnected:"703B",ce_server_ports:"703C",ce_disable_always_on_top:"703D",ce_restart_client:"703E",ce_start_ftp_server:"703F",ce_client_connected:"7040",ec_get_server_list:"9001",ec_test_server_ip:"9002",ec_complete_command:"9003",ec_server_added:"9004",ec_error:"9005",ec_server_saved:"9006",ec_get_client_settings:"9007",ec_load_autoconnect_server:"9008",ec_open_dialog:"9009",ec_storage_get:"900A",ec_statistics_get:"900B",ec_get_mc_client_info:"900C",ec_open_local_kanban:"900D",ec_ftp_login:"900E",ec_ftp_error:"900F",ec_ftp_uploaded:"9010",ec_ftp_list:"9011",ec_ftp_progress:"9012",ec_get_clipboard_files_list:"9019",ec_file_download_start:"9017",ec_file_download_progress:"9013",ec_file_download_complete:"9015",ec_file_download_aborted:"9018",ec_file_upload_start:"9020",ec_file_upload_progress:"9014",ec_file_upload_complete:"9016",ec_file_upload_aborted:"9021",ec_file_upload_prepare_start:"9024",ec_file_upload_prepare_progress:"9022",ec_file_check_exist:"9025",ec_mainWindowFocused:"9026",ec_history_get_dialogs:"9027",ec_file_direct_upload_start:"9028",ec_file_direct_upload_aborted:"9029",ec_file_direct_upload_progress:"902A",ec_file_direct_upload_complete:"902B",ec_get_logs_list:"902C",ec_drop_connect:"902D",ec_file_direct_upload_no_files:"902E",ec_get_user_folder:"902F",ec_file_set_new_folder_for_user:"9030",ec_file_direct_receive_start:"9031",ec_file_direct_receive_client_disconnected:"9032",ec_get_logs_files:"9033",ec_system_suspend:"9034",ec_system_resume:"9035",ec_download_update:"9036",ec_mainWindowBlur:"9037",ec_file_download_file_no_found:"9038",errElectron:{eDuplicateServer:1,eUnknownServerID:2,eFtpNotConnected:3,eFtpError:4,eFileDownload:5,eFileUpload:6},_last_:"---"}}),window.JS_SHA1_NO_COMMON_JS=!0;var mcConst={Title:"MyChat",LMSG:[],_CMD_:window.hasOwnProperty("getCMD")?getCMD():{},countHistoryMessagesLoad:45,minChatFrameWidth:300,isWindowFocused:!0,socketIO:null,ClientSettings:{},changeProtocol:location.protocol,nodePathes:{images:"sendimages",files:"files"},imageSize:{small:{x:120,y:120,xy:"120x120"},medium:{x:150,y:150,xy:"150x150"},big:{x:200,y:200,xy:"200x200"},0:{x:120,y:120,xy:"120x120"},1:{x:150,y:150,xy:"150x150"},2:{x:200,y:200,xy:"200x200"}},loadGif:"<img src='source/images/loading.gif'>",reconnectTime:5e3,lockPrevHotKeys:!0,maxAvailableDate:"01.01.3000.00.00.00",neverDate:"01.01.1900.00.00.00",storageOpts:{OPENUSERS:"openUsers-",SEQUENCE:"sequence-",STATUSICO:"statusU-",DIALOGOPT:"dialogOpt-",WRAPOPTS:"wrapOpts-",INPUTOPTS:"inputOpts-",HISTORYDLG:"historyDialogs-",CURRENTITM:"currentItem-",cUserOpt:"cUserOpt-"},Lang:"ru",containers:{left:"wrapperLeft",center:"wrapperCenter",right:"wrapperRight"},lockInterface:"lockInterface",mirrorStreamName:"mirrorStreamName",videoStreamName:"videoStreamName",audioStreamName:"audioStreamName",videoContainer:"videoFrameContainer",storageFields:{lang:"cliLang",Login:"cliLogin",Pwd:"cliPwd",ServPwd:"cliServPwd",Rm:"cliRm",AutoRld:"cliNoAutoConnect"},userFields:"REMOTECLIENTTYPE,REMOTEINTERFACESLIST,LASTACCESS,LASTSPEAKTIME,STATE,TAG,HARDWAREID,DOMAIN,DOMAINREGTIME,DOMAINCHANGETIME,VER,UTC,REPUTATION,NICK,DISPLAYNAME,EMAIL,GROUPRIGHTS,COMPNETNAME,IP,MAC,UIN,ACTIVE,REGISTERED,WORKDEPT,TEAMLEAD",dataModels:{Login:"Login",Main:"Main",ChatWrapper:"ChatWrapper",ChatFrame:"ChatFrame",ConfUserList:"ConfUserList",UserProfile:"UserProfile",Files:"Files",CommonContacts:"CommonContacts",PersonalContacts:"PersonalContacts",Dialogs:"Dialogs",PrivateConfs:"PrivateConfs",PrivateInfo:"PrivateInfo",ServerManager:"ServerManager",ConfManager:"ConfManager",MainMenu:"MainMenu",Kanban:"Kanban",BBS:"BBS",CommonFiles:"CommonFiles",HistoryDialogs:"HistoryDialogs",ViewLogs:"ViewLogs",ReceiveFiles:"ReceiveFiles",Settings:"Settings",Broadcast:"Broadcast",Update:"Update",Forum:"Forum",History:"History"},sexIcon:{0:"<span class='fa fa-user'></span>",1:"<span class='fa fa-male'></span>",2:"<span class='fa fa-female'></span>"},imagesPath:{noFilter:"source/images/nofilter20.png",loading:"source/images/loading.gif",all:"source/images/",flags:"source/images/flags/",loadImage:"source/images/loadimg.gif",nofile:"source/images/nofile.gif"},pathAliases:{AliasAdmin:"admin",AliasAPI:"API",AliasChat:"chat",AliasFiles:"files",AliasForum:"forum",AliasKanban:"kanban",LobbyEnable:!0,ForumEnable:!0,KanbanEnable:!0,ChatEnable:!0,AdminEnable:!0},whereFiles:{private:1,conf:2,forum:3,kanban:4,bbs:5,broadc:6},states:{offline:-1,online:0,away:1,dnd:2,webOnline:3},currentState:0,LicenseInfo:{ServerRegisteredBy:"Network Software Solutions",IsFree:!1,IsMyChatGuestRegistered:!1},customLogin:!1,lockWindowHeight:80,ApplyPanelShowed:!1,errMessageExpire:5e3,guestGroupId:7,userFoto:{w:135,h:157},CRLF:"\r\n",CR:"\r",LF:"\n",ignores:{all:"all",confs:"confs",confpersonal:"confpersonal",confalert:"confalert",private:"private",privatebeep:"privatebeep",info:"info",files:"files",plugins:"plugins"},MyRightsSet:[],LoginInfo:{login:"",pwd:"",servPwd:"",rm:""},Auth:"",PWD:"",servPass:"",BrowserID:"",SessionID:"",LoggedIn:!1,nowLogin:!1,terminator:"•",terminator2:"",terminator3:"",newLine:"\v",myChatLinkTitle:"?specialMyChatLinkTitle=",PingTimer:null,PingInterval:200,mcPara:"L$",mcParaRight:"R#$",mcParaCenter:"C#$",UserInfo:{UIN:0,Nick:"Anonymous",Sex:1,Avatar:0,Status:0,LoginStyle:"login",AutoAwayTime:15,ServerSignature:"",HWID:"",Domain:"domain"},ErrorText:{},SrvErrorText:{},CanDisplayNotificator:!1,NotificatorObject:null,ExtendedMode:!0,CanChangToExtendedMode:!0,WidthForExtendedMode:800,oneDay:864e5,navWidth:270,isShowed:null,nextShow:"",scrResize:null,navResize:null,noNotify:!1,notify:null,idNotify:0,ServerInfo:{Host:"127.0.0.1",Port:2004,ID:null},keyCodes:{a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,n0:48,n1:49,n2:50,n3:51,n4:52,n5:53,n6:54,n7:55,n8:56,n9:57,tab:9,enter:13,shift:16,backspace:8,ctrl:17,alt:18,esc:27,space:32,menu:93,pause:19,cmd:91,insert:45,home:36,pageup:33,delete:46,end:35,pagedown:34,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,np0:96,np1:97,np2:98,np3:99,np4:100,np5:101,np6:102,np7:103,np8:104,np9:105,npslash:11,npstar:106,nphyphen:109,npplus:107,npdot:110,capslock:20,numlock:144,scrolllock:145,equals:61,hyphen:109,coma:188,dot:190,gravis:192,backslash:220,sbopen:219,sbclose:221,slash:191,semicolon:59,apostrophe:222,aleft:37,aup:38,aright:39,adown:40,PrintSymbols:[32,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,96,97,98,99,100,101,102,103,105,106,107,109,110,111,186,187,188,189,190,104,191,192,219,220,221,222],EditSymbols:[8,32,46],Digits:[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105],ControlFunc:[33,34,35,36,37,38,39,40,112,113,114,115,116,117,118,119,120,121,122,123],ControlsKeys:[36,33,35,34,37,38,39,40],PrintAndEdit:function(){return mcConst.keyCodes.PrintSymbols.concat(mcConst.keyCodes.EditSymbols)}},KanbanEvents:{TASK_ADDED:1,TASK_PERFORMER_CHANGED:2,COMMENT_ADDED:3,TASK_MOVED:4,TASK_CHANGED:5,TASK_DELETED:6,PROJECT_CLOSED:7},historyTypes:{count:1,range:2,list:3},FTP:{CommonUser:"mcuser",CommonPWD:"mychat"}};!function(){function e(o){"use strict";for(var i={fill:0},s=function(e){for(e+=9;e%64>0;e+=1);return e},a=function(e,t){var n=new Uint8Array(e.buffer),o=t%4,i=t-o;switch(o){case 0:n[i+3]=0;case 1:n[i+2]=0;case 2:n[i+1]=0;case 3:n[i+0]=0}for(var s=1+(t>>2);s<e.length;s++)e[s]=0},r=function(e,t,n){e[t>>2]|=128<<24-(t%4<<3),e[14+(2+(t>>2)&-16)]=n/(1<<29)|0,e[15+(2+(t>>2)&-16)]=n<<3},c=function(e,t,n,o,i){var s,a=this,r=i%4,c=(o+r)%4,l=o-c;switch(r){case 0:e[i]=a.charCodeAt(n+3);case 1:e[i+1-(r<<1)|0]=a.charCodeAt(n+2);case 2:e[i+2-(r<<1)|0]=a.charCodeAt(n+1);case 3:e[i+3-(r<<1)|0]=a.charCodeAt(n)}if(!(o<c+r)){for(s=4-r;s<l;s=s+4|0)t[i+s>>2]=a.charCodeAt(n+s)<<24|a.charCodeAt(n+s+1)<<16|a.charCodeAt(n+s+2)<<8|a.charCodeAt(n+s+3);switch(c){case 3:e[i+l+1|0]=a.charCodeAt(n+l+2);case 2:e[i+l+2|0]=a.charCodeAt(n+l+1);case 1:e[i+l+3|0]=a.charCodeAt(n+l)}}},l=function(e,t,n,o,i){var s,a=this,r=i%4,c=(o+r)%4,l=o-c;switch(r){case 0:e[i]=a[n+3];case 1:e[i+1-(r<<1)|0]=a[n+2];case 2:e[i+2-(r<<1)|0]=a[n+1];case 3:e[i+3-(r<<1)|0]=a[n]}if(!(o<c+r)){for(s=4-r;s<l;s=s+4|0)t[i+s>>2|0]=a[n+s]<<24|a[n+s+1]<<16|a[n+s+2]<<8|a[n+s+3];switch(c){case 3:e[i+l+1|0]=a[n+l+2];case 2:e[i+l+2|0]=a[n+l+1];case 1:e[i+l+3|0]=a[n+l]}}},d=function(e,t,o,i,s){var a,r=this,c=s%4,l=(i+c)%4,d=i-l,m=new Uint8Array(n.readAsArrayBuffer(r.slice(o,o+i)));switch(c){case 0:e[s]=m[3];case 1:e[s+1-(c<<1)|0]=m[2];case 2:e[s+2-(c<<1)|0]=m[1];case 3:e[s+3-(c<<1)|0]=m[0]}if(!(i<l+c)){for(a=4-c;a<d;a=a+4|0)t[s+a>>2|0]=m[a]<<24|m[a+1]<<16|m[a+2]<<8|m[a+3];switch(l){case 3:e[s+d+1|0]=m[d+2];case 2:e[s+d+2|0]=m[d+1];case 1:e[s+d+3|0]=m[d]}}},m=function(e){switch(t.getDataType(e)){case"string":return c.bind(e);case"array":case"buffer":return l.bind(e);case"arraybuffer":return l.bind(new Uint8Array(e));case"view":return l.bind(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case"blob":return d.bind(e)}},u=new Array(256),f=0;f<256;f++)u[f]=(f<16?"0":"")+f.toString(16);var g=function(e){for(var t=new Uint8Array(e),n=new Array(e.byteLength),o=0;o<n.length;o++)n[o]=u[t[o]];return n.join("")},_=function(e){var t;if(e<=65536)return 65536;if(e<16777216)for(t=1;t<e;t<<=1);else for(t=16777216;t<e;t+=16777216);return t};!function(t){if(t%64>0)throw new Error("Chunk size must be a multiple of 128 bit");i.offset=0,i.maxChunkLen=t,i.padMaxChunkLen=s(t),i.heap=new ArrayBuffer(_(i.padMaxChunkLen+320+20)),i.h32=new Int32Array(i.heap),i.h8=new Int8Array(i.heap),i.core=new e._core({Int32Array:Int32Array,DataView:DataView},{},i.heap),i.buffer=null}(o||65536);var p=function(e,t){i.offset=0;var n=new Int32Array(e,t+320,5);n[0]=1732584193,n[1]=-271733879,n[2]=-1732584194,n[3]=271733878,n[4]=-1009589776},h=function(e,t){var n=s(e),o=new Int32Array(i.heap,0,n>>2);return a(o,e),r(o,e,t),n},v=function(e,t,n,o){m(e)(i.h8,i.h32,t,n,o||0)},C=function(e,t,n,o,s){var a=n;v(e,t,n),s&&(a=h(n,o)),i.core.hash(a,i.padMaxChunkLen)},S=function(e,t){var n=new Int32Array(e,t+320,5),o=new Int32Array(5),i=new DataView(o.buffer);return i.setInt32(0,n[0],!1),i.setInt32(4,n[1],!1),i.setInt32(8,n[2],!1),i.setInt32(12,n[3],!1),i.setInt32(16,n[4],!1),o},b=this.rawDigest=function(e){var t=e.byteLength||e.length||e.size||0;p(i.heap,i.padMaxChunkLen);var n=0,o=i.maxChunkLen;for(n=0;t>n+o;n+=o)C(e,n,o,t,!1);return C(e,n,t-n,t,!0),S(i.heap,i.padMaxChunkLen)};this.digest=this.digestFromString=this.digestFromBuffer=this.digestFromArrayBuffer=function(e){return g(b(e).buffer)},this.resetState=function(){return p(i.heap,i.padMaxChunkLen),this},this.append=function(e){var t,n=0,o=e.byteLength||e.length||e.size||0,s=i.offset%i.maxChunkLen;for(i.offset+=o;n<o;)t=Math.min(o-n,i.maxChunkLen-s),v(e,n,t,s),n+=t,(s+=t)===i.maxChunkLen&&(i.core.hash(i.maxChunkLen,i.padMaxChunkLen),s=0);return this},this.getState=function(){var e;if(i.offset%i.maxChunkLen)e=i.heap.slice(0);else{var t=new Int32Array(i.heap,i.padMaxChunkLen+320,5);e=t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}return{offset:i.offset,heap:e}},this.setState=function(e){return i.offset=e.offset,20===e.heap.byteLength?new Int32Array(i.heap,i.padMaxChunkLen+320,5).set(new Int32Array(e.heap)):i.h32.set(new Int32Array(e.heap)),this};var w=this.rawEnd=function(){var e=i.offset,t=e%i.maxChunkLen,n=h(t,e);i.core.hash(n,i.padMaxChunkLen);var o=S(i.heap,i.padMaxChunkLen);return p(i.heap,i.padMaxChunkLen),o};this.end=function(){return g(w().buffer)}}var t={getDataType:function(e){if("string"==typeof e)return"string";if(e instanceof Array)return"array";if("undefined"!=typeof global&&global.Buffer&&global.Buffer.isBuffer(e))return"buffer";if(e instanceof ArrayBuffer)return"arraybuffer";if(e.buffer instanceof ArrayBuffer)return"view";if(e instanceof Blob)return"blob";throw new Error("Unsupported data type.")}};if(e._core=function(e,t,n){"use asm";var o=new e.Int32Array(n);function i(e,t){e=e|0;t=t|0;var n=0,i=0,s=0,a=0,r=0,c=0,l=0,d=0,m=0,u=0,f=0,g=0,_=0,p=0;s=o[t+320>>2]|0;r=o[t+324>>2]|0;l=o[t+328>>2]|0;m=o[t+332>>2]|0;f=o[t+336>>2]|0;for(n=0;(n|0)<(e|0);n=n+64|0){a=s;c=r;d=l;u=m;g=f;for(i=0;(i|0)<64;i=i+4|0){p=o[n+i>>2]|0;_=((s<<5|s>>>27)+(r&l|~r&m)|0)+((p+f|0)+1518500249|0)|0;f=m;m=l;l=r<<30|r>>>2;r=s;s=_;o[e+i>>2]=p}for(i=e+64|0;(i|0)<(e+80|0);i=i+4|0){p=(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])<<1|(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])>>>31;_=((s<<5|s>>>27)+(r&l|~r&m)|0)+((p+f|0)+1518500249|0)|0;f=m;m=l;l=r<<30|r>>>2;r=s;s=_;o[i>>2]=p}for(i=e+80|0;(i|0)<(e+160|0);i=i+4|0){p=(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])<<1|(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])>>>31;_=((s<<5|s>>>27)+(r^l^m)|0)+((p+f|0)+1859775393|0)|0;f=m;m=l;l=r<<30|r>>>2;r=s;s=_;o[i>>2]=p}for(i=e+160|0;(i|0)<(e+240|0);i=i+4|0){p=(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])<<1|(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])>>>31;_=((s<<5|s>>>27)+(r&l|r&m|l&m)|0)+((p+f|0)-1894007588|0)|0;f=m;m=l;l=r<<30|r>>>2;r=s;s=_;o[i>>2]=p}for(i=e+240|0;(i|0)<(e+320|0);i=i+4|0){p=(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])<<1|(o[i-12>>2]^o[i-32>>2]^o[i-56>>2]^o[i-64>>2])>>>31;_=((s<<5|s>>>27)+(r^l^m)|0)+((p+f|0)-899497514|0)|0;f=m;m=l;l=r<<30|r>>>2;r=s;s=_;o[i>>2]=p}s=s+a|0;r=r+c|0;l=l+d|0;m=m+u|0;f=f+g|0}o[t+320>>2]=s;o[t+324>>2]=r;o[t+328>>2]=l;o[t+332>>2]=m;o[t+336>>2]=f}return{hash:i}},"undefined"!=typeof window?window.Rusha=e:"undefined"!=typeof module&&(module.exports=e),"undefined"!=typeof FileReaderSync){var n=new FileReaderSync,o=function(e,t,n){try{return n(null,e.digest(t))}catch(e){return n(e)}},i=function(e,t,n,o,s){var a=new self.FileReader;a.onloadend=function(){var r=a.result;t+=a.result.byteLength;try{e.append(r)}catch(e){return void s(e)}t<o.size?i(e,t,n,o,s):s(null,e.end())},a.readAsArrayBuffer(o.slice(t,t+n))};self.onmessage=function(t){var n=t.data.data,s=t.data.file,a=t.data.id;if(void 0!==a&&(s||n)){var r=t.data.blockSize||4194304,c=new e(r);c.resetState();var l=function(e,t){e?self.postMessage({id:a,error:e.name}):self.postMessage({id:a,hash:t})};n&&o(c,n,l),s&&i(c,0,r,s,l)}}}}(),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function e(t,n,o){function i(a,r){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!r&&c)return c(a,!0);if(s)return s(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return i(n||e)},d,d.exports,e,t,n,o)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";function o(e,t,n,o,i){var s=c.writeRtpDescription(e.kind,t);if(s+=c.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=c.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":i||"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a="msid:"+o.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+a,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),s}function i(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var o=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof o;return i&&(o=[o]),o=o.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=i?o[0]:o,!!o.length}return!1})}function s(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},o=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var s=o(e.parameters.apt,n),a=o(t.parameters.apt,i);return s&&a&&s.name.toLowerCase()===a.name.toLowerCase()};return e.codecs.forEach(function(o){for(var s=0;s<t.codecs.length;s++){var a=t.codecs[s];if(o.name.toLowerCase()===a.name.toLowerCase()&&o.clockRate===a.clockRate){if("rtx"===o.name.toLowerCase()&&o.parameters&&a.parameters.apt&&!i(o,a,e.codecs,t.codecs))continue;(a=JSON.parse(JSON.stringify(a))).numChannels=Math.min(o.numChannels,a.numChannels),n.codecs.push(a),a.rtcpFeedback=a.rtcpFeedback.filter(function(e){for(var t=0;t<o.rtcpFeedback.length;t++)if(o.rtcpFeedback[t].type===e.type&&o.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var o=0;o<t.headerExtensions.length;o++){var i=t.headerExtensions[o];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function a(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function r(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}var c=e("sdp");t.exports=function(e,t){var n=function(n){var o=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){o[e]=s[e].bind(s)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy){var a=new Error("rtcpMuxPolicy 'negotiate' is not supported");throw a.name="NotSupportedError",a}switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=i(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var r=n.iceCandidatePoolSize;r>0;r--)this._iceGatherers=new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy});else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=c.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0};return n.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},n.prototype.getConfiguration=function(){return this._config},n.prototype.getLocalStreams=function(){return this.localStreams},n.prototype.getRemoteStreams=function(){return this.remoteStreams},n.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var o=this._createIceAndDtlsTransports();n.iceTransport=o.iceTransport,n.dtlsTransport=o.dtlsTransport}return this.transceivers.push(n),n},n.prototype.addTrack=function(t,n){for(var o,i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(o=this.transceivers[i]);return o||(o=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),o.track=t,o.stream=n,o.rtpSender=new e.RTCRtpSender(t,o.dtlsTransport),o.rtpSender},n.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var o=e.clone();e.getTracks().forEach(function(e,t){var n=o.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),o.getTracks().forEach(function(e){n.addTrack(e,o)})}},n.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},n.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},n.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},n.prototype._createIceGatherer=function(t,n){var o=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].candidates=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==o.transceivers[t].candidates&&o.transceivers[t].candidates.push(e.candidate)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},n.prototype._gather=function(t,n){var o=this,i=this.transceivers[n].iceGatherer;if(!i.onlocalcandidate){var s=this.transceivers[n].candidates;this.transceivers[n].candidates=null,i.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),i.onlocalcandidate=function(e){if(!(o.usingBundle&&n>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,r=!a||0===Object.keys(a).length;r?"new"!==i.state&&"gathering"!==i.state||(i.state="completed"):("new"===i.state&&(i.state="gathering"),a.component=1,s.candidate.candidate=c.writeCandidate(a));var l=c.splitSections(o.localDescription.sdp);l[s.candidate.sdpMLineIndex+1]+=r?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",o.localDescription.sdp=l.join("");var d=o.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==o.iceGatheringState&&(o.iceGatheringState="gathering",o._emitGatheringStateChange()),r||(o.dispatchEvent(s),"function"==typeof o.onicecandidate&&o.onicecandidate(s)),d&&(o.dispatchEvent(new Event("icecandidate")),"function"==typeof o.onicecandidate&&o.onicecandidate(new Event("icecandidate")),o.iceGatheringState="complete",o._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e,i.onlocalcandidate(t)})},0)}},n.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateConnectionState()};var o=new e.RTCDtlsTransport(n);return o.ondtlsstatechange=function(){t._updateConnectionState()},o.onerror=function(){Object.defineProperty(o,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:o}},n.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var o=this.transceivers[e].dtlsTransport;o&&(delete o.ondtlsstatechange,delete o.onerror,delete this.transceivers[e].dtlsTransport)},n.prototype._transceive=function(e,n,o){var i=s(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(i.encodings=e.sendEncodingParameters,i.rtcp={cname:c.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(i.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(i)),o&&e.rtpReceiver&&i.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),i.encodings=e.recvEncodingParameters,i.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(i.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(i))},n.prototype.setLocalDescription=function(e){var t=this,n=arguments;if(!a("setLocalDescription",e.type,this.signalingState))return new Promise(function(o,i){var s=new Error("Can not set local "+e.type+" in state "+t.signalingState);s.name="InvalidStateError",n.length>2&&"function"==typeof n[2]&&n[2].apply(null,[s]),i(s)});var o,i;if("offer"===e.type)o=c.splitSections(e.sdp),i=o.shift(),o.forEach(function(e,n){var o=c.parseRtpParameters(e);t.transceivers[n].localCapabilities=o}),this.transceivers.forEach(function(e,n){t._gather(e.mid,n)});else if("answer"===e.type){o=c.splitSections(t.remoteDescription.sdp),i=o.shift();var r=c.matchPrefix(i,"a=ice-lite").length>0;o.forEach(function(e,n){var o=t.transceivers[n],a=o.iceGatherer,l=o.iceTransport,d=o.dtlsTransport,m=o.localCapabilities,u=o.remoteCapabilities;if(!(c.isRejected(e)&&1===!c.matchPrefix(e,"a=bundle-only").length)&&!o.isDatachannel){var f=c.getIceParameters(e,i),g=c.getDtlsParameters(e,i);r&&(g.role="server"),t.usingBundle&&0!==n||(t._gather(o.mid,n),"new"===l.state&&l.start(a,f,r?"controlling":"controlled"),"new"===d.state&&d.start(g));var _=s(m,u);t._transceive(o,_.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var l=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){l&&l.apply(null),e()})},n.prototype.setRemoteDescription=function(n){var o=this,i=arguments;if(!a("setRemoteDescription",n.type,this.signalingState))return new Promise(function(e,t){var s=new Error("Can not set remote "+n.type+" in state "+o.signalingState);s.name="InvalidStateError",i.length>2&&"function"==typeof i[2]&&i[2].apply(null,[s]),t(s)});var s={};this.remoteStreams.forEach(function(e){s[e.id]=e});var l=[],d=c.splitSections(n.sdp),m=d.shift(),u=c.matchPrefix(m,"a=ice-lite").length>0,f=c.matchPrefix(m,"a=group:BUNDLE ").length>0;this.usingBundle=f;var g=c.matchPrefix(m,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,d.forEach(function(i,a){var d=c.splitLines(i),g=c.getKind(i),_=c.isRejected(i)&&1===!c.matchPrefix(i,"a=bundle-only").length,p=d[0].substr(2).split(" ")[2],h=c.getDirection(i,m),v=c.parseMsid(i),C=c.getMid(i)||c.generateIdentifier();if("application"!==g||"DTLS/SCTP"!==p){var S,b,w,y,I,T,D,L,M,P,k,N=c.parseRtpParameters(i);_||(P=c.getIceParameters(i,m),(k=c.getDtlsParameters(i,m)).role="client"),D=c.parseRtpEncodingParameters(i);var E=c.parseRtcpParameters(i),x=c.matchPrefix(i,"a=end-of-candidates",m).length>0,F=c.matchPrefix(i,"a=candidate:").map(function(e){return c.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!_&&f&&a>0&&o.transceivers[a]&&(o._disposeIceAndDtlsTransports(a),o.transceivers[a].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[a].iceTransport=o.transceivers[0].iceTransport,o.transceivers[a].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[a].rtpSender&&o.transceivers[a].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[a].rtpReceiver&&o.transceivers[a].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==n.type||_)"answer"!==n.type||_||(b=(S=o.transceivers[a]).iceGatherer,w=S.iceTransport,y=S.dtlsTransport,I=S.rtpReceiver,T=S.sendEncodingParameters,L=S.localCapabilities,o.transceivers[a].recvEncodingParameters=D,o.transceivers[a].remoteCapabilities=N,o.transceivers[a].rtcpParameters=E,F.length&&"new"===w.state&&(!u&&!x||f&&0!==a?F.forEach(function(e){r(S.iceTransport,e)}):w.setRemoteCandidates(F)),f&&0!==a||("new"===w.state&&w.start(b,P,"controlling"),"new"===y.state&&y.start(k)),o._transceive(S,"sendrecv"===h||"recvonly"===h,"sendrecv"===h||"sendonly"===h),!I||"sendrecv"!==h&&"sendonly"!==h?delete S.rtpReceiver:(M=I.track,v?(s[v.stream]||(s[v.stream]=new e.MediaStream),s[v.stream].addTrack(M),l.push([M,I,s[v.stream]])):(s.default||(s.default=new e.MediaStream),s.default.addTrack(M),l.push([M,I,s.default]))));else{(S=o.transceivers[a]||o._createTransceiver(g)).mid=C,S.iceGatherer||(S.iceGatherer=o._createIceGatherer(a,f)),F.length&&"new"===S.iceTransport.state&&(!x||f&&0!==a?F.forEach(function(e){r(S.iceTransport,e)}):S.iceTransport.setRemoteCandidates(F)),L=e.RTCRtpReceiver.getCapabilities(g),t<15019&&(L.codecs=L.codecs.filter(function(e){return"rtx"!==e.name})),T=S.sendEncodingParameters||[{ssrc:1001*(2*a+2)}];var $=!1;if(("sendrecv"===h||"sendonly"===h)&&($=!S.rtpReceiver,I=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,g),$)){var A;M=I.track,v?(s[v.stream]||(s[v.stream]=new e.MediaStream,Object.defineProperty(s[v.stream],"id",{get:function(){return v.stream}})),Object.defineProperty(M,"id",{get:function(){return v.track}}),A=s[v.stream]):(s.default||(s.default=new e.MediaStream),A=s.default),A.addTrack(M),l.push([M,I,A])}S.localCapabilities=L,S.remoteCapabilities=N,S.rtpReceiver=I,S.rtcpParameters=E,S.sendEncodingParameters=T,S.recvEncodingParameters=D,o._transceive(o.transceivers[a],!1,$)}}else o.transceivers[a]={mid:C,isDatachannel:!0}}),void 0===this._dtlsRole&&(this._dtlsRole="offer"===n.type?"active":"passive"),this.remoteDescription={type:n.type,sdp:n.sdp},n.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+n.type+'"')}return Object.keys(s).forEach(function(t){var n=s[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){o.dispatchEvent(i),"function"==typeof o.onaddstream&&o.onaddstream(i)})}l.forEach(function(t){var i=t[0],s=t[1];if(n.id===t[2].id){var a=new Event("track");a.track=i,a.receiver=s,a.transceiver={receiver:s},a.streams=[n],e.setTimeout(function(){o.dispatchEvent(a),"function"==typeof o.ontrack&&o.ontrack(a)})}})}}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),new Promise(function(e){i.length>1&&"function"==typeof i[1]&&i[1].apply(null),e()})},n.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},n.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(t)},n.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),"function"==typeof t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},n.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},n.prototype.createOffer=function(){var n,i=this,s=arguments;1===arguments.length&&"function"!=typeof arguments[0]?n=arguments[0]:3===arguments.length&&(n=arguments[2]);var a=this.transceivers.filter(function(e){return"audio"===e.kind}).length,r=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(n){if(n.mandatory||n.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==n.offerToReceiveAudio&&(a=!0===n.offerToReceiveAudio?1:!1===n.offerToReceiveAudio?0:n.offerToReceiveAudio),void 0!==n.offerToReceiveVideo&&(r=!0===n.offerToReceiveVideo?1:!1===n.offerToReceiveVideo?0:n.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)});a>0||r>0;)a>0&&(this._createTransceiver("audio"),a--),r>0&&(this._createTransceiver("video"),r--);var l=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(n,o){var s=n.track,a=n.kind,r=c.generateIdentifier();n.mid=r,n.iceGatherer||(n.iceGatherer=i._createIceGatherer(o,i.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name})),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var d=n.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,a)),n.localCapabilities=l,n.sendEncodingParameters=d}),"max-compat"!==this._config.bundlePolicy&&(l+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",this.transceivers.forEach(function(e,t){l+=o(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,l+="a="+c.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:l});return new Promise(function(e){if(s.length>0&&"function"==typeof s[0])return s[0].apply(null,[d]),void e();e(d)})},n.prototype.createAnswer=function(){var n=this,i=arguments,a=c.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(a+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var r=c.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,i){if(!(i+1>r))if(e.isDatachannel)a+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{if(e.stream){var c;"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var l=s(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,a+=o(e,l,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(a+="a=rtcp-rsize\r\n")}});var l=new e.RTCSessionDescription({type:"answer",sdp:a});return new Promise(function(e){if(i.length>0&&"function"==typeof i[0])return i[0].apply(null,[l]),void e();e(l)})},n.prototype.addIceCandidate=function(e){var t,n;if(e&&""!==e.candidate){if(void 0===e.sdpMLineIndex&&!e.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");if(this.remoteDescription){var o=e.sdpMLineIndex;if(e.sdpMid)for(var i=0;i<this.transceivers.length;i++)if(this.transceivers[i].mid===e.sdpMid){o=i;break}var s=this.transceivers[o];if(s){if(s.isDatachannel)return Promise.resolve();var a=Object.keys(e.candidate).length>0?c.parseCandidate(e.candidate):{};if("tcp"===a.protocol&&(0===a.port||9===a.port))return Promise.resolve();if(a.component&&1!==a.component)return Promise.resolve();if((0===o||o>0&&s.iceTransport!==this.transceivers[0].iceTransport)&&(r(s.iceTransport,a)||((t=new Error("Can not add ICE candidate")).name="OperationError")),!t){var l=e.candidate.trim();0===l.indexOf("a=")&&(l=l.substr(2)),(n=c.splitSections(this.remoteDescription.sdp))[o+1]+="a="+(a.type?l:"end-of-candidates")+"\r\n",this.remoteDescription.sdp=n.join("")}}else(t=new Error("Can not add ICE candidate")).name="OperationError"}else(t=new Error("Can not add ICE candidate without a remote description")).name="InvalidStateError"}else for(var d=0;d<this.transceivers.length&&(this.transceivers[d].isDatachannel||(this.transceivers[d].iceTransport.addRemoteCandidate({}),n=c.splitSections(this.remoteDescription.sdp),n[d+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=n.join(""),!this.usingBundle));d++);var m=arguments;return new Promise(function(e,n){t?(m.length>2&&"function"==typeof m[2]&&m[2].apply(null,[t]),n(t)):(m.length>1&&"function"==typeof m[1]&&m[1].apply(null),e())})},n.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(n){t[n]&&e.push(t[n].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],n=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(o){var i=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=n(e[t]),i.set(t,e[t])})}),t&&t.apply(null,i),o(i)})})},n}},{sdp:2}],2:[function(e,t,n){"use strict";var o={};o.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},o.localCName=o.generateIdentifier(),o.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},o.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},o.matchPrefix=function(e,t){return o.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},o.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},o=8;o<t.length;o+=2)switch(t[o]){case"raddr":n.relatedAddress=t[o+1];break;case"rport":n.relatedPort=parseInt(t[o+1],10);break;case"tcptype":n.tcpType=t[o+1];break;case"ufrag":n.ufrag=t[o+1],n.usernameFragment=t[o+1];break;default:n[t[o]]=t[o+1]}return n},o.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},o.parseIceOptions=function(e){return e.substr(14).split(" ")},o.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},o.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},o.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},o.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},o.parseFmtp=function(e){for(var t,n={},o=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<o.length;i++)n[(t=o[i].trim().split("="))[0].trim()]=t[1];return n},o.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var o=[];Object.keys(e.parameters).forEach(function(t){o.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+n+" "+o.join(";")+"\r\n"}return t},o.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},o.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},o.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},o=e.indexOf(":",t);return o>-1?(n.attribute=e.substr(t+1,o-t-1),n.value=e.substr(o+1)):n.attribute=e.substr(t+1),n},o.getMid=function(e){var t=o.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},o.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},o.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:o.matchPrefix(e+t,"a=fingerprint:").map(o.parseFingerprint)}},o.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},o.getIceParameters=function(e,t){var n=o.splitLines(e);return{usernameFragment:(n=n.concat(o.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},o.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},o.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=o.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var s=n[i],a=o.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(a){var r=o.parseRtpMap(a),c=o.matchPrefix(e,"a=fmtp:"+s+" ");switch(r.parameters=c.length?o.parseFmtp(c[0]):{},r.rtcpFeedback=o.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(o.parseRtcpFb),t.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(r.name.toUpperCase())}}}return o.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(o.parseExtmap(e))}),t},o.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=o.writeRtpMap(e),n+=o.writeFmtp(e),n+=o.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=o.writeExtmap(e)}),n},o.parseRtpEncodingParameters=function(e){var t,n=[],i=o.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),a=-1!==i.fecMechanisms.indexOf("ULPFEC"),r=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=r.length>0&&r[0].ssrc,l=o.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var o={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};n.push(o),s&&((o=JSON.parse(JSON.stringify(o))).fec={ssrc:t,mechanism:a?"red+ulpfec":"red"},n.push(o))}}),0===n.length&&c&&n.push({ssrc:c});var d=o.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},o.parseRtcpParameters=function(e){var t={},n=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=o.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var s=o.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},o.parseMsid=function(e){var t,n=o.matchPrefix(e,"a=msid:");if(1===n.length)return t=n[0].substr(7).split(" "),{stream:t[0],track:t[1]};var i=o.matchPrefix(e,"a=ssrc:").map(function(e){return o.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?(t=i[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},o.generateSessionId=function(){return Math.random().toString().substr(2,21)},o.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||o.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},o.writeMediaSection=function(e,t,n,i){var s=o.writeRtpDescription(e.kind,t);if(s+=o.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=o.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+a,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+a,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+a,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+o.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+o.localCName+"\r\n"),s},o.getDirection=function(e,t){for(var n=o.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?o.getDirection(t):"sendrecv"},o.getKind=function(e){return o.splitLines(e)[0].split(" ")[0].substr(2)},o.isRejected=function(e){return"0"===e.split(" ",2)[1]},o.parseMLine=function(e){var t=o.splitLines(e)[0].split(" ");return{kind:t[0].substr(2),port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},"object"==typeof t&&(t.exports=o)},{}],3:[function(e,t,n){(function(n){"use strict";var o=e("./adapter_factory.js");t.exports=o({window:n.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,n){"use strict";var o=e("./utils");t.exports=function(t,n){var i=t&&t.window,s={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var a in n)hasOwnProperty.call(n,a)&&(s[a]=n[a]);var r=o.log,c=o.detectBrowser(i),l={browserDetails:c,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings},d=e("./chrome/chrome_shim")||null,m=e("./edge/edge_shim")||null,u=e("./firefox/firefox_shim")||null,f=e("./safari/safari_shim")||null,g=e("./common_shim")||null;switch(c.browser){case"chrome":if(!d||!d.shimPeerConnection||!s.shimChrome)return r("Chrome shim is not included in this adapter release."),l;r("adapter.js shimming chrome."),l.browserShim=d,g.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimMediaStream(i),d.shimSourceObject(i),d.shimPeerConnection(i),d.shimOnTrack(i),d.shimAddTrackRemoveTrack(i),d.shimGetSendersWithDtmf(i),g.shimRTCIceCandidate(i);break;case"firefox":if(!u||!u.shimPeerConnection||!s.shimFirefox)return r("Firefox shim is not included in this adapter release."),l;r("adapter.js shimming firefox."),l.browserShim=u,g.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),g.shimRTCIceCandidate(i);break;case"edge":if(!m||!m.shimPeerConnection||!s.shimEdge)return r("MS edge shim is not included in this adapter release."),l;r("adapter.js shimming edge."),l.browserShim=m,g.shimCreateObjectURL(i),m.shimGetUserMedia(i),m.shimPeerConnection(i),m.shimReplaceTrack(i);break;case"safari":if(!f||!s.shimSafari)return r("Safari shim is not included in this adapter release."),l;r("adapter.js shimming safari."),l.browserShim=f,g.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimTrackEventTransceiver(i),f.shimGetUserMedia(i),f.shimCreateOfferLegacy(i),g.shimRTCIceCandidate(i);break;default:r("Unsupported browser!")}return l}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":10,"./safari/safari_shim":12,"./utils":13}],5:[function(e,t,n){"use strict";var o=e("../utils.js"),i=o.log,s={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(o){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===o.track.id}):{track:o.track};var s=new Event("track");s.track=o.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],n.dispatchEvent(s)}),t.stream.getTracks().forEach(function(o){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===o.id}):{track:o};var s=new Event("track");s.track=o,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],n.dispatchEvent(s)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,o){var i=this,s=n.apply(i,arguments);return s||(s=t(i,e),i._senders.push(s)),s};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;o.apply(t,arguments);var n=t._senders.indexOf(e);-1!==n&&t._senders.splice(n,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],i.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],s.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var o=e._reverseStreams[t],i=e._streams[o.id];n=n.replace(new RegExp(i.id,"g"),o.id)}),new RTCSessionDescription({type:t.type,sdp:n})}function n(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var o=e._reverseStreams[t],i=e._streams[o.id];n=n.replace(new RegExp(o.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}var i=o.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&i.version>=63)){var s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=s.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var o=new e.MediaStream(t.getTracks());n._streams[t.id]=o,n._reverseStreams[o.id]=t,t=o}a.apply(n,[t])};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},r.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var o=this;if("closed"===o.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(o.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");o._streams=o._streams||{},o._reverseStreams=o._reverseStreams||{};var s=o._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then(function(){o.dispatchEvent(new Event("negotiationneeded"))});else{var a=new e.MediaStream([t]);o._streams[n.id]=a,o._reverseStreams[a.id]=n,o.addStream(a)}return o.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(n){var o=e.RTCPeerConnection.prototype[n];e.RTCPeerConnection.prototype[n]=function(){var e=this,n=arguments;return arguments.length&&"function"==typeof arguments[0]?o.apply(e,[function(o){var i=t(e,o);n[0].apply(null,[i])},function(e){n[1]&&n[1].apply(null,e)},arguments[2]]):o.apply(e,arguments).then(function(n){return t(e,n)})}});var c=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=n(e,arguments[0]),c.apply(e,arguments)):c.apply(e,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,n=l.get.apply(this);return""===n.type?n:t(e,n)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===t))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var n;Object.keys(t._streams).forEach(function(o){t._streams[o].getTracks().find(function(t){return e.track===t})&&(n=t._streams[o])}),n&&(1===n.getTracks().length?t.removeStream(t._reverseStreams[n.id]):n.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=o.detectBrowser(e);if(e.RTCPeerConnection){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var i=[],s=0;s<e.iceServers.length;s++){var a=e.iceServers[s];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,i.push(a)):i.push(e.iceServers[s])}e.iceServers=i}return new n(e,t)},e.RTCPeerConnection.prototype=n.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})}else e.RTCPeerConnection=function(t,n){return i("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var o=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof arguments[0]))return s.apply(this,[]);var a=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},r=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return s.apply(this,[function(e){i[1](r(a(e)))},arguments[0]])}return new Promise(function(e,t){s.apply(o,[function(t){e(r(a(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,o=new Promise(function(o,i){n.apply(t,[e[0],o,i])});return e.length<2?o:o.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(o,i){n.apply(e,[o,i,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:s.shimMediaStream,shimOnTrack:s.shimOnTrack,shimAddTrackRemoveTrack:s.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:s.shimGetSendersWithDtmf,shimSourceObject:s.shimSourceObject,shimPeerConnection:s.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":13,"./getusermedia":6}],6:[function(e,t,n){"use strict";var o=e("../utils.js"),i=o.log;t.exports=function(e){var t=o.detectBrowser(e),n=e&&e.navigator;e.__navigator=e.navigator;var s=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var s={};"number"==typeof o.ideal?(s[i("min",n)]=o.ideal,t.optional.push(s),(s={})[i("max",n)]=o.ideal,t.optional.push(s)):(s[i("",n)]=o.ideal,t.optional.push(s))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=o.exact):["min","max"].forEach(function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=o[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,o){if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"==typeof e.video){var r=e.video.facingMode;r=r&&("object"==typeof r?r:{ideal:r});var c=t.version<66;if(r&&("user"===r.exact||"environment"===r.exact||"user"===r.ideal||"environment"===r.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||c)){delete e.video.facingMode;var l;if("environment"===r.exact||"environment"===r.ideal?l=["back","rear"]:"user"!==r.exact&&"user"!==r.ideal||(l=["front"]),l)return n.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return l.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==l.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=r.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=s(e.video),i("chrome: "+JSON.stringify(e)),o(e)})}e.video=s(e.video)}return i("chrome: "+JSON.stringify(e)),o(e)},r=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};n.getUserMedia=function(e,t,o){a(e,function(e){n.webkitGetUserMedia(e,t,function(e){o&&o(r(e))})})};var c=function(e){return new Promise(function(t,o){n.getUserMedia(e,t,o)})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),n.mediaDevices.getUserMedia){var l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return a(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(r(e))})})}}else n.mediaDevices.getUserMedia=function(e){return c(e)};void 0===n.mediaDevices.addEventListener&&(n.mediaDevices.addEventListener=function(){i("Dummy mediaDevices.addEventListener called.")}),void 0===n.mediaDevices.removeEventListener&&(n.mediaDevices.removeEventListener=function(){i("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":13}],7:[function(e,t,n){"use strict";function o(e,t,n){if(e.RTCPeerConnection){var o=e.RTCPeerConnection.prototype,i=o.addEventListener;o.addEventListener=function(e,o){if(e!==t)return i.apply(this,arguments);var s=function(e){o(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[o]=s,i.apply(this,[e,s])};var s=o.removeEventListener;o.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return s.apply(this,arguments);var o=this._eventMap[n];return delete this._eventMap[n],s.apply(this,[e,o])},Object.defineProperty(o,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var i=e("sdp"),s=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2));var n=new t(e),o=i.parseCandidate(e.candidate),s=Object.assign(n,o);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s},o(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var n=t.createObjectURL.bind(t),o=t.revokeObjectURL.bind(t),i=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return i.set(t,e),s.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return n(e)},t.revokeObjectURL=function(e){o(e),i.delete(e)};var r=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return r.get.apply(this)},set:function(e){return this.srcObject=i.get(e)||null,r.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=i.get(arguments[1])||null),c.apply(this,arguments)}}}}},{"./utils":13,sdp:2}],8:[function(e,t,n){"use strict";var o=e("../utils"),i=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=o.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=i(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":13,"./getusermedia":9,"rtcpeerconnection-shim":1}],9:[function(e,t,n){"use strict";t.exports=function(e){var t=e&&e.navigator,n=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return o(e).catch(function(e){return Promise.reject(n(e))})}}},{}],10:[function(e,t,n){"use strict";var o=e("../utils"),i={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=o.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,o){if(t.version<38&&n&&n.iceServers){for(var i=[],s=0;s<n.iceServers.length;s++){var a=n.iceServers[s];if(a.hasOwnProperty("urls"))for(var r=0;r<a.urls.length;r++){var c={url:a.urls[r]};0===a.urls[r].indexOf("turn")&&(c.username=a.username,c.credential=a.credential),i.push(c)}else i.push(n.iceServers[s])}n.iceServers=i}return new e.mozRTCPeerConnection(n,o)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var n=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t},s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,o){return a.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=i(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=s[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:s[t.type]||t.type}))})}return e}).then(n,o)}}}};t.exports={shimOnTrack:i.shimOnTrack,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":13,"./getusermedia":11}],11:[function(e,t,n){"use strict";var o=e("../utils"),i=o.log;t.exports=function(e){var t=o.detectBrowser(e),n=e&&e.navigator,s=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},r=function(e,o,s){var r=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if(void 0===o.min&&void 0===o.max&&void 0===o.exact||t.push(n),void 0!==o.exact&&("number"==typeof o.exact?o.min=o.max=o.exact:e[n]=o.exact,delete o.exact),void 0!==o.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof o.ideal?i[n]={min:o.ideal,max:o.ideal}:i[n]=o.ideal,e.advanced.push(i),delete o.ideal,Object.keys(o).length||delete e[n]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(i("spec: "+JSON.stringify(e)),e.audio&&(e.audio=r(e.audio)),e.video&&(e.video=r(e.video)),i("ff37: "+JSON.stringify(e))),n.mozGetUserMedia(e,o,function(e){s(a(e))})};if(n.mediaDevices||(n.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){r(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),n.mediaDevices.enumerateDevices=n.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var c=n.mediaDevices.enumerateDevices.bind(n.mediaDevices);n.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var l=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){var d=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},m=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),d(e.audio,"autoGainControl","mozAutoGainControl"),d(e.audio,"noiseSuppression","mozNoiseSuppression")),m(e)},s&&s.prototype.getSettings){var u=s.prototype.getSettings;s.prototype.getSettings=function(){var e=u.apply(this,arguments);return d(e,"mozAutoGainControl","autoGainControl"),d(e,"mozNoiseSuppression","noiseSuppression"),e}}if(s&&s.prototype.applyConstraints){var f=s.prototype.applyConstraints;s.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),d(e,"autoGainControl","mozAutoGainControl"),d(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}n.getUserMedia=function(e,i,s){if(t.version<44)return r(e,i,s);o.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(i,s)}}},{"../utils":13}],12:[function(e,t,n){"use strict";var o=e("../utils"),i={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(o){t.call(n,o,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,o=e.getTracks();this.getSenders().forEach(function(e){-1!==o.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,o=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var o=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[o]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=o.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};var r=function(e,t,n){var o=i.apply(this,[e]);return n?(o.then(t,n),Promise.resolve()):o};t.setLocalDescription=r,r=function(e,t,n){var o=s.apply(this,[e]);return n?(o.then(t,n),Promise.resolve()):o},t.setRemoteDescription=r,r=function(e,t,n){var o=a.apply(this,[e]);return n?(o.then(t,n),Promise.resolve()):o},t.addIceCandidate=r}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,o){t.mediaDevices.getUserMedia(e).then(n,o)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var i=[],s=0;s<e.iceServers.length;s++){var a=e.iceServers[s];!a.hasOwnProperty("urls")&&a.hasOwnProperty("url")?(o.deprecated("RTCIceServer.url","RTCIceServer.urls"),(a=JSON.parse(JSON.stringify(a))).urls=a.url,delete a.url,i.push(a)):i.push(e.iceServers[s])}e.iceServers=i}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){var o=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&o?"sendrecv"===o.direction?o.setDirection("sendonly"):"recvonly"===o.direction&&o.setDirection("inactive"):!0!==e.offerToReceiveAudio||o||n.addTransceiver("audio");var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}};t.exports={shimCallbacksAPI:i.shimCallbacksAPI,shimLocalStreamsAPI:i.shimLocalStreamsAPI,shimRemoteStreamsAPI:i.shimRemoteStreamsAPI,shimGetUserMedia:i.shimGetUserMedia,shimRTCIceServerUrls:i.shimRTCIceServerUrls,shimTrackEventTransceiver:i.shimTrackEventTransceiver,shimCreateOfferLegacy:i.shimCreateOfferLegacy}},{"../utils":13}],13:[function(e,t,n){"use strict";var o=!0,i=!0,s={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(o=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(i=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(o)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){i&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,n){var o=e.match(t);return o&&o.length>=n&&parseInt(o[n],10)},detectBrowser:function(e){var t=e&&e.navigator,n={};if(n.browser=null,n.version=null,void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)n.browser="chrome",n.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return n.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}};t.exports={log:s.log,deprecated:s.deprecated,disableLog:s.disableLog,disableWarnings:s.disableWarnings,extractVersion:s.extractVersion,shimCreateObjectURL:s.shimCreateObjectURL,detectBrowser:s.detectBrowser.bind(s)}},{}]},{},[3])(3)});var canvasResize=function(e,t,n){var o=e.width,i=e.height,s=t.width,a=t.height,r=e.getContext("2d").getImageData(0,0,o,i),c=t.getContext("2d").getImageData(0,0,s,a);if(s>o||a>i)t.getContext("2d").drawImage(e,0,0,s,a);else{for(var l=r.data,d=c.data,m=Array(d.length),u=0;u<d.length;u++)m[u]=0;for(var f=Array(d.length>>2),u=0;u<d.length>>2;u++)f[u]=1;var g=s/o,_=a/i,p=function(e){for(var t=0;t<o;t++){var n=!1,a=!1,r=Math.floor(t*g),c=Math.floor(e*_),d=g,u=_,v=0,C=0,S=4*(e*o+t),b=4*(c*s+r);r<Math.floor((t+1)*g)&&(d-=C=(t+1)*g%1,n=!0),c<Math.floor((e+1)*_)&&(u-=v=(e+1)*_%1,a=!0);var w;w=l[S+3]/255;var y=b/4;n&&(m[b+4]+=l[S]*C*u*w,m[b+5]+=l[S+1]*C*u*w,m[b+6]+=l[S+2]*C*u*w,m[b+7]+=l[S+3]*C*u,f[y+1]-=(1-w)*C*u),a&&(m[b+4*s]+=l[S]*d*v*w,m[b+4*s+1]+=l[S+1]*d*v*w,m[b+4*s+2]+=l[S+2]*d*v*w,m[b+4*s+3]+=l[S+3]*d*v,f[y+s]-=(1-w)*d*v),n&&a&&(m[b+4*s+4]+=l[S]*C*v*w,m[b+4*s+5]+=l[S+1]*C*v*w,m[b+4*s+6]+=l[S+2]*C*v*w,m[b+4*s+7]+=l[S+3]*C*v,f[y+s+1]-=(1-w)*C*v),m[b]+=l[S]*d*u*w,m[b+1]+=l[S+1]*d*u*w,m[b+2]+=l[S+2]*d*u*w,m[b+3]+=l[S+3]*d*u,f[y]-=(1-w)*d*u}e++<i?setTimeout(p.bind(this,e),0):h()};p(0);var h=function(){for(e=0;e<d.length>>2;e++)f[e]&&f[e]<1&&(m[e<<2]/=f[e],m[1+(e<<2)]/=f[e],m[2+(e<<2)]/=f[e]);for(var e=0;e<m.length;e++)d[e]=Math.round(m[e]);t.getContext("2d").putImageData(c,0,0),n&&n()}}};"undefined"!=typeof window?window.canvasResize=canvasResize:module.exports=canvasResize;var browserDetect=function(){function e(e){function n(t){var n=e.match(t);return n&&n.length>1&&n[1]||""}var o,i=n(/(ipod|iphone|ipad)/i).toLowerCase(),s=!/like android/i.test(e)&&/android/i.test(e),a=n(/edge\/(\d+(\.\d+)?)/i),r=n(/version\/(\d+(\.\d+)?)/i),c=/tablet/i.test(e),l=!c&&/[^-]mobi/i.test(e);/opera|opr/i.test(e)?o={name:"Opera",opera:t,version:r||n(/(?:opera|opr)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?o={name:"Yandex Browser",yandexbrowser:t,version:r||n(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/(windows phone|lumia)/i.test(e)?(o={name:"Windows Phone",windowsphone:t},a?(o.msedge=t,o.version=a):(o.msie=t,o.version=n(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?o={name:"Internet Explorer",msie:t,version:n(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?o={name:"Microsoft Edge",msedge:t,version:a}:/chrome|crios|crmo/i.test(e)?o={name:"Chrome",chrome:t,version:n(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:i?(o={name:"iphone"==i?"iPhone":"ipad"==i?"iPad":"iPod"},r&&(o.version=r)):/sailfish/i.test(e)?o={name:"Sailfish",sailfish:t,version:n(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?o={name:"SeaMonkey",seamonkey:t,version:n(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel/i.test(e)?(o={name:"Firefox",firefox:t,version:n(/(?:firefox|iceweasel)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(o.firefoxos=t)):/silk/i.test(e)?o={name:"Amazon Silk",silk:t,version:n(/silk\/(\d+(\.\d+)?)/i)}:s?o={name:"Android",version:r}:/phantom/i.test(e)?o={name:"PhantomJS",phantom:t,version:n(/phantomjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?o={name:"BlackBerry",blackberry:t,version:r||n(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:/(web|hpw)os/i.test(e)?(o={name:"WebOS",webos:t,version:r||n(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(o.touchpad=t)):o=/bada/i.test(e)?{name:"Bada",bada:t,version:n(/dolfin\/(\d+(\.\d+)?)/i)}:/tizen/i.test(e)?{name:"Tizen",tizen:t,version:n(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||r}:/safari/i.test(e)?{name:"Safari",safari:t,version:r}:{name:n(/^(.*)\/(.*) /),version:function(t){var n=e.match(t);return n&&n.length>1&&n[2]||""}(/^(.*)\/(.*) /)},!o.msedge&&/(apple)?webkit/i.test(e)?(o.name=o.name||"Webkit",o.webkit=t,!o.version&&r&&(o.version=r)):!o.opera&&/gecko\//i.test(e)&&(o.name=o.name||"Gecko",o.gecko=t,o.version=o.version||n(/gecko\/(\d+(\.\d+)?)/i)),o.msedge||!s&&!o.silk?i&&(o[i]=t,o.ios=t):o.android=t;var d="";o.windowsphone?d=n(/(windows phone|lumia) (?:os)?\s?(\d+(\.\d+)*)/i):i?d=(d=n(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):s?d=n(/android[ \/-](\d+(\.\d+)*)/i):o.webos?d=n(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):o.blackberry?d=n(/rim\stablet\sos\s(\d+(\.\d+)*)/i):o.bada?d=n(/bada\/(\d+(\.\d+)*)/i):o.tizen&&(d=n(/tizen[\/\s](\d+(\.\d+)*)/i)),d&&(o.osversion=d);var m=d.split(".")[0];return c||"ipad"==i||s&&(3==m||4==m&&!l)||o.silk?o.tablet=t:(l||"iphone"==i||"ipod"==i||s||o.blackberry||o.webos||o.bada||o.windowsphone)&&(o.mobile=t),o.msedge||o.msie&&o.version>=10||o.yandexbrowser&&o.version>=15||o.chrome&&o.version>=20||o.firefox&&o.version>=20||o.safari&&o.version>=6||o.opera&&o.version>=10||o.ios&&o.osversion&&o.osversion.split(".")[0]>=6||o.blackberry&&o.version>=10.1?o.a=t:o.msie&&o.version<10||o.chrome&&o.version<20||o.firefox&&o.version<20||o.safari&&o.version<6||o.opera&&o.version<10||o.ios&&o.osversion&&o.osversion.split(".")[0]<6?o.c=t:o.x=t,o}var t=!0,n=e("undefined"!=typeof navigator?navigator.userAgent:"");return n.test=function(e){for(var t=0;t<e.length;++t){var o=e[t];if("string"==typeof o&&o in n)return!0}return!1},n._detect=e,n}();!function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,n){var o=(new Date).getTime(),i=Math.max(0,16-(o-e)),s=window.setTimeout(function(){t(o+i)},i);return e=o+i,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var TouchScroll=function(){"use strict";return{axis:"x",drag:!1,zoom:1,time:.04,isIE:window.navigator.userAgent.toLowerCase().indexOf("msie")>-1,isFirefox:window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,init:function(e){var t=this;this.options=e,e&&e.id&&(this.el=document.getElementById(e.id)),this.el||(this.isIE||this.isFirefox?this.el=document.documentElement:this.el=document.body),!0===e.draggable&&(this.isIE&&(document.ondragstart=function(){return!1}),this.isIE||this.isFirefox?this.body=document.documentElement:this.body=document.body,this.addEvent("touchstart",this.el,function(e){t.onMouseDown(e)}),this.addEvent("touchmove",this.el,function(e){t.onMouseMove(e)}),this.addEvent("touchend",this.body,function(e){t.onMouseUp(e)})),e&&e.zoom&&(this.elzoom=document.getElementById(e.zoom),this.isFirefox?this.addEvent("DOMMouseScroll",this.el,function(e){t.onMouseWheel(e)}):this.addEvent("mousewheel",this.el,function(e){t.onMouseWheel(e)})),e&&e.prev&&(this.prev=document.getElementById(e.prev),this.addEvent("touchstart",this.prev,function(e){t.onMouseDown(e)}),this.addEvent("touchend",this.prev,function(n){t.diffx=e.distance?-e.distance/11:-11,t.onMouseUp(n)})),e&&e.next&&(this.next=document.getElementById(e.next),this.addEvent("touchstart",this.next,function(e){t.onMouseDown(e)}),this.addEvent("touchend",this.next,function(n){t.diffx=e.distance?e.distance/11:11,t.onMouseUp(n)}))},addEvent:function(e,t,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent?t.attachEvent("on"+e,n):t[e]=n},cancelEvent:function(e){e||(e=window.event),e.target&&"IMG"===e.target.nodeName?e.preventDefault():e.srcElement&&"IMG"===e.srcElement.nodeName&&(e.returnValue=!1)},onMouseDown:function(e){if(!1===this.drag||!1===this.options.wait){var t=event.touches[0]?event.touches[0]:event;this.drag=!0,this.cancelEvent(e),this.startx=t.clientX+this.el.scrollLeft,this.starty=t.clientY+this.el.scrollTop,this.diffx=0,this.diffy=0}},onMouseMove:function(e){if(!0===this.drag){var t=event.touches[0]?event.touches[0]:event;this.cancelEvent(e),this.diffx=this.startx-(t.clientX+this.el.scrollLeft),this.diffy=this.starty-(t.clientY+this.el.scrollTop),this.el.scrollTop+=this.diffy}},onMouseUp:function(e){if(!0===this.drag){this.options.wait||(this.drag=null),this.cancelEvent(e);var t=this,n=1,o=function(){var e=Math.sin(n);e<=0?(t.diffx=0,t.diffy=0,window.cancelAnimationFrame(o),t.drag=!1):(t.el.scrollLeft+=t.diffx*e,t.el.scrollTop+=t.diffy*e,n-=t.time,window.requestAnimationFrame(o))};o()}},onMouseWheel:function(e){this.cancelEvent(e),e.detail?this.zoom-=e.detail:this.zoom+=e.wheelDelta/1200,this.zoom<1?this.zoom=1:this.zoom>10&&(this.zoom=10),this.elzoom.style.zoom=100*this.zoom+"%"}}};!function(e){"object"!=typeof exports?"function"==typeof define&&define.amd?define(e):window.purl=e():exports.purl=e()}(function(){function e(e,t){for(var n=decodeURI(e),o=_[t?"strict":"loose"].exec(n),i={attr:{},param:{},seg:{}},a=14;a--;)i.attr[f[a]]=o[a]||"";return i.param.query=s(i.attr.query),i.param.fragment=s(i.attr.fragment),i.seg.path=i.attr.path.replace(/^\/+|\/+$/g,"").split("/"),i.seg.fragment=i.attr.fragment.replace(/^\/+|\/+$/g,"").split("/"),i.attr.base=i.attr.host?(i.attr.protocol?i.attr.protocol+"://"+i.attr.host:i.attr.host)+(i.attr.port?":"+i.attr.port:""):"",i}function t(e){var t=e.tagName;return void 0!==t?u[t.toLowerCase()]:t}function n(e,t){if(0===e[t].length)return e[t]={};var n={};for(var o in e[t])n[o]=e[t][o];return e[t]=n,n}function o(e,t,i,s){var a=e.shift();if(a){var r=t[i]=t[i]||[];"]"==a?l(r)?""!==s&&r.push(s):"object"==typeof r?r[d(r).length]=s:r=t[i]=[t[i],s]:~a.indexOf("]")?(a=a.substr(0,a.length-1),!p.test(a)&&l(r)&&(r=n(t,i)),o(e,r,a,s)):(!p.test(a)&&l(r)&&(r=n(t,i)),o(e,r,a,s))}else l(t[i])?t[i].push(s):"object"==typeof t[i]?t[i]=s:void 0===t[i]?t[i]=s:t[i]=[t[i],s]}function i(e,t,n){if(~t.indexOf("]"))o(t.split("["),e,"base",n);else{if(!p.test(t)&&l(e.base)){var i={};for(var s in e.base)i[s]=e.base[s];e.base=i}""!==t&&a(e.base,t,n)}return e}function s(e){return c(String(e).split(/&|;/),function(e,t){try{t=decodeURIComponent(t.replace(/\+/g," "))}catch(e){}var n=t.indexOf("="),o=r(t),s=t.substr(0,o||n),a=t.substr(o||n,t.length);return a=a.substr(a.indexOf("=")+1,a.length),""===s&&(s=t,a=""),i(e,s,a)},{base:{}}).base}function a(e,t,n){var o=e[t];void 0===o?e[t]=n:l(o)?o.push(n):e[t]=[o,n]}function r(e){for(var t,n,o=e.length,i=0;i<o;++i)if("]"==(n=e[i])&&(t=!1),"["==n&&(t=!0),"="==n&&!t)return i}function c(e,t){for(var n=0,o=e.length>>0,i=arguments[2];n<o;)n in e&&(i=t.call(void 0,i,e[n],n,e)),++n;return i}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function d(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function m(t,n){return 1===arguments.length&&!0===t&&(n=!0,t=void 0),n=n||!1,t=t||window.location.toString(),{data:e(t,n),attr:function(e){return void 0!==(e=g[e]||e)?this.data.attr[e]:this.data.attr},param:function(e){return void 0!==e?this.data.param.query[e]:this.data.param.query},fparam:function(e){return void 0!==e?this.data.param.fragment[e]:this.data.param.fragment},segment:function(e){return void 0===e?this.data.seg.path:(e=e<0?this.data.seg.path.length+e:e-1,this.data.seg.path[e])},fsegment:function(e){return void 0===e?this.data.seg.fragment:(e=e<0?this.data.seg.fragment.length+e:e-1,this.data.seg.fragment[e])}}}var u={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href",embed:"src",object:"data"},f=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],g={anchor:"fragment"},_={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},p=/^[0-9]+$/;return m.jQuery=function(e){null!=e&&(e.fn.url=function(n){var o="";return this.length&&(o=e(this).attr(t(this[0]))||""),m(o,n)},e.url=m)},m}),function(e){function t(){}function n(e,t){return function(){e.apply(t,arguments)}}function o(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function i(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,o._immediateFn(function(){var n=1===e._state?t.onFulfilled:t.onRejected;if(null!==n){var o;try{o=n(e._value)}catch(e){return void a(t.promise,e)}s(t.promise,o)}else(1===e._state?s:a)(t.promise,e._value)})):e._deferreds.push(t)}function s(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var i=t.then;if(t instanceof o)return e._state=3,e._value=t,void r(e);if("function"==typeof i)return void l(n(i,t),e)}e._state=1,e._value=t,r(e)}catch(t){a(e,t)}}function a(e,t){e._state=2,e._value=t,r(e)}function r(e){2===e._state&&0===e._deferreds.length&&o._immediateFn(function(){e._handled||o._unhandledRejectionFn(e._value)});for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function c(e,t,n){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=n}function l(e,t){var n=!1;try{e(function(e){n||(n=!0,s(t,e))},function(e){n||(n=!0,a(t,e))})}catch(e){if(n)return;n=!0,a(t,e)}}var d=setTimeout;o.prototype.catch=function(e){return this.then(null,e)},o.prototype.then=function(e,n){var o=new this.constructor(t);return i(this,new c(e,n,o)),o},o.all=function(e){var t=Array.prototype.slice.call(e);return new o(function(e,n){function o(s,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var r=a.then;if("function"==typeof r)return void r.call(a,function(e){o(s,e)},n)}t[s]=a,0==--i&&e(t)}catch(e){n(e)}}if(0===t.length)return e([]);for(var i=t.length,s=0;s<t.length;s++)o(s,t[s])})},o.resolve=function(e){return e&&"object"==typeof e&&e.constructor===o?e:new o(function(t){t(e)})},o.reject=function(e){return new o(function(t,n){n(e)})},o.race=function(e){return new o(function(t,n){for(var o=0,i=e.length;o<i;o++)e[o].then(t,n)})},o._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){d(e,0)},o._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},o._setImmediateFn=function(e){o._immediateFn=e},o._setUnhandledRejectionFn=function(e){o._unhandledRejectionFn=e},"undefined"!=typeof module&&module.exports?module.exports=o:e.Promise||(e.Promise=o)}(this),function(){function e(e,t){"[object String]"!==Object.prototype.toString.call(e)?console.error("[events.on] Event name must be string"):r.hasOwnProperty(e)?r[e].push(t):r[e]=[t]}function t(e){r.hasOwnProperty(e)?delete r[e]:console.warn("[events.off] Unknown event: "+e)}function n(e,t,n){var o=null;if("[object String]"!==Object.prototype.toString.call(e))console.warn("[events.broadcast] Event name must be string");else if(r.hasOwnProperty(e)){if(r[e].forEach(function(e){o=e.apply(null,[null,t])}),o)return o}else n||console.warn("[events.broadcast] Unknown event: "+e)}function o(e,t){var n;try{(n=new Promise(function(n,o){var i=new XMLHttpRequest;i.open("GET",e),i.onreadystatechange=function(){4===i.readyState&&(200==i.status?(t&&t(i.responseText),n(i.responseText)):o(i.statusText))},i.send(null)})).success=n.then}catch(e){console.error(e.message)}return n}function i(){l&&(l.data=purl().data,c.$broadcast("onChangeHrefPath",[l],!0))}var s=[],a={},r={},c={$on:e,$off:t,$emit:n,$broadcast:n,isWebClient:"file:"!==location.protocol},l=null;try{l=purl()}catch(e){console.error(e.message)}window.mcComponents={start:function(){return s.forEach(function(i){var s=a;s.$rootScope=c,s.$http=o,s.$location=l,s.$scope={$on:e,$off:t,$emit:n,$broadcast:n};try{a[i.module]=new(Function.prototype.bind.apply(window[i.module],[null].concat(i.args.map(function(e){return s[e]}))))}catch(e){console.error(e)}s=null}),this},units:function(e){return s="[object Array]"===Object.prototype.toString.call(e)?e:[],this},_broadcast:n},function(e){window[e[0]](e[1]+"popstate",i,!1)}(window.addEventListener?["addEventListener",""]:["attachEvent","on"])}();var _messages_={},___native_console=window.console;!function(e,t,n){"use strict";function o(){function o(e,t){this.scrollLeft=e,this.scrollTop=t}function i(e){return.5*(1-Math.cos(Math.PI*e))}function s(e){if("object"!=typeof e||null===e||e.behavior===n||"auto"===e.behavior||"instant"===e.behavior)return!0;if("object"==typeof e&&"smooth"===e.behavior)return!1;throw new TypeError("behavior not valid")}function a(n){var o,i,s;do{o=(n=n.parentNode)===t.body,i=n.clientHeight<n.scrollHeight||n.clientWidth<n.scrollWidth,s="visible"===e.getComputedStyle(n,null).overflow}while(!o&&(!i||s));return o=i=s=null,n}function r(t){var n,o,s,a=(u()-t.startTime)/d;n=i(a=a>1?1:a),o=t.startX+(t.x-t.startX)*n,s=t.startY+(t.y-t.startY)*n,t.method.call(t.scrollable,o,s),o===t.x&&s===t.y||e.requestAnimationFrame(r.bind(e,t))}function c(n,i,s){var a,c,l,d,f=u();n===t.body?(a=e,c=e.scrollX||e.pageXOffset,l=e.scrollY||e.pageYOffset,d=m.scroll):(a=n,c=n.scrollLeft,l=n.scrollTop,d=o),r({scrollable:a,method:d,startTime:f,startX:c,startY:l,x:i,y:s})}if(!("scrollBehavior"in t.documentElement.style)){var l=e.HTMLElement||e.Element,d=468,m={scroll:e.scroll||e.scrollTo,scrollBy:e.scrollBy,elScroll:l.prototype.scroll||o,scrollIntoView:l.prototype.scrollIntoView},u=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now;e.scroll=e.scrollTo=function(){s(arguments[0])?m.scroll.call(e,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):c.call(e,t.body,~~arguments[0].left,~~arguments[0].top)},e.scrollBy=function(){s(arguments[0])?m.scrollBy.call(e,arguments[0].left||arguments[0],arguments[0].top||arguments[1]):c.call(e,t.body,~~arguments[0].left+(e.scrollX||e.pageXOffset),~~arguments[0].top+(e.scrollY||e.pageYOffset))},l.prototype.scroll=l.prototype.scrollTo=function(){if(s(arguments[0]))m.elScroll.call(this,arguments[0].left||arguments[0],arguments[0].top||arguments[1]);else{var e=arguments[0].left,t=arguments[0].top;c.call(this,this,"number"==typeof e?e:this.scrollLeft,"number"==typeof t?t:this.scrollTop)}},l.prototype.scrollBy=function(){var e=arguments[0];"object"==typeof e?this.scroll({left:e.left+this.scrollLeft,top:e.top+this.scrollTop,behavior:e.behavior}):this.scroll(this.scrollLeft+e,this.scrollTop+arguments[1])},l.prototype.scrollIntoView=function(){if(s(arguments[0]))m.scrollIntoView.call(this,arguments[0]===n||arguments[0]);else{var o=a(this),i=o.getBoundingClientRect(),r=this.getBoundingClientRect();o!==t.body?(c.call(this,o,o.scrollLeft+r.left-i.left,o.scrollTop+r.top-i.top),e.scrollBy({left:i.left,top:i.top,behavior:"smooth"})):e.scrollBy({left:r.left,top:r.top,behavior:"smooth"})}}}}"object"==typeof exports?module.exports={polyfill:o}:o()}(window,document),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,o;if(!this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),o=0;o<s;){var a;o in i&&(a=i[o],e.call(n,a,o,i)),o++}});var _Dragging={move:function(e,t,n){e.style.left=t+"px",e.style.top=n+"px"},startMoving:function(e,t,n){var o=(n=n||window.event).clientX,i=n.clientY,s=o-e.offsetLeft,a=i-e.offsetTop,r=document.getElementById(t),c=parseInt(e.offsetWidth),l=parseInt(e.offsetHeight),d=parseInt(r.offsetWidth),m=parseInt(r.offsetHeight);document.onmousemove=function(t){var n=(t=t||window.event).clientX,o=t.clientY,i=n-s,r=o-a;i<0&&(i=0),r<0&&(r=0),i+c>d&&(i=d-c),r+l>m&&(r=m-l),_Dragging.move(e,i,r)}},stopMoving:function(){document.onmousemove=function(){}}};if(Date.prototype.startOfDay=function(){return this.getTime()-(1e3*this.getHours()*60*60+1e3*this.getMinutes()*60+1e3*this.getSeconds()+this.getMilliseconds())},window.mcWidgets?window.mcWidgets.ButtonsListWithContext=function(e){function t(t,n,o,i){var s=mcService.RandomHash(7);mcService.isString(o)&&(o=$$(o)),e.hotKeyDispatcher.addPreset(s,[{key:mcConst.keyCodes.enter,lockPrev:!0,func:function(){var e=t.dialog.getChildViews()[1];!0!==t.confirm.apply(e,[].concat(e.getChildViews()).concat(o?o.getSelectedItem():[]))&&t.dialog.close()}},{key:mcConst.keyCodes.esc,lockPrev:!0,func:function(){t.dialog.close()}}],document,!0),t.dialog=webix.ui(mcService.Marge(n,{view:"window",position:"center",id:s,head:t.title,body:{view:"form",rules:{Name:webix.rules.isNotEmpty},elements:[{view:"text",label:t.editTitle,name:"Name",labelPosition:"top",required:"true"}].concat(t.additionalItems?t.additionalItems:[]).concat({cols:[{view:"button",value:t.okTitle,click:function(){var e=this.getFormView();!0!==t.confirm.apply(e,[].concat(e.getChildViews()).concat(o?o.getSelectedItem():[]))&&t.dialog.close()}},{view:"button",type:"danger",value:t.cancelTitle,click:function(){t.dialog.close(),t.abort&&t.abort()}}]})},on:{onShow:function(){i&&this.getChildViews()[1].getChildViews().forEach(function(e,n){void 0!=t.fillItems[n]&&e.setValue(o.getSelectedItem()[t.fillItems[n]])}),this.getChildViews()[1].getChildViews()[0].focus()},onDestruct:function(){e.hotKeyDispatcher.removePreset(s)}}})),!t.onBeforeShow||t.onBeforeShow&&t.onBeforeShow.apply(t,[o.getSelectedItem(),o])?t.dialog.show():t.dialog.close()}var n=this,o=[];this.editButtons=function(i){var s={},a=[],r=(o=mcService.Marge({buttons:[{additionalItems:[],type:"add",confirm:null,abort:null,addToContext:!1,showedInList:!0,css:"",contextCss:"",label:"",icon:"",contextIcon:"",title:"",editTitle:"",fillItems:[],delName:"",onBeforeShow:null,onBeforeDelete:null}],fillItems:[],list:null,vertical:!1,onHideContext:null,onShowContext:null,options:{modal:!0,head:"",width:300},contextOpt:{width:200}},i)).vertical?"rows":"cols";return o.buttons.forEach(function(i){function s(){i.addToContext&&n.contextMenu&&n.contextMenu&&n.contextMenu.hide()}var r={};switch(i.type){case"add":r={view:"button",click:function(){s(),t(i,o.options,o.list)}};break;case"edit":r={view:"button",click:function(){s(),t(i,o.options,o.list,!0)}};break;case"del":r={view:"button",type:"danger",click:function(){s(),mcService.isString(o.list)&&(o.list=$$(o.list));var t=o.list.getSelectedItem();t&&(!i.onBeforeDelete||i.onBeforeDelete&&i.onBeforeDelete.apply(i,[t,o.list]))&&e.$broadcast("addShowedWindow",[mcService.RandomHash(4),webix.confirm({type:"confirm-warning",text:mcService.myReplace(i.title,i.delName?t[i.delName]:null),ok:i.delTitle,cancel:i.cancelTitle,callback:function(e){e&&i.confirm(t)}})])}}}i.fillItems&&i.fillItems.length||(i.fillItems=o.fillItems),r._opt=i,a.push(r)}),s[r]=[],a.forEach(function(e){var t=mcService.Marge({},e);t._opt.confirm&&t._opt.showedInList&&(t._opt.icon?(t.type="icon",t.icon=t._opt.icon,t.label=t._opt.label):t.value=t._opt.label,t.css=t._opt.css||void 0,s[r].push(mcService.Marge({},t)))}),s[r].length||(s.width=1,s.height=1),{btnList:s,emitAction:function(e,n){mcService.isString(e)&&isNaN(parseInt(e))&&(e=mcService.findItemInArrayOfObj(o.buttons,e,"name")),o.buttons[e]&&t(o.buttons[e],o.options,n)},hideContext:function(){n.contextMenu&&n.contextMenu.hide()},attachContext:function(){if(!n.contextMenu){var e=[];a.forEach(function(t){var n=mcService.Marge({},t);n._opt.confirm&&n._opt.addToContext&&(n._opt.contextIcon?(n.type="icon",n.icon=n._opt.contextIcon,n.label=n._opt.label):n.value=n._opt.label,o.contextOpt.btnHeight&&(n.height=o.contextOpt.btnHeight),n.css=n._opt.contextCss||void 0,n._opt=mcService.Marge({okTitle:mcLang(28),cancelTitle:mcLang(29),delTitle:mcLang(581)},n._opt),e.push(mcService.Marge({},n)))});var t=mcService.Marge(o.contextOpt,{view:"context",master:mcService.isString(o.list)?$$(o.list):o.list,body:{rows:e},on:{}});o.onShowContext&&(t.on.onShow=o.onShowContext),o.onHideContext&&(t.on.onHide=o.onHideContext),e&&e.length&&(n.contextMenu=webix.ui(t))}}}}}:console.error("window.mcWidgets is not defined!"),!window.old_IE){var units=[].concat({module:"mcPlaySound",args:["$rootScope"]}).concat({module:"mcConnect",args:[]}).concat({module:"mcCmdLoop",args:["mcConnect","$rootScope"]}).concat({module:"CallStates",args:[]}).concat({module:"MediaCall",args:[]}).concat({module:"mcMedia",args:["mcPlaySound","$rootScope","MediaCall","CallStates"]}).concat({module:"mcDialogsList",args:["$rootScope","mcPlaySound"]}).concat({module:"mcFileUploading",args:["$rootScope"]}).concat({module:"mcStorage",args:["$rootScope"]}).concat({module:"mcUploadProgress",args:["$rootScope"]}).concat("file:"===location.protocol?{module:"mcStatistics",args:["$rootScope"]}:[]).concat({module:"mcCmdParser",args:["mcConnect","$rootScope","mcPlaySound","mcStatistics"]}).concat({module:"mainController",args:["$scope","$rootScope","mcCmdParser","mcCmdLoop","$http","$location","mcStatistics"]}).concat({module:"loginController",args:["$scope","$rootScope","$location"]}).concat({module:"commonContactsController",args:["$scope","$rootScope"]}).concat({module:"personalContactsController",args:["$scope","$rootScope"]}).concat({module:"chatFrameController",args:["$scope","$rootScope","mcPlaySound"]}).concat({module:"confUserListController",args:["$scope","$rootScope"]}).concat({module:"confManagerController",args:["$scope","$rootScope"]}).concat({module:"dialogsController",args:["$scope","$rootScope","mcPlaySound"]}).concat({module:"mainMenuController",args:["$scope","$rootScope"]}).concat({module:"privateInfoController",args:["$scope","$rootScope","mcMedia","mcPlaySound"]}).concat({module:"userProfileController",args:["$scope","$rootScope"]}).concat({module:"chatWrapperController",args:["$scope","$rootScope"]}).concat({module:"bbsController",args:["$scope","$rootScope","mcPlaySound"]}).concat({module:"kanbanController",args:["$scope","$rootScope"]}).concat({module:"commonFilesController",args:["$scope","$rootScope"]}).concat({module:"historyDialogsController",args:["$scope","$rootScope"]}).concat({module:"broadcastController",args:["$scope","$rootScope"]}).concat("file:"===location.protocol?{module:"updateController",args:["$scope","$rootScope"]}:[]).concat("file:"===location.protocol?{module:"viewLogsController",args:["$scope","$rootScope"]}:[]).concat("file:"===location.protocol?{module:"serverManagerController",args:["$scope","$rootScope"]}:[]).concat("file:"===location.protocol?{module:"receiveFilesController",args:["$scope","$rootScope"]}:[]).concat("file:"===location.protocol?{module:"settingsController",args:["$scope","$rootScope"]}:[]);window.mcService=servicesController("chat"),window.mcLang=mcService.Lang,mcComponents.units(units).start()}
//# sourceMappingURL=chat.min.js.map